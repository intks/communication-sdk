"use strict";var A=Object.defineProperty;var k=(i,e,t)=>e in i?A(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var a=(i,e,t)=>k(i,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class y{constructor(e,t,n){a(this,"callbacks");a(this,"mediaManager");a(this,"subscriptionManager");a(this,"intervalId",null);this.callbacks=e,this.mediaManager=t,this.subscriptionManager=n}start(){this.stop(),this.intervalId=window.setInterval(()=>{this.mediaManager.media.forEach((e,t)=>{var d,g,S,b;const n=this.subscriptionManager.getSubscription(t)||{video:!0,audio:!0};let u=0;const r=e.analyser;if(r){const s=new Uint8Array(r.fftSize);r.getByteTimeDomainData(s);let f=0;for(let c=0;c<s.length;c++){const p=(s[c]-128)/128;f+=p*p}u=Math.min(1,Math.sqrt(f/s.length)*2)}const h=e.volume;e.volume=h*.6+u*.4,Math.abs(e.volume-h)>.02&&this.callbacks.onParticipantVolumeChanged&&this.callbacks.onParticipantVolumeChanged(t,e.volume);const m=((d=e.remoteStream)==null?void 0:d.getAudioTracks().some(s=>s.readyState==="live"))??!1,v=(e==null?void 0:e.videoElement)&&((g=e.videoElement)==null?void 0:g.videoWidth)>0&&((S=e.videoElement)==null?void 0:S.videoHeight)>0||(((b=e.remoteStream)==null?void 0:b.getVideoTracks().some(s=>s.readyState==="live"))??!1),o={hasAudio:n.audio&&m,hasVideo:n.video&&v,isActive:!!e.remoteStream&&(m||v),lastUpdated:Date.now()},l=e.streamStatus,M=l.hasAudio!==o.hasAudio||l.hasVideo!==o.hasVideo||l.isActive!==o.isActive;e.streamStatus=o,M&&this.callbacks.onStreamStatusChanged&&this.callbacks.onStreamStatusChanged(t,o)})},500)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}}exports.StatusMonitor=y;
