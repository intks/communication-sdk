"use strict";var hd=Object.defineProperty;var fd=(Tt,N,F)=>N in Tt?hd(Tt,N,{enumerable:!0,configurable:!0,writable:!0,value:F}):Tt[N]=F;var tt=(Tt,N,F)=>fd(Tt,typeof N!="symbol"?N+"":N,F);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var Ni=(Tt=>(Tt.MuteAudio="MUTE_AUDIO",Tt.UnmuteAudio="UNMUTE_AUDIO",Tt.MuteVideo="MUTE_VIDEO",Tt.UnmuteVideo="UNMUTE_VIDEO",Tt.StatusUpdate="STATUS_UPDATE",Tt))(Ni||{});async function pd(Tt,N,F){const Z={video:{deviceId:Tt?{ideal:Tt}:void 0,width:{ideal:N,max:N},height:{ideal:F,max:F}},audio:!1};try{return await navigator.mediaDevices.getUserMedia(Z)}catch(ue){throw ue}}async function od(Tt){return navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:Tt}},video:!1})}function ed(Tt){return{hasAudio:(Tt==null?void 0:Tt.getAudioTracks().some(N=>N.readyState==="live"&&N.enabled))??!1,hasVideo:(Tt==null?void 0:Tt.getVideoTracks().some(N=>N.readyState==="live"&&N.enabled))??!1}}const ad=Tt=>"type"in Tt;class gd{constructor(N,F,Z,ue,je){tt(this,"config");tt(this,"callbacks");tt(this,"publishManager");tt(this,"mediaManager");tt(this,"participantManager");this.config=N,this.callbacks=F,this.publishManager=Z,this.mediaManager=ue,this.participantManager=je}handleSeiMessage(N,F){const Z=F.payload instanceof ArrayBuffer?F.payload:F.payload instanceof Uint8Array?F.payload.buffer.slice(F.payload.byteOffset,F.payload.byteOffset+F.payload.byteLength):null;if(Z)try{const ue=JSON.parse(new TextDecoder().decode(Z));ad(ue)&&(this.applyCommand(ue),this.callbacks.onCommandReceived&&this.callbacks.onCommandReceived(ue))}catch{console.warn("Failed to parse SEI message")}}applyCommand(N){const F=N.targetParticipantId;if(!F)return;const ue={[Ni.MuteAudio]:()=>this.handleAudioControl(F,!1),[Ni.UnmuteAudio]:()=>this.handleAudioControl(F,!0),[Ni.MuteVideo]:()=>this.handleVideoControl(F,!1),[Ni.UnmuteVideo]:()=>this.handleVideoControl(F,!0),[Ni.StatusUpdate]:()=>this.handleStatusUpdate(F,N)}[N.type];ue&&ue()}handleAudioControl(N,F){const Z=this.participantManager.getSelfId();!Z||N!==Z||(this.publishManager.setLocalAudioEnabled(F),this.updateAndBroadcastStatus(Z))}handleVideoControl(N,F){const Z=this.participantManager.getSelfId();!Z||N!==Z||(this.publishManager.setLocalVideoEnabled(F),this.updateAndBroadcastStatus(Z))}updateAndBroadcastStatus(N){const F=this.publishManager.getLocalStream(),{hasAudio:Z,hasVideo:ue}=ed(F);this.mediaManager.setRemoteControlState(N,"audio",Z),this.mediaManager.setRemoteControlState(N,"video",ue),this.sendSeiMessage({type:Ni.StatusUpdate,targetParticipantId:N,data:{hasAudio:Z,hasVideo:ue}})}handleStatusUpdate(N,F){if(!ad(F))return;const{hasAudio:Z,hasVideo:ue}=F.data;Z!==void 0&&this.mediaManager.setRemoteControlState(N,"audio",Z),ue!==void 0&&this.mediaManager.setRemoteControlState(N,"video",ue),console.log(`Status updated for ${N}:`,{hasAudio:Z,hasVideo:ue})}async broadcastCommand(N,F=3){return N.type===Ni.StatusUpdate?this.sendSeiMessage(N,F):this.config.role!=="admin"?!1:this.sendSeiMessage(N,F)}async sendSeiMessage(N,F=3){const Z=this.publishManager.getRawVideoStream();if(!Z)return console.warn("No video stream available for SEI message"),!1;const ue=Z.mediaStreamTrack;if(!ue||ue.readyState!=="live")return console.warn("Video track is not ready for SEI message",{hasTrack:!!ue,readyState:ue==null?void 0:ue.readyState}),!1;const je=new TextEncoder().encode(JSON.stringify({...N,timestamp:Date.now()})),O=je.buffer.slice(je.byteOffset,je.byteOffset+je.byteLength);try{return await Z.insertSeiMessage(O,{repeatCount:F}),!0}catch{try{return await Z.insertSeiMessage(O),!0}catch{return!1}}}muteAudio(N){this.config.role==="admin"&&(this.broadcastCommand({type:Ni.MuteAudio,targetParticipantId:N}),this.callbacks.onParticipantMuted&&this.callbacks.onParticipantMuted(N,"audio"),this.mediaManager.setRemoteControlState(N,"audio",!1))}unmuteAudio(N){this.config.role==="admin"&&(this.broadcastCommand({type:Ni.UnmuteAudio,targetParticipantId:N}),this.callbacks.onParticipantUnmuted&&this.callbacks.onParticipantUnmuted(N,"audio"),this.mediaManager.setRemoteControlState(N,"audio",!0))}muteVideo(N){this.config.role==="admin"&&(this.broadcastCommand({type:Ni.MuteVideo,targetParticipantId:N}),this.callbacks.onParticipantMuted&&this.callbacks.onParticipantMuted(N,"video"),this.mediaManager.setRemoteControlState(N,"video",!1))}unmuteVideo(N){this.config.role==="admin"&&(this.broadcastCommand({type:Ni.UnmuteVideo,targetParticipantId:N}),this.callbacks.onParticipantUnmuted&&this.callbacks.onParticipantUnmuted(N,"video"),this.mediaManager.setRemoteControlState(N,"video",!0))}}class md{constructor(N,F,Z){tt(this,"callbacks");tt(this,"subscriptionManager");tt(this,"participantManager");tt(this,"audioContext",null);tt(this,"isSafari",/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent));tt(this,"media",new Map);this.callbacks=N,this.subscriptionManager=F,this.participantManager=Z}initializeParticipant(N){this.media.set(N,{remoteStream:null,videoElement:null,audioElement:null,audioContext:null,analyser:null,source:null,volume:0,streamStatus:{hasAudio:!1,hasVideo:!1,isActive:!1,lastUpdated:Date.now()},remoteControlState:null})}addStreams(N,F){let Z=this.media.get(N);Z||(this.initializeParticipant(N),Z=this.media.get(N));const ue=F.map(O=>O.mediaStreamTrack).filter(O=>O);let je;return Z!=null&&Z.remoteStream?(je=Z.remoteStream,ue.forEach(O=>{je.getTrackById(O.id)||je.addTrack(O)})):je=new MediaStream(ue),Z&&(Z.remoteStream=je),je}removeStreams(N,F){const Z=this.media.get(N);return Z!=null&&Z.remoteStream?(F.forEach(ue=>{ue.mediaStreamTrack&&Z.remoteStream.removeTrack(ue.mediaStreamTrack)}),Z.remoteStream.getAudioTracks().some(ue=>ue.readyState==="live")||this.cleanupAudio(N),this.updateVideoElement(N),Z.remoteStream.getTracks().length>0):!1}attachStreams(N){const F=this.media.get(N);if(!(F!=null&&F.remoteStream))return;this.updateVideoElement(N);const Z=this.participantManager.getSelfId();N!==Z&&F.remoteStream.getAudioTracks().length>0?this.setupAudioPlayback(N):N===Z&&(this.cleanupAudio(N),this.updateVideoElement(N)),this.updateStreamStatus(N)}updateVideoElement(N){const F=this.media.get(N);if(!(F!=null&&F.remoteStream)){console.warn(`No remote stream for participant ${N}`);return}if(F.videoElement)F.videoElement.srcObject=null,F.videoElement&&F.remoteStream&&(F.videoElement.srcObject=F.remoteStream,F.videoElement.play().catch(Z=>{console.error(`Failed to play video for ${N}:`,Z)}));else{const Z=document.createElement("video");Z.autoplay=!0,Z.playsInline=!0,Z.muted=!0,Z.srcObject=F.remoteStream,Z.play().catch(ue=>{console.error(`Failed to play video for ${N}:`,ue)}),F.videoElement=Z}}setupAudioPlayback(N){const F=this.media.get(N);if(!(F!=null&&F.remoteStream))return;if(!F.audioElement){const O=document.createElement("audio");O.autoplay=!0,O.muted=!1,O.controls=!1,O.style.display="none",document.body.appendChild(O),F.audioElement=O}if(F.audioElement.srcObject=F.remoteStream,F.audioElement.play().catch(()=>{}),this.isSafari)return;const Z=this.getAudioContext();if(!Z)return;const ue=Z.createMediaStreamSource(F.remoteStream),je=Z.createAnalyser();je.fftSize=256,je.smoothingTimeConstant=.8,ue.connect(je),F.audioContext=Z,F.source=ue,F.analyser=je}cleanupAudio(N){var Z;const F=this.media.get(N);F&&(F.audioElement&&(F.audioElement.pause(),F.audioElement.srcObject=null,(Z=F.audioElement.parentNode)==null||Z.removeChild(F.audioElement),F.audioElement=null),F.source&&(F.source.disconnect(),F.source=null),F.audioContext&&(F.audioContext.close().catch(()=>{}),F.audioContext=null),F.analyser=null)}updateSubscription(N){const F=this.media.get(N),Z=this.subscriptionManager.getSubscription(N);!(F!=null&&F.remoteStream)||!Z||(Z.audio&&F.remoteStream.getAudioTracks().length>0?this.setupAudioPlayback(N):this.cleanupAudio(N),this.updateStreamStatus(N))}updateStreamStatus(N){const F=this.media.get(N),Z=this.subscriptionManager.getSubscription(N)||{video:!0,audio:!0};if(!F)return;const{hasAudio:ue,hasVideo:je}=ed(F.remoteStream);let O=ue,k=je;F.remoteControlState?Date.now()-F.remoteControlState.lastUpdated<5e3?(F.remoteControlState.hasAudio!==void 0&&(O=F.remoteControlState.hasAudio),F.remoteControlState.hasVideo!==void 0&&(k=F.remoteControlState.hasVideo)):F.remoteControlState=null:console.log(`No remote control state for ${N}, using actual stream state`);const p={hasAudio:Z.audio&&O,hasVideo:Z.video&&k,isActive:!!F.remoteStream&&(O||k),lastUpdated:Date.now()},v=F.streamStatus,m=v.hasAudio!==p.hasAudio||v.hasVideo!==p.hasVideo||v.isActive!==p.isActive;F.streamStatus=p,m&&this.callbacks.onStreamStatusChanged&&this.callbacks.onStreamStatusChanged(N,p)}getVolume(N){var F;return((F=this.media.get(N))==null?void 0:F.volume)??0}getAnalyser(N){var F;return((F=this.media.get(N))==null?void 0:F.analyser)??null}cleanup(N){const F=this.media.get(N);F&&(F.streamStatus.isActive=!1,F.streamStatus.lastUpdated=Date.now(),this.callbacks.onStreamStatusChanged&&this.callbacks.onStreamStatusChanged(N,F.streamStatus),F.videoElement=null,this.cleanupAudio(N),F.remoteStream=null,F.volume=0,this.media.delete(N))}cleanupAll(){this.media.forEach((N,F)=>this.cleanup(F)),this.audioContext&&this.audioContext.state!=="closed"&&(this.audioContext.close().catch(()=>{}),this.audioContext=null)}forceRefreshVideoElement(N){const F=this.media.get(N);if(!(F!=null&&F.remoteStream)){console.warn(`No remote stream for participant ${N} to force refresh`);return}F.videoElement&&(F.videoElement.srcObject=null,F.videoElement=null),this.updateVideoElement(N)}setLocalStream(N,F){this.initializeParticipant(N);const Z=this.media.get(N);Z&&(Z.remoteStream=F,this.updateVideoElement(N),this.updateStreamStatus(N))}setRemoteControlState(N,F,Z){const ue=this.media.get(N);ue&&(ue.remoteControlState||(ue.remoteControlState={lastUpdated:Date.now()}),F==="audio"?ue.remoteControlState.hasAudio=Z:ue.remoteControlState.hasVideo=Z,ue.remoteControlState.lastUpdated=Date.now(),console.log("Remote control state set:",ue.remoteControlState),this.updateStreamStatus(N))}getAudioContext(){if(this.audioContext&&this.audioContext.state!=="closed")return this.audioContext;try{return this.audioContext=new AudioContext,this.audioContext.state==="suspended"&&this.audioContext.resume().catch(()=>{}),this.audioContext}catch{return null}}}class vd{constructor(N){tt(this,"participants",new Map);tt(this,"publishManager");tt(this,"selfId",null);this.publishManager=N}getSelfId(){return this.selfId}checkSelfParticipant(N,F){const Z=new Set(this.publishManager.getStreams().map(je=>{var O;return(O=je.mediaStreamTrack)==null?void 0:O.id}).filter(je=>je));F.some(je=>je.mediaStreamTrack&&Z.has(je.mediaStreamTrack.id))&&(this.selfId=N.id)}add(N){this.participants.set(N.id,N)}remove(N){this.participants.delete(N)}getParticipants(){return Array.from(this.participants.values()).map(({id:N,attributes:F,isPublishing:Z})=>({id:N,role:(F==null?void 0:F.role)||"user",isPublishing:!!Z}))}clear(){this.participants.clear()}}var sd={exports:{}};/*! For license information please see amazon-ivs-web-broadcast.js.LICENSE.txt */(function(Tt,N){(function(F,Z){Tt.exports=Z()})(self,()=>(()=>{var F={2505:(O,k,p)=>{O.exports=p(8015)},5592:(O,k,p)=>{var v=p(9516),m=p(7522),y=p(3948),E=p(9106),I=p(9615),S=p(2012),f=p(4202),b=p(4896),x=p(5845),D=p(8563),A=p(5656);O.exports=function(M){return new Promise(function(W,z){var q,ne=M.data,se=M.headers,he=M.responseType;function Oe(){M.cancelToken&&M.cancelToken.unsubscribe(q),M.signal&&M.signal.removeEventListener("abort",q)}v.isFormData(ne)&&v.isStandardBrowserEnv()&&delete se["Content-Type"];var H=new XMLHttpRequest;if(M.auth){var me=M.auth.username||"",ke=M.auth.password?unescape(encodeURIComponent(M.auth.password)):"";se.Authorization="Basic "+btoa(me+":"+ke)}var Ee=I(M.baseURL,M.url);function ee(){if(H){var le="getAllResponseHeaders"in H?S(H.getAllResponseHeaders()):null,ge={data:he&&he!=="text"&&he!=="json"?H.response:H.responseText,status:H.status,statusText:H.statusText,headers:le,config:M,request:H};m(function(De){W(De),Oe()},function(De){z(De),Oe()},ge),H=null}}if(H.open(M.method.toUpperCase(),E(Ee,M.params,M.paramsSerializer),!0),H.timeout=M.timeout,"onloadend"in H?H.onloadend=ee:H.onreadystatechange=function(){H&&H.readyState===4&&(H.status!==0||H.responseURL&&H.responseURL.indexOf("file:")===0)&&setTimeout(ee)},H.onabort=function(){H&&(z(new x("Request aborted",x.ECONNABORTED,M,H)),H=null)},H.onerror=function(){z(new x("Network Error",x.ERR_NETWORK,M,H,H)),H=null},H.ontimeout=function(){var le=M.timeout?"timeout of "+M.timeout+"ms exceeded":"timeout exceeded",ge=M.transitional||b;M.timeoutErrorMessage&&(le=M.timeoutErrorMessage),z(new x(le,ge.clarifyTimeoutError?x.ETIMEDOUT:x.ECONNABORTED,M,H)),H=null},v.isStandardBrowserEnv()){var J=(M.withCredentials||f(Ee))&&M.xsrfCookieName?y.read(M.xsrfCookieName):void 0;J&&(se[M.xsrfHeaderName]=J)}"setRequestHeader"in H&&v.forEach(se,function(le,ge){ne===void 0&&ge.toLowerCase()==="content-type"?delete se[ge]:H.setRequestHeader(ge,le)}),v.isUndefined(M.withCredentials)||(H.withCredentials=!!M.withCredentials),he&&he!=="json"&&(H.responseType=M.responseType),typeof M.onDownloadProgress=="function"&&H.addEventListener("progress",M.onDownloadProgress),typeof M.onUploadProgress=="function"&&H.upload&&H.upload.addEventListener("progress",M.onUploadProgress),(M.cancelToken||M.signal)&&(q=function(le){H&&(z(!le||le&&le.type?new D:le),H.abort(),H=null)},M.cancelToken&&M.cancelToken.subscribe(q),M.signal&&(M.signal.aborted?q():M.signal.addEventListener("abort",q))),ne||(ne=null);var X=A(Ee);X&&["http","https","file"].indexOf(X)===-1?z(new x("Unsupported protocol "+X+":",x.ERR_BAD_REQUEST,M)):H.send(ne)})}},8015:(O,k,p)=>{var v=p(9516),m=p(9012),y=p(5155),E=p(5343),I=function S(f){var b=new y(f),x=m(y.prototype.request,b);return v.extend(x,y.prototype,b),v.extend(x,b),x.create=function(D){return S(E(f,D))},x}(p(7412));I.Axios=y,I.CanceledError=p(8563),I.CancelToken=p(3191),I.isCancel=p(3864),I.VERSION=p(9641).version,I.toFormData=p(6440),I.AxiosError=p(5845),I.Cancel=I.CanceledError,I.all=function(S){return Promise.all(S)},I.spread=p(7980),I.isAxiosError=p(5019),O.exports=I,O.exports.default=I},3191:(O,k,p)=>{var v=p(8563);function m(y){if(typeof y!="function")throw new TypeError("executor must be a function.");var E;this.promise=new Promise(function(S){E=S});var I=this;this.promise.then(function(S){if(I._listeners){var f,b=I._listeners.length;for(f=0;f<b;f++)I._listeners[f](S);I._listeners=null}}),this.promise.then=function(S){var f,b=new Promise(function(x){I.subscribe(x),f=x}).then(S);return b.cancel=function(){I.unsubscribe(f)},b},y(function(S){I.reason||(I.reason=new v(S),E(I.reason))})}m.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},m.prototype.subscribe=function(y){this.reason?y(this.reason):this._listeners?this._listeners.push(y):this._listeners=[y]},m.prototype.unsubscribe=function(y){if(this._listeners){var E=this._listeners.indexOf(y);E!==-1&&this._listeners.splice(E,1)}},m.source=function(){var y;return{token:new m(function(E){y=E}),cancel:y}},O.exports=m},8563:(O,k,p)=>{var v=p(5845);function m(y){v.call(this,y??"canceled",v.ERR_CANCELED),this.name="CanceledError"}p(9516).inherits(m,v,{__CANCEL__:!0}),O.exports=m},3864:O=>{O.exports=function(k){return!(!k||!k.__CANCEL__)}},5155:(O,k,p)=>{var v=p(9516),m=p(9106),y=p(3471),E=p(4490),I=p(5343),S=p(9615),f=p(4841),b=f.validators;function x(D){this.defaults=D,this.interceptors={request:new y,response:new y}}x.prototype.request=function(D,A){typeof D=="string"?(A=A||{}).url=D:A=D||{},(A=I(this.defaults,A)).method?A.method=A.method.toLowerCase():this.defaults.method?A.method=this.defaults.method.toLowerCase():A.method="get";var M=A.transitional;M!==void 0&&f.assertOptions(M,{silentJSONParsing:b.transitional(b.boolean),forcedJSONParsing:b.transitional(b.boolean),clarifyTimeoutError:b.transitional(b.boolean)},!1);var W=[],z=!0;this.interceptors.request.forEach(function(me){typeof me.runWhen=="function"&&me.runWhen(A)===!1||(z=z&&me.synchronous,W.unshift(me.fulfilled,me.rejected))});var q,ne=[];if(this.interceptors.response.forEach(function(me){ne.push(me.fulfilled,me.rejected)}),!z){var se=[E,void 0];for(Array.prototype.unshift.apply(se,W),se=se.concat(ne),q=Promise.resolve(A);se.length;)q=q.then(se.shift(),se.shift());return q}for(var he=A;W.length;){var Oe=W.shift(),H=W.shift();try{he=Oe(he)}catch(me){H(me);break}}try{q=E(he)}catch(me){return Promise.reject(me)}for(;ne.length;)q=q.then(ne.shift(),ne.shift());return q},x.prototype.getUri=function(D){D=I(this.defaults,D);var A=S(D.baseURL,D.url);return m(A,D.params,D.paramsSerializer)},v.forEach(["delete","get","head","options"],function(D){x.prototype[D]=function(A,M){return this.request(I(M||{},{method:D,url:A,data:(M||{}).data}))}}),v.forEach(["post","put","patch"],function(D){function A(M){return function(W,z,q){return this.request(I(q||{},{method:D,headers:M?{"Content-Type":"multipart/form-data"}:{},url:W,data:z}))}}x.prototype[D]=A(),x.prototype[D+"Form"]=A(!0)}),O.exports=x},5845:(O,k,p)=>{var v=p(9516);function m(I,S,f,b,x){Error.call(this),this.message=I,this.name="AxiosError",S&&(this.code=S),f&&(this.config=f),b&&(this.request=b),x&&(this.response=x)}v.inherits(m,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var y=m.prototype,E={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(I){E[I]={value:I}}),Object.defineProperties(m,E),Object.defineProperty(y,"isAxiosError",{value:!0}),m.from=function(I,S,f,b,x,D){var A=Object.create(y);return v.toFlatObject(I,A,function(M){return M!==Error.prototype}),m.call(A,I.message,S,f,b,x),A.name=I.name,D&&Object.assign(A,D),A},O.exports=m},3471:(O,k,p)=>{var v=p(9516);function m(){this.handlers=[]}m.prototype.use=function(y,E,I){return this.handlers.push({fulfilled:y,rejected:E,synchronous:!!I&&I.synchronous,runWhen:I?I.runWhen:null}),this.handlers.length-1},m.prototype.eject=function(y){this.handlers[y]&&(this.handlers[y]=null)},m.prototype.forEach=function(y){v.forEach(this.handlers,function(E){E!==null&&y(E)})},O.exports=m},9615:(O,k,p)=>{var v=p(9137),m=p(4680);O.exports=function(y,E){return y&&!v(E)?m(y,E):E}},4490:(O,k,p)=>{var v=p(9516),m=p(2881),y=p(3864),E=p(7412),I=p(8563);function S(f){if(f.cancelToken&&f.cancelToken.throwIfRequested(),f.signal&&f.signal.aborted)throw new I}O.exports=function(f){return S(f),f.headers=f.headers||{},f.data=m.call(f,f.data,f.headers,f.transformRequest),f.headers=v.merge(f.headers.common||{},f.headers[f.method]||{},f.headers),v.forEach(["delete","get","head","post","put","patch","common"],function(b){delete f.headers[b]}),(f.adapter||E.adapter)(f).then(function(b){return S(f),b.data=m.call(f,b.data,b.headers,f.transformResponse),b},function(b){return y(b)||(S(f),b&&b.response&&(b.response.data=m.call(f,b.response.data,b.response.headers,f.transformResponse))),Promise.reject(b)})}},5343:(O,k,p)=>{var v=p(9516);O.exports=function(m,y){y=y||{};var E={};function I(A,M){return v.isPlainObject(A)&&v.isPlainObject(M)?v.merge(A,M):v.isPlainObject(M)?v.merge({},M):v.isArray(M)?M.slice():M}function S(A){return v.isUndefined(y[A])?v.isUndefined(m[A])?void 0:I(void 0,m[A]):I(m[A],y[A])}function f(A){if(!v.isUndefined(y[A]))return I(void 0,y[A])}function b(A){return v.isUndefined(y[A])?v.isUndefined(m[A])?void 0:I(void 0,m[A]):I(void 0,y[A])}function x(A){return A in y?I(m[A],y[A]):A in m?I(void 0,m[A]):void 0}var D={url:f,method:f,data:f,baseURL:b,transformRequest:b,transformResponse:b,paramsSerializer:b,timeout:b,timeoutMessage:b,withCredentials:b,adapter:b,responseType:b,xsrfCookieName:b,xsrfHeaderName:b,onUploadProgress:b,onDownloadProgress:b,decompress:b,maxContentLength:b,maxBodyLength:b,beforeRedirect:b,transport:b,httpAgent:b,httpsAgent:b,cancelToken:b,socketPath:b,responseEncoding:b,validateStatus:x};return v.forEach(Object.keys(m).concat(Object.keys(y)),function(A){var M=D[A]||S,W=M(A);v.isUndefined(W)&&M!==x||(E[A]=W)}),E}},7522:(O,k,p)=>{var v=p(5845);O.exports=function(m,y,E){var I=E.config.validateStatus;E.status&&I&&!I(E.status)?y(new v("Request failed with status code "+E.status,[v.ERR_BAD_REQUEST,v.ERR_BAD_RESPONSE][Math.floor(E.status/100)-4],E.config,E.request,E)):m(E)}},2881:(O,k,p)=>{var v=p(9516),m=p(7412);O.exports=function(y,E,I){var S=this||m;return v.forEach(I,function(f){y=f.call(S,y,E)}),y}},7412:(O,k,p)=>{var v=p(9516),m=p(7018),y=p(5845),E=p(4896),I=p(6440),S={"Content-Type":"application/x-www-form-urlencoded"};function f(D,A){!v.isUndefined(D)&&v.isUndefined(D["Content-Type"])&&(D["Content-Type"]=A)}var b,x={transitional:E,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(b=p(5592)),b),transformRequest:[function(D,A){if(m(A,"Accept"),m(A,"Content-Type"),v.isFormData(D)||v.isArrayBuffer(D)||v.isBuffer(D)||v.isStream(D)||v.isFile(D)||v.isBlob(D))return D;if(v.isArrayBufferView(D))return D.buffer;if(v.isURLSearchParams(D))return f(A,"application/x-www-form-urlencoded;charset=utf-8"),D.toString();var M,W=v.isObject(D),z=A&&A["Content-Type"];if((M=v.isFileList(D))||W&&z==="multipart/form-data"){var q=this.env&&this.env.FormData;return I(M?{"files[]":D}:D,q&&new q)}return W||z==="application/json"?(f(A,"application/json"),function(ne,se,he){if(v.isString(ne))try{return(se||JSON.parse)(ne),v.trim(ne)}catch(Oe){if(Oe.name!=="SyntaxError")throw Oe}return(0,JSON.stringify)(ne)}(D)):D}],transformResponse:[function(D){var A=this.transitional||x.transitional,M=A&&A.silentJSONParsing,W=A&&A.forcedJSONParsing,z=!M&&this.responseType==="json";if(z||W&&v.isString(D)&&D.length)try{return JSON.parse(D)}catch(q){if(z)throw q.name==="SyntaxError"?y.from(q,y.ERR_BAD_RESPONSE,this,null,this.response):q}return D}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:p(1534)},validateStatus:function(D){return D>=200&&D<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};v.forEach(["delete","get","head"],function(D){x.headers[D]={}}),v.forEach(["post","put","patch"],function(D){x.headers[D]=v.merge(S)}),O.exports=x},4896:O=>{O.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},9641:O=>{O.exports={version:"0.27.2"}},9012:O=>{O.exports=function(k,p){return function(){for(var v=new Array(arguments.length),m=0;m<v.length;m++)v[m]=arguments[m];return k.apply(p,v)}}},9106:(O,k,p)=>{var v=p(9516);function m(y){return encodeURIComponent(y).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}O.exports=function(y,E,I){if(!E)return y;var S;if(I)S=I(E);else if(v.isURLSearchParams(E))S=E.toString();else{var f=[];v.forEach(E,function(x,D){x!=null&&(v.isArray(x)?D+="[]":x=[x],v.forEach(x,function(A){v.isDate(A)?A=A.toISOString():v.isObject(A)&&(A=JSON.stringify(A)),f.push(m(D)+"="+m(A))}))}),S=f.join("&")}if(S){var b=y.indexOf("#");b!==-1&&(y=y.slice(0,b)),y+=(y.indexOf("?")===-1?"?":"&")+S}return y}},4680:O=>{O.exports=function(k,p){return p?k.replace(/\/+$/,"")+"/"+p.replace(/^\/+/,""):k}},3948:(O,k,p)=>{var v=p(9516);O.exports=v.isStandardBrowserEnv()?{write:function(m,y,E,I,S,f){var b=[];b.push(m+"="+encodeURIComponent(y)),v.isNumber(E)&&b.push("expires="+new Date(E).toGMTString()),v.isString(I)&&b.push("path="+I),v.isString(S)&&b.push("domain="+S),f===!0&&b.push("secure"),document.cookie=b.join("; ")},read:function(m){var y=document.cookie.match(new RegExp("(^|;\\s*)("+m+")=([^;]*)"));return y?decodeURIComponent(y[3]):null},remove:function(m){this.write(m,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},9137:O=>{O.exports=function(k){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(k)}},5019:(O,k,p)=>{var v=p(9516);O.exports=function(m){return v.isObject(m)&&m.isAxiosError===!0}},4202:(O,k,p)=>{var v=p(9516);O.exports=v.isStandardBrowserEnv()?function(){var m,y=/(msie|trident)/i.test(navigator.userAgent),E=document.createElement("a");function I(S){var f=S;return y&&(E.setAttribute("href",f),f=E.href),E.setAttribute("href",f),{href:E.href,protocol:E.protocol?E.protocol.replace(/:$/,""):"",host:E.host,search:E.search?E.search.replace(/^\?/,""):"",hash:E.hash?E.hash.replace(/^#/,""):"",hostname:E.hostname,port:E.port,pathname:E.pathname.charAt(0)==="/"?E.pathname:"/"+E.pathname}}return m=I(window.location.href),function(S){var f=v.isString(S)?I(S):S;return f.protocol===m.protocol&&f.host===m.host}}():function(){return!0}},7018:(O,k,p)=>{var v=p(9516);O.exports=function(m,y){v.forEach(m,function(E,I){I!==y&&I.toUpperCase()===y.toUpperCase()&&(m[y]=E,delete m[I])})}},1534:O=>{O.exports=null},2012:(O,k,p)=>{var v=p(9516),m=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];O.exports=function(y){var E,I,S,f={};return y&&v.forEach(y.split(`
`),function(b){if(S=b.indexOf(":"),E=v.trim(b.substr(0,S)).toLowerCase(),I=v.trim(b.substr(S+1)),E){if(f[E]&&m.indexOf(E)>=0)return;f[E]=E==="set-cookie"?(f[E]?f[E]:[]).concat([I]):f[E]?f[E]+", "+I:I}}),f}},5656:O=>{O.exports=function(k){var p=/^([-+\w]{1,25})(:?\/\/|:)/.exec(k);return p&&p[1]||""}},7980:O=>{O.exports=function(k){return function(p){return k.apply(null,p)}}},6440:(O,k,p)=>{var v=p(9516);O.exports=function(m,y){y=y||new FormData;var E=[];function I(S){return S===null?"":v.isDate(S)?S.toISOString():v.isArrayBuffer(S)||v.isTypedArray(S)?typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}return function S(f,b){if(v.isPlainObject(f)||v.isArray(f)){if(E.indexOf(f)!==-1)throw Error("Circular reference detected in "+b);E.push(f),v.forEach(f,function(x,D){if(!v.isUndefined(x)){var A,M=b?b+"."+D:D;if(x&&!b&&typeof x=="object"){if(v.endsWith(D,"{}"))x=JSON.stringify(x);else if(v.endsWith(D,"[]")&&(A=v.toArray(x)))return void A.forEach(function(W){!v.isUndefined(W)&&y.append(M,I(W))})}S(x,M)}}),E.pop()}else y.append(b,I(f))}(m),y}},4841:(O,k,p)=>{var v=p(9641).version,m=p(5845),y={};["object","boolean","number","function","string","symbol"].forEach(function(I,S){y[I]=function(f){return typeof f===I||"a"+(S<1?"n ":" ")+I}});var E={};y.transitional=function(I,S,f){function b(x,D){return"[Axios v"+v+"] Transitional option '"+x+"'"+D+(f?". "+f:"")}return function(x,D,A){if(I===!1)throw new m(b(D," has been removed"+(S?" in "+S:"")),m.ERR_DEPRECATED);return S&&!E[D]&&(E[D]=!0,console.warn(b(D," has been deprecated since v"+S+" and will be removed in the near future"))),!I||I(x,D,A)}},O.exports={assertOptions:function(I,S,f){if(typeof I!="object")throw new m("options must be an object",m.ERR_BAD_OPTION_VALUE);for(var b=Object.keys(I),x=b.length;x-- >0;){var D=b[x],A=S[D];if(A){var M=I[D],W=M===void 0||A(M,D,I);if(W!==!0)throw new m("option "+D+" must be "+W,m.ERR_BAD_OPTION_VALUE)}else if(f!==!0)throw new m("Unknown option "+D,m.ERR_BAD_OPTION)}},validators:y}},9516:(O,k,p)=>{var v,m=p(9012),y=Object.prototype.toString,E=(v=Object.create(null),function(H){var me=y.call(H);return v[me]||(v[me]=me.slice(8,-1).toLowerCase())});function I(H){return H=H.toLowerCase(),function(me){return E(me)===H}}function S(H){return Array.isArray(H)}function f(H){return H===void 0}var b=I("ArrayBuffer");function x(H){return H!==null&&typeof H=="object"}function D(H){if(E(H)!=="object")return!1;var me=Object.getPrototypeOf(H);return me===null||me===Object.prototype}var A=I("Date"),M=I("File"),W=I("Blob"),z=I("FileList");function q(H){return y.call(H)==="[object Function]"}var ne=I("URLSearchParams");function se(H,me){if(H!=null)if(typeof H!="object"&&(H=[H]),S(H))for(var ke=0,Ee=H.length;ke<Ee;ke++)me.call(null,H[ke],ke,H);else for(var ee in H)Object.prototype.hasOwnProperty.call(H,ee)&&me.call(null,H[ee],ee,H)}var he,Oe=(he=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(H){return he&&H instanceof he});O.exports={isArray:S,isArrayBuffer:b,isBuffer:function(H){return H!==null&&!f(H)&&H.constructor!==null&&!f(H.constructor)&&typeof H.constructor.isBuffer=="function"&&H.constructor.isBuffer(H)},isFormData:function(H){var me="[object FormData]";return H&&(typeof FormData=="function"&&H instanceof FormData||y.call(H)===me||q(H.toString)&&H.toString()===me)},isArrayBufferView:function(H){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(H):H&&H.buffer&&b(H.buffer)},isString:function(H){return typeof H=="string"},isNumber:function(H){return typeof H=="number"},isObject:x,isPlainObject:D,isUndefined:f,isDate:A,isFile:M,isBlob:W,isFunction:q,isStream:function(H){return x(H)&&q(H.pipe)},isURLSearchParams:ne,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:se,merge:function H(){var me={};function ke(J,X){D(me[X])&&D(J)?me[X]=H(me[X],J):D(J)?me[X]=H({},J):S(J)?me[X]=J.slice():me[X]=J}for(var Ee=0,ee=arguments.length;Ee<ee;Ee++)se(arguments[Ee],ke);return me},extend:function(H,me,ke){return se(me,function(Ee,ee){H[ee]=ke&&typeof Ee=="function"?m(Ee,ke):Ee}),H},trim:function(H){return H.trim?H.trim():H.replace(/^\s+|\s+$/g,"")},stripBOM:function(H){return H.charCodeAt(0)===65279&&(H=H.slice(1)),H},inherits:function(H,me,ke,Ee){H.prototype=Object.create(me.prototype,Ee),H.prototype.constructor=H,ke&&Object.assign(H.prototype,ke)},toFlatObject:function(H,me,ke){var Ee,ee,J,X={};me=me||{};do{for(ee=(Ee=Object.getOwnPropertyNames(H)).length;ee-- >0;)X[J=Ee[ee]]||(me[J]=H[J],X[J]=!0);H=Object.getPrototypeOf(H)}while(H&&(!ke||ke(H,me))&&H!==Object.prototype);return me},kindOf:E,kindOfTest:I,endsWith:function(H,me,ke){H=String(H),(ke===void 0||ke>H.length)&&(ke=H.length),ke-=me.length;var Ee=H.indexOf(me,ke);return Ee!==-1&&Ee===ke},toArray:function(H){if(!H)return null;var me=H.length;if(f(me))return null;for(var ke=new Array(me);me-- >0;)ke[me]=H[me];return ke},isTypedArray:Oe,isFileList:z}},6880:function(O){O.exports=function(k){var p={};function v(m){if(p[m])return p[m].exports;var y=p[m]={i:m,l:!1,exports:{}};return k[m].call(y.exports,y,y.exports,v),y.l=!0,y.exports}return v.m=k,v.c=p,v.d=function(m,y,E){v.o(m,y)||Object.defineProperty(m,y,{enumerable:!0,get:E})},v.r=function(m){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})},v.t=function(m,y){if(1&y&&(m=v(m)),8&y||4&y&&typeof m=="object"&&m&&m.__esModule)return m;var E=Object.create(null);if(v.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:m}),2&y&&typeof m!="string")for(var I in m)v.d(E,I,(function(S){return m[S]}).bind(null,I));return E},v.n=function(m){var y=m&&m.__esModule?function(){return m.default}:function(){return m};return v.d(y,"a",y),y},v.o=function(m,y){return Object.prototype.hasOwnProperty.call(m,y)},v.p="",v(v.s=90)}({17:function(k,p,v){p.__esModule=!0,p.default=void 0;var m=v(18),y=function(){function E(){}return E.getFirstMatch=function(I,S){var f=S.match(I);return f&&f.length>0&&f[1]||""},E.getSecondMatch=function(I,S){var f=S.match(I);return f&&f.length>1&&f[2]||""},E.matchAndReturnConst=function(I,S,f){if(I.test(S))return f},E.getWindowsVersionName=function(I){switch(I){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},E.getMacOSVersionName=function(I){var S=I.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(S.push(0),S[0]===10)switch(S[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},E.getAndroidVersionName=function(I){var S=I.split(".").splice(0,2).map(function(f){return parseInt(f,10)||0});if(S.push(0),!(S[0]===1&&S[1]<5))return S[0]===1&&S[1]<6?"Cupcake":S[0]===1&&S[1]>=6?"Donut":S[0]===2&&S[1]<2?"Eclair":S[0]===2&&S[1]===2?"Froyo":S[0]===2&&S[1]>2?"Gingerbread":S[0]===3?"Honeycomb":S[0]===4&&S[1]<1?"Ice Cream Sandwich":S[0]===4&&S[1]<4?"Jelly Bean":S[0]===4&&S[1]>=4?"KitKat":S[0]===5?"Lollipop":S[0]===6?"Marshmallow":S[0]===7?"Nougat":S[0]===8?"Oreo":S[0]===9?"Pie":void 0},E.getVersionPrecision=function(I){return I.split(".").length},E.compareVersions=function(I,S,f){f===void 0&&(f=!1);var b=E.getVersionPrecision(I),x=E.getVersionPrecision(S),D=Math.max(b,x),A=0,M=E.map([I,S],function(W){var z=D-E.getVersionPrecision(W),q=W+new Array(z+1).join(".0");return E.map(q.split("."),function(ne){return new Array(20-ne.length).join("0")+ne}).reverse()});for(f&&(A=D-Math.min(b,x)),D-=1;D>=A;){if(M[0][D]>M[1][D])return 1;if(M[0][D]===M[1][D]){if(D===A)return 0;D-=1}else if(M[0][D]<M[1][D])return-1}},E.map=function(I,S){var f,b=[];if(Array.prototype.map)return Array.prototype.map.call(I,S);for(f=0;f<I.length;f+=1)b.push(S(I[f]));return b},E.find=function(I,S){var f,b;if(Array.prototype.find)return Array.prototype.find.call(I,S);for(f=0,b=I.length;f<b;f+=1){var x=I[f];if(S(x,f))return x}},E.assign=function(I){for(var S,f,b=I,x=arguments.length,D=new Array(x>1?x-1:0),A=1;A<x;A++)D[A-1]=arguments[A];if(Object.assign)return Object.assign.apply(Object,[I].concat(D));var M=function(){var W=D[S];typeof W=="object"&&W!==null&&Object.keys(W).forEach(function(z){b[z]=W[z]})};for(S=0,f=D.length;S<f;S+=1)M();return I},E.getBrowserAlias=function(I){return m.BROWSER_ALIASES_MAP[I]},E.getBrowserTypeByAlias=function(I){return m.BROWSER_MAP[I]||""},E}();p.default=y,k.exports=p.default},18:function(k,p,v){p.__esModule=!0,p.ENGINE_MAP=p.OS_MAP=p.PLATFORMS_MAP=p.BROWSER_MAP=p.BROWSER_ALIASES_MAP=void 0,p.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},p.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},p.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},p.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},p.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(k,p,v){p.__esModule=!0,p.default=void 0;var m,y=(m=v(91))&&m.__esModule?m:{default:m},E=v(18);function I(f,b){for(var x=0;x<b.length;x++){var D=b[x];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(f,D.key,D)}}var S=function(){function f(){}var b,x,D;return f.getParser=function(A,M){if(M===void 0&&(M=!1),typeof A!="string")throw new Error("UserAgent should be a string");return new y.default(A,M)},f.parse=function(A){return new y.default(A).getResult()},b=f,D=[{key:"BROWSER_MAP",get:function(){return E.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return E.ENGINE_MAP}},{key:"OS_MAP",get:function(){return E.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return E.PLATFORMS_MAP}}],(x=null)&&I(b.prototype,x),D&&I(b,D),f}();p.default=S,k.exports=p.default},91:function(k,p,v){p.__esModule=!0,p.default=void 0;var m=f(v(92)),y=f(v(93)),E=f(v(94)),I=f(v(95)),S=f(v(17));function f(x){return x&&x.__esModule?x:{default:x}}var b=function(){function x(A,M){if(M===void 0&&(M=!1),A==null||A==="")throw new Error("UserAgent parameter can't be empty");this._ua=A,this.parsedResult={},M!==!0&&this.parse()}var D=x.prototype;return D.getUA=function(){return this._ua},D.test=function(A){return A.test(this._ua)},D.parseBrowser=function(){var A=this;this.parsedResult.browser={};var M=S.default.find(m.default,function(W){if(typeof W.test=="function")return W.test(A);if(W.test instanceof Array)return W.test.some(function(z){return A.test(z)});throw new Error("Browser's test function is not valid")});return M&&(this.parsedResult.browser=M.describe(this.getUA())),this.parsedResult.browser},D.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},D.getBrowserName=function(A){return A?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},D.getBrowserVersion=function(){return this.getBrowser().version},D.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},D.parseOS=function(){var A=this;this.parsedResult.os={};var M=S.default.find(y.default,function(W){if(typeof W.test=="function")return W.test(A);if(W.test instanceof Array)return W.test.some(function(z){return A.test(z)});throw new Error("Browser's test function is not valid")});return M&&(this.parsedResult.os=M.describe(this.getUA())),this.parsedResult.os},D.getOSName=function(A){var M=this.getOS().name;return A?String(M).toLowerCase()||"":M||""},D.getOSVersion=function(){return this.getOS().version},D.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},D.getPlatformType=function(A){A===void 0&&(A=!1);var M=this.getPlatform().type;return A?String(M).toLowerCase()||"":M||""},D.parsePlatform=function(){var A=this;this.parsedResult.platform={};var M=S.default.find(E.default,function(W){if(typeof W.test=="function")return W.test(A);if(W.test instanceof Array)return W.test.some(function(z){return A.test(z)});throw new Error("Browser's test function is not valid")});return M&&(this.parsedResult.platform=M.describe(this.getUA())),this.parsedResult.platform},D.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},D.getEngineName=function(A){return A?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},D.parseEngine=function(){var A=this;this.parsedResult.engine={};var M=S.default.find(I.default,function(W){if(typeof W.test=="function")return W.test(A);if(W.test instanceof Array)return W.test.some(function(z){return A.test(z)});throw new Error("Browser's test function is not valid")});return M&&(this.parsedResult.engine=M.describe(this.getUA())),this.parsedResult.engine},D.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},D.getResult=function(){return S.default.assign({},this.parsedResult)},D.satisfies=function(A){var M=this,W={},z=0,q={},ne=0;if(Object.keys(A).forEach(function(ee){var J=A[ee];typeof J=="string"?(q[ee]=J,ne+=1):typeof J=="object"&&(W[ee]=J,z+=1)}),z>0){var se=Object.keys(W),he=S.default.find(se,function(ee){return M.isOS(ee)});if(he){var Oe=this.satisfies(W[he]);if(Oe!==void 0)return Oe}var H=S.default.find(se,function(ee){return M.isPlatform(ee)});if(H){var me=this.satisfies(W[H]);if(me!==void 0)return me}}if(ne>0){var ke=Object.keys(q),Ee=S.default.find(ke,function(ee){return M.isBrowser(ee,!0)});if(Ee!==void 0)return this.compareVersion(q[Ee])}},D.isBrowser=function(A,M){M===void 0&&(M=!1);var W=this.getBrowserName().toLowerCase(),z=A.toLowerCase(),q=S.default.getBrowserTypeByAlias(z);return M&&q&&(z=q.toLowerCase()),z===W},D.compareVersion=function(A){var M=[0],W=A,z=!1,q=this.getBrowserVersion();if(typeof q=="string")return A[0]===">"||A[0]==="<"?(W=A.substr(1),A[1]==="="?(z=!0,W=A.substr(2)):M=[],A[0]===">"?M.push(1):M.push(-1)):A[0]==="="?W=A.substr(1):A[0]==="~"&&(z=!0,W=A.substr(1)),M.indexOf(S.default.compareVersions(q,W,z))>-1},D.isOS=function(A){return this.getOSName(!0)===String(A).toLowerCase()},D.isPlatform=function(A){return this.getPlatformType(!0)===String(A).toLowerCase()},D.isEngine=function(A){return this.getEngineName(!0)===String(A).toLowerCase()},D.is=function(A,M){return M===void 0&&(M=!1),this.isBrowser(A,M)||this.isOS(A)||this.isPlatform(A)},D.some=function(A){var M=this;return A===void 0&&(A=[]),A.some(function(W){return M.is(W)})},x}();p.default=b,k.exports=p.default},92:function(k,p,v){p.__esModule=!0,p.default=void 0;var m,y=(m=v(17))&&m.__esModule?m:{default:m},E=/version\/(\d+(\.?_?\d+)+)/i,I=[{test:[/googlebot/i],describe:function(S){var f={name:"Googlebot"},b=y.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/opera/i],describe:function(S){var f={name:"Opera"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/opr\/|opios/i],describe:function(S){var f={name:"Opera"},b=y.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/SamsungBrowser/i],describe:function(S){var f={name:"Samsung Internet for Android"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/Whale/i],describe:function(S){var f={name:"NAVER Whale Browser"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/MZBrowser/i],describe:function(S){var f={name:"MZ Browser"},b=y.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/focus/i],describe:function(S){var f={name:"Focus"},b=y.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/swing/i],describe:function(S){var f={name:"Swing"},b=y.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/coast/i],describe:function(S){var f={name:"Opera Coast"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(S){var f={name:"Opera Touch"},b=y.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/yabrowser/i],describe:function(S){var f={name:"Yandex Browser"},b=y.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/ucbrowser/i],describe:function(S){var f={name:"UC Browser"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/Maxthon|mxios/i],describe:function(S){var f={name:"Maxthon"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/epiphany/i],describe:function(S){var f={name:"Epiphany"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/puffin/i],describe:function(S){var f={name:"Puffin"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/sleipnir/i],describe:function(S){var f={name:"Sleipnir"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/k-meleon/i],describe:function(S){var f={name:"K-Meleon"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/micromessenger/i],describe:function(S){var f={name:"WeChat"},b=y.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/qqbrowser/i],describe:function(S){var f={name:/qqbrowserlite/i.test(S)?"QQ Browser Lite":"QQ Browser"},b=y.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/msie|trident/i],describe:function(S){var f={name:"Internet Explorer"},b=y.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/\sedg\//i],describe:function(S){var f={name:"Microsoft Edge"},b=y.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/edg([ea]|ios)/i],describe:function(S){var f={name:"Microsoft Edge"},b=y.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/vivaldi/i],describe:function(S){var f={name:"Vivaldi"},b=y.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/seamonkey/i],describe:function(S){var f={name:"SeaMonkey"},b=y.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/sailfish/i],describe:function(S){var f={name:"Sailfish"},b=y.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,S);return b&&(f.version=b),f}},{test:[/silk/i],describe:function(S){var f={name:"Amazon Silk"},b=y.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/phantom/i],describe:function(S){var f={name:"PhantomJS"},b=y.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/slimerjs/i],describe:function(S){var f={name:"SlimerJS"},b=y.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(S){var f={name:"BlackBerry"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/(web|hpw)[o0]s/i],describe:function(S){var f={name:"WebOS Browser"},b=y.default.getFirstMatch(E,S)||y.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/bada/i],describe:function(S){var f={name:"Bada"},b=y.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/tizen/i],describe:function(S){var f={name:"Tizen"},b=y.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/qupzilla/i],describe:function(S){var f={name:"QupZilla"},b=y.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/firefox|iceweasel|fxios/i],describe:function(S){var f={name:"Firefox"},b=y.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/electron/i],describe:function(S){var f={name:"Electron"},b=y.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/MiuiBrowser/i],describe:function(S){var f={name:"Miui"},b=y.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/chromium/i],describe:function(S){var f={name:"Chromium"},b=y.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,S)||y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/chrome|crios|crmo/i],describe:function(S){var f={name:"Chrome"},b=y.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/GSA/i],describe:function(S){var f={name:"Google Search"},b=y.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:function(S){var f=!S.test(/like android/i),b=S.test(/android/i);return f&&b},describe:function(S){var f={name:"Android Browser"},b=y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/playstation 4/i],describe:function(S){var f={name:"PlayStation 4"},b=y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/safari|applewebkit/i],describe:function(S){var f={name:"Safari"},b=y.default.getFirstMatch(E,S);return b&&(f.version=b),f}},{test:[/.*/i],describe:function(S){var f=S.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:y.default.getFirstMatch(f,S),version:y.default.getSecondMatch(f,S)}}}];p.default=I,k.exports=p.default},93:function(k,p,v){p.__esModule=!0,p.default=void 0;var m,y=(m=v(17))&&m.__esModule?m:{default:m},E=v(18),I=[{test:[/Roku\/DVP/],describe:function(S){var f=y.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,S);return{name:E.OS_MAP.Roku,version:f}}},{test:[/windows phone/i],describe:function(S){var f=y.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,S);return{name:E.OS_MAP.WindowsPhone,version:f}}},{test:[/windows /i],describe:function(S){var f=y.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,S),b=y.default.getWindowsVersionName(f);return{name:E.OS_MAP.Windows,version:f,versionName:b}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(S){var f={name:E.OS_MAP.iOS},b=y.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,S);return b&&(f.version=b),f}},{test:[/macintosh/i],describe:function(S){var f=y.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,S).replace(/[_\s]/g,"."),b=y.default.getMacOSVersionName(f),x={name:E.OS_MAP.MacOS,version:f};return b&&(x.versionName=b),x}},{test:[/(ipod|iphone|ipad)/i],describe:function(S){var f=y.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,S).replace(/[_\s]/g,".");return{name:E.OS_MAP.iOS,version:f}}},{test:function(S){var f=!S.test(/like android/i),b=S.test(/android/i);return f&&b},describe:function(S){var f=y.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,S),b=y.default.getAndroidVersionName(f),x={name:E.OS_MAP.Android,version:f};return b&&(x.versionName=b),x}},{test:[/(web|hpw)[o0]s/i],describe:function(S){var f=y.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,S),b={name:E.OS_MAP.WebOS};return f&&f.length&&(b.version=f),b}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(S){var f=y.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,S)||y.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,S)||y.default.getFirstMatch(/\bbb(\d+)/i,S);return{name:E.OS_MAP.BlackBerry,version:f}}},{test:[/bada/i],describe:function(S){var f=y.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,S);return{name:E.OS_MAP.Bada,version:f}}},{test:[/tizen/i],describe:function(S){var f=y.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,S);return{name:E.OS_MAP.Tizen,version:f}}},{test:[/linux/i],describe:function(){return{name:E.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:E.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(S){var f=y.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,S);return{name:E.OS_MAP.PlayStation4,version:f}}}];p.default=I,k.exports=p.default},94:function(k,p,v){p.__esModule=!0,p.default=void 0;var m,y=(m=v(17))&&m.__esModule?m:{default:m},E=v(18),I=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(S){var f=y.default.getFirstMatch(/(can-l01)/i,S)&&"Nova",b={type:E.PLATFORMS_MAP.mobile,vendor:"Huawei"};return f&&(b.model=f),b}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:E.PLATFORMS_MAP.tablet}}},{test:function(S){var f=S.test(/ipod|iphone/i),b=S.test(/like (ipod|iphone)/i);return f&&!b},describe:function(S){var f=y.default.getFirstMatch(/(ipod|iphone)/i,S);return{type:E.PLATFORMS_MAP.mobile,vendor:"Apple",model:f}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:E.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:E.PLATFORMS_MAP.mobile}}},{test:function(S){return S.getBrowserName(!0)==="blackberry"},describe:function(){return{type:E.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(S){return S.getBrowserName(!0)==="bada"},describe:function(){return{type:E.PLATFORMS_MAP.mobile}}},{test:function(S){return S.getBrowserName()==="windows phone"},describe:function(){return{type:E.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(S){var f=Number(String(S.getOSVersion()).split(".")[0]);return S.getOSName(!0)==="android"&&f>=3},describe:function(){return{type:E.PLATFORMS_MAP.tablet}}},{test:function(S){return S.getOSName(!0)==="android"},describe:function(){return{type:E.PLATFORMS_MAP.mobile}}},{test:function(S){return S.getOSName(!0)==="macos"},describe:function(){return{type:E.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(S){return S.getOSName(!0)==="windows"},describe:function(){return{type:E.PLATFORMS_MAP.desktop}}},{test:function(S){return S.getOSName(!0)==="linux"},describe:function(){return{type:E.PLATFORMS_MAP.desktop}}},{test:function(S){return S.getOSName(!0)==="playstation 4"},describe:function(){return{type:E.PLATFORMS_MAP.tv}}},{test:function(S){return S.getOSName(!0)==="roku"},describe:function(){return{type:E.PLATFORMS_MAP.tv}}}];p.default=I,k.exports=p.default},95:function(k,p,v){p.__esModule=!0,p.default=void 0;var m,y=(m=v(17))&&m.__esModule?m:{default:m},E=v(18),I=[{test:function(S){return S.getBrowserName(!0)==="microsoft edge"},describe:function(S){if(/\sedg\//i.test(S))return{name:E.ENGINE_MAP.Blink};var f=y.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,S);return{name:E.ENGINE_MAP.EdgeHTML,version:f}}},{test:[/trident/i],describe:function(S){var f={name:E.ENGINE_MAP.Trident},b=y.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:function(S){return S.test(/presto/i)},describe:function(S){var f={name:E.ENGINE_MAP.Presto},b=y.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:function(S){var f=S.test(/gecko/i),b=S.test(/like gecko/i);return f&&!b},describe:function(S){var f={name:E.ENGINE_MAP.Gecko},b=y.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:E.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(S){var f={name:E.ENGINE_MAP.WebKit},b=y.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,S);return b&&(f.version=b),f}}];p.default=I,k.exports=p.default}})},228:O=>{var k=Object.prototype.hasOwnProperty,p="~";function v(){}function m(S,f,b){this.fn=S,this.context=f,this.once=b||!1}function y(S,f,b,x,D){if(typeof b!="function")throw new TypeError("The listener must be a function");var A=new m(b,x||S,D),M=p?p+f:f;return S._events[M]?S._events[M].fn?S._events[M]=[S._events[M],A]:S._events[M].push(A):(S._events[M]=A,S._eventsCount++),S}function E(S,f){--S._eventsCount==0?S._events=new v:delete S._events[f]}function I(){this._events=new v,this._eventsCount=0}Object.create&&(v.prototype=Object.create(null),new v().__proto__||(p=!1)),I.prototype.eventNames=function(){var S,f,b=[];if(this._eventsCount===0)return b;for(f in S=this._events)k.call(S,f)&&b.push(p?f.slice(1):f);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(S)):b},I.prototype.listeners=function(S){var f=p?p+S:S,b=this._events[f];if(!b)return[];if(b.fn)return[b.fn];for(var x=0,D=b.length,A=new Array(D);x<D;x++)A[x]=b[x].fn;return A},I.prototype.listenerCount=function(S){var f=p?p+S:S,b=this._events[f];return b?b.fn?1:b.length:0},I.prototype.emit=function(S,f,b,x,D,A){var M=p?p+S:S;if(!this._events[M])return!1;var W,z,q=this._events[M],ne=arguments.length;if(q.fn){switch(q.once&&this.removeListener(S,q.fn,void 0,!0),ne){case 1:return q.fn.call(q.context),!0;case 2:return q.fn.call(q.context,f),!0;case 3:return q.fn.call(q.context,f,b),!0;case 4:return q.fn.call(q.context,f,b,x),!0;case 5:return q.fn.call(q.context,f,b,x,D),!0;case 6:return q.fn.call(q.context,f,b,x,D,A),!0}for(z=1,W=new Array(ne-1);z<ne;z++)W[z-1]=arguments[z];q.fn.apply(q.context,W)}else{var se,he=q.length;for(z=0;z<he;z++)switch(q[z].once&&this.removeListener(S,q[z].fn,void 0,!0),ne){case 1:q[z].fn.call(q[z].context);break;case 2:q[z].fn.call(q[z].context,f);break;case 3:q[z].fn.call(q[z].context,f,b);break;case 4:q[z].fn.call(q[z].context,f,b,x);break;default:if(!W)for(se=1,W=new Array(ne-1);se<ne;se++)W[se-1]=arguments[se];q[z].fn.apply(q[z].context,W)}}return!0},I.prototype.on=function(S,f,b){return y(this,S,f,b,!1)},I.prototype.once=function(S,f,b){return y(this,S,f,b,!0)},I.prototype.removeListener=function(S,f,b,x){var D=p?p+S:S;if(!this._events[D])return this;if(!f)return E(this,D),this;var A=this._events[D];if(A.fn)A.fn!==f||x&&!A.once||b&&A.context!==b||E(this,D);else{for(var M=0,W=[],z=A.length;M<z;M++)(A[M].fn!==f||x&&!A[M].once||b&&A[M].context!==b)&&W.push(A[M]);W.length?this._events[D]=W.length===1?W[0]:W:E(this,D)}return this},I.prototype.removeAllListeners=function(S){var f;return S?(f=p?p+S:S,this._events[f]&&E(this,f)):(this._events=new v,this._eventsCount=0),this},I.prototype.off=I.prototype.removeListener,I.prototype.addListener=I.prototype.on,I.prefixed=p,I.EventEmitter=I,O.exports=I},8954:function(O){var k;k=()=>(()=>{var p={228:y=>{var E=Object.prototype.hasOwnProperty,I="~";function S(){}function f(A,M,W){this.fn=A,this.context=M,this.once=W||!1}function b(A,M,W,z,q){if(typeof W!="function")throw new TypeError("The listener must be a function");var ne=new f(W,z||A,q),se=I?I+M:M;return A._events[se]?A._events[se].fn?A._events[se]=[A._events[se],ne]:A._events[se].push(ne):(A._events[se]=ne,A._eventsCount++),A}function x(A,M){--A._eventsCount==0?A._events=new S:delete A._events[M]}function D(){this._events=new S,this._eventsCount=0}Object.create&&(S.prototype=Object.create(null),new S().__proto__||(I=!1)),D.prototype.eventNames=function(){var A,M,W=[];if(this._eventsCount===0)return W;for(M in A=this._events)E.call(A,M)&&W.push(I?M.slice(1):M);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(A)):W},D.prototype.listeners=function(A){var M=I?I+A:A,W=this._events[M];if(!W)return[];if(W.fn)return[W.fn];for(var z=0,q=W.length,ne=new Array(q);z<q;z++)ne[z]=W[z].fn;return ne},D.prototype.listenerCount=function(A){var M=I?I+A:A,W=this._events[M];return W?W.fn?1:W.length:0},D.prototype.emit=function(A,M,W,z,q,ne){var se=I?I+A:A;if(!this._events[se])return!1;var he,Oe,H=this._events[se],me=arguments.length;if(H.fn){switch(H.once&&this.removeListener(A,H.fn,void 0,!0),me){case 1:return H.fn.call(H.context),!0;case 2:return H.fn.call(H.context,M),!0;case 3:return H.fn.call(H.context,M,W),!0;case 4:return H.fn.call(H.context,M,W,z),!0;case 5:return H.fn.call(H.context,M,W,z,q),!0;case 6:return H.fn.call(H.context,M,W,z,q,ne),!0}for(Oe=1,he=new Array(me-1);Oe<me;Oe++)he[Oe-1]=arguments[Oe];H.fn.apply(H.context,he)}else{var ke,Ee=H.length;for(Oe=0;Oe<Ee;Oe++)switch(H[Oe].once&&this.removeListener(A,H[Oe].fn,void 0,!0),me){case 1:H[Oe].fn.call(H[Oe].context);break;case 2:H[Oe].fn.call(H[Oe].context,M);break;case 3:H[Oe].fn.call(H[Oe].context,M,W);break;case 4:H[Oe].fn.call(H[Oe].context,M,W,z);break;default:if(!he)for(ke=1,he=new Array(me-1);ke<me;ke++)he[ke-1]=arguments[ke];H[Oe].fn.apply(H[Oe].context,he)}}return!0},D.prototype.on=function(A,M,W){return b(this,A,M,W,!1)},D.prototype.once=function(A,M,W){return b(this,A,M,W,!0)},D.prototype.removeListener=function(A,M,W,z){var q=I?I+A:A;if(!this._events[q])return this;if(!M)return x(this,q),this;var ne=this._events[q];if(ne.fn)ne.fn!==M||z&&!ne.once||W&&ne.context!==W||x(this,q);else{for(var se=0,he=[],Oe=ne.length;se<Oe;se++)(ne[se].fn!==M||z&&!ne[se].once||W&&ne[se].context!==W)&&he.push(ne[se]);he.length?this._events[q]=he.length===1?he[0]:he:x(this,q)}return this},D.prototype.removeAllListeners=function(A){var M;return A?(M=I?I+A:A,this._events[M]&&x(this,M)):(this._events=new S,this._eventsCount=0),this},D.prototype.off=D.prototype.removeListener,D.prototype.addListener=D.prototype.on,D.prefixed=I,D.EventEmitter=D,y.exports=D},543:function(y,E,I){var S;y=I.nmd(y),(function(){var f,b="Expected a function",x="__lodash_hash_undefined__",D="__lodash_placeholder__",A=32,M=128,W=1/0,z=9007199254740991,q=NaN,ne=4294967295,se=[["ary",M],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",A],["partialRight",64],["rearg",256]],he="[object Arguments]",Oe="[object Array]",H="[object Boolean]",me="[object Date]",ke="[object Error]",Ee="[object Function]",ee="[object GeneratorFunction]",J="[object Map]",X="[object Number]",le="[object Object]",ge="[object Promise]",De="[object RegExp]",Ie="[object Set]",_t="[object String]",bn="[object Symbol]",Yt="[object WeakMap]",Nn="[object ArrayBuffer]",kn="[object DataView]",Ur="[object Float32Array]",Tr="[object Float64Array]",gr="[object Int8Array]",$n="[object Int16Array]",jr="[object Int32Array]",Cr="[object Uint8Array]",Ir="[object Uint8ClampedArray]",qe="[object Uint16Array]",Zr="[object Uint32Array]",Ks=/\b__p \+= '';/g,un=/\b(__p \+=) '' \+/g,os=/(__e\(.*?\)|\b__t\)) \+\n'';/g,as=/&(?:amp|lt|gt|quot|#39);/g,sa=/[&<>"']/g,bo=RegExp(as.source),er=RegExp(sa.source),To=/<%-([\s\S]+?)%>/g,Mi=/<%([\s\S]+?)%>/g,eo=/<%=([\s\S]+?)%>/g,ss=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Li=/^\w*$/,Co=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ei=/[\\^$.*+?()[\]{}|]/g,cs=RegExp(ei.source),Rt=/^\s+/,Ft=/\s/,us=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Wc=/\{\n\/\* \[wrapped with (.+)\] \*/,zn=/,? & /,Ke=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Js=/[()=,{}\[\]\/\s]/,Si=/\\(\\)?/g,Ys=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Io=/\w*$/,ca=/^[-+]0x[0-9a-f]+$/i,Ro=/^0b[01]+$/i,Y=/^\[object .+?Constructor\]$/,ie=/^0o[0-7]+$/i,fe=/^(?:0|[1-9]\d*)$/,Te=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Xe=/($^)/,tn=/['\n\r\u2028\u2029\\]/g,it="\\ud800-\\udfff",nt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ue="\\u2700-\\u27bf",we="a-z\\xdf-\\xf6\\xf8-\\xff",Ge="A-Z\\xc0-\\xd6\\xd8-\\xde",He="\\ufe0e\\ufe0f",St="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Vt="["+it+"]",$t="["+St+"]",Tn="["+nt+"]",ua="\\d+",la="["+Ue+"]",Qs="["+we+"]",ls="[^"+it+St+ua+Ue+we+Ge+"]",ds="\\ud83c[\\udffb-\\udfff]",hs="[^"+it+"]",da="(?:\\ud83c[\\udde6-\\uddff]){2}",xi="[\\ud800-\\udbff][\\udc00-\\udfff]",wo="["+Ge+"]",Hc="\\u200d",ha="(?:"+Qs+"|"+ls+")",fa="(?:"+wo+"|"+ls+")",Oo="(?:['’](?:d|ll|m|re|s|t|ve))?",Ao="(?:['’](?:D|LL|M|RE|S|T|VE))?",ko="(?:"+Tn+"|"+ds+")?",pa="["+He+"]?",fs=pa+ko+"(?:"+Hc+"(?:"+[hs,da,xi].join("|")+")"+pa+ko+")*",Xs="(?:"+[la,da,xi].join("|")+")"+fs,$c="(?:"+[hs+Tn+"?",Tn,da,xi,Vt].join("|")+")",Fr=RegExp("['’]","g"),Vr=RegExp(Tn,"g"),ga=RegExp(ds+"(?="+ds+")|"+$c+fs,"g"),Pu=RegExp([wo+"?"+Qs+"+"+Oo+"(?="+[$t,wo,"$"].join("|")+")",fa+"+"+Ao+"(?="+[$t,wo+ha,"$"].join("|")+")",wo+"?"+ha+"+"+Oo,wo+"+"+Ao,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ua,Xs].join("|"),"g"),pl=RegExp("["+Hc+it+nt+He+"]"),ps=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,zc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],zt=-1,Ye={};Ye[Ur]=Ye[Tr]=Ye[gr]=Ye[$n]=Ye[jr]=Ye[Cr]=Ye[Ir]=Ye[qe]=Ye[Zr]=!0,Ye[he]=Ye[Oe]=Ye[Nn]=Ye[H]=Ye[kn]=Ye[me]=Ye[ke]=Ye[Ee]=Ye[J]=Ye[X]=Ye[le]=Ye[De]=Ye[Ie]=Ye[_t]=Ye[Yt]=!1;var Gt={};Gt[he]=Gt[Oe]=Gt[Nn]=Gt[kn]=Gt[H]=Gt[me]=Gt[Ur]=Gt[Tr]=Gt[gr]=Gt[$n]=Gt[jr]=Gt[J]=Gt[X]=Gt[le]=Gt[De]=Gt[Ie]=Gt[_t]=Gt[bn]=Gt[Cr]=Gt[Ir]=Gt[qe]=Gt[Zr]=!0,Gt[ke]=Gt[Ee]=Gt[Yt]=!1;var qc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Kc=parseFloat,Jc=parseInt,Du=typeof I.g=="object"&&I.g&&I.g.Object===Object&&I.g,Fe=typeof self=="object"&&self&&self.Object===Object&&self,Cn=Du||Fe||Function("return this")(),ot=E&&!E.nodeType&&E,to=ot&&y&&!y.nodeType&&y,Po=to&&to.exports===ot,Mn=Po&&Du.process,ln=function(){try{return to&&to.require&&to.require("util").types||Mn&&Mn.binding&&Mn.binding("util")}catch{}}(),gs=ln&&ln.isArrayBuffer,Zs=ln&&ln.isDate,ec=ln&&ln.isMap,ms=ln&&ln.isRegExp,ma=ln&&ln.isSet,tr=ln&&ln.isTypedArray;function Rr(L,V,G){switch(G.length){case 0:return L.call(V);case 1:return L.call(V,G[0]);case 2:return L.call(V,G[0],G[1]);case 3:return L.call(V,G[0],G[1],G[2])}return L.apply(V,G)}function wr(L,V,G,re){for(var ye=-1,Pe=L==null?0:L.length;++ye<Pe;){var Ze=L[ye];V(re,Ze,G(Ze),L)}return re}function Or(L,V){for(var G=-1,re=L==null?0:L.length;++G<re&&V(L[G],G,L)!==!1;);return L}function tc(L,V){for(var G=L==null?0:L.length;G--&&V(L[G],G,L)!==!1;);return L}function ti(L,V){for(var G=-1,re=L==null?0:L.length;++G<re;)if(!V(L[G],G,L))return!1;return!0}function Gr(L,V){for(var G=-1,re=L==null?0:L.length,ye=0,Pe=[];++G<re;){var Ze=L[G];V(Ze,G,L)&&(Pe[ye++]=Ze)}return Pe}function Do(L,V){return!(L==null||!L.length)&&_a(L,V,0)>-1}function Qt(L,V,G){for(var re=-1,ye=L==null?0:L.length;++re<ye;)if(G(V,L[re]))return!0;return!1}function lt(L,V){for(var G=-1,re=L==null?0:L.length,ye=Array(re);++G<re;)ye[G]=V(L[G],G,L);return ye}function ni(L,V){for(var G=-1,re=V.length,ye=L.length;++G<re;)L[ye+G]=V[G];return L}function Yc(L,V,G,re){var ye=-1,Pe=L==null?0:L.length;for(re&&Pe&&(G=L[++ye]);++ye<Pe;)G=V(G,L[ye],ye,L);return G}function Qc(L,V,G,re){var ye=L==null?0:L.length;for(re&&ye&&(G=L[--ye]);ye--;)G=V(G,L[ye],ye,L);return G}function va(L,V){for(var G=-1,re=L==null?0:L.length;++G<re;)if(V(L[G],G,L))return!0;return!1}var In=Sa("length");function vs(L,V,G){var re;return G(L,function(ye,Pe,Ze){if(V(ye,Pe,Ze))return re=Pe,!1}),re}function ri(L,V,G,re){for(var ye=L.length,Pe=G+(re?1:-1);re?Pe--:++Pe<ye;)if(V(L[Pe],Pe,L))return Pe;return-1}function _a(L,V,G){return V==V?function(re,ye,Pe){for(var Ze=Pe-1,on=re.length;++Ze<on;)if(re[Ze]===ye)return Ze;return-1}(L,V,G):ri(L,Xc,G)}function Nu(L,V,G,re){for(var ye=G-1,Pe=L.length;++ye<Pe;)if(re(L[ye],V))return ye;return-1}function Xc(L){return L!=L}function nr(L,V){var G=L==null?0:L.length;return G?Ss(L,V)/G:q}function Sa(L){return function(V){return V==null?f:V[L]}}function _s(L){return function(V){return L==null?f:L[V]}}function nc(L,V,G,re,ye){return ye(L,function(Pe,Ze,on){G=re?(re=!1,Pe):V(G,Pe,Ze,on)}),G}function Ss(L,V){for(var G,re=-1,ye=L.length;++re<ye;){var Pe=V(L[re]);Pe!==f&&(G=G===f?Pe:G+Pe)}return G}function rc(L,V){for(var G=-1,re=Array(L);++G<L;)re[G]=V(G);return re}function rr(L){return L&&L.slice(0,dn(L)+1).replace(Rt,"")}function qn(L){return function(V){return L(V)}}function no(L,V){return lt(V,function(G){return L[G]})}function Ea(L,V){return L.has(V)}function Zc(L,V){for(var G=-1,re=L.length;++G<re&&_a(V,L[G],0)>-1;);return G}function Mu(L,V){for(var G=L.length;G--&&_a(V,L[G],0)>-1;);return G}var gl=_s({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),ml=_s({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ya(L){return"\\"+qc[L]}function ro(L){return pl.test(L)}function ic(L){var V=-1,G=Array(L.size);return L.forEach(function(re,ye){G[++V]=[ye,re]}),G}function Bi(L,V){return function(G){return L(V(G))}}function Wr(L,V){for(var G=-1,re=L.length,ye=0,Pe=[];++G<re;){var Ze=L[G];Ze!==V&&Ze!==D||(L[G]=D,Pe[ye++]=G)}return Pe}function oc(L){var V=-1,G=Array(L.size);return L.forEach(function(re){G[++V]=re}),G}function ii(L){return ro(L)?function(V){for(var G=ga.lastIndex=0;ga.test(V);)++G;return G}(L):In(L)}function vn(L){return ro(L)?function(V){return V.match(ga)||[]}(L):function(V){return V.split("")}(L)}function dn(L){for(var V=L.length;V--&&Ft.test(L.charAt(V)););return V}var ac=_s({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),No=function L(V){var G,re=(V=V==null?Cn:No.defaults(Cn.Object(),V,No.pick(Cn,zc))).Array,ye=V.Date,Pe=V.Error,Ze=V.Function,on=V.Math,Qe=V.Object,Es=V.RegExp,mr=V.String,wt=V.TypeError,Ui=re.prototype,io=Ze.prototype,Ar=Qe.prototype,Hr=V["__core-js_shared__"],xe=io.toString,Ve=Ar.hasOwnProperty,eu=0,ys=(G=/[^.]+$/.exec(Hr&&Hr.keys&&Hr.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"",Je=Ar.toString,vl=xe.call(Qe),_l=Cn._,Sl=Es("^"+xe.call(Ve).replace(ei,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rn=Po?V.Buffer:f,Un=V.Symbol,oo=V.Uint8Array,tu=Rn?Rn.allocUnsafe:f,Mo=Bi(Qe.getPrototypeOf,Qe),nu=Qe.create,bs=Ar.propertyIsEnumerable,oi=Ui.splice,ru=Un?Un.isConcatSpreadable:f,ji=Un?Un.iterator:f,Kn=Un?Un.toStringTag:f,Lo=function(){try{var e=Ji(Qe,"defineProperty");return e({},"",{}),e}catch{}}(),El=V.clearTimeout!==Cn.clearTimeout&&V.clearTimeout,ba=ye&&ye.now!==Cn.Date.now&&ye.now,Lu=V.setTimeout!==Cn.setTimeout&&V.setTimeout,xo=on.ceil,Bo=on.floor,Ta=Qe.getOwnPropertySymbols,yl=Rn?Rn.isBuffer:f,Uo=V.isFinite,bl=Ui.join,xu=Bi(Qe.keys,Qe),gt=on.max,Ot=on.min,sc=ye.now,Tl=V.parseInt,Ts=on.random,Bu=Ui.reverse,Ca=Ji(V,"DataView"),ve=Ji(V,"Map"),qt=Ji(V,"Promise"),ai=Ji(V,"Set"),Fi=Ji(V,"WeakMap"),Vi=Ji(Qe,"create"),jo=Fi&&new Fi,$r={},Cl=go(Ca),Fo=go(ve),Uu=go(qt),Jn=go(ai),ju=go(Fi),Yn=Un?Un.prototype:f,Ei=Yn?Yn.valueOf:f,ao=Yn?Yn.toString:f;function g(e){if(pn(e)&&!ut(e)&&!(e instanceof Ae)){if(e instanceof Xt)return e;if(Ve.call(e,"__wrapped__"))return Wu(e)}return new Xt(e)}var ze=function(){function e(){}return function(t){if(!st(t))return{};if(nu)return nu(t);e.prototype=t;var i=new e;return e.prototype=f,i}}();function si(){}function Xt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=f}function Ae(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ne,this.__views__=[]}function ir(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var o=e[t];this.set(o[0],o[1])}}function Pt(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var o=e[t];this.set(o[0],o[1])}}function hn(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var o=e[t];this.set(o[0],o[1])}}function vr(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new hn;++t<i;)this.add(e[t])}function At(e){var t=this.__data__=new Pt(e);this.size=t.size}function de(e,t){var i=ut(e),o=!i&&Be(e),u=!i&&!o&&Yi(e),d=!i&&!o&&!u&&qa(e),h=i||o||u||d,_=h?rc(e.length,mr):[],T=_.length;for(var C in e)!t&&!Ve.call(e,C)||h&&(C=="length"||u&&(C=="offset"||C=="parent")||d&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||ki(C,T))||_.push(C);return _}function or(e){var t=e.length;return t?e[As(0,t-1)]:f}function Il(e,t){return Pi(lr(e),_r(t,0,e.length))}function cc(e){return Pi(lr(e))}function so(e,t,i){(i!==f&&!Qr(e[t],i)||i===f&&!(t in e))&&_n(e,t,i)}function ci(e,t,i){var o=e[t];Ve.call(e,t)&&Qr(o,i)&&(i!==f||t in e)||_n(e,t,i)}function yi(e,t){for(var i=e.length;i--;)if(Qr(e[i][0],t))return i;return-1}function iu(e,t,i,o){return jn(e,function(u,d,h){t(o,u,i(u),h)}),o}function ou(e,t){return e&&fn(t,ct(t),e)}function _n(e,t,i){t=="__proto__"&&Lo?Lo(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function Ia(e,t){for(var i=-1,o=t.length,u=re(o),d=e==null;++i<o;)u[i]=d?f:Ws(e,t[i]);return u}function _r(e,t,i){return e==e&&(i!==f&&(e=e<=i?e:i),t!==f&&(e=e>=t?e:t)),e}function an(e,t,i,o,u,d){var h,_=1&t,T=2&t,C=4&t;if(i&&(h=u?i(e,o,u,d):i(e)),h!==f)return h;if(!st(e))return e;var R=ut(e);if(R){if(h=function(B){var $=B.length,K=new B.constructor($);return $&&typeof B[0]=="string"&&Ve.call(B,"index")&&(K.index=B.index,K.input=B.input),K}(e),!_)return lr(e,h)}else{var w=gn(e),P=w==Ee||w==ee;if(Yi(e))return Ps(e,_);if(w==le||w==he||P&&!u){if(h=T||P?{}:bc(e),!_)return T?function(B,$){return fn(B,Ls(B),$)}(e,function(B,$){return B&&fn($,mn($),B)}(h,e)):function(B,$){return fn(B,Mr(B),$)}(e,ou(h,e))}else{if(!Gt[w])return u?e:{};h=function(B,$,K){var Q,oe=B.constructor;switch($){case Nn:return $o(B);case H:case me:return new oe(+B);case kn:return function(ce,ae){var te=ae?$o(ce.buffer):ce.buffer;return new ce.constructor(te,ce.byteOffset,ce.byteLength)}(B,K);case Ur:case Tr:case gr:case $n:case jr:case Cr:case Ir:case qe:case Zr:return fo(B,K);case J:return new oe;case X:case _t:return new oe(B);case De:return function(ce){var ae=new ce.constructor(ce.source,Io.exec(ce));return ae.lastIndex=ce.lastIndex,ae}(B);case Ie:return new oe;case bn:return Q=B,Ei?Qe(Ei.call(Q)):{}}}(e,w,_)}}d||(d=new At);var U=d.get(e);if(U)return U;d.set(e,h),mo(e)?e.forEach(function(B){h.add(an(B,t,i,B,e,d))}):Eu(e)&&e.forEach(function(B,$){h.set($,an(B,t,i,$,e,d))});var j=R?f:(C?T?Ai:Vn:T?mn:ct)(e);return Or(j||e,function(B,$){j&&(B=e[$=B]),ci(h,$,an(B,t,i,$,e,d))}),h}function Cs(e,t,i){var o=i.length;if(e==null)return!o;for(e=Qe(e);o--;){var u=i[o],d=t[u],h=e[u];if(h===f&&!(u in e)||!d(h))return!1}return!0}function Is(e,t,i){if(typeof e!="function")throw new wt(b);return Xo(function(){e.apply(f,i)},t)}function ui(e,t,i,o){var u=-1,d=Do,h=!0,_=e.length,T=[],C=t.length;if(!_)return T;i&&(t=lt(t,qn(i))),o?(d=Qt,h=!1):t.length>=200&&(d=Ea,h=!1,t=new vr(t));e:for(;++u<_;){var R=e[u],w=i==null?R:i(R);if(R=o||R!==0?R:0,h&&w==w){for(var P=C;P--;)if(t[P]===w)continue e;T.push(R)}else d(t,w,o)||T.push(R)}return T}g.templateSettings={escape:To,evaluate:Mi,interpolate:eo,variable:"",imports:{_:g}},g.prototype=si.prototype,g.prototype.constructor=g,Xt.prototype=ze(si.prototype),Xt.prototype.constructor=Xt,Ae.prototype=ze(si.prototype),Ae.prototype.constructor=Ae,ir.prototype.clear=function(){this.__data__=Vi?Vi(null):{},this.size=0},ir.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ir.prototype.get=function(e){var t=this.__data__;if(Vi){var i=t[e];return i===x?f:i}return Ve.call(t,e)?t[e]:f},ir.prototype.has=function(e){var t=this.__data__;return Vi?t[e]!==f:Ve.call(t,e)},ir.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Vi&&t===f?x:t,this},Pt.prototype.clear=function(){this.__data__=[],this.size=0},Pt.prototype.delete=function(e){var t=this.__data__,i=yi(t,e);return!(i<0||(i==t.length-1?t.pop():oi.call(t,i,1),--this.size,0))},Pt.prototype.get=function(e){var t=this.__data__,i=yi(t,e);return i<0?f:t[i][1]},Pt.prototype.has=function(e){return yi(this.__data__,e)>-1},Pt.prototype.set=function(e,t){var i=this.__data__,o=yi(i,e);return o<0?(++this.size,i.push([e,t])):i[o][1]=t,this},hn.prototype.clear=function(){this.size=0,this.__data__={hash:new ir,map:new(ve||Pt),string:new ir}},hn.prototype.delete=function(e){var t=We(this,e).delete(e);return this.size-=t?1:0,t},hn.prototype.get=function(e){return We(this,e).get(e)},hn.prototype.has=function(e){return We(this,e).has(e)},hn.prototype.set=function(e,t){var i=We(this,e),o=i.size;return i.set(e,t),this.size+=i.size==o?0:1,this},vr.prototype.add=vr.prototype.push=function(e){return this.__data__.set(e,x),this},vr.prototype.has=function(e){return this.__data__.has(e)},At.prototype.clear=function(){this.__data__=new Pt,this.size=0},At.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},At.prototype.get=function(e){return this.__data__.get(e)},At.prototype.has=function(e){return this.__data__.has(e)},At.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Pt){var o=i.__data__;if(!ve||o.length<199)return o.push([e,t]),this.size=++i.size,this;i=this.__data__=new hn(o)}return i.set(e,t),this.size=i.size,this};var jn=Ii(wn),uc=Ii(Oa,!0);function au(e,t){var i=!0;return jn(e,function(o,u,d){return i=!!t(o,u,d)}),i}function co(e,t,i){for(var o=-1,u=e.length;++o<u;){var d=e[o],h=t(d);if(h!=null&&(_===f?h==h&&!Zt(h):i(h,_)))var _=h,T=d}return T}function lc(e,t){var i=[];return jn(e,function(o,u,d){t(o,u,d)&&i.push(o)}),i}function bt(e,t,i,o,u){var d=-1,h=e.length;for(i||(i=fu),u||(u=[]);++d<h;){var _=e[d];t>0&&i(_)?t>1?bt(_,t-1,i,o,u):ni(u,_):o||(u[u.length]=_)}return u}var Ra=lu(),wa=lu(!0);function wn(e,t){return e&&Ra(e,t,ct)}function Oa(e,t){return e&&wa(e,t,ct)}function ar(e,t){return Gr(t,function(i){return Kt(e[i])})}function sr(e,t){for(var i=0,o=(t=Ln(t,e)).length;e!=null&&i<o;)e=e[Qn(t[i++])];return i&&i==o?e:f}function Rs(e,t,i){var o=t(e);return ut(e)?o:ni(o,i(e))}function Mt(e){return e==null?e===f?"[object Undefined]":"[object Null]":Kn&&Kn in Qe(e)?function(t){var i=Ve.call(t,Kn),o=t[Kn];try{t[Kn]=f;var u=!0}catch{}var d=Je.call(t);return u&&(i?t[Kn]=o:delete t[Kn]),d}(e):function(t){return Je.call(t)}(e)}function Aa(e,t){return e>t}function Fu(e,t){return e!=null&&Ve.call(e,t)}function Vu(e,t){return e!=null&&t in Qe(e)}function ka(e,t,i){for(var o=i?Qt:Do,u=e[0].length,d=e.length,h=d,_=re(d),T=1/0,C=[];h--;){var R=e[h];h&&t&&(R=lt(R,qn(t))),T=Ot(R.length,T),_[h]=!i&&(t||u>=120&&R.length>=120)?new vr(h&&R):f}R=e[0];var w=-1,P=_[0];e:for(;++w<u&&C.length<T;){var U=R[w],j=t?t(U):U;if(U=i||U!==0?U:0,!(P?Ea(P,j):o(C,j,i))){for(h=d;--h;){var B=_[h];if(!(B?Ea(B,j):o(e[h],j,i)))continue e}P&&P.push(j),C.push(U)}}return C}function Gi(e,t,i){var o=(e=An(e,t=Ln(t,e)))==null?e:e[Qn(hr(t))];return o==null?f:Rr(o,e,i)}function dc(e){return pn(e)&&Mt(e)==he}function bi(e,t,i,o,u){return e===t||(e==null||t==null||!pn(e)&&!pn(t)?e!=e&&t!=t:function(d,h,_,T,C,R){var w=ut(d),P=ut(h),U=w?Oe:gn(d),j=P?Oe:gn(h),B=(U=U==he?le:U)==le,$=(j=j==he?le:j)==le,K=U==j;if(K&&Yi(d)){if(!Yi(h))return!1;w=!0,B=!1}if(K&&!B)return R||(R=new At),w||qa(d)?Ko(d,h,_,T,C,R):function(te,pe,be,Ce,_e,Se,Le){switch(be){case kn:if(te.byteLength!=pe.byteLength||te.byteOffset!=pe.byteOffset)return!1;te=te.buffer,pe=pe.buffer;case Nn:return!(te.byteLength!=pe.byteLength||!Se(new oo(te),new oo(pe)));case H:case me:case X:return Qr(+te,+pe);case ke:return te.name==pe.name&&te.message==pe.message;case De:case _t:return te==pe+"";case J:var et=ic;case Ie:var vt=1&Ce;if(et||(et=oc),te.size!=pe.size&&!vt)return!1;var Et=Le.get(te);if(Et)return Et==pe;Ce|=2,Le.set(te,pe);var mt=Ko(et(te),et(pe),Ce,_e,Se,Le);return Le.delete(te),mt;case bn:if(Ei)return Ei.call(te)==Ei.call(pe)}return!1}(d,h,U,_,T,C,R);if(!(1&_)){var Q=B&&Ve.call(d,"__wrapped__"),oe=$&&Ve.call(h,"__wrapped__");if(Q||oe){var ce=Q?d.value():d,ae=oe?h.value():h;return R||(R=new At),C(ce,ae,_,T,R)}}return!!K&&(R||(R=new At),function(te,pe,be,Ce,_e,Se){var Le=1&be,et=Vn(te),vt=et.length;if(vt!=Vn(pe).length&&!Le)return!1;for(var Et=vt;Et--;){var mt=et[Et];if(!(Le?mt in pe:Ve.call(pe,mt)))return!1}var It=Se.get(te),en=Se.get(pe);if(It&&en)return It==pe&&en==te;var Ht=!0;Se.set(te,pe),Se.set(pe,te);for(var Ut=Le;++Et<vt;){var xt=te[mt=et[Et]],Nt=pe[mt];if(Ce)var jt=Le?Ce(Nt,xt,mt,pe,te,Se):Ce(xt,Nt,mt,te,pe,Se);if(!(jt===f?xt===Nt||_e(xt,Nt,be,Ce,Se):jt)){Ht=!1;break}Ut||(Ut=mt=="constructor")}if(Ht&&!Ut){var rn=te.constructor,kt=pe.constructor;rn==kt||!("constructor"in te)||!("constructor"in pe)||typeof rn=="function"&&rn instanceof rn&&typeof kt=="function"&&kt instanceof kt||(Ht=!1)}return Se.delete(te),Se.delete(pe),Ht}(d,h,_,T,C,R))}(e,t,i,o,bi,u))}function ws(e,t,i,o){var u=i.length,d=u,h=!o;if(e==null)return!d;for(e=Qe(e);u--;){var _=i[u];if(h&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++u<d;){var T=(_=i[u])[0],C=e[T],R=_[1];if(h&&_[2]){if(C===f&&!(T in e))return!1}else{var w=new At;if(o)var P=o(C,R,T,e,t,w);if(!(P===f?bi(R,C,3,o,w):P))return!1}}return!0}function Re(e){return!(!st(e)||(t=e,ys&&ys in t))&&(Kt(e)?Sl:Y).test(go(e));var t}function hc(e){return typeof e=="function"?e:e==null?Xn:typeof e=="object"?ut(e)?su(e[0],e[1]):fc(e):Ou(e)}function uo(e){if(!Yo(e))return xu(e);var t=[];for(var i in Qe(e))Ve.call(e,i)&&i!="constructor"&&t.push(i);return t}function On(e,t){return e<t}function Os(e,t){var i=-1,o=yt(e)?re(e.length):[];return jn(e,function(u,d,h){o[++i]=t(u,d,h)}),o}function fc(e){var t=Fa(e);return t.length==1&&t[0][2]?Cc(t[0][0],t[0][1]):function(i){return i===e||ws(i,e,t)}}function su(e,t){return Bn(e)&&Qo(t)?Cc(Qn(e),t):function(i){var o=Ws(i,e);return o===f&&o===t?yu(i,e):bi(t,o,3)}}function Vo(e,t,i,o,u){e!==t&&Ra(t,function(d,h){if(u||(u=new At),st(d))(function(T,C,R,w,P,U,j){var B=Va(T,R),$=Va(C,R),K=j.get($);if(K)so(T,R,K);else{var Q=U?U(B,$,R+"",T,C,j):f,oe=Q===f;if(oe){var ce=ut($),ae=!ce&&Yi($),te=!ce&&!ae&&qa($);Q=$,ce||ae||te?ut(B)?Q=B:ft(B)?Q=lr(B):ae?(oe=!1,Q=Ps($,!0)):te?(oe=!1,Q=fo($,!0)):Q=[]:pi($)||Be($)?(Q=B,Be(B)?Q=pt(B):st(B)&&!Kt(B)||(Q=bc($))):oe=!1}oe&&(j.set($,Q),P(Q,$,w,U,j),j.delete($)),so(T,R,Q)}})(e,t,h,i,Vo,o,u);else{var _=o?o(Va(e,h),d,h+"",e,t,u):f;_===f&&(_=d),so(e,h,_)}},mn)}function Pa(e,t){var i=e.length;if(i)return ki(t+=t<0?i:0,i)?e[t]:f}function pc(e,t,i){t=t.length?lt(t,function(d){return ut(d)?function(h){return sr(h,d.length===1?d[0]:d)}:d}):[Xn];var o=-1;t=lt(t,qn($e()));var u=Os(e,function(d,h,_){var T=lt(t,function(C){return C(d)});return{criteria:T,index:++o,value:d}});return function(d){var h=d.length;for(d.sort(function(_,T){return function(C,R,w){for(var P=-1,U=C.criteria,j=R.criteria,B=U.length,$=w.length;++P<B;){var K=Sc(U[P],j[P]);if(K)return P>=$?K:K*(w[P]=="desc"?-1:1)}return C.index-R.index}(_,T,i)});h--;)d[h]=d[h].value;return d}(u)}function lo(e,t,i){for(var o=-1,u=t.length,d={};++o<u;){var h=t[o],_=sr(e,h);i(_,h)&&cr(d,Ln(h,e),_)}return d}function gc(e,t,i,o){var u=o?Nu:_a,d=-1,h=t.length,_=e;for(e===t&&(t=lr(t)),i&&(_=lt(e,qn(i)));++d<h;)for(var T=0,C=t[d],R=i?i(C):C;(T=u(_,R,T,o))>-1;)_!==e&&oi.call(_,T,1),oi.call(e,T,1);return e}function mc(e,t){for(var i=e?t.length:0,o=i-1;i--;){var u=t[i];if(i==o||u!==d){var d=u;ki(u)?oi.call(e,u,1):Dr(e,u)}}return e}function As(e,t){return e+Bo(Ts()*(t-e+1))}function Da(e,t){var i="";if(!e||t<1||t>z)return i;do t%2&&(i+=e),(t=Bo(t/2))&&(e+=e);while(t);return i}function ht(e,t){return po(Ic(e,t,Xn),e+"")}function at(e){return or(ia(e))}function Na(e,t){var i=ia(e);return Pi(i,_r(t,0,i.length))}function cr(e,t,i,o){if(!st(e))return e;for(var u=-1,d=(t=Ln(t,e)).length,h=d-1,_=e;_!=null&&++u<d;){var T=Qn(t[u]),C=i;if(T==="__proto__"||T==="constructor"||T==="prototype")return e;if(u!=h){var R=_[T];(C=o?o(R,T,_):f)===f&&(C=st(R)?R:ki(t[u+1])?[]:{})}ci(_,T,C),_=_[T]}return e}var Wi=jo?function(e,t){return jo.set(e,t),e}:Xn,Fn=Lo?function(e,t){return Lo(e,"toString",{configurable:!0,enumerable:!1,value:Hs(t),writable:!0})}:Xn;function ho(e){return Pi(ia(e))}function dt(e,t,i){var o=-1,u=e.length;t<0&&(t=-t>u?0:u+t),(i=i>u?u:i)<0&&(i+=u),u=t>i?0:i-t>>>0,t>>>=0;for(var d=re(u);++o<u;)d[o]=e[o+t];return d}function kr(e,t){var i;return jn(e,function(o,u,d){return!(i=t(o,u,d))}),!!i}function Pr(e,t,i){var o=0,u=e==null?o:e.length;if(typeof t=="number"&&t==t&&u<=2147483647){for(;o<u;){var d=o+u>>>1,h=e[d];h!==null&&!Zt(h)&&(i?h<=t:h<t)?o=d+1:u=d}return u}return Go(e,t,Xn,i)}function Go(e,t,i,o){var u=0,d=e==null?0:e.length;if(d===0)return 0;for(var h=(t=i(t))!=t,_=t===null,T=Zt(t),C=t===f;u<d;){var R=Bo((u+d)/2),w=i(e[R]),P=w!==f,U=w===null,j=w==w,B=Zt(w);if(h)var $=o||j;else $=C?j&&(o||P):_?j&&P&&(o||!U):T?j&&P&&!U&&(o||!B):!U&&!B&&(o?w<=t:w<t);$?u=R+1:d=R}return Ot(d,4294967294)}function ks(e,t){for(var i=-1,o=e.length,u=0,d=[];++i<o;){var h=e[i],_=t?t(h):h;if(!i||!Qr(_,T)){var T=_;d[u++]=h===0?0:h}}return d}function vc(e){return typeof e=="number"?e:Zt(e)?q:+e}function ur(e){if(typeof e=="string")return e;if(ut(e))return lt(e,ur)+"";if(Zt(e))return ao?ao.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function Dt(e,t,i){var o=-1,u=Do,d=e.length,h=!0,_=[],T=_;if(i)h=!1,u=Qt;else if(d>=200){var C=t?null:hu(e);if(C)return oc(C);h=!1,u=Ea,T=new vr}else T=t?[]:_;e:for(;++o<d;){var R=e[o],w=t?t(R):R;if(R=i||R!==0?R:0,h&&w==w){for(var P=T.length;P--;)if(T[P]===w)continue e;t&&T.push(w),_.push(R)}else u(T,w,i)||(T!==_&&T.push(w),_.push(R))}return _}function Dr(e,t){return(e=An(e,t=Ln(t,e)))==null||delete e[Qn(hr(t))]}function Wo(e,t,i,o){return cr(e,t,i(sr(e,t)),o)}function Hi(e,t,i,o){for(var u=e.length,d=o?u:-1;(o?d--:++d<u)&&t(e[d],d,e););return i?dt(e,o?0:d,o?d+1:u):dt(e,o?d+1:0,o?u:d)}function Ho(e,t){var i=e;return i instanceof Ae&&(i=i.value()),Yc(t,function(o,u){return u.func.apply(u.thisArg,ni([o],u.args))},i)}function _c(e,t,i){var o=e.length;if(o<2)return o?Dt(e[0]):[];for(var u=-1,d=re(o);++u<o;)for(var h=e[u],_=-1;++_<o;)_!=u&&(d[u]=ui(d[u]||h,e[_],t,i));return Dt(bt(d,1),t,i)}function Ti(e,t,i){for(var o=-1,u=e.length,d=t.length,h={};++o<u;){var _=o<d?t[o]:f;i(h,e[o],_)}return h}function zr(e){return ft(e)?e:[]}function $i(e){return typeof e=="function"?e:Xn}function Ln(e,t){return ut(e)?e:Bn(e,t)?[e]:di(Me(e))}var li=ht;function Nr(e,t,i){var o=e.length;return i=i===f?o:i,!t&&i>=o?e:dt(e,t,i)}var zi=El||function(e){return Cn.clearTimeout(e)};function Ps(e,t){if(t)return e.slice();var i=e.length,o=tu?tu(i):new e.constructor(i);return e.copy(o),o}function $o(e){var t=new e.constructor(e.byteLength);return new oo(t).set(new oo(e)),t}function fo(e,t){var i=t?$o(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function Sc(e,t){if(e!==t){var i=e!==f,o=e===null,u=e==e,d=Zt(e),h=t!==f,_=t===null,T=t==t,C=Zt(t);if(!_&&!C&&!d&&e>t||d&&h&&T&&!_&&!C||o&&h&&T||!i&&T||!u)return 1;if(!o&&!d&&!C&&e<t||C&&i&&u&&!o&&!d||_&&i&&u||!h&&u||!T)return-1}return 0}function cu(e,t,i,o){for(var u=-1,d=e.length,h=i.length,_=-1,T=t.length,C=gt(d-h,0),R=re(T+C),w=!o;++_<T;)R[_]=t[_];for(;++u<h;)(w||u<d)&&(R[i[u]]=e[u]);for(;C--;)R[_++]=e[u++];return R}function uu(e,t,i,o){for(var u=-1,d=e.length,h=-1,_=i.length,T=-1,C=t.length,R=gt(d-_,0),w=re(R+C),P=!o;++u<R;)w[u]=e[u];for(var U=u;++T<C;)w[U+T]=t[T];for(;++h<_;)(P||u<d)&&(w[U+i[h]]=e[u++]);return w}function lr(e,t){var i=-1,o=e.length;for(t||(t=re(o));++i<o;)t[i]=e[i];return t}function fn(e,t,i,o){var u=!i;i||(i={});for(var d=-1,h=t.length;++d<h;){var _=t[d],T=o?o(i[_],e[_],_,i,e):f;T===f&&(T=e[_]),u?_n(i,_,T):ci(i,_,T)}return i}function Sr(e,t){return function(i,o){var u=ut(i)?wr:iu,d=t?t():{};return u(i,e,$e(o,2),d)}}function Ci(e){return ht(function(t,i){var o=-1,u=i.length,d=u>1?i[u-1]:f,h=u>2?i[2]:f;for(d=e.length>3&&typeof d=="function"?(u--,d):f,h&&sn(i[0],i[1],h)&&(d=u<3?f:d,u=1),t=Qe(t);++o<u;){var _=i[o];_&&e(t,_,o,d)}return t})}function Ii(e,t){return function(i,o){if(i==null)return i;if(!yt(i))return e(i,o);for(var u=i.length,d=t?u:-1,h=Qe(i);(t?d--:++d<u)&&o(h[d],d,h)!==!1;);return i}}function lu(e){return function(t,i,o){for(var u=-1,d=Qe(t),h=o(t),_=h.length;_--;){var T=h[e?_:++u];if(i(d[T],T,d)===!1)break}return t}}function du(e){return function(t){var i=ro(t=Me(t))?vn(t):f,o=i?i[0]:t.charAt(0),u=i?Nr(i,1).join(""):t.slice(1);return o[e]()+u}}function zo(e){return function(t){return Yc(Ru(Cu(t).replace(Fr,"")),e,"")}}function Ri(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=ze(e.prototype),o=e.apply(i,t);return st(o)?o:i}}function Ma(e){return function(t,i,o){var u=Qe(t);if(!yt(t)){var d=$e(i,3);t=ct(t),i=function(_){return d(u[_],_,u)}}var h=e(t,i,o);return h>-1?u[d?t[h]:h]:f}}function Ec(e){return dr(function(t){var i=t.length,o=i,u=Xt.prototype.thru;for(e&&t.reverse();o--;){var d=t[o];if(typeof d!="function")throw new wt(b);if(u&&!h&&qi(d)=="wrapper")var h=new Xt([],!0)}for(o=h?o:i;++o<i;){var _=qi(d=t[o]),T=_=="wrapper"?qr(d):f;h=T&&Jo(T[0])&&T[1]==424&&!T[4].length&&T[9]==1?h[qi(T[0])].apply(h,T[3]):d.length==1&&Jo(d)?h[_]():h.thru(d)}return function(){var C=arguments,R=C[0];if(h&&C.length==1&&ut(R))return h.plant(R).value();for(var w=0,P=i?t[w].apply(this,C):R;++w<i;)P=t[w].call(this,P);return P}})}function La(e,t,i,o,u,d,h,_,T,C){var R=t&M,w=1&t,P=2&t,U=24&t,j=512&t,B=P?f:Ri(e);return function $(){for(var K=arguments.length,Q=re(K),oe=K;oe--;)Q[oe]=arguments[oe];if(U)var ce=Ki($),ae=function(Ce,_e){for(var Se=Ce.length,Le=0;Se--;)Ce[Se]===_e&&++Le;return Le}(Q,ce);if(o&&(Q=cu(Q,o,u,U)),d&&(Q=uu(Q,d,h,U)),K-=ae,U&&K<C){var te=Wr(Q,ce);return Ms(e,t,La,$.placeholder,i,Q,te,_,T,C-K)}var pe=w?i:this,be=P?pe[e]:e;return K=Q.length,_?Q=function(Ce,_e){for(var Se=Ce.length,Le=Ot(_e.length,Se),et=lr(Ce);Le--;){var vt=_e[Le];Ce[Le]=ki(vt,Se)?et[vt]:f}return Ce}(Q,_):j&&K>1&&Q.reverse(),R&&T<K&&(Q.length=T),this&&this!==Cn&&this instanceof $&&(be=B||Ri(be)),be.apply(pe,Q)}}function Er(e,t){return function(i,o){return function(u,d,h,_){return wn(u,function(T,C,R){d(_,h(T),C,R)}),_}(i,e,t(o),{})}}function xa(e,t){return function(i,o){var u;if(i===f&&o===f)return t;if(i!==f&&(u=i),o!==f){if(u===f)return o;typeof i=="string"||typeof o=="string"?(i=ur(i),o=ur(o)):(i=vc(i),o=vc(o)),u=e(i,o)}return u}}function qo(e){return dr(function(t){return t=lt(t,qn($e())),ht(function(i){var o=this;return e(t,function(u){return Rr(u,o,i)})})})}function Ba(e,t){var i=(t=t===f?" ":ur(t)).length;if(i<2)return i?Da(t,e):t;var o=Da(t,xo(e/ii(t)));return ro(t)?Nr(vn(o),0,e).join(""):o.slice(0,e)}function Ds(e){return function(t,i,o){return o&&typeof o!="number"&&sn(t,i,o)&&(i=o=f),t=Ne(t),i===f?(i=t,t=0):i=Ne(i),function(u,d,h,_){for(var T=-1,C=gt(xo((d-u)/(h||1)),0),R=re(C);C--;)R[_?C:++T]=u,u+=h;return R}(t,i,o=o===f?t<i?1:-1:Ne(o),e)}}function Ns(e){return function(t,i){return typeof t=="string"&&typeof i=="string"||(t=Lr(t),i=Lr(i)),e(t,i)}}function Ms(e,t,i,o,u,d,h,_,T,C){var R=8&t;t|=R?A:64,4&(t&=~(R?64:A))||(t&=-4);var w=[e,t,u,R?d:f,R?h:f,R?f:d,R?f:h,_,T,C],P=i.apply(f,w);return Jo(e)&&Rc(P,w),P.placeholder=o,Ga(P,e,t)}function yc(e){var t=on[e];return function(i,o){if(i=Lr(i),(o=o==null?0:Ot(rt(o),292))&&Uo(i)){var u=(Me(i)+"e").split("e");return+((u=(Me(t(u[0]+"e"+(+u[1]+o)))+"e").split("e"))[0]+"e"+(+u[1]-o))}return t(i)}}var hu=ai&&1/oc(new ai([,-0]))[1]==W?function(e){return new ai(e)}:Zn;function Gu(e){return function(t){var i=gn(t);return i==J?ic(t):i==Ie?function(o){var u=-1,d=Array(o.size);return o.forEach(function(h){d[++u]=[h,h]}),d}(t):function(o,u){return lt(u,function(d){return[d,o[d]]})}(t,e(t))}}function wi(e,t,i,o,u,d,h,_){var T=2&t;if(!T&&typeof e!="function")throw new wt(b);var C=o?o.length:0;if(C||(t&=-97,o=u=f),h=h===f?h:gt(rt(h),0),_=_===f?_:rt(_),C-=u?u.length:0,64&t){var R=o,w=u;o=u=f}var P=T?f:qr(e),U=[e,t,i,o,u,R,w,d,h,_];if(P&&function(B,$){var K=B[1],Q=$[1],oe=K|Q,ce=oe<131,ae=Q==M&&K==8||Q==M&&K==256&&B[7].length<=$[8]||Q==384&&$[7].length<=$[8]&&K==8;if(!ce&&!ae)return B;1&Q&&(B[2]=$[2],oe|=1&K?0:4);var te=$[3];if(te){var pe=B[3];B[3]=pe?cu(pe,te,$[4]):te,B[4]=pe?Wr(B[3],D):$[4]}(te=$[5])&&(pe=B[5],B[5]=pe?uu(pe,te,$[6]):te,B[6]=pe?Wr(B[5],D):$[6]),(te=$[7])&&(B[7]=te),Q&M&&(B[8]=B[8]==null?$[8]:Ot(B[8],$[8])),B[9]==null&&(B[9]=$[9]),B[0]=$[0],B[1]=oe}(U,P),e=U[0],t=U[1],i=U[2],o=U[3],u=U[4],!(_=U[9]=U[9]===f?T?0:e.length:gt(U[9]-C,0))&&24&t&&(t&=-25),t&&t!=1)j=t==8||t==16?function(B,$,K){var Q=Ri(B);return function oe(){for(var ce=arguments.length,ae=re(ce),te=ce,pe=Ki(oe);te--;)ae[te]=arguments[te];var be=ce<3&&ae[0]!==pe&&ae[ce-1]!==pe?[]:Wr(ae,pe);return(ce-=be.length)<K?Ms(B,$,La,oe.placeholder,f,ae,be,f,f,K-ce):Rr(this&&this!==Cn&&this instanceof oe?Q:B,this,ae)}}(e,t,_):t!=A&&t!=33||u.length?La.apply(f,U):function(B,$,K,Q){var oe=1&$,ce=Ri(B);return function ae(){for(var te=-1,pe=arguments.length,be=-1,Ce=Q.length,_e=re(Ce+pe),Se=this&&this!==Cn&&this instanceof ae?ce:B;++be<Ce;)_e[be]=Q[be];for(;pe--;)_e[be++]=arguments[++te];return Rr(Se,oe?K:this,_e)}}(e,t,i,o);else var j=function(B,$,K){var Q=1&$,oe=Ri(B);return function ce(){return(this&&this!==Cn&&this instanceof ce?oe:B).apply(Q?K:this,arguments)}}(e,t,i);return Ga((P?Wi:Rc)(j,U),e,t)}function Oi(e,t,i,o){return e===f||Qr(e,Ar[i])&&!Ve.call(o,i)?t:e}function Ua(e,t,i,o,u,d){return st(e)&&st(t)&&(d.set(t,e),Vo(e,t,f,Ua,d),d.delete(t)),e}function ja(e){return pi(e)?f:e}function Ko(e,t,i,o,u,d){var h=1&i,_=e.length,T=t.length;if(_!=T&&!(h&&T>_))return!1;var C=d.get(e),R=d.get(t);if(C&&R)return C==t&&R==e;var w=-1,P=!0,U=2&i?new vr:f;for(d.set(e,t),d.set(t,e);++w<_;){var j=e[w],B=t[w];if(o)var $=h?o(B,j,w,t,e,d):o(j,B,w,e,t,d);if($!==f){if($)continue;P=!1;break}if(U){if(!va(t,function(K,Q){if(!Ea(U,Q)&&(j===K||u(j,K,i,o,d)))return U.push(Q)})){P=!1;break}}else if(j!==B&&!u(j,B,i,o,d)){P=!1;break}}return d.delete(e),d.delete(t),P}function dr(e){return po(Ic(e,f,gu),e+"")}function Vn(e){return Rs(e,ct,Mr)}function Ai(e){return Rs(e,mn,Ls)}var qr=jo?function(e){return jo.get(e)}:Zn;function qi(e){for(var t=e.name+"",i=$r[t],o=Ve.call($r,t)?i.length:0;o--;){var u=i[o],d=u.func;if(d==null||d==e)return u.name}return t}function Ki(e){return(Ve.call(g,"placeholder")?g:e).placeholder}function $e(){var e=g.iteratee||Gc;return e=e===Gc?hc:e,arguments.length?e(arguments[0],arguments[1]):e}function We(e,t){var i,o,u=e.__data__;return((o=typeof(i=t))=="string"||o=="number"||o=="symbol"||o=="boolean"?i!=="__proto__":i===null)?u[typeof t=="string"?"string":"hash"]:u.map}function Fa(e){for(var t=ct(e),i=t.length;i--;){var o=t[i],u=e[o];t[i]=[o,u,Qo(u)]}return t}function Ji(e,t){var i=function(o,u){return o==null?f:o[u]}(e,t);return Re(i)?i:f}var Mr=Ta?function(e){return e==null?[]:(e=Qe(e),Gr(Ta(e),function(t){return bs.call(e,t)}))}:Ya,Ls=Ta?function(e){for(var t=[];e;)ni(t,Mr(e)),e=Mo(e);return t}:Ya,gn=Mt;function xn(e,t,i){for(var o=-1,u=(t=Ln(t,e)).length,d=!1;++o<u;){var h=Qn(t[o]);if(!(d=e!=null&&i(e,h)))break;e=e[h]}return d||++o!=u?d:!!(u=e==null?0:e.length)&&Jt(u)&&ki(h,u)&&(ut(e)||Be(e))}function bc(e){return typeof e.constructor!="function"||Yo(e)?{}:ze(Mo(e))}function fu(e){return ut(e)||Be(e)||!!(ru&&e&&e[ru])}function ki(e,t){var i=typeof e;return!!(t=t??z)&&(i=="number"||i!="symbol"&&fe.test(e))&&e>-1&&e%1==0&&e<t}function sn(e,t,i){if(!st(i))return!1;var o=typeof t;return!!(o=="number"?yt(i)&&ki(t,i.length):o=="string"&&t in i)&&Qr(i[t],e)}function Bn(e,t){if(ut(e))return!1;var i=typeof e;return!(i!="number"&&i!="symbol"&&i!="boolean"&&e!=null&&!Zt(e))||Li.test(e)||!ss.test(e)||t!=null&&e in Qe(t)}function Jo(e){var t=qi(e),i=g[t];if(typeof i!="function"||!(t in Ae.prototype))return!1;if(e===i)return!0;var o=qr(i);return!!o&&e===o[0]}(Ca&&gn(new Ca(new ArrayBuffer(1)))!=kn||ve&&gn(new ve)!=J||qt&&gn(qt.resolve())!=ge||ai&&gn(new ai)!=Ie||Fi&&gn(new Fi)!=Yt)&&(gn=function(e){var t=Mt(e),i=t==le?e.constructor:f,o=i?go(i):"";if(o)switch(o){case Cl:return kn;case Fo:return J;case Uu:return ge;case Jn:return Ie;case ju:return Yt}return t});var Tc=Hr?Kt:Au;function Yo(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||Ar)}function Qo(e){return e==e&&!st(e)}function Cc(e,t){return function(i){return i!=null&&i[e]===t&&(t!==f||e in Qe(i))}}function Ic(e,t,i){return t=gt(t===f?e.length-1:t,0),function(){for(var o=arguments,u=-1,d=gt(o.length-t,0),h=re(d);++u<d;)h[u]=o[t+u];u=-1;for(var _=re(t+1);++u<t;)_[u]=o[u];return _[t]=i(h),Rr(e,this,_)}}function An(e,t){return t.length<2?e:sr(e,dt(t,0,-1))}function Va(e,t){if((t!=="constructor"||typeof e[t]!="function")&&t!="__proto__")return e[t]}var Rc=wc(Wi),Xo=Lu||function(e,t){return Cn.setTimeout(e,t)},po=wc(Fn);function Ga(e,t,i){var o=t+"";return po(e,function(u,d){var h=d.length;if(!h)return u;var _=h-1;return d[_]=(h>1?"& ":"")+d[_],d=d.join(h>2?", ":" "),u.replace(us,`{
/* [wrapped with `+d+`] */
`)}(o,function(u,d){return Or(se,function(h){var _="_."+h[0];d&h[1]&&!Do(u,_)&&u.push(_)}),u.sort()}(function(u){var d=u.match(Wc);return d?d[1].split(zn):[]}(o),i)))}function wc(e){var t=0,i=0;return function(){var o=sc(),u=16-(o-i);if(i=o,u>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(f,arguments)}}function Pi(e,t){var i=-1,o=e.length,u=o-1;for(t=t===f?o:t;++i<t;){var d=As(i,u),h=e[d];e[d]=e[i],e[i]=h}return e.length=t,e}var Wa,Oc,di=(Wa=ta(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Co,function(i,o,u,d){t.push(u?d.replace(Si,"$1"):o||i)}),t},function(e){return Oc.size===500&&Oc.clear(),e}),Oc=Wa.cache,Wa);function Qn(e){if(typeof e=="string"||Zt(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function go(e){if(e!=null){try{return xe.call(e)}catch{}try{return e+""}catch{}}return""}function Wu(e){if(e instanceof Ae)return e.clone();var t=new Xt(e.__wrapped__,e.__chain__);return t.__actions__=lr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Rl=ht(function(e,t){return ft(e)?ui(e,bt(t,1,ft,!0)):[]}),pu=ht(function(e,t){var i=hr(t);return ft(i)&&(i=f),ft(e)?ui(e,bt(t,1,ft,!0),$e(i,2)):[]}),Ac=ht(function(e,t){var i=hr(t);return ft(i)&&(i=f),ft(e)?ui(e,bt(t,1,ft,!0),f,i):[]});function kc(e,t,i){var o=e==null?0:e.length;if(!o)return-1;var u=i==null?0:rt(i);return u<0&&(u=gt(o+u,0)),ri(e,$e(t,3),u)}function xs(e,t,i){var o=e==null?0:e.length;if(!o)return-1;var u=o-1;return i!==f&&(u=rt(i),u=i<0?gt(o+u,0):Ot(u,o-1)),ri(e,$e(t,3),u,!0)}function gu(e){return e!=null&&e.length?bt(e,1):[]}function Hu(e){return e&&e.length?e[0]:f}var wl=ht(function(e){var t=lt(e,zr);return t.length&&t[0]===e[0]?ka(t):[]}),$u=ht(function(e){var t=hr(e),i=lt(e,zr);return t===hr(i)?t=f:i.pop(),i.length&&i[0]===e[0]?ka(i,$e(t,2)):[]}),Kr=ht(function(e){var t=hr(e),i=lt(e,zr);return(t=typeof t=="function"?t:f)&&i.pop(),i.length&&i[0]===e[0]?ka(i,f,t):[]});function hr(e){var t=e==null?0:e.length;return t?e[t-1]:f}var zu=ht(qu);function qu(e,t){return e&&e.length&&t&&t.length?gc(e,t):e}var Zo=dr(function(e,t){var i=e==null?0:e.length,o=Ia(e,t);return mc(e,lt(t,function(u){return ki(u,i)?+u:u}).sort(Sc)),o});function Ha(e){return e==null?e:Bu.call(e)}var Ku=ht(function(e){return Dt(bt(e,1,ft,!0))}),Ol=ht(function(e){var t=hr(e);return ft(t)&&(t=f),Dt(bt(e,1,ft,!0),$e(t,2))}),mu=ht(function(e){var t=hr(e);return t=typeof t=="function"?t:f,Dt(bt(e,1,ft,!0),f,t)});function Pc(e){if(!e||!e.length)return[];var t=0;return e=Gr(e,function(i){if(ft(i))return t=gt(i.length,t),!0}),rc(t,function(i){return lt(e,Sa(i))})}function Ju(e,t){if(!e||!e.length)return[];var i=Pc(e);return t==null?i:lt(i,function(o){return Rr(t,f,o)})}var Al=ht(function(e,t){return ft(e)?ui(e,t):[]}),kl=ht(function(e){return _c(Gr(e,ft))}),Yu=ht(function(e){var t=hr(e);return ft(t)&&(t=f),_c(Gr(e,ft),$e(t,2))}),Pl=ht(function(e){var t=hr(e);return t=typeof t=="function"?t:f,_c(Gr(e,ft),f,t)}),Dl=ht(Pc),vu=ht(function(e){var t=e.length,i=t>1?e[t-1]:f;return i=typeof i=="function"?(e.pop(),i):f,Ju(e,i)});function Bs(e){var t=g(e);return t.__chain__=!0,t}function Dc(e,t){return t(e)}var Nl=dr(function(e){var t=e.length,i=t?e[0]:0,o=this.__wrapped__,u=function(d){return Ia(d,e)};return!(t>1||this.__actions__.length)&&o instanceof Ae&&ki(i)?((o=o.slice(i,+i+(t?1:0))).__actions__.push({func:Dc,args:[u],thisArg:f}),new Xt(o,this.__chain__).thru(function(d){return t&&!d.length&&d.push(f),d})):this.thru(u)}),Ml=Sr(function(e,t,i){Ve.call(e,i)?++e[i]:_n(e,i,1)}),Ll=Ma(kc),Qu=Ma(xs);function _u(e,t){return(ut(e)?Or:jn)(e,$e(t,3))}function Xu(e,t){return(ut(e)?tc:uc)(e,$e(t,3))}var xl=Sr(function(e,t,i){Ve.call(e,i)?e[i].push(t):_n(e,i,[t])}),Zu=ht(function(e,t,i){var o=-1,u=typeof t=="function",d=yt(e)?re(e.length):[];return jn(e,function(h){d[++o]=u?Rr(t,h,i):Gi(h,t,i)}),d}),ea=Sr(function(e,t,i){_n(e,i,t)});function Gn(e,t){return(ut(e)?lt:Os)(e,$e(t,3))}var Jr=Sr(function(e,t,i){e[i?0:1].push(t)},function(){return[[],[]]}),Lt=ht(function(e,t){if(e==null)return[];var i=t.length;return i>1&&sn(e,t[0],t[1])?t=[]:i>2&&sn(t[0],t[1],t[2])&&(t=[t[0]]),pc(e,bt(t,1),[])}),Us=ba||function(){return Cn.Date.now()};function Nc(e,t,i){return t=i?f:t,t=e&&t==null?e.length:t,wi(e,M,f,f,f,f,t)}function Mc(e,t){var i;if(typeof t!="function")throw new wt(b);return e=rt(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=f),i}}var js=ht(function(e,t,i){var o=1;if(i.length){var u=Wr(i,Ki(js));o|=A}return wi(e,o,t,i,u)}),Lc=ht(function(e,t,i){var o=3;if(i.length){var u=Wr(i,Ki(Lc));o|=A}return wi(t,o,e,i,u)});function el(e,t,i){var o,u,d,h,_,T,C=0,R=!1,w=!1,P=!0;if(typeof e!="function")throw new wt(b);function U(Q){var oe=o,ce=u;return o=u=f,C=Q,h=e.apply(ce,oe)}function j(Q){var oe=Q-T;return T===f||oe>=t||oe<0||w&&Q-C>=d}function B(){var Q=Us();if(j(Q))return $(Q);_=Xo(B,function(oe){var ce=t-(oe-T);return w?Ot(ce,d-(oe-C)):ce}(Q))}function $(Q){return _=f,P&&o?U(Q):(o=u=f,h)}function K(){var Q=Us(),oe=j(Q);if(o=arguments,u=this,T=Q,oe){if(_===f)return function(ce){return C=ce,_=Xo(B,t),R?U(ce):h}(T);if(w)return zi(_),_=Xo(B,t),U(T)}return _===f&&(_=Xo(B,t)),h}return t=Lr(t)||0,st(i)&&(R=!!i.leading,d=(w="maxWait"in i)?gt(Lr(i.maxWait)||0,t):d,P="trailing"in i?!!i.trailing:P),K.cancel=function(){_!==f&&zi(_),C=0,o=T=u=_=f},K.flush=function(){return _===f?h:$(Us())},K}var Bl=ht(function(e,t){return Is(e,1,t)}),xc=ht(function(e,t,i){return Is(e,Lr(t)||0,i)});function ta(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new wt(b);var i=function(){var o=arguments,u=t?t.apply(this,o):o[0],d=i.cache;if(d.has(u))return d.get(u);var h=e.apply(this,o);return i.cache=d.set(u,h)||d,h};return i.cache=new(ta.Cache||hn),i}function Bc(e){if(typeof e!="function")throw new wt(b);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}ta.Cache=hn;var Su=li(function(e,t){var i=(t=t.length==1&&ut(t[0])?lt(t[0],qn($e())):lt(bt(t,1),qn($e()))).length;return ht(function(o){for(var u=-1,d=Ot(o.length,i);++u<d;)o[u]=t[u].call(this,o[u]);return Rr(e,this,o)})}),$a=ht(function(e,t){var i=Wr(t,Ki($a));return wi(e,A,f,t,i)}),Wn=ht(function(e,t){var i=Wr(t,Ki(Wn));return wi(e,64,f,t,i)}),Yr=dr(function(e,t){return wi(e,256,f,f,f,t)});function Qr(e,t){return e===t||e!=e&&t!=t}var Ul=Ns(Aa),hi=Ns(function(e,t){return e>=t}),Be=dc(function(){return arguments}())?dc:function(e){return pn(e)&&Ve.call(e,"callee")&&!bs.call(e,"callee")},ut=re.isArray,fr=gs?qn(gs):function(e){return pn(e)&&Mt(e)==Nn};function yt(e){return e!=null&&Jt(e.length)&&!Kt(e)}function ft(e){return pn(e)&&yt(e)}var Yi=yl||Au,Uc=Zs?qn(Zs):function(e){return pn(e)&&Mt(e)==me};function fi(e){if(!pn(e))return!1;var t=Mt(e);return t==ke||t=="[object DOMException]"||typeof e.message=="string"&&typeof e.name=="string"&&!pi(e)}function Kt(e){if(!st(e))return!1;var t=Mt(e);return t==Ee||t==ee||t=="[object AsyncFunction]"||t=="[object Proxy]"}function Qi(e){return typeof e=="number"&&e==rt(e)}function Jt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=z}function st(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function pn(e){return e!=null&&typeof e=="object"}var Eu=ec?qn(ec):function(e){return pn(e)&&gn(e)==J};function za(e){return typeof e=="number"||pn(e)&&Mt(e)==X}function pi(e){if(!pn(e)||Mt(e)!=le)return!1;var t=Mo(e);if(t===null)return!0;var i=Ve.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&xe.call(i)==vl}var Sn=ms?qn(ms):function(e){return pn(e)&&Mt(e)==De},mo=ma?qn(ma):function(e){return pn(e)&&gn(e)==Ie};function Ct(e){return typeof e=="string"||!ut(e)&&pn(e)&&Mt(e)==_t}function Zt(e){return typeof e=="symbol"||pn(e)&&Mt(e)==bn}var qa=tr?qn(tr):function(e){return pn(e)&&Jt(e.length)&&!!Ye[Mt(e)]},Fs=Ns(On),Vs=Ns(function(e,t){return e<=t});function nn(e){if(!e)return[];if(yt(e))return Ct(e)?vn(e):lr(e);if(ji&&e[ji])return function(i){for(var o,u=[];!(o=i.next()).done;)u.push(o.value);return u}(e[ji]());var t=gn(e);return(t==J?ic:t==Ie?oc:ia)(e)}function Ne(e){return e?(e=Lr(e))===W||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:e===0?e:0}function rt(e){var t=Ne(e),i=t%1;return t==t?i?t-i:t:0}function pr(e){return e?_r(rt(e),0,ne):0}function Lr(e){if(typeof e=="number")return e;if(Zt(e))return q;if(st(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=st(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=rr(e);var i=Ro.test(e);return i||ie.test(e)?Jc(e.slice(2),i?2:8):ca.test(e)?q:+e}function pt(e){return fn(e,mn(e))}function Me(e){return e==null?"":ur(e)}var tl=Ci(function(e,t){if(Yo(t)||yt(t))fn(t,ct(t),e);else for(var i in t)Ve.call(t,i)&&ci(e,i,t[i])}),Gs=Ci(function(e,t){fn(t,mn(t),e)}),jc=Ci(function(e,t,i,o){fn(t,mn(t),e,o)}),jl=Ci(function(e,t,i,o){fn(t,ct(t),e,o)}),Fc=dr(Ia),vo=ht(function(e,t){e=Qe(e);var i=-1,o=t.length,u=o>2?t[2]:f;for(u&&sn(t[0],t[1],u)&&(o=1);++i<o;)for(var d=t[i],h=mn(d),_=-1,T=h.length;++_<T;){var C=h[_],R=e[C];(R===f||Qr(R,Ar[C])&&!Ve.call(e,C))&&(e[C]=d[C])}return e}),na=ht(function(e){return e.push(f,Ua),Rr(gi,f,e)});function Ws(e,t,i){var o=e==null?f:sr(e,t);return o===f?i:o}function yu(e,t){return e!=null&&xn(e,t,Vu)}var Fl=Er(function(e,t,i){t!=null&&typeof t.toString!="function"&&(t=Je.call(t)),e[t]=i},Hs(Xn)),Vl=Er(function(e,t,i){t!=null&&typeof t.toString!="function"&&(t=Je.call(t)),Ve.call(e,t)?e[t].push(i):e[t]=[i]},$e),Bt=ht(Gi);function ct(e){return yt(e)?de(e):uo(e)}function mn(e){return yt(e)?de(e,!0):function(t){if(!st(t))return function(d){var h=[];if(d!=null)for(var _ in Qe(d))h.push(_);return h}(t);var i=Yo(t),o=[];for(var u in t)(u!="constructor"||!i&&Ve.call(t,u))&&o.push(u);return o}(e)}var ra=Ci(function(e,t,i){Vo(e,t,i)}),gi=Ci(function(e,t,i,o){Vo(e,t,i,o)}),nl=dr(function(e,t){var i={};if(e==null)return i;var o=!1;t=lt(t,function(d){return d=Ln(d,e),o||(o=d.length>1),d}),fn(e,Ai(e),i),o&&(i=an(i,7,ja));for(var u=t.length;u--;)Dr(i,t[u]);return i}),Vc=dr(function(e,t){return e==null?{}:function(i,o){return lo(i,o,function(u,d){return yu(i,d)})}(e,t)});function mi(e,t){if(e==null)return{};var i=lt(Ai(e),function(o){return[o]});return t=$e(t),lo(e,i,function(o,u){return t(o,u[0])})}var cn=Gu(ct),En=Gu(mn);function ia(e){return e==null?[]:no(e,ct(e))}var bu=zo(function(e,t,i){return t=t.toLowerCase(),e+(i?Tu(t):t)});function Tu(e){return Ja(Me(e).toLowerCase())}function Cu(e){return(e=Me(e))&&e.replace(Te,gl).replace(Vr,"")}var rl=zo(function(e,t,i){return e+(i?"-":"")+t.toLowerCase()}),Gl=zo(function(e,t,i){return e+(i?" ":"")+t.toLowerCase()}),il=du("toLowerCase"),Iu=zo(function(e,t,i){return e+(i?"_":"")+t.toLowerCase()}),ol=zo(function(e,t,i){return e+(i?" ":"")+Ja(t)}),Ka=zo(function(e,t,i){return e+(i?" ":"")+t.toUpperCase()}),Ja=du("toUpperCase");function Ru(e,t,i){return e=Me(e),(t=i?f:t)===f?function(o){return ps.test(o)}(e)?function(o){return o.match(Pu)||[]}(e):function(o){return o.match(Ke)||[]}(e):e.match(t)||[]}var al=ht(function(e,t){try{return Rr(e,f,t)}catch(i){return fi(i)?i:new Pe(i)}}),Hn=dr(function(e,t){return Or(t,function(i){i=Qn(i),_n(e,i,js(e[i],e))}),e});function Hs(e){return function(){return e}}var _o=Ec(),yr=Ec(!0);function Xn(e){return e}function Gc(e){return hc(typeof e=="function"?e:an(e,1))}var sl=ht(function(e,t){return function(i){return Gi(i,e,t)}}),wu=ht(function(e,t){return function(i){return Gi(e,i,t)}});function yn(e,t,i){var o=ct(t),u=ar(t,o);i!=null||st(t)&&(u.length||!o.length)||(i=t,t=e,e=this,u=ar(t,ct(t)));var d=!(st(i)&&"chain"in i&&!i.chain),h=Kt(e);return Or(u,function(_){var T=t[_];e[_]=T,h&&(e.prototype[_]=function(){var C=this.__chain__;if(d||C){var R=e(this.__wrapped__);return(R.__actions__=lr(this.__actions__)).push({func:T,args:arguments,thisArg:e}),R.__chain__=C,R}return T.apply(e,ni([this.value()],arguments))})}),e}function Zn(){}var So=qo(lt),Wl=qo(ti),Wt=qo(va);function Ou(e){return Bn(e)?Sa(Qn(e)):function(t){return function(i){return sr(i,t)}}(e)}var Hl=Ds(),oa=Ds(!0);function Ya(){return[]}function Au(){return!1}var Eo,$l=xa(function(e,t){return e+t},0),s=yc("ceil"),r=xa(function(e,t){return e/t},1),a=yc("floor"),c=xa(function(e,t){return e*t},1),l=yc("round"),n=xa(function(e,t){return e-t},0);return g.after=function(e,t){if(typeof t!="function")throw new wt(b);return e=rt(e),function(){if(--e<1)return t.apply(this,arguments)}},g.ary=Nc,g.assign=tl,g.assignIn=Gs,g.assignInWith=jc,g.assignWith=jl,g.at=Fc,g.before=Mc,g.bind=js,g.bindAll=Hn,g.bindKey=Lc,g.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return ut(e)?e:[e]},g.chain=Bs,g.chunk=function(e,t,i){t=(i?sn(e,t,i):t===f)?1:gt(rt(t),0);var o=e==null?0:e.length;if(!o||t<1)return[];for(var u=0,d=0,h=re(xo(o/t));u<o;)h[d++]=dt(e,u,u+=t);return h},g.compact=function(e){for(var t=-1,i=e==null?0:e.length,o=0,u=[];++t<i;){var d=e[t];d&&(u[o++]=d)}return u},g.concat=function(){var e=arguments.length;if(!e)return[];for(var t=re(e-1),i=arguments[0],o=e;o--;)t[o-1]=arguments[o];return ni(ut(i)?lr(i):[i],bt(t,1))},g.cond=function(e){var t=e==null?0:e.length,i=$e();return e=t?lt(e,function(o){if(typeof o[1]!="function")throw new wt(b);return[i(o[0]),o[1]]}):[],ht(function(o){for(var u=-1;++u<t;){var d=e[u];if(Rr(d[0],this,o))return Rr(d[1],this,o)}})},g.conforms=function(e){return function(t){var i=ct(t);return function(o){return Cs(o,t,i)}}(an(e,1))},g.constant=Hs,g.countBy=Ml,g.create=function(e,t){var i=ze(e);return t==null?i:ou(i,t)},g.curry=function e(t,i,o){var u=wi(t,8,f,f,f,f,f,i=o?f:i);return u.placeholder=e.placeholder,u},g.curryRight=function e(t,i,o){var u=wi(t,16,f,f,f,f,f,i=o?f:i);return u.placeholder=e.placeholder,u},g.debounce=el,g.defaults=vo,g.defaultsDeep=na,g.defer=Bl,g.delay=xc,g.difference=Rl,g.differenceBy=pu,g.differenceWith=Ac,g.drop=function(e,t,i){var o=e==null?0:e.length;return o?dt(e,(t=i||t===f?1:rt(t))<0?0:t,o):[]},g.dropRight=function(e,t,i){var o=e==null?0:e.length;return o?dt(e,0,(t=o-(t=i||t===f?1:rt(t)))<0?0:t):[]},g.dropRightWhile=function(e,t){return e&&e.length?Hi(e,$e(t,3),!0,!0):[]},g.dropWhile=function(e,t){return e&&e.length?Hi(e,$e(t,3),!0):[]},g.fill=function(e,t,i,o){var u=e==null?0:e.length;return u?(i&&typeof i!="number"&&sn(e,t,i)&&(i=0,o=u),function(d,h,_,T){var C=d.length;for((_=rt(_))<0&&(_=-_>C?0:C+_),(T=T===f||T>C?C:rt(T))<0&&(T+=C),T=_>T?0:pr(T);_<T;)d[_++]=h;return d}(e,t,i,o)):[]},g.filter=function(e,t){return(ut(e)?Gr:lc)(e,$e(t,3))},g.flatMap=function(e,t){return bt(Gn(e,t),1)},g.flatMapDeep=function(e,t){return bt(Gn(e,t),W)},g.flatMapDepth=function(e,t,i){return i=i===f?1:rt(i),bt(Gn(e,t),i)},g.flatten=gu,g.flattenDeep=function(e){return e!=null&&e.length?bt(e,W):[]},g.flattenDepth=function(e,t){return e!=null&&e.length?bt(e,t=t===f?1:rt(t)):[]},g.flip=function(e){return wi(e,512)},g.flow=_o,g.flowRight=yr,g.fromPairs=function(e){for(var t=-1,i=e==null?0:e.length,o={};++t<i;){var u=e[t];o[u[0]]=u[1]}return o},g.functions=function(e){return e==null?[]:ar(e,ct(e))},g.functionsIn=function(e){return e==null?[]:ar(e,mn(e))},g.groupBy=xl,g.initial=function(e){return e!=null&&e.length?dt(e,0,-1):[]},g.intersection=wl,g.intersectionBy=$u,g.intersectionWith=Kr,g.invert=Fl,g.invertBy=Vl,g.invokeMap=Zu,g.iteratee=Gc,g.keyBy=ea,g.keys=ct,g.keysIn=mn,g.map=Gn,g.mapKeys=function(e,t){var i={};return t=$e(t,3),wn(e,function(o,u,d){_n(i,t(o,u,d),o)}),i},g.mapValues=function(e,t){var i={};return t=$e(t,3),wn(e,function(o,u,d){_n(i,u,t(o,u,d))}),i},g.matches=function(e){return fc(an(e,1))},g.matchesProperty=function(e,t){return su(e,an(t,1))},g.memoize=ta,g.merge=ra,g.mergeWith=gi,g.method=sl,g.methodOf=wu,g.mixin=yn,g.negate=Bc,g.nthArg=function(e){return e=rt(e),ht(function(t){return Pa(t,e)})},g.omit=nl,g.omitBy=function(e,t){return mi(e,Bc($e(t)))},g.once=function(e){return Mc(2,e)},g.orderBy=function(e,t,i,o){return e==null?[]:(ut(t)||(t=t==null?[]:[t]),ut(i=o?f:i)||(i=i==null?[]:[i]),pc(e,t,i))},g.over=So,g.overArgs=Su,g.overEvery=Wl,g.overSome=Wt,g.partial=$a,g.partialRight=Wn,g.partition=Jr,g.pick=Vc,g.pickBy=mi,g.property=Ou,g.propertyOf=function(e){return function(t){return e==null?f:sr(e,t)}},g.pull=zu,g.pullAll=qu,g.pullAllBy=function(e,t,i){return e&&e.length&&t&&t.length?gc(e,t,$e(i,2)):e},g.pullAllWith=function(e,t,i){return e&&e.length&&t&&t.length?gc(e,t,f,i):e},g.pullAt=Zo,g.range=Hl,g.rangeRight=oa,g.rearg=Yr,g.reject=function(e,t){return(ut(e)?Gr:lc)(e,Bc($e(t,3)))},g.remove=function(e,t){var i=[];if(!e||!e.length)return i;var o=-1,u=[],d=e.length;for(t=$e(t,3);++o<d;){var h=e[o];t(h,o,e)&&(i.push(h),u.push(o))}return mc(e,u),i},g.rest=function(e,t){if(typeof e!="function")throw new wt(b);return ht(e,t=t===f?t:rt(t))},g.reverse=Ha,g.sampleSize=function(e,t,i){return t=(i?sn(e,t,i):t===f)?1:rt(t),(ut(e)?Il:Na)(e,t)},g.set=function(e,t,i){return e==null?e:cr(e,t,i)},g.setWith=function(e,t,i,o){return o=typeof o=="function"?o:f,e==null?e:cr(e,t,i,o)},g.shuffle=function(e){return(ut(e)?cc:ho)(e)},g.slice=function(e,t,i){var o=e==null?0:e.length;return o?(i&&typeof i!="number"&&sn(e,t,i)?(t=0,i=o):(t=t==null?0:rt(t),i=i===f?o:rt(i)),dt(e,t,i)):[]},g.sortBy=Lt,g.sortedUniq=function(e){return e&&e.length?ks(e):[]},g.sortedUniqBy=function(e,t){return e&&e.length?ks(e,$e(t,2)):[]},g.split=function(e,t,i){return i&&typeof i!="number"&&sn(e,t,i)&&(t=i=f),(i=i===f?ne:i>>>0)?(e=Me(e))&&(typeof t=="string"||t!=null&&!Sn(t))&&!(t=ur(t))&&ro(e)?Nr(vn(e),0,i):e.split(t,i):[]},g.spread=function(e,t){if(typeof e!="function")throw new wt(b);return t=t==null?0:gt(rt(t),0),ht(function(i){var o=i[t],u=Nr(i,0,t);return o&&ni(u,o),Rr(e,this,u)})},g.tail=function(e){var t=e==null?0:e.length;return t?dt(e,1,t):[]},g.take=function(e,t,i){return e&&e.length?dt(e,0,(t=i||t===f?1:rt(t))<0?0:t):[]},g.takeRight=function(e,t,i){var o=e==null?0:e.length;return o?dt(e,(t=o-(t=i||t===f?1:rt(t)))<0?0:t,o):[]},g.takeRightWhile=function(e,t){return e&&e.length?Hi(e,$e(t,3),!1,!0):[]},g.takeWhile=function(e,t){return e&&e.length?Hi(e,$e(t,3)):[]},g.tap=function(e,t){return t(e),e},g.throttle=function(e,t,i){var o=!0,u=!0;if(typeof e!="function")throw new wt(b);return st(i)&&(o="leading"in i?!!i.leading:o,u="trailing"in i?!!i.trailing:u),el(e,t,{leading:o,maxWait:t,trailing:u})},g.thru=Dc,g.toArray=nn,g.toPairs=cn,g.toPairsIn=En,g.toPath=function(e){return ut(e)?lt(e,Qn):Zt(e)?[e]:lr(di(Me(e)))},g.toPlainObject=pt,g.transform=function(e,t,i){var o=ut(e),u=o||Yi(e)||qa(e);if(t=$e(t,4),i==null){var d=e&&e.constructor;i=u?o?new d:[]:st(e)&&Kt(d)?ze(Mo(e)):{}}return(u?Or:wn)(e,function(h,_,T){return t(i,h,_,T)}),i},g.unary=function(e){return Nc(e,1)},g.union=Ku,g.unionBy=Ol,g.unionWith=mu,g.uniq=function(e){return e&&e.length?Dt(e):[]},g.uniqBy=function(e,t){return e&&e.length?Dt(e,$e(t,2)):[]},g.uniqWith=function(e,t){return t=typeof t=="function"?t:f,e&&e.length?Dt(e,f,t):[]},g.unset=function(e,t){return e==null||Dr(e,t)},g.unzip=Pc,g.unzipWith=Ju,g.update=function(e,t,i){return e==null?e:Wo(e,t,$i(i))},g.updateWith=function(e,t,i,o){return o=typeof o=="function"?o:f,e==null?e:Wo(e,t,$i(i),o)},g.values=ia,g.valuesIn=function(e){return e==null?[]:no(e,mn(e))},g.without=Al,g.words=Ru,g.wrap=function(e,t){return $a($i(t),e)},g.xor=kl,g.xorBy=Yu,g.xorWith=Pl,g.zip=Dl,g.zipObject=function(e,t){return Ti(e||[],t||[],ci)},g.zipObjectDeep=function(e,t){return Ti(e||[],t||[],cr)},g.zipWith=vu,g.entries=cn,g.entriesIn=En,g.extend=Gs,g.extendWith=jc,yn(g,g),g.add=$l,g.attempt=al,g.camelCase=bu,g.capitalize=Tu,g.ceil=s,g.clamp=function(e,t,i){return i===f&&(i=t,t=f),i!==f&&(i=(i=Lr(i))==i?i:0),t!==f&&(t=(t=Lr(t))==t?t:0),_r(Lr(e),t,i)},g.clone=function(e){return an(e,4)},g.cloneDeep=function(e){return an(e,5)},g.cloneDeepWith=function(e,t){return an(e,5,t=typeof t=="function"?t:f)},g.cloneWith=function(e,t){return an(e,4,t=typeof t=="function"?t:f)},g.conformsTo=function(e,t){return t==null||Cs(e,t,ct(t))},g.deburr=Cu,g.defaultTo=function(e,t){return e==null||e!=e?t:e},g.divide=r,g.endsWith=function(e,t,i){e=Me(e),t=ur(t);var o=e.length,u=i=i===f?o:_r(rt(i),0,o);return(i-=t.length)>=0&&e.slice(i,u)==t},g.eq=Qr,g.escape=function(e){return(e=Me(e))&&er.test(e)?e.replace(sa,ml):e},g.escapeRegExp=function(e){return(e=Me(e))&&cs.test(e)?e.replace(ei,"\\$&"):e},g.every=function(e,t,i){var o=ut(e)?ti:au;return i&&sn(e,t,i)&&(t=f),o(e,$e(t,3))},g.find=Ll,g.findIndex=kc,g.findKey=function(e,t){return vs(e,$e(t,3),wn)},g.findLast=Qu,g.findLastIndex=xs,g.findLastKey=function(e,t){return vs(e,$e(t,3),Oa)},g.floor=a,g.forEach=_u,g.forEachRight=Xu,g.forIn=function(e,t){return e==null?e:Ra(e,$e(t,3),mn)},g.forInRight=function(e,t){return e==null?e:wa(e,$e(t,3),mn)},g.forOwn=function(e,t){return e&&wn(e,$e(t,3))},g.forOwnRight=function(e,t){return e&&Oa(e,$e(t,3))},g.get=Ws,g.gt=Ul,g.gte=hi,g.has=function(e,t){return e!=null&&xn(e,t,Fu)},g.hasIn=yu,g.head=Hu,g.identity=Xn,g.includes=function(e,t,i,o){e=yt(e)?e:ia(e),i=i&&!o?rt(i):0;var u=e.length;return i<0&&(i=gt(u+i,0)),Ct(e)?i<=u&&e.indexOf(t,i)>-1:!!u&&_a(e,t,i)>-1},g.indexOf=function(e,t,i){var o=e==null?0:e.length;if(!o)return-1;var u=i==null?0:rt(i);return u<0&&(u=gt(o+u,0)),_a(e,t,u)},g.inRange=function(e,t,i){return t=Ne(t),i===f?(i=t,t=0):i=Ne(i),function(o,u,d){return o>=Ot(u,d)&&o<gt(u,d)}(e=Lr(e),t,i)},g.invoke=Bt,g.isArguments=Be,g.isArray=ut,g.isArrayBuffer=fr,g.isArrayLike=yt,g.isArrayLikeObject=ft,g.isBoolean=function(e){return e===!0||e===!1||pn(e)&&Mt(e)==H},g.isBuffer=Yi,g.isDate=Uc,g.isElement=function(e){return pn(e)&&e.nodeType===1&&!pi(e)},g.isEmpty=function(e){if(e==null)return!0;if(yt(e)&&(ut(e)||typeof e=="string"||typeof e.splice=="function"||Yi(e)||qa(e)||Be(e)))return!e.length;var t=gn(e);if(t==J||t==Ie)return!e.size;if(Yo(e))return!uo(e).length;for(var i in e)if(Ve.call(e,i))return!1;return!0},g.isEqual=function(e,t){return bi(e,t)},g.isEqualWith=function(e,t,i){var o=(i=typeof i=="function"?i:f)?i(e,t):f;return o===f?bi(e,t,f,i):!!o},g.isError=fi,g.isFinite=function(e){return typeof e=="number"&&Uo(e)},g.isFunction=Kt,g.isInteger=Qi,g.isLength=Jt,g.isMap=Eu,g.isMatch=function(e,t){return e===t||ws(e,t,Fa(t))},g.isMatchWith=function(e,t,i){return i=typeof i=="function"?i:f,ws(e,t,Fa(t),i)},g.isNaN=function(e){return za(e)&&e!=+e},g.isNative=function(e){if(Tc(e))throw new Pe("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Re(e)},g.isNil=function(e){return e==null},g.isNull=function(e){return e===null},g.isNumber=za,g.isObject=st,g.isObjectLike=pn,g.isPlainObject=pi,g.isRegExp=Sn,g.isSafeInteger=function(e){return Qi(e)&&e>=-9007199254740991&&e<=z},g.isSet=mo,g.isString=Ct,g.isSymbol=Zt,g.isTypedArray=qa,g.isUndefined=function(e){return e===f},g.isWeakMap=function(e){return pn(e)&&gn(e)==Yt},g.isWeakSet=function(e){return pn(e)&&Mt(e)=="[object WeakSet]"},g.join=function(e,t){return e==null?"":bl.call(e,t)},g.kebabCase=rl,g.last=hr,g.lastIndexOf=function(e,t,i){var o=e==null?0:e.length;if(!o)return-1;var u=o;return i!==f&&(u=(u=rt(i))<0?gt(o+u,0):Ot(u,o-1)),t==t?function(d,h,_){for(var T=_+1;T--;)if(d[T]===h)return T;return T}(e,t,u):ri(e,Xc,u,!0)},g.lowerCase=Gl,g.lowerFirst=il,g.lt=Fs,g.lte=Vs,g.max=function(e){return e&&e.length?co(e,Xn,Aa):f},g.maxBy=function(e,t){return e&&e.length?co(e,$e(t,2),Aa):f},g.mean=function(e){return nr(e,Xn)},g.meanBy=function(e,t){return nr(e,$e(t,2))},g.min=function(e){return e&&e.length?co(e,Xn,On):f},g.minBy=function(e,t){return e&&e.length?co(e,$e(t,2),On):f},g.stubArray=Ya,g.stubFalse=Au,g.stubObject=function(){return{}},g.stubString=function(){return""},g.stubTrue=function(){return!0},g.multiply=c,g.nth=function(e,t){return e&&e.length?Pa(e,rt(t)):f},g.noConflict=function(){return Cn._===this&&(Cn._=_l),this},g.noop=Zn,g.now=Us,g.pad=function(e,t,i){e=Me(e);var o=(t=rt(t))?ii(e):0;if(!t||o>=t)return e;var u=(t-o)/2;return Ba(Bo(u),i)+e+Ba(xo(u),i)},g.padEnd=function(e,t,i){e=Me(e);var o=(t=rt(t))?ii(e):0;return t&&o<t?e+Ba(t-o,i):e},g.padStart=function(e,t,i){e=Me(e);var o=(t=rt(t))?ii(e):0;return t&&o<t?Ba(t-o,i)+e:e},g.parseInt=function(e,t,i){return i||t==null?t=0:t&&(t=+t),Tl(Me(e).replace(Rt,""),t||0)},g.random=function(e,t,i){if(i&&typeof i!="boolean"&&sn(e,t,i)&&(t=i=f),i===f&&(typeof t=="boolean"?(i=t,t=f):typeof e=="boolean"&&(i=e,e=f)),e===f&&t===f?(e=0,t=1):(e=Ne(e),t===f?(t=e,e=0):t=Ne(t)),e>t){var o=e;e=t,t=o}if(i||e%1||t%1){var u=Ts();return Ot(e+u*(t-e+Kc("1e-"+((u+"").length-1))),t)}return As(e,t)},g.reduce=function(e,t,i){var o=ut(e)?Yc:nc,u=arguments.length<3;return o(e,$e(t,4),i,u,jn)},g.reduceRight=function(e,t,i){var o=ut(e)?Qc:nc,u=arguments.length<3;return o(e,$e(t,4),i,u,uc)},g.repeat=function(e,t,i){return t=(i?sn(e,t,i):t===f)?1:rt(t),Da(Me(e),t)},g.replace=function(){var e=arguments,t=Me(e[0]);return e.length<3?t:t.replace(e[1],e[2])},g.result=function(e,t,i){var o=-1,u=(t=Ln(t,e)).length;for(u||(u=1,e=f);++o<u;){var d=e==null?f:e[Qn(t[o])];d===f&&(o=u,d=i),e=Kt(d)?d.call(e):d}return e},g.round=l,g.runInContext=L,g.sample=function(e){return(ut(e)?or:at)(e)},g.size=function(e){if(e==null)return 0;if(yt(e))return Ct(e)?ii(e):e.length;var t=gn(e);return t==J||t==Ie?e.size:uo(e).length},g.snakeCase=Iu,g.some=function(e,t,i){var o=ut(e)?va:kr;return i&&sn(e,t,i)&&(t=f),o(e,$e(t,3))},g.sortedIndex=function(e,t){return Pr(e,t)},g.sortedIndexBy=function(e,t,i){return Go(e,t,$e(i,2))},g.sortedIndexOf=function(e,t){var i=e==null?0:e.length;if(i){var o=Pr(e,t);if(o<i&&Qr(e[o],t))return o}return-1},g.sortedLastIndex=function(e,t){return Pr(e,t,!0)},g.sortedLastIndexBy=function(e,t,i){return Go(e,t,$e(i,2),!0)},g.sortedLastIndexOf=function(e,t){if(e!=null&&e.length){var i=Pr(e,t,!0)-1;if(Qr(e[i],t))return i}return-1},g.startCase=ol,g.startsWith=function(e,t,i){return e=Me(e),i=i==null?0:_r(rt(i),0,e.length),t=ur(t),e.slice(i,i+t.length)==t},g.subtract=n,g.sum=function(e){return e&&e.length?Ss(e,Xn):0},g.sumBy=function(e,t){return e&&e.length?Ss(e,$e(t,2)):0},g.template=function(e,t,i){var o=g.templateSettings;i&&sn(e,t,i)&&(t=f),e=Me(e),t=jc({},t,o,Oi);var u,d,h=jc({},t.imports,o.imports,Oi),_=ct(h),T=no(h,_),C=0,R=t.interpolate||Xe,w="__p += '",P=Es((t.escape||Xe).source+"|"+R.source+"|"+(R===eo?Ys:Xe).source+"|"+(t.evaluate||Xe).source+"|$","g"),U="//# sourceURL="+(Ve.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++zt+"]")+`
`;e.replace(P,function($,K,Q,oe,ce,ae){return Q||(Q=oe),w+=e.slice(C,ae).replace(tn,ya),K&&(u=!0,w+=`' +
__e(`+K+`) +
'`),ce&&(d=!0,w+=`';
`+ce+`;
__p += '`),Q&&(w+=`' +
((__t = (`+Q+`)) == null ? '' : __t) +
'`),C=ae+$.length,$}),w+=`';
`;var j=Ve.call(t,"variable")&&t.variable;if(j){if(Js.test(j))throw new Pe("Invalid `variable` option passed into `_.template`")}else w=`with (obj) {
`+w+`
}
`;w=(d?w.replace(Ks,""):w).replace(un,"$1").replace(os,"$1;"),w="function("+(j||"obj")+`) {
`+(j?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(u?", __e = _.escape":"")+(d?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+w+`return __p
}`;var B=al(function(){return Ze(_,U+"return "+w).apply(f,T)});if(B.source=w,fi(B))throw B;return B},g.times=function(e,t){if((e=rt(e))<1||e>z)return[];var i=ne,o=Ot(e,ne);t=$e(t),e-=ne;for(var u=rc(o,t);++i<e;)t(i);return u},g.toFinite=Ne,g.toInteger=rt,g.toLength=pr,g.toLower=function(e){return Me(e).toLowerCase()},g.toNumber=Lr,g.toSafeInteger=function(e){return e?_r(rt(e),-9007199254740991,z):e===0?e:0},g.toString=Me,g.toUpper=function(e){return Me(e).toUpperCase()},g.trim=function(e,t,i){if((e=Me(e))&&(i||t===f))return rr(e);if(!e||!(t=ur(t)))return e;var o=vn(e),u=vn(t);return Nr(o,Zc(o,u),Mu(o,u)+1).join("")},g.trimEnd=function(e,t,i){if((e=Me(e))&&(i||t===f))return e.slice(0,dn(e)+1);if(!e||!(t=ur(t)))return e;var o=vn(e);return Nr(o,0,Mu(o,vn(t))+1).join("")},g.trimStart=function(e,t,i){if((e=Me(e))&&(i||t===f))return e.replace(Rt,"");if(!e||!(t=ur(t)))return e;var o=vn(e);return Nr(o,Zc(o,vn(t))).join("")},g.truncate=function(e,t){var i=30,o="...";if(st(t)){var u="separator"in t?t.separator:u;i="length"in t?rt(t.length):i,o="omission"in t?ur(t.omission):o}var d=(e=Me(e)).length;if(ro(e)){var h=vn(e);d=h.length}if(i>=d)return e;var _=i-ii(o);if(_<1)return o;var T=h?Nr(h,0,_).join(""):e.slice(0,_);if(u===f)return T+o;if(h&&(_+=T.length-_),Sn(u)){if(e.slice(_).search(u)){var C,R=T;for(u.global||(u=Es(u.source,Me(Io.exec(u))+"g")),u.lastIndex=0;C=u.exec(R);)var w=C.index;T=T.slice(0,w===f?_:w)}}else if(e.indexOf(ur(u),_)!=_){var P=T.lastIndexOf(u);P>-1&&(T=T.slice(0,P))}return T+o},g.unescape=function(e){return(e=Me(e))&&bo.test(e)?e.replace(as,ac):e},g.uniqueId=function(e){var t=++eu;return Me(e)+t},g.upperCase=Ka,g.upperFirst=Ja,g.each=_u,g.eachRight=Xu,g.first=Hu,yn(g,(Eo={},wn(g,function(e,t){Ve.call(g.prototype,t)||(Eo[t]=e)}),Eo),{chain:!1}),g.VERSION="4.17.21",Or(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){g[e].placeholder=g}),Or(["drop","take"],function(e,t){Ae.prototype[e]=function(i){i=i===f?1:gt(rt(i),0);var o=this.__filtered__&&!t?new Ae(this):this.clone();return o.__filtered__?o.__takeCount__=Ot(i,o.__takeCount__):o.__views__.push({size:Ot(i,ne),type:e+(o.__dir__<0?"Right":"")}),o},Ae.prototype[e+"Right"]=function(i){return this.reverse()[e](i).reverse()}}),Or(["filter","map","takeWhile"],function(e,t){var i=t+1,o=i==1||i==3;Ae.prototype[e]=function(u){var d=this.clone();return d.__iteratees__.push({iteratee:$e(u,3),type:i}),d.__filtered__=d.__filtered__||o,d}}),Or(["head","last"],function(e,t){var i="take"+(t?"Right":"");Ae.prototype[e]=function(){return this[i](1).value()[0]}}),Or(["initial","tail"],function(e,t){var i="drop"+(t?"":"Right");Ae.prototype[e]=function(){return this.__filtered__?new Ae(this):this[i](1)}}),Ae.prototype.compact=function(){return this.filter(Xn)},Ae.prototype.find=function(e){return this.filter(e).head()},Ae.prototype.findLast=function(e){return this.reverse().find(e)},Ae.prototype.invokeMap=ht(function(e,t){return typeof e=="function"?new Ae(this):this.map(function(i){return Gi(i,e,t)})}),Ae.prototype.reject=function(e){return this.filter(Bc($e(e)))},Ae.prototype.slice=function(e,t){e=rt(e);var i=this;return i.__filtered__&&(e>0||t<0)?new Ae(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),t!==f&&(i=(t=rt(t))<0?i.dropRight(-t):i.take(t-e)),i)},Ae.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Ae.prototype.toArray=function(){return this.take(ne)},wn(Ae.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),o=/^(?:head|last)$/.test(t),u=g[o?"take"+(t=="last"?"Right":""):t],d=o||/^find/.test(t);u&&(g.prototype[t]=function(){var h=this.__wrapped__,_=o?[1]:arguments,T=h instanceof Ae,C=_[0],R=T||ut(h),w=function(K){var Q=u.apply(g,ni([K],_));return o&&P?Q[0]:Q};R&&i&&typeof C=="function"&&C.length!=1&&(T=R=!1);var P=this.__chain__,U=!!this.__actions__.length,j=d&&!P,B=T&&!U;if(!d&&R){h=B?h:new Ae(this);var $=e.apply(h,_);return $.__actions__.push({func:Dc,args:[w],thisArg:f}),new Xt($,P)}return j&&B?e.apply(this,_):($=this.thru(w),j?o?$.value()[0]:$.value():$)})}),Or(["pop","push","shift","sort","splice","unshift"],function(e){var t=Ui[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",o=/^(?:pop|shift)$/.test(e);g.prototype[e]=function(){var u=arguments;if(o&&!this.__chain__){var d=this.value();return t.apply(ut(d)?d:[],u)}return this[i](function(h){return t.apply(ut(h)?h:[],u)})}}),wn(Ae.prototype,function(e,t){var i=g[t];if(i){var o=i.name+"";Ve.call($r,o)||($r[o]=[]),$r[o].push({name:t,func:i})}}),$r[La(f,2).name]=[{name:"wrapper",func:f}],Ae.prototype.clone=function(){var e=new Ae(this.__wrapped__);return e.__actions__=lr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=lr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=lr(this.__views__),e},Ae.prototype.reverse=function(){if(this.__filtered__){var e=new Ae(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Ae.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,i=ut(e),o=t<0,u=i?e.length:0,d=function(ae,te,pe){for(var be=-1,Ce=pe.length;++be<Ce;){var _e=pe[be],Se=_e.size;switch(_e.type){case"drop":ae+=Se;break;case"dropRight":te-=Se;break;case"take":te=Ot(te,ae+Se);break;case"takeRight":ae=gt(ae,te-Se)}}return{start:ae,end:te}}(0,u,this.__views__),h=d.start,_=d.end,T=_-h,C=o?_:h-1,R=this.__iteratees__,w=R.length,P=0,U=Ot(T,this.__takeCount__);if(!i||!o&&u==T&&U==T)return Ho(e,this.__actions__);var j=[];e:for(;T--&&P<U;){for(var B=-1,$=e[C+=t];++B<w;){var K=R[B],Q=K.iteratee,oe=K.type,ce=Q($);if(oe==2)$=ce;else if(!ce){if(oe==1)continue e;break e}}j[P++]=$}return j},g.prototype.at=Nl,g.prototype.chain=function(){return Bs(this)},g.prototype.commit=function(){return new Xt(this.value(),this.__chain__)},g.prototype.next=function(){this.__values__===f&&(this.__values__=nn(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?f:this.__values__[this.__index__++]}},g.prototype.plant=function(e){for(var t,i=this;i instanceof si;){var o=Wu(i);o.__index__=0,o.__values__=f,t?u.__wrapped__=o:t=o;var u=o;i=i.__wrapped__}return u.__wrapped__=e,t},g.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Ae){var t=e;return this.__actions__.length&&(t=new Ae(this)),(t=t.reverse()).__actions__.push({func:Dc,args:[Ha],thisArg:f}),new Xt(t,this.__chain__)}return this.thru(Ha)},g.prototype.toJSON=g.prototype.valueOf=g.prototype.value=function(){return Ho(this.__wrapped__,this.__actions__)},g.prototype.first=g.prototype.head,ji&&(g.prototype[ji]=function(){return this}),g}();Cn._=No,(S=(function(){return No}).call(E,I,E,y))===f||(y.exports=S)}).call(this)},815:function(y,E){var I,S,f=this&&this.__extends||(I=function(ee,J){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(X,le){X.__proto__=le}||function(X,le){for(var ge in le)Object.prototype.hasOwnProperty.call(le,ge)&&(X[ge]=le[ge])},I(ee,J)},function(ee,J){if(typeof J!="function"&&J!==null)throw new TypeError("Class extends value "+String(J)+" is not a constructor or null");function X(){this.constructor=ee}I(ee,J),ee.prototype=J===null?Object.create(J):(X.prototype=J.prototype,new X)});function b(ee){return 60*ee*60}function x(ee,J){var X={};return Object.assign(X,ee),J&&Object.assign(X,J),X}Object.defineProperty(E,"__esModule",{value:!0}),E.DeviceConfigPropertyHolder=E.DeviceConfigManager=E.DeviceConfigEnv=void 0,function(ee){ee.BETA="beta",ee.PROD="prod",ee.CUSTOM="custom"}(S||(E.DeviceConfigEnv=S={}));var D=function(ee){function J(X){return ee.call(this,X)||this}return f(J,ee),J}(Error),A="data",M=b(2),W="base64",z=function(){function ee(J,X){var le,ge,De,Ie,_t,bn,Yt,Nn;if(!X.fileKey)throw new Error("options.fileKey cannot be empty");var kn=(le=X.clock)!==null&&le!==void 0?le:new me,Ur=kn.getMillis();switch(this.context=J,this.fileKey=X.fileKey,this.env=X.standardEnv,X.standardEnv){case S.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case S.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case S.CUSTOM:if(!X.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=X.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(X.standardEnv))}this.trace=(ge=X.trace)!==null&&ge!==void 0?ge:new he(X.enableConsoleLog),this.fetch=(De=X.fetch)!==null&&De!==void 0?De:new se(J),this.storage=new H("amazon_ivs_device_config_v1_"+X.fileKey,J.localStorage),this.state=new Ee(this.storage,"state"),this.refresh={refreshIntervalSeconds:(Ie=X.refresh.refreshIntervalSeconds)!==null&&Ie!==void 0?Ie:900,retryCount:(_t=X.refresh.retryCount)!==null&&_t!==void 0?_t:3,retryIntervalSeconds:(bn=X.refresh.retryIntervalSeconds)!==null&&bn!==void 0?bn:10,maxCacheAgeSeconds:(Yt=X.refresh.maxCacheAgeSeconds)!==null&&Yt!==void 0?Yt:259200,stopRefreshAfterSeconds:(Nn=X.refresh.stopRefreshAfterSeconds)!==null&&Nn!==void 0?Nn:M,canRefreshNow:X.refresh.canRefreshNow},this.emitMetrics=X.emitMetrics,this.analyticsProperties=X.analyticsProperties,this.enableConsoleLog=X.enableConsoleLog,this.clock=kn,this.isInitialRefreshDone=!1;var Tr=0,gr=this.state.getState();gr&&gr.fetchServer===this.fetchServer&&gr.lastFetchWhenMs&&(Tr=gr.lastFetchWhenMs);var $n,jr=kn.getMillis(),Cr=(jr-Tr)/1e3;if(Cr<=this.refresh.maxCacheAgeSeconds){var Ir=this.storage.getJson(A);Ir&&Ir.fetchServer===this.fetchServer&&this.setData(Ir.json)}this.lastUseMs=jr,Cr>=this.refresh.refreshIntervalSeconds||Tr==0?$n=0:($n=Math.round(this.refresh.refreshIntervalSeconds-Cr),this.isInitialRefreshDone=!0),$n<5&&($n=5),this.trace.onTrace("Will start refresh in "+$n+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*$n);var qe=kn.getMillis();this.initialLoadTime=qe-Ur}return ee.getInstance=function(J,X){try{if(!(J.fetch&&J.setTimeout&&J.clearTimeout&&J.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(le){return void console.error("Error checking for context properties "+le)}if(this.gInstance){if(this.gInstance.fileKey!=X.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(X.fileKey));return this.gInstance}return this.gInstance=new ee(J,X),this.gInstance},ee.prototype.getConfigurationHolder=function(J){var X,le=this.clock.getMillis();this.lastUseMs=le;var ge=(X=J.analytics)!==null&&X!==void 0?X:new Oe(this.enableConsoleLog),De=0,Ie=this.state.getState();return Ie&&Ie.fetchServer===this.fetchServer&&Ie.lastFetchWhenMs&&(De=Ie.lastFetchWhenMs),(le-De)/1e3<=this.refresh.maxCacheAgeSeconds?new q(ge,this.analyticsProperties,this.properties,De,this.clock):new q(ge,void 0,void 0,0,this.clock)},ee.prototype.getFetchUrl=function(){var J="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),X=new URL(J);return X.searchParams.set("version","1.0"),X},ee.clearInstance=function(){var J;(J=this.gInstance)===null||J===void 0||J.clearInstanceImpl(),this.gInstance=void 0},ee.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},ee.prototype.startRefresh=function(){var J=this;this.trace.onTrace("Starting refresh request"),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds);var X=this.clock.getMillis();if((X-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds)this.trace.onTrace("Will not refresh due to refresh timeout");else if(!this.isInitialRefreshDone||this.refresh.canRefreshNow()){this.isInitialRefreshDone=!0;var le={};this.fetchData().then(function(ge){J.processResponse(ge,le,X),J.emitMetricsImpl(le)}).catch(function(ge){J.exceptionMetrics(le,ge),J.emitMetricsImpl(le),J.trace.onTrace("Fetch error: "+ge),J.refresh.retryCount>0&&J.scheduleRetry(1)})}else this.trace.onTrace("Will not refresh due to callback having returned false")},ee.prototype.fetchData=function(){var J=this.getFetchUrl(),X=new Headers,le=this.state.getState();return le.fetchServer===this.fetchServer&&(le.lastFetchWhenFullMs&&this.clock.getMillis()-le.lastFetchWhenFullMs>1e3*b(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&le.lastFetchEtagHeader&&X.set("If-None-Match",le.lastFetchEtagHeader)),this.fetch.fetchUrl(J,X)},ee.prototype.processResponse=function(J,X,le){var ge={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},De=J.headers.get("etag");if(De&&(ge.lastFetchEtagHeader=De),J.status<300&&J.json)if(this.setData(J.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(A,{fetchServer:this.fetchServer,json:J.json});var Ie=this.clock.getMillis();ge.lastFetchWhenFullMs=Ie,this.state.setState(ge),X.success_new_data_count=1,X.fetch_duration_average=Math.max(0,Ie-le)}else X.fail_invalid_data_count=1;else{if(J.status!==304){var _t="Unexpected http fetch status: "+J.status;throw this.trace.onTrace(_t),new D(_t)}this.trace.onTrace("Server said no change in data"),Ie=this.clock.getMillis(),ge.lastFetchWhenMs=Ie,this.state.setState(ge),X.success_no_change_count=1,X.fetch_duration_average=Math.max(0,Ie-le)}},ee.prototype.scheduleRetry=function(J){var X=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var le=J*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout(function(){X.retryTask=void 0,X.fetchRetry(J)},1e3*le)},ee.prototype.fetchRetry=function(J){var X=this;this.trace.onTrace("Starting retry request ".concat(J,"..."));var le={},ge=this.clock.getMillis();this.fetchData().then(function(De){X.processResponse(De,le,ge),X.emitMetricsImpl(le)}).catch(function(De){X.exceptionMetrics(le,De),X.emitMetricsImpl(le),X.trace.onTrace("Fetch error: "+De),X.refresh.retryCount>J&&X.scheduleRetry(J+1)})},ee.prototype.setData=function(J){if(!J)return!1;if(J.version!=="1.0")return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var X=J.properties;if(!X||!Array.isArray(X))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var le=new Map,ge=0,De=X;ge<De.length;ge++){var Ie=De[ge];if(Ie.name&&Ie.type&&this.isValidValueType(Ie.type)){if(Ie.value_string&&typeof Ie.value_string!="string"){this.trace.onTrace("Invalid type of value.value_string "+typeof Ie.value_string);continue}if(Ie.value_number&&typeof Ie.value_number!="number"){this.trace.onTrace("Invalid type of value.value_number "+typeof Ie.value_number);continue}if(Ie.value_boolean&&typeof Ie.value_boolean!="boolean"){this.trace.onTrace("Invalid type of value.value_boolean "+typeof Ie.value_boolean);continue}if(Ie.value_json&&typeof Ie.value_json!="string"){this.trace.onTrace("Invalid type of value.value_json "+typeof Ie.value_json);continue}if(Ie.value_analytics&&typeof Ie.value_analytics!="string"){this.trace.onTrace("Invalid type of item.value_analytics "+typeof Ie.value_analytics);continue}var _t=new ke(Ie.name,this.parseValueType(Ie.type),Ie.value_string,Ie.value_number,Ie.value_boolean,Ie.value_json,Ie.value_analytics,Ie.encoding);le.set(_t.name,_t)}}return le.size!=0&&(this.properties=le,!0)},ee.prototype.isValidValueType=function(J){return J==="string"||J==="number"||J==="boolean"||J=="json"},ee.prototype.parseValueType=function(J){switch(J){case"string":return ne.STRING;case"number":return ne.NUMBER;case"boolean":return ne.BOOLEAN;case"json":return ne.JSON;default:throw new Error("Unsupported value type ".concat(J))}},ee.prototype.emitMetricsImpl=function(J){var X,le,ge,De,Ie,_t,bn={initial_load_time:this.initialLoadTime,fetch_attempt_count:1,fetch_duration_average:(X=J.fetch_duration_average)!==null&&X!==void 0?X:0,success_no_change_count:(le=J.success_no_change_count)!==null&&le!==void 0?le:0,success_new_data_count:(ge=J.success_new_data_count)!==null&&ge!==void 0?ge:0,fail_exception_count:(De=J.fail_exception_count)!==null&&De!==void 0?De:0,fail_http_error_count:(Ie=J.fail_http_error_count)!==null&&Ie!==void 0?Ie:0,fail_invalid_data_count:(_t=J.fail_invalid_data_count)!==null&&_t!==void 0?_t:0};this.emitMetrics(x(bn,this.analyticsProperties))},ee.prototype.exceptionMetrics=function(J,X){var le;X instanceof D||!((le=X==null?void 0:X.message)===null||le===void 0)&&le.startsWith("http error")?J.fail_http_error_count=1:J.fail_exception_count=1},ee}();E.DeviceConfigManager=z;var q=function(){function ee(J,X,le,ge,De){this.analytics=J,this.analyticsProperties=X,this.properties=le,this.dataFetchedWhenMs=ge,this.clock=De}return ee.prototype.getSize=function(){return this.properties?this.properties.size:-1},ee.prototype.getStringValue=function(J){var X,le;if(this.properties){var ge=this.properties.get(J);if(ge){if(ge.type===ne.STRING){var De=(X=ge.valueString)!==null&&X!==void 0?X:"";return this.analytics.onValue(x({key_name:ge.name,value:(le=ge.valueAnalytics)!==null&&le!==void 0?le:De,fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),De}this.analytics.onError(x({key_name:ge.name,message:"Type is not string"},this.analyticsProperties))}}else this.analytics.onTrace(x({key_name:J,message:"Configuration is not available"},this.analyticsProperties))},ee.prototype.getNumberValue=function(J){var X,le;if(this.properties){var ge=this.properties.get(J);if(ge){if(ge.type===ne.NUMBER){var De=(X=ge.valueNumber)!==null&&X!==void 0?X:0;return this.analytics.onValue(x({key_name:ge.name,value:(le=ge.valueAnalytics)!==null&&le!==void 0?le:De.toString(),fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),De}this.analytics.onError(x({key_name:ge.name,message:"Type is not number"},this.analyticsProperties))}}else this.analytics.onTrace(x({key_name:J,message:"Configuration is not available"},this.analyticsProperties))},ee.prototype.getBooleanValue=function(J){var X,le;if(this.properties){var ge=this.properties.get(J);if(ge){if(ge.type===ne.BOOLEAN){var De=(X=ge.valueBoolean)!==null&&X!==void 0&&X;return this.analytics.onValue(x({key_name:ge.name,value:(le=ge.valueAnalytics)!==null&&le!==void 0?le:De.toString(),fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),De}this.analytics.onError(x({key_name:ge.name,message:"Type is not number"},this.analyticsProperties))}}else this.analytics.onTrace(x({key_name:J,message:"Configuration is not available"},this.analyticsProperties))},ee.prototype.getJsonValue=function(J){var X,le;if(this.properties){var ge=this.properties.get(J);if(ge){if(ge.type===ne.JSON){var De=ge.valueJson;if(!De)return this.analytics.onValue(x({key_name:ge.name,value:(X=ge.valueAnalytics)!==null&&X!==void 0?X:"",fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),null;try{var Ie=JSON.parse(De);return this.analytics.onValue(x({key_name:ge.name,value:(le=ge.valueAnalytics)!==null&&le!==void 0?le:Ie,fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),Ie}catch{return void this.analytics.onError(x({key_name:ge.name,message:"JSON parse error"},this.analyticsProperties))}}this.analytics.onError(x({key_name:ge.name,message:"Type is not JSON"},this.analyticsProperties))}}else this.analytics.onTrace(x({key_name:J,message:"Configuration is not available"},this.analyticsProperties))},ee.prototype.getFetchedSecondsAgo=function(){if(this.dataFetchedWhenMs)return(this.clock.getMillis()-this.dataFetchedWhenMs)/1e3},ee}();E.DeviceConfigPropertyHolder=q;var ne,se=function(){function ee(J){this.context=J}return ee.prototype.fetchUrl=function(J,X){var le=this,ge={headers:X,cache:"no-store"},De=null;if(typeof AbortController<"u"){var Ie=new AbortController;De=this.context.setTimeout(function(){return Ie.abort()},15e3),ge.signal=Ie.signal}return new Promise(function(_t,bn){le.context.fetch(J,ge).then(function(Yt){if(Yt.status>=400)bn(new D("http error ".concat(Yt.status,", ").concat(Yt.statusText)));else{var Nn={status:Yt.status,headers:Yt.headers};Yt.json().then(function(kn){Nn.json=kn,_t(Nn)}).catch(function(){_t(Nn)})}}).catch(function(Yt){bn(Yt)}).finally(function(){De&&le.context.clearTimeout(De)})})},ee}(),he=function(){function ee(J){this.enableConsoleLog=J}return ee.prototype.onTrace=function(J){this.enableConsoleLog&&console.log("DeviceConfig trace: "+J)},ee}(),Oe=function(){function ee(J){this.enableConsoleLog=J}return ee.prototype.onValue=function(J){this.enableConsoleLog&&console.log("DeviceConfig analytics value:  ".concat(J))},ee.prototype.onError=function(J){this.enableConsoleLog&&console.error("DeviceConfig analytics error: ".concat(J))},ee.prototype.onTrace=function(J){this.enableConsoleLog&&console.log("DeviceConfig analytics trace: ".concat(J))},ee}(),H=function(){function ee(J,X){this.prefix=J,this.storage=X}return ee.prototype.getJson=function(J){var X=this.prefix+"_"+J;try{var le=this.storage.getItem(X);if(le)return JSON.parse(le)}catch(ge){console.error("Error getting local storage key ".concat(X)+ge)}return null},ee.prototype.setJson=function(J,X){var le=this.prefix+"_"+J;try{this.storage.setItem(le,JSON.stringify(X))}catch(ge){console.error("Error setting local storage key ".concat(le,": ")+ge)}},ee}(),me=function(){function ee(){}return ee.prototype.getMillis=function(){return Date.now()},ee}();(function(ee){ee[ee.STRING=0]="STRING",ee[ee.NUMBER=1]="NUMBER",ee[ee.BOOLEAN=2]="BOOLEAN",ee[ee.JSON=3]="JSON"})(ne||(ne={}));var ke=function(ee,J,X,le,ge,De,Ie,_t){switch(this.name=ee,this.type=J,this.valueString=X,this.valueNumber=le,this.valueBoolean=ge,this.valueJson=De,this.valueAnalytics=Ie,this.type){case ne.STRING:_t===W&&X&&(this.valueString=atob(X));break;case ne.JSON:_t===W&&De&&(this.valueJson=atob(De))}},Ee=function(){function ee(J,X){var le;this.storage=J,this.key=X,this.state=(le=J.getJson(X))!==null&&le!==void 0?le:{}}return ee.prototype.getState=function(){return this.state},ee.prototype.setState=function(J){Object.assign(this.state,J),this.storage.setJson(this.key,this.state)},ee}()},456:function(y,E,I){var S=this&&this.__createBinding||(Object.create?function(b,x,D,A){A===void 0&&(A=D);var M=Object.getOwnPropertyDescriptor(x,D);M&&!("get"in M?!x.__esModule:M.writable||M.configurable)||(M={enumerable:!0,get:function(){return x[D]}}),Object.defineProperty(b,A,M)}:function(b,x,D,A){A===void 0&&(A=D),b[A]=x[D]}),f=this&&this.__exportStar||function(b,x){for(var D in b)D==="default"||Object.prototype.hasOwnProperty.call(x,D)||S(x,b,D)};Object.defineProperty(E,"__esModule",{value:!0}),f(I(903),E)},903:function(y,E,I){var S=this&&this.__spreadArray||function(x,D,A){if(A||arguments.length===2)for(var M,W=0,z=D.length;W<z;W++)!M&&W in D||(M||(M=Array.prototype.slice.call(D,0,W)),M[W]=D[W]);return x.concat(M||Array.prototype.slice.call(D))};Object.defineProperty(E,"__esModule",{value:!0}),E.TypedEmitter=void 0;var f=I(228),b=function(){function x(D){var A=D.propagateErrors;this.emitter=new f.EventEmitter,this.propagateErrors=A!=null&&A}return x.prototype.on=function(D,A){A.call=this.wrapCall(D,A),this.emitter.on(D,A)},x.prototype.off=function(D,A){this.emitter.off(D,A)},x.prototype.emit=function(D){for(var A,M=[],W=1;W<arguments.length;W++)M[W-1]=arguments[W];(A=this.emitter).emit.apply(A,S([D],M,!1))},x.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},x.prototype.wrapCall=function(D,A){var M=this;return function(W){for(var z=[],q=1;q<arguments.length;q++)z[q-1]=arguments[q];if(M.propagateErrors)A.apply(W,z);else try{A.apply(W,z)}catch(he){var ne="Error in callback for ".concat(D),se=A.name;return se&&(ne+=" for function ".concat(se)),void console.error(ne,he)}}},x}();E.TypedEmitter=b},987:function(y,E,I){var S,f=this&&this.__extends||(S=function(z,q){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ne,se){ne.__proto__=se}||function(ne,se){for(var he in se)Object.prototype.hasOwnProperty.call(se,he)&&(ne[he]=se[he])},S(z,q)},function(z,q){if(typeof q!="function"&&q!==null)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");function ne(){this.constructor=z}S(z,q),z.prototype=q===null?Object.create(q):(ne.prototype=q.prototype,new ne)}),b=this&&this.__createBinding||(Object.create?function(z,q,ne,se){se===void 0&&(se=ne);var he=Object.getOwnPropertyDescriptor(q,ne);he&&!("get"in he?!q.__esModule:he.writable||he.configurable)||(he={enumerable:!0,get:function(){return q[ne]}}),Object.defineProperty(z,se,he)}:function(z,q,ne,se){se===void 0&&(se=ne),z[se]=q[ne]}),x=this&&this.__setModuleDefault||(Object.create?function(z,q){Object.defineProperty(z,"default",{enumerable:!0,value:q})}:function(z,q){z.default=q}),D=this&&this.__importStar||function(z){if(z&&z.__esModule)return z;var q={};if(z!=null)for(var ne in z)ne!=="default"&&Object.prototype.hasOwnProperty.call(z,ne)&&b(q,z,ne);return x(q,z),q};Object.defineProperty(E,"__esModule",{value:!0}),E.createFsm=E.FsmWildcardState=E.RejectedTransitionError=E.InvalidStateTransitionError=void 0;var A=D(I(293)),M=function(z){function q(ne,se){var he=z.call(this,"Invalid transition from '".concat(se,"' via event '").concat(ne,"'"))||this;return he.name="InvalidStateTransitionError",he}return f(q,z),q}(Error);E.InvalidStateTransitionError=M;var W=function(z){function q(ne,se,he){var Oe=z.call(this,"Transition from '".concat(se,"' via event '").concat(ne,"' was rejected for: ").concat(he))||this;return Oe.name="RejectedTransitionError",Oe}return f(q,z),q}(Error);E.RejectedTransitionError=W,E.FsmWildcardState="*",E.createFsm=function(z){var q,ne=z.transitions,se=z.callbacks,he=z.initialState,Oe=function(H){var me,ke=(me=ne[H])===null||me===void 0?void 0:me.from;return!!ke&&(typeof ke=="string"?ke===E.FsmWildcardState:ke.includes(he))};return{canTransition:Oe,transition:function(H,me){var ke,Ee,ee,J,X,le;if(!Oe(H))return A.err(new M(String(he),String(H)));var ge=ne[H];return ge.shouldTransition===void 0||ge.shouldTransition(he)?((Ee=(ke=se==null?void 0:se[he])===null||ke===void 0?void 0:ke.onExiting)===null||Ee===void 0||Ee.call(ke),(ee=se==null?void 0:se.onStateExiting)===null||ee===void 0||ee.call(se,he),q=he,he=ge.to,(X=(J=se==null?void 0:se[he])===null||J===void 0?void 0:J.onChanged)===null||X===void 0||X.call(J,q,me),(le=se==null?void 0:se.onStateChanged)===null||le===void 0||le.call(se,q,he,me),A.ok(he)):A.err(new W(String(he),String(H),"shouldTransition returned false"))},previousState:function(){return q},currentState:function(){return he}}}},156:function(y,E,I){var S=this&&this.__createBinding||(Object.create?function(b,x,D,A){A===void 0&&(A=D);var M=Object.getOwnPropertyDescriptor(x,D);M&&!("get"in M?!x.__esModule:M.writable||M.configurable)||(M={enumerable:!0,get:function(){return x[D]}}),Object.defineProperty(b,A,M)}:function(b,x,D,A){A===void 0&&(A=D),b[A]=x[D]}),f=this&&this.__exportStar||function(b,x){for(var D in b)D==="default"||Object.prototype.hasOwnProperty.call(x,D)||S(x,b,D)};Object.defineProperty(E,"__esModule",{value:!0}),E.VERSION=void 0,E.VERSION="0.5.0",f(I(815),E),f(I(456),E),f(I(987),E),f(I(293),E),f(I(925),E)},925:function(y,E,I){var S=this&&this.__createBinding||(Object.create?function(b,x,D,A){A===void 0&&(A=D);var M=Object.getOwnPropertyDescriptor(x,D);M&&!("get"in M?!x.__esModule:M.writable||M.configurable)||(M={enumerable:!0,get:function(){return x[D]}}),Object.defineProperty(b,A,M)}:function(b,x,D,A){A===void 0&&(A=D),b[A]=x[D]}),f=this&&this.__exportStar||function(b,x){for(var D in b)D==="default"||Object.prototype.hasOwnProperty.call(x,D)||S(x,b,D)};Object.defineProperty(E,"__esModule",{value:!0}),f(I(166),E),f(I(612),E),f(I(56),E),f(I(139),E),f(I(877),E)},166:function(y,E,I){var S=this&&this.__assign||function(){return S=Object.assign||function(z){for(var q,ne=1,se=arguments.length;ne<se;ne++)for(var he in q=arguments[ne])Object.prototype.hasOwnProperty.call(q,he)&&(z[he]=q[he]);return z},S.apply(this,arguments)},f=this&&this.__spreadArray||function(z,q,ne){if(ne||arguments.length===2)for(var se,he=0,Oe=q.length;he<Oe;he++)!se&&he in q||(se||(se=Array.prototype.slice.call(q,0,he)),se[he]=q[he]);return z.concat(se||Array.prototype.slice.call(q))};Object.defineProperty(E,"__esModule",{value:!0}),E.getLogConfig=E.setLogConfig=E.setLogConfigByLevel=E.extractLogConfig=void 0;var b=I(612),x=I(56),D=I(139),A=I(478),M={enabled:!1,levels:{debug:!0,log:!0,info:!0,warn:!0,error:!0},targets:[(0,x.createConsoleLogTarget)()],categories:{}},W=Object.keys(M);E.extractLogConfig=function(z){var q={};if(Object.keys(z).some(function(H){return W.includes(H)})){for(var ne=0,se=W;ne<se.length;ne++){var he=se[ne];if(z[he]!==void 0){var Oe=z[he];q[he]=Oe}}return q}},E.setLogConfigByLevel=function(z){var q=z.enabled||M.enabled,ne=z.targets||M.targets,se={debug:!1,log:!1,info:!1,warn:!1,error:!1},he=function(Oe,H){for(var me=0,ke=Oe;me<ke.length;me++){var Ee=ke[me];se[Ee]=H}};switch(z.level){case"debug":he(["debug","log","info","warn","error"],q);break;case"log":he(["log","info","warn","error"],q);break;case"info":he(["info","warn","error"],!0);break;case"warn":he(["warn","error"],!0);break;case"error":he(["error"],!0)}(0,E.setLogConfig)({enabled:q,levels:se,targets:ne})},E.setLogConfig=function(z){var q=(0,A.mergeConfigs)(M,z);q&&(M=q,b.defaultLogEmitter.emit(D.LogEventType.CONFIG_UPDATED,M))},E.getLogConfig=function(){return{enabled:M.enabled,levels:S({},M.levels),targets:f([],M.targets,!0),categories:S({},M.categories)}}},612:(y,E,I)=>{Object.defineProperty(E,"__esModule",{value:!0}),E.defaultLogEmitter=void 0;var S=I(456);E.defaultLogEmitter=new S.TypedEmitter({})},56:function(y,E,I){var S=this&&this.__spreadArray||function(b,x,D){if(D||arguments.length===2)for(var A,M=0,W=x.length;M<W;M++)!A&&M in x||(A||(A=Array.prototype.slice.call(x,0,M)),A[M]=x[M]);return b.concat(A||Array.prototype.slice.call(x))};Object.defineProperty(E,"__esModule",{value:!0}),E.createEventLogTarget=E.createConsoleLogTarget=void 0;var f=I(139);E.createConsoleLogTarget=function(){return{handleMessage:function(b){for(var x=[],D=1;D<arguments.length;D++)x[D-1]=arguments[D];console[b].apply(console,x)}}},E.createEventLogTarget=function(b){return{handleMessage:function(x){for(var D=[],A=1;A<arguments.length;A++)D[A-1]=arguments[A];b.emit.apply(b,S([f.LogEventType.MESSAGE_LOGGED,x],D,!1))}}}},139:(y,E)=>{var I;Object.defineProperty(E,"__esModule",{value:!0}),E.LogEventType=void 0,function(S){S.CONFIG_UPDATED="logConfigUpdated",S.MESSAGE_LOGGED="messageLogged"}(I||(E.LogEventType=I={}))},877:function(y,E,I){var S=this&&this.__assign||function(){return S=Object.assign||function(W){for(var z,q=1,ne=arguments.length;q<ne;q++)for(var se in z=arguments[q])Object.prototype.hasOwnProperty.call(z,se)&&(W[se]=z[se]);return W},S.apply(this,arguments)},f=this&&this.__spreadArray||function(W,z,q){if(q||arguments.length===2)for(var ne,se=0,he=z.length;se<he;se++)!ne&&se in z||(ne||(ne=Array.prototype.slice.call(z,0,se)),ne[se]=z[se]);return W.concat(ne||Array.prototype.slice.call(z))};Object.defineProperty(E,"__esModule",{value:!0}),E.createLogger=void 0;var b=I(478),x=I(166),D=I(612),A=I(139),M=function(W,z){return(0,b.mergeConfigs)(W,z)||W};E.createLogger=function(W){var z=W.name,q=W.category,ne=W.parent,se=(0,x.extractLogConfig)(W)||{},he=M((0,x.getLogConfig)(),se);D.defaultLogEmitter.on(A.LogEventType.CONFIG_UPDATED,function(Ee){he=M(Ee,se||{})});var Oe=function(Ee){for(var ee=[],J=1;J<arguments.length;J++)ee[J-1]=arguments[J];if(ne&&!ne.canLog(Ee)||!me(Ee))return!1;for(var X=H(),le=new Date().toTimeString().split(" ")[0],ge=f(["".concat(le," - (").concat(X,")")],ee,!0),De=0,Ie=he.targets;De<Ie.length;De++){var _t=Ie[De];_t.handleMessage.apply(_t,f([Ee],ge,!1))}return!0},H=function(){return ne?"".concat(ne.getName()," | ").concat(z):z},me=function(Ee){return!(!he.enabled||!he.levels[Ee]||he.targets.length===0||q!==void 0&&!he.categories[q])},ke={debug:function(){for(var Ee=[],ee=0;ee<arguments.length;ee++)Ee[ee]=arguments[ee];return Oe.apply(void 0,f(["debug"],Ee,!1))},log:function(){for(var Ee=[],ee=0;ee<arguments.length;ee++)Ee[ee]=arguments[ee];return Oe.apply(void 0,f(["log"],Ee,!1))},info:function(){for(var Ee=[],ee=0;ee<arguments.length;ee++)Ee[ee]=arguments[ee];return Oe.apply(void 0,f(["info"],Ee,!1))},warn:function(){for(var Ee=[],ee=0;ee<arguments.length;ee++)Ee[ee]=arguments[ee];return Oe.apply(void 0,f(["warn"],Ee,!1))},error:function(){for(var Ee=[],ee=0;ee<arguments.length;ee++)Ee[ee]=arguments[ee];return Oe.apply(void 0,f(["error"],Ee,!1))},getName:H,canLog:me,getChildLogger:function(Ee){return(0,E.createLogger)(S(S({},Ee),{parent:ke}))},setConfig:function(Ee){he=M(he,se=Ee)}};return ke}},478:function(y,E,I){var S=this&&this.__spreadArray||function(x,D,A){if(A||arguments.length===2)for(var M,W=0,z=D.length;W<z;W++)!M&&W in D||(M||(M=Array.prototype.slice.call(D,0,W)),M[W]=D[W]);return x.concat(M||Array.prototype.slice.call(D))};Object.defineProperty(E,"__esModule",{value:!0}),E.mergeConfigs=void 0;var f=I(543),b=function(x,D){if((0,f.isArray)(x))return D};E.mergeConfigs=function(x){for(var D=[],A=1;A<arguments.length;A++)D[A-1]=arguments[A];var M=D.map(function(W){return W==null||typeof W!="object"}).filter(Boolean).length>0;if(typeof x=="object"&&!M)return f.mergeWith.apply(void 0,S(S([{},x],D,!1),[b],!1))}},293:(y,E)=>{Object.defineProperty(E,"__esModule",{value:!0}),E.getErr=E.getOk_or=E.getOk=E.isNotOk=E.isOk=E.err=E.ok=void 0,E.ok=function(I){return{ok:!0,value:I}},E.err=function(I){return{ok:!1,error:I}},E.isOk=function(I){return I.ok===!0},E.isNotOk=function(I){return!(0,E.isOk)(I)},E.getOk=function(I){return I.ok===!0?I.value:void 0},E.getOk_or=function(I,S){return I.ok===!0?I.value:S},E.getErr=function(I){return I.ok===!0?void 0:I.error}}},v={};function m(y){var E=v[y];if(E!==void 0)return E.exports;var I=v[y]={id:y,loaded:!1,exports:{}};return p[y].call(I.exports,I,I.exports,m),I.loaded=!0,I.exports}return m.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),m.nmd=y=>(y.paths=[],y.children||(y.children=[]),y),m(156)})(),O.exports=k()},1549:(O,k,p)=>{var v=p(2032),m=p(3862),y=p(6721),E=p(2749),I=p(5749);function S(f){var b=-1,x=f==null?0:f.length;for(this.clear();++b<x;){var D=f[b];this.set(D[0],D[1])}}S.prototype.clear=v,S.prototype.delete=m,S.prototype.get=y,S.prototype.has=E,S.prototype.set=I,O.exports=S},79:(O,k,p)=>{var v=p(3702),m=p(80),y=p(4739),E=p(8655),I=p(1175);function S(f){var b=-1,x=f==null?0:f.length;for(this.clear();++b<x;){var D=f[b];this.set(D[0],D[1])}}S.prototype.clear=v,S.prototype.delete=m,S.prototype.get=y,S.prototype.has=E,S.prototype.set=I,O.exports=S},8223:(O,k,p)=>{var v=p(6110)(p(9325),"Map");O.exports=v},3661:(O,k,p)=>{var v=p(3040),m=p(7670),y=p(289),E=p(4509),I=p(2949);function S(f){var b=-1,x=f==null?0:f.length;for(this.clear();++b<x;){var D=f[b];this.set(D[0],D[1])}}S.prototype.clear=v,S.prototype.delete=m,S.prototype.get=y,S.prototype.has=E,S.prototype.set=I,O.exports=S},7217:(O,k,p)=>{var v=p(79),m=p(1420),y=p(938),E=p(3605),I=p(9817),S=p(945);function f(b){var x=this.__data__=new v(b);this.size=x.size}f.prototype.clear=m,f.prototype.delete=y,f.prototype.get=E,f.prototype.has=I,f.prototype.set=S,O.exports=f},1873:(O,k,p)=>{var v=p(9325).Symbol;O.exports=v},7828:(O,k,p)=>{var v=p(9325).Uint8Array;O.exports=v},1033:O=>{O.exports=function(k,p,v){switch(v.length){case 0:return k.call(p);case 1:return k.call(p,v[0]);case 2:return k.call(p,v[0],v[1]);case 3:return k.call(p,v[0],v[1],v[2])}return k.apply(p,v)}},695:(O,k,p)=>{var v=p(8096),m=p(2428),y=p(6449),E=p(3656),I=p(361),S=p(7167),f=Object.prototype.hasOwnProperty;O.exports=function(b,x){var D=y(b),A=!D&&m(b),M=!D&&!A&&E(b),W=!D&&!A&&!M&&S(b),z=D||A||M||W,q=z?v(b.length,String):[],ne=q.length;for(var se in b)!x&&!f.call(b,se)||z&&(se=="length"||M&&(se=="offset"||se=="parent")||W&&(se=="buffer"||se=="byteLength"||se=="byteOffset")||I(se,ne))||q.push(se);return q}},7805:(O,k,p)=>{var v=p(3360),m=p(5288);O.exports=function(y,E,I){(I!==void 0&&!m(y[E],I)||I===void 0&&!(E in y))&&v(y,E,I)}},6547:(O,k,p)=>{var v=p(3360),m=p(5288),y=Object.prototype.hasOwnProperty;O.exports=function(E,I,S){var f=E[I];y.call(E,I)&&m(f,S)&&(S!==void 0||I in E)||v(E,I,S)}},6025:(O,k,p)=>{var v=p(5288);O.exports=function(m,y){for(var E=m.length;E--;)if(v(m[E][0],y))return E;return-1}},3360:(O,k,p)=>{var v=p(3243);O.exports=function(m,y,E){y=="__proto__"&&v?v(m,y,{configurable:!0,enumerable:!0,value:E,writable:!0}):m[y]=E}},9344:(O,k,p)=>{var v=p(3805),m=Object.create,y=function(){function E(){}return function(I){if(!v(I))return{};if(m)return m(I);E.prototype=I;var S=new E;return E.prototype=void 0,S}}();O.exports=y},6649:(O,k,p)=>{var v=p(3221)();O.exports=v},2552:(O,k,p)=>{var v=p(1873),m=p(659),y=p(9350),E=v?v.toStringTag:void 0;O.exports=function(I){return I==null?I===void 0?"[object Undefined]":"[object Null]":E&&E in Object(I)?m(I):y(I)}},7534:(O,k,p)=>{var v=p(2552),m=p(346);O.exports=function(y){return m(y)&&v(y)=="[object Arguments]"}},5083:(O,k,p)=>{var v=p(1882),m=p(7296),y=p(3805),E=p(7473),I=/^\[object .+?Constructor\]$/,S=Function.prototype,f=Object.prototype,b=S.toString,x=f.hasOwnProperty,D=RegExp("^"+b.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");O.exports=function(A){return!(!y(A)||m(A))&&(v(A)?D:I).test(E(A))}},4901:(O,k,p)=>{var v=p(2552),m=p(294),y=p(346),E={};E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0,E["[object Arguments]"]=E["[object Array]"]=E["[object ArrayBuffer]"]=E["[object Boolean]"]=E["[object DataView]"]=E["[object Date]"]=E["[object Error]"]=E["[object Function]"]=E["[object Map]"]=E["[object Number]"]=E["[object Object]"]=E["[object RegExp]"]=E["[object Set]"]=E["[object String]"]=E["[object WeakMap]"]=!1,O.exports=function(I){return y(I)&&m(I.length)&&!!E[v(I)]}},2903:(O,k,p)=>{var v=p(3805),m=p(5527),y=p(181),E=Object.prototype.hasOwnProperty;O.exports=function(I){if(!v(I))return y(I);var S=m(I),f=[];for(var b in I)(b!="constructor"||!S&&E.call(I,b))&&f.push(b);return f}},5250:(O,k,p)=>{var v=p(7217),m=p(7805),y=p(6649),E=p(2824),I=p(3805),S=p(7241),f=p(4974);O.exports=function b(x,D,A,M,W){x!==D&&y(D,function(z,q){if(W||(W=new v),I(z))E(x,D,q,A,b,M,W);else{var ne=M?M(f(x,q),z,q+"",x,D,W):void 0;ne===void 0&&(ne=z),m(x,q,ne)}},S)}},2824:(O,k,p)=>{var v=p(7805),m=p(3290),y=p(1961),E=p(3007),I=p(5529),S=p(2428),f=p(6449),b=p(3693),x=p(3656),D=p(1882),A=p(3805),M=p(1331),W=p(7167),z=p(4974),q=p(9884);O.exports=function(ne,se,he,Oe,H,me,ke){var Ee=z(ne,he),ee=z(se,he),J=ke.get(ee);if(J)v(ne,he,J);else{var X=me?me(Ee,ee,he+"",ne,se,ke):void 0,le=X===void 0;if(le){var ge=f(ee),De=!ge&&x(ee),Ie=!ge&&!De&&W(ee);X=ee,ge||De||Ie?f(Ee)?X=Ee:b(Ee)?X=E(Ee):De?(le=!1,X=m(ee,!0)):Ie?(le=!1,X=y(ee,!0)):X=[]:M(ee)||S(ee)?(X=Ee,S(Ee)?X=q(Ee):A(Ee)&&!D(Ee)||(X=I(ee))):le=!1}le&&(ke.set(ee,X),H(X,ee,Oe,me,ke),ke.delete(ee)),v(ne,he,X)}}},9302:(O,k,p)=>{var v=p(3488),m=p(6757),y=p(2865);O.exports=function(E,I){return y(m(E,I,v),E+"")}},9570:(O,k,p)=>{var v=p(7334),m=p(3243),y=p(3488),E=m?function(I,S){return m(I,"toString",{configurable:!0,enumerable:!1,value:v(S),writable:!0})}:y;O.exports=E},8096:O=>{O.exports=function(k,p){for(var v=-1,m=Array(k);++v<k;)m[v]=p(v);return m}},7301:O=>{O.exports=function(k){return function(p){return k(p)}}},9653:(O,k,p)=>{var v=p(7828);O.exports=function(m){var y=new m.constructor(m.byteLength);return new v(y).set(new v(m)),y}},3290:(O,k,p)=>{O=p.nmd(O);var v=p(9325),m=k&&!k.nodeType&&k,y=m&&O&&!O.nodeType&&O,E=y&&y.exports===m?v.Buffer:void 0,I=E?E.allocUnsafe:void 0;O.exports=function(S,f){if(f)return S.slice();var b=S.length,x=I?I(b):new S.constructor(b);return S.copy(x),x}},1961:(O,k,p)=>{var v=p(9653);O.exports=function(m,y){var E=y?v(m.buffer):m.buffer;return new m.constructor(E,m.byteOffset,m.length)}},3007:O=>{O.exports=function(k,p){var v=-1,m=k.length;for(p||(p=Array(m));++v<m;)p[v]=k[v];return p}},1791:(O,k,p)=>{var v=p(6547),m=p(3360);O.exports=function(y,E,I,S){var f=!I;I||(I={});for(var b=-1,x=E.length;++b<x;){var D=E[b],A=S?S(I[D],y[D],D,I,y):void 0;A===void 0&&(A=y[D]),f?m(I,D,A):v(I,D,A)}return I}},5481:(O,k,p)=>{var v=p(9325)["__core-js_shared__"];O.exports=v},999:(O,k,p)=>{var v=p(9302),m=p(6800);O.exports=function(y){return v(function(E,I){var S=-1,f=I.length,b=f>1?I[f-1]:void 0,x=f>2?I[2]:void 0;for(b=y.length>3&&typeof b=="function"?(f--,b):void 0,x&&m(I[0],I[1],x)&&(b=f<3?void 0:b,f=1),E=Object(E);++S<f;){var D=I[S];D&&y(E,D,S,b)}return E})}},3221:O=>{O.exports=function(k){return function(p,v,m){for(var y=-1,E=Object(p),I=m(p),S=I.length;S--;){var f=I[k?S:++y];if(v(E[f],f,E)===!1)break}return p}}},3243:(O,k,p)=>{var v=p(6110),m=function(){try{var y=v(Object,"defineProperty");return y({},"",{}),y}catch{}}();O.exports=m},4840:(O,k,p)=>{var v=typeof p.g=="object"&&p.g&&p.g.Object===Object&&p.g;O.exports=v},2651:(O,k,p)=>{var v=p(4218);O.exports=function(m,y){var E=m.__data__;return v(y)?E[typeof y=="string"?"string":"hash"]:E.map}},6110:(O,k,p)=>{var v=p(5083),m=p(392);O.exports=function(y,E){var I=m(y,E);return v(I)?I:void 0}},8879:(O,k,p)=>{var v=p(4335)(Object.getPrototypeOf,Object);O.exports=v},659:(O,k,p)=>{var v=p(1873),m=Object.prototype,y=m.hasOwnProperty,E=m.toString,I=v?v.toStringTag:void 0;O.exports=function(S){var f=y.call(S,I),b=S[I];try{S[I]=void 0;var x=!0}catch{}var D=E.call(S);return x&&(f?S[I]=b:delete S[I]),D}},392:O=>{O.exports=function(k,p){return k==null?void 0:k[p]}},2032:(O,k,p)=>{var v=p(1042);O.exports=function(){this.__data__=v?v(null):{},this.size=0}},3862:O=>{O.exports=function(k){var p=this.has(k)&&delete this.__data__[k];return this.size-=p?1:0,p}},6721:(O,k,p)=>{var v=p(1042),m=Object.prototype.hasOwnProperty;O.exports=function(y){var E=this.__data__;if(v){var I=E[y];return I==="__lodash_hash_undefined__"?void 0:I}return m.call(E,y)?E[y]:void 0}},2749:(O,k,p)=>{var v=p(1042),m=Object.prototype.hasOwnProperty;O.exports=function(y){var E=this.__data__;return v?E[y]!==void 0:m.call(E,y)}},5749:(O,k,p)=>{var v=p(1042);O.exports=function(m,y){var E=this.__data__;return this.size+=this.has(m)?0:1,E[m]=v&&y===void 0?"__lodash_hash_undefined__":y,this}},5529:(O,k,p)=>{var v=p(9344),m=p(8879),y=p(5527);O.exports=function(E){return typeof E.constructor!="function"||y(E)?{}:v(m(E))}},361:O=>{var k=/^(?:0|[1-9]\d*)$/;O.exports=function(p,v){var m=typeof p;return!!(v=v??9007199254740991)&&(m=="number"||m!="symbol"&&k.test(p))&&p>-1&&p%1==0&&p<v}},6800:(O,k,p)=>{var v=p(5288),m=p(4894),y=p(361),E=p(3805);O.exports=function(I,S,f){if(!E(f))return!1;var b=typeof S;return!!(b=="number"?m(f)&&y(S,f.length):b=="string"&&S in f)&&v(f[S],I)}},4218:O=>{O.exports=function(k){var p=typeof k;return p=="string"||p=="number"||p=="symbol"||p=="boolean"?k!=="__proto__":k===null}},7296:(O,k,p)=>{var v,m=p(5481),y=(v=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||""))?"Symbol(src)_1."+v:"";O.exports=function(E){return!!y&&y in E}},5527:O=>{var k=Object.prototype;O.exports=function(p){var v=p&&p.constructor;return p===(typeof v=="function"&&v.prototype||k)}},3702:O=>{O.exports=function(){this.__data__=[],this.size=0}},80:(O,k,p)=>{var v=p(6025),m=Array.prototype.splice;O.exports=function(y){var E=this.__data__,I=v(E,y);return!(I<0)&&(I==E.length-1?E.pop():m.call(E,I,1),--this.size,!0)}},4739:(O,k,p)=>{var v=p(6025);O.exports=function(m){var y=this.__data__,E=v(y,m);return E<0?void 0:y[E][1]}},8655:(O,k,p)=>{var v=p(6025);O.exports=function(m){return v(this.__data__,m)>-1}},1175:(O,k,p)=>{var v=p(6025);O.exports=function(m,y){var E=this.__data__,I=v(E,m);return I<0?(++this.size,E.push([m,y])):E[I][1]=y,this}},3040:(O,k,p)=>{var v=p(1549),m=p(79),y=p(8223);O.exports=function(){this.size=0,this.__data__={hash:new v,map:new(y||m),string:new v}}},7670:(O,k,p)=>{var v=p(2651);O.exports=function(m){var y=v(this,m).delete(m);return this.size-=y?1:0,y}},289:(O,k,p)=>{var v=p(2651);O.exports=function(m){return v(this,m).get(m)}},4509:(O,k,p)=>{var v=p(2651);O.exports=function(m){return v(this,m).has(m)}},2949:(O,k,p)=>{var v=p(2651);O.exports=function(m,y){var E=v(this,m),I=E.size;return E.set(m,y),this.size+=E.size==I?0:1,this}},1042:(O,k,p)=>{var v=p(6110)(Object,"create");O.exports=v},181:O=>{O.exports=function(k){var p=[];if(k!=null)for(var v in Object(k))p.push(v);return p}},6009:(O,k,p)=>{O=p.nmd(O);var v=p(4840),m=k&&!k.nodeType&&k,y=m&&O&&!O.nodeType&&O,E=y&&y.exports===m&&v.process,I=function(){try{var S=y&&y.require&&y.require("util").types;return S||E&&E.binding&&E.binding("util")}catch{}}();O.exports=I},9350:O=>{var k=Object.prototype.toString;O.exports=function(p){return k.call(p)}},4335:O=>{O.exports=function(k,p){return function(v){return k(p(v))}}},6757:(O,k,p)=>{var v=p(1033),m=Math.max;O.exports=function(y,E,I){return E=m(E===void 0?y.length-1:E,0),function(){for(var S=arguments,f=-1,b=m(S.length-E,0),x=Array(b);++f<b;)x[f]=S[E+f];f=-1;for(var D=Array(E+1);++f<E;)D[f]=S[f];return D[E]=I(x),v(y,this,D)}}},9325:(O,k,p)=>{var v=p(4840),m=typeof self=="object"&&self&&self.Object===Object&&self,y=v||m||Function("return this")();O.exports=y},4974:O=>{O.exports=function(k,p){if((p!=="constructor"||typeof k[p]!="function")&&p!="__proto__")return k[p]}},2865:(O,k,p)=>{var v=p(9570),m=p(1811)(v);O.exports=m},1811:O=>{var k=Date.now;O.exports=function(p){var v=0,m=0;return function(){var y=k(),E=16-(y-m);if(m=y,E>0){if(++v>=800)return arguments[0]}else v=0;return p.apply(void 0,arguments)}}},1420:(O,k,p)=>{var v=p(79);O.exports=function(){this.__data__=new v,this.size=0}},938:O=>{O.exports=function(k){var p=this.__data__,v=p.delete(k);return this.size=p.size,v}},3605:O=>{O.exports=function(k){return this.__data__.get(k)}},9817:O=>{O.exports=function(k){return this.__data__.has(k)}},945:(O,k,p)=>{var v=p(79),m=p(8223),y=p(3661);O.exports=function(E,I){var S=this.__data__;if(S instanceof v){var f=S.__data__;if(!m||f.length<199)return f.push([E,I]),this.size=++S.size,this;S=this.__data__=new y(f)}return S.set(E,I),this.size=S.size,this}},7473:O=>{var k=Function.prototype.toString;O.exports=function(p){if(p!=null){try{return k.call(p)}catch{}try{return p+""}catch{}}return""}},7334:O=>{O.exports=function(k){return function(){return k}}},5288:O=>{O.exports=function(k,p){return k===p||k!=k&&p!=p}},3488:O=>{O.exports=function(k){return k}},2428:(O,k,p)=>{var v=p(7534),m=p(346),y=Object.prototype,E=y.hasOwnProperty,I=y.propertyIsEnumerable,S=v(function(){return arguments}())?v:function(f){return m(f)&&E.call(f,"callee")&&!I.call(f,"callee")};O.exports=S},6449:O=>{var k=Array.isArray;O.exports=k},4894:(O,k,p)=>{var v=p(1882),m=p(294);O.exports=function(y){return y!=null&&m(y.length)&&!v(y)}},3693:(O,k,p)=>{var v=p(4894),m=p(346);O.exports=function(y){return m(y)&&v(y)}},3656:(O,k,p)=>{O=p.nmd(O);var v=p(9325),m=p(9935),y=k&&!k.nodeType&&k,E=y&&O&&!O.nodeType&&O,I=E&&E.exports===y?v.Buffer:void 0,S=(I?I.isBuffer:void 0)||m;O.exports=S},1882:(O,k,p)=>{var v=p(2552),m=p(3805);O.exports=function(y){if(!m(y))return!1;var E=v(y);return E=="[object Function]"||E=="[object GeneratorFunction]"||E=="[object AsyncFunction]"||E=="[object Proxy]"}},294:O=>{O.exports=function(k){return typeof k=="number"&&k>-1&&k%1==0&&k<=9007199254740991}},3805:O=>{O.exports=function(k){var p=typeof k;return k!=null&&(p=="object"||p=="function")}},346:O=>{O.exports=function(k){return k!=null&&typeof k=="object"}},1331:(O,k,p)=>{var v=p(2552),m=p(8879),y=p(346),E=Function.prototype,I=Object.prototype,S=E.toString,f=I.hasOwnProperty,b=S.call(Object);O.exports=function(x){if(!y(x)||v(x)!="[object Object]")return!1;var D=m(x);if(D===null)return!0;var A=f.call(D,"constructor")&&D.constructor;return typeof A=="function"&&A instanceof A&&S.call(A)==b}},7167:(O,k,p)=>{var v=p(4901),m=p(7301),y=p(6009),E=y&&y.isTypedArray,I=E?m(E):v;O.exports=I},7241:(O,k,p)=>{var v=p(695),m=p(2903),y=p(4894);O.exports=function(E){return y(E)?v(E,!0):m(E)}},2543:function(O,k,p){var v;O=p.nmd(O),(function(){var m,y="Expected a function",E="__lodash_hash_undefined__",I="__lodash_placeholder__",S=16,f=32,b=64,x=128,D=256,A=1/0,M=9007199254740991,W=NaN,z=4294967295,q=[["ary",x],["bind",1],["bindKey",2],["curry",8],["curryRight",S],["flip",512],["partial",f],["partialRight",b],["rearg",D]],ne="[object Arguments]",se="[object Array]",he="[object Boolean]",Oe="[object Date]",H="[object Error]",me="[object Function]",ke="[object GeneratorFunction]",Ee="[object Map]",ee="[object Number]",J="[object Object]",X="[object Promise]",le="[object RegExp]",ge="[object Set]",De="[object String]",Ie="[object Symbol]",_t="[object WeakMap]",bn="[object ArrayBuffer]",Yt="[object DataView]",Nn="[object Float32Array]",kn="[object Float64Array]",Ur="[object Int8Array]",Tr="[object Int16Array]",gr="[object Int32Array]",$n="[object Uint8Array]",jr="[object Uint8ClampedArray]",Cr="[object Uint16Array]",Ir="[object Uint32Array]",qe=/\b__p \+= '';/g,Zr=/\b(__p \+=) '' \+/g,Ks=/(__e\(.*?\)|\b__t\)) \+\n'';/g,un=/&(?:amp|lt|gt|quot|#39);/g,os=/[&<>"']/g,as=RegExp(un.source),sa=RegExp(os.source),bo=/<%-([\s\S]+?)%>/g,er=/<%([\s\S]+?)%>/g,To=/<%=([\s\S]+?)%>/g,Mi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,eo=/^\w*$/,ss=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Li=/[\\^$.*+?()[\]{}|]/g,Co=RegExp(Li.source),ei=/^\s+/,cs=/\s/,Rt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ft=/\{\n\/\* \[wrapped with (.+)\] \*/,us=/,? & /,Wc=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,zn=/[()=,{}\[\]\/\s]/,Ke=/\\(\\)?/g,Js=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Si=/\w*$/,Ys=/^[-+]0x[0-9a-f]+$/i,Io=/^0b[01]+$/i,ca=/^\[object .+?Constructor\]$/,Ro=/^0o[0-7]+$/i,Y=/^(?:0|[1-9]\d*)$/,ie=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,fe=/($^)/,Te=/['\n\r\u2028\u2029\\]/g,Xe="\\ud800-\\udfff",tn="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",it="\\u2700-\\u27bf",nt="a-z\\xdf-\\xf6\\xf8-\\xff",Ue="A-Z\\xc0-\\xd6\\xd8-\\xde",we="\\ufe0e\\ufe0f",Ge="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",He="['’]",St="["+Xe+"]",Vt="["+Ge+"]",$t="["+tn+"]",Tn="\\d+",ua="["+it+"]",la="["+nt+"]",Qs="[^"+Xe+Ge+Tn+it+nt+Ue+"]",ls="\\ud83c[\\udffb-\\udfff]",ds="[^"+Xe+"]",hs="(?:\\ud83c[\\udde6-\\uddff]){2}",da="[\\ud800-\\udbff][\\udc00-\\udfff]",xi="["+Ue+"]",wo="\\u200d",Hc="(?:"+la+"|"+Qs+")",ha="(?:"+xi+"|"+Qs+")",fa="(?:['’](?:d|ll|m|re|s|t|ve))?",Oo="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ao="(?:"+$t+"|"+ls+")?",ko="["+we+"]?",pa=ko+Ao+("(?:"+wo+"(?:"+[ds,hs,da].join("|")+")"+ko+Ao+")*"),fs="(?:"+[ua,hs,da].join("|")+")"+pa,Xs="(?:"+[ds+$t+"?",$t,hs,da,St].join("|")+")",$c=RegExp(He,"g"),Fr=RegExp($t,"g"),Vr=RegExp(ls+"(?="+ls+")|"+Xs+pa,"g"),ga=RegExp([xi+"?"+la+"+"+fa+"(?="+[Vt,xi,"$"].join("|")+")",ha+"+"+Oo+"(?="+[Vt,xi+Hc,"$"].join("|")+")",xi+"?"+Hc+"+"+fa,xi+"+"+Oo,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Tn,fs].join("|"),"g"),Pu=RegExp("["+wo+Xe+tn+we+"]"),pl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],zc=-1,zt={};zt[Nn]=zt[kn]=zt[Ur]=zt[Tr]=zt[gr]=zt[$n]=zt[jr]=zt[Cr]=zt[Ir]=!0,zt[ne]=zt[se]=zt[bn]=zt[he]=zt[Yt]=zt[Oe]=zt[H]=zt[me]=zt[Ee]=zt[ee]=zt[J]=zt[le]=zt[ge]=zt[De]=zt[_t]=!1;var Ye={};Ye[ne]=Ye[se]=Ye[bn]=Ye[Yt]=Ye[he]=Ye[Oe]=Ye[Nn]=Ye[kn]=Ye[Ur]=Ye[Tr]=Ye[gr]=Ye[Ee]=Ye[ee]=Ye[J]=Ye[le]=Ye[ge]=Ye[De]=Ye[Ie]=Ye[$n]=Ye[jr]=Ye[Cr]=Ye[Ir]=!0,Ye[H]=Ye[me]=Ye[_t]=!1;var Gt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qc=parseFloat,Kc=parseInt,Jc=typeof p.g=="object"&&p.g&&p.g.Object===Object&&p.g,Du=typeof self=="object"&&self&&self.Object===Object&&self,Fe=Jc||Du||Function("return this")(),Cn=k&&!k.nodeType&&k,ot=Cn&&O&&!O.nodeType&&O,to=ot&&ot.exports===Cn,Po=to&&Jc.process,Mn=function(){try{var L=ot&&ot.require&&ot.require("util").types;return L||Po&&Po.binding&&Po.binding("util")}catch{}}(),ln=Mn&&Mn.isArrayBuffer,gs=Mn&&Mn.isDate,Zs=Mn&&Mn.isMap,ec=Mn&&Mn.isRegExp,ms=Mn&&Mn.isSet,ma=Mn&&Mn.isTypedArray;function tr(L,V,G){switch(G.length){case 0:return L.call(V);case 1:return L.call(V,G[0]);case 2:return L.call(V,G[0],G[1]);case 3:return L.call(V,G[0],G[1],G[2])}return L.apply(V,G)}function Rr(L,V,G,re){for(var ye=-1,Pe=L==null?0:L.length;++ye<Pe;){var Ze=L[ye];V(re,Ze,G(Ze),L)}return re}function wr(L,V){for(var G=-1,re=L==null?0:L.length;++G<re&&V(L[G],G,L)!==!1;);return L}function Or(L,V){for(var G=L==null?0:L.length;G--&&V(L[G],G,L)!==!1;);return L}function tc(L,V){for(var G=-1,re=L==null?0:L.length;++G<re;)if(!V(L[G],G,L))return!1;return!0}function ti(L,V){for(var G=-1,re=L==null?0:L.length,ye=0,Pe=[];++G<re;){var Ze=L[G];V(Ze,G,L)&&(Pe[ye++]=Ze)}return Pe}function Gr(L,V){return!!(L!=null&&L.length)&&ri(L,V,0)>-1}function Do(L,V,G){for(var re=-1,ye=L==null?0:L.length;++re<ye;)if(G(V,L[re]))return!0;return!1}function Qt(L,V){for(var G=-1,re=L==null?0:L.length,ye=Array(re);++G<re;)ye[G]=V(L[G],G,L);return ye}function lt(L,V){for(var G=-1,re=V.length,ye=L.length;++G<re;)L[ye+G]=V[G];return L}function ni(L,V,G,re){var ye=-1,Pe=L==null?0:L.length;for(re&&Pe&&(G=L[++ye]);++ye<Pe;)G=V(G,L[ye],ye,L);return G}function Yc(L,V,G,re){var ye=L==null?0:L.length;for(re&&ye&&(G=L[--ye]);ye--;)G=V(G,L[ye],ye,L);return G}function Qc(L,V){for(var G=-1,re=L==null?0:L.length;++G<re;)if(V(L[G],G,L))return!0;return!1}var va=nr("length");function In(L,V,G){var re;return G(L,function(ye,Pe,Ze){if(V(ye,Pe,Ze))return re=Pe,!1}),re}function vs(L,V,G,re){for(var ye=L.length,Pe=G+(re?1:-1);re?Pe--:++Pe<ye;)if(V(L[Pe],Pe,L))return Pe;return-1}function ri(L,V,G){return V==V?function(re,ye,Pe){for(var Ze=Pe-1,on=re.length;++Ze<on;)if(re[Ze]===ye)return Ze;return-1}(L,V,G):vs(L,Nu,G)}function _a(L,V,G,re){for(var ye=G-1,Pe=L.length;++ye<Pe;)if(re(L[ye],V))return ye;return-1}function Nu(L){return L!=L}function Xc(L,V){var G=L==null?0:L.length;return G?nc(L,V)/G:W}function nr(L){return function(V){return V==null?m:V[L]}}function Sa(L){return function(V){return L==null?m:L[V]}}function _s(L,V,G,re,ye){return ye(L,function(Pe,Ze,on){G=re?(re=!1,Pe):V(G,Pe,Ze,on)}),G}function nc(L,V){for(var G,re=-1,ye=L.length;++re<ye;){var Pe=V(L[re]);Pe!==m&&(G=G===m?Pe:G+Pe)}return G}function Ss(L,V){for(var G=-1,re=Array(L);++G<L;)re[G]=V(G);return re}function rc(L){return L&&L.slice(0,dn(L)+1).replace(ei,"")}function rr(L){return function(V){return L(V)}}function qn(L,V){return Qt(V,function(G){return L[G]})}function no(L,V){return L.has(V)}function Ea(L,V){for(var G=-1,re=L.length;++G<re&&ri(V,L[G],0)>-1;);return G}function Zc(L,V){for(var G=L.length;G--&&ri(V,L[G],0)>-1;);return G}var Mu=Sa({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),gl=Sa({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ml(L){return"\\"+Gt[L]}function ya(L){return Pu.test(L)}function ro(L){var V=-1,G=Array(L.size);return L.forEach(function(re,ye){G[++V]=[ye,re]}),G}function ic(L,V){return function(G){return L(V(G))}}function Bi(L,V){for(var G=-1,re=L.length,ye=0,Pe=[];++G<re;){var Ze=L[G];Ze!==V&&Ze!==I||(L[G]=I,Pe[ye++]=G)}return Pe}function Wr(L){var V=-1,G=Array(L.size);return L.forEach(function(re){G[++V]=re}),G}function oc(L){var V=-1,G=Array(L.size);return L.forEach(function(re){G[++V]=[re,re]}),G}function ii(L){return ya(L)?function(V){for(var G=Vr.lastIndex=0;Vr.test(V);)++G;return G}(L):va(L)}function vn(L){return ya(L)?function(V){return V.match(Vr)||[]}(L):function(V){return V.split("")}(L)}function dn(L){for(var V=L.length;V--&&cs.test(L.charAt(V)););return V}var ac=Sa({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),No=function L(V){var G,re=(V=V==null?Fe:No.defaults(Fe.Object(),V,No.pick(Fe,ps))).Array,ye=V.Date,Pe=V.Error,Ze=V.Function,on=V.Math,Qe=V.Object,Es=V.RegExp,mr=V.String,wt=V.TypeError,Ui=re.prototype,io=Ze.prototype,Ar=Qe.prototype,Hr=V["__core-js_shared__"],xe=io.toString,Ve=Ar.hasOwnProperty,eu=0,ys=(G=/[^.]+$/.exec(Hr&&Hr.keys&&Hr.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"",Je=Ar.toString,vl=xe.call(Qe),_l=Fe._,Sl=Es("^"+xe.call(Ve).replace(Li,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rn=to?V.Buffer:m,Un=V.Symbol,oo=V.Uint8Array,tu=Rn?Rn.allocUnsafe:m,Mo=ic(Qe.getPrototypeOf,Qe),nu=Qe.create,bs=Ar.propertyIsEnumerable,oi=Ui.splice,ru=Un?Un.isConcatSpreadable:m,ji=Un?Un.iterator:m,Kn=Un?Un.toStringTag:m,Lo=function(){try{var n=Mr(Qe,"defineProperty");return n({},"",{}),n}catch{}}(),El=V.clearTimeout!==Fe.clearTimeout&&V.clearTimeout,ba=ye&&ye.now!==Fe.Date.now&&ye.now,Lu=V.setTimeout!==Fe.setTimeout&&V.setTimeout,xo=on.ceil,Bo=on.floor,Ta=Qe.getOwnPropertySymbols,yl=Rn?Rn.isBuffer:m,Uo=V.isFinite,bl=Ui.join,xu=ic(Qe.keys,Qe),gt=on.max,Ot=on.min,sc=ye.now,Tl=V.parseInt,Ts=on.random,Bu=Ui.reverse,Ca=Mr(V,"DataView"),ve=Mr(V,"Map"),qt=Mr(V,"Promise"),ai=Mr(V,"Set"),Fi=Mr(V,"WeakMap"),Vi=Mr(Qe,"create"),jo=Fi&&new Fi,$r={},Cl=Qn(Ca),Fo=Qn(ve),Uu=Qn(qt),Jn=Qn(ai),ju=Qn(Fi),Yn=Un?Un.prototype:m,Ei=Yn?Yn.valueOf:m,ao=Yn?Yn.toString:m;function g(n){if(st(n)&&!Be(n)&&!(n instanceof Ae)){if(n instanceof Xt)return n;if(Ve.call(n,"__wrapped__"))return go(n)}return new Xt(n)}var ze=function(){function n(){}return function(e){if(!Jt(e))return{};if(nu)return nu(e);n.prototype=e;var t=new n;return n.prototype=m,t}}();function si(){}function Xt(n,e){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=m}function Ae(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=z,this.__views__=[]}function ir(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}function Pt(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}function hn(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}function vr(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new hn;++e<t;)this.add(n[e])}function At(n){var e=this.__data__=new Pt(n);this.size=e.size}function de(n,e){var t=Be(n),i=!t&&hi(n),o=!t&&!i&&ft(n),u=!t&&!i&&!o&&Zt(n),d=t||i||o||u,h=d?Ss(n.length,mr):[],_=h.length;for(var T in n)!e&&!Ve.call(n,T)||d&&(T=="length"||o&&(T=="offset"||T=="parent")||u&&(T=="buffer"||T=="byteLength"||T=="byteOffset")||sn(T,_))||h.push(T);return h}function or(n){var e=n.length;return e?n[Da(0,e-1)]:m}function Il(n,e){return Wa(fn(n),_r(e,0,n.length))}function cc(n){return Wa(fn(n))}function so(n,e,t){(t!==m&&!Yr(n[e],t)||t===m&&!(e in n))&&_n(n,e,t)}function ci(n,e,t){var i=n[e];Ve.call(n,e)&&Yr(i,t)&&(t!==m||e in n)||_n(n,e,t)}function yi(n,e){for(var t=n.length;t--;)if(Yr(n[t][0],e))return t;return-1}function iu(n,e,t,i){return jn(n,function(o,u,d){e(i,o,t(o),d)}),i}function ou(n,e){return n&&Sr(e,Bt(e),n)}function _n(n,e,t){e=="__proto__"&&Lo?Lo(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}function Ia(n,e){for(var t=-1,i=e.length,o=re(i),u=n==null;++t<i;)o[t]=u?m:na(n,e[t]);return o}function _r(n,e,t){return n==n&&(t!==m&&(n=n<=t?n:t),e!==m&&(n=n>=e?n:e)),n}function an(n,e,t,i,o,u){var d,h=1&e,_=2&e,T=4&e;if(t&&(d=o?t(n,i,o,u):t(n)),d!==m)return d;if(!Jt(n))return n;var C=Be(n);if(C){if(d=function(j){var B=j.length,$=new j.constructor(B);return B&&typeof j[0]=="string"&&Ve.call(j,"index")&&($.index=j.index,$.input=j.input),$}(n),!h)return fn(n,d)}else{var R=xn(n),w=R==me||R==ke;if(ft(n))return $o(n,h);if(R==J||R==ne||w&&!o){if(d=_||w?{}:fu(n),!h)return _?function(j,B){return Sr(j,gn(j),B)}(n,function(j,B){return j&&Sr(B,ct(B),j)}(d,n)):function(j,B){return Sr(j,Ls(j),B)}(n,ou(d,n))}else{if(!Ye[R])return o?n:{};d=function(j,B,$){var K=j.constructor;switch(B){case bn:return fo(j);case he:case Oe:return new K(+j);case Yt:return function(oe,ce){var ae=ce?fo(oe.buffer):oe.buffer;return new oe.constructor(ae,oe.byteOffset,oe.byteLength)}(j,$);case Nn:case kn:case Ur:case Tr:case gr:case $n:case jr:case Cr:case Ir:return Sc(j,$);case Ee:return new K;case ee:case De:return new K(j);case le:return function(oe){var ce=new oe.constructor(oe.source,Si.exec(oe));return ce.lastIndex=oe.lastIndex,ce}(j);case ge:return new K;case Ie:return Q=j,Ei?Qe(Ei.call(Q)):{}}var Q}(n,R,h)}}u||(u=new At);var P=u.get(n);if(P)return P;u.set(n,d),Sn(n)?n.forEach(function(j){d.add(an(j,e,t,j,n,u))}):pn(n)&&n.forEach(function(j,B){d.set(B,an(j,e,t,B,n,u))});var U=C?m:(T?_?qr:Ai:_?ct:Bt)(n);return wr(U||n,function(j,B){U&&(j=n[B=j]),ci(d,B,an(j,e,t,B,n,u))}),d}function Cs(n,e,t){var i=t.length;if(n==null)return!i;for(n=Qe(n);i--;){var o=t[i],u=e[o],d=n[o];if(d===m&&!(o in n)||!u(d))return!1}return!0}function Is(n,e,t){if(typeof n!="function")throw new wt(y);return po(function(){n.apply(m,t)},e)}function ui(n,e,t,i){var o=-1,u=Gr,d=!0,h=n.length,_=[],T=e.length;if(!h)return _;t&&(e=Qt(e,rr(t))),i?(u=Do,d=!1):e.length>=200&&(u=no,d=!1,e=new vr(e));e:for(;++o<h;){var C=n[o],R=t==null?C:t(C);if(C=i||C!==0?C:0,d&&R==R){for(var w=T;w--;)if(e[w]===R)continue e;_.push(C)}else u(e,R,i)||_.push(C)}return _}g.templateSettings={escape:bo,evaluate:er,interpolate:To,variable:"",imports:{_:g}},g.prototype=si.prototype,g.prototype.constructor=g,Xt.prototype=ze(si.prototype),Xt.prototype.constructor=Xt,Ae.prototype=ze(si.prototype),Ae.prototype.constructor=Ae,ir.prototype.clear=function(){this.__data__=Vi?Vi(null):{},this.size=0},ir.prototype.delete=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e},ir.prototype.get=function(n){var e=this.__data__;if(Vi){var t=e[n];return t===E?m:t}return Ve.call(e,n)?e[n]:m},ir.prototype.has=function(n){var e=this.__data__;return Vi?e[n]!==m:Ve.call(e,n)},ir.prototype.set=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=Vi&&e===m?E:e,this},Pt.prototype.clear=function(){this.__data__=[],this.size=0},Pt.prototype.delete=function(n){var e=this.__data__,t=yi(e,n);return!(t<0)&&(t==e.length-1?e.pop():oi.call(e,t,1),--this.size,!0)},Pt.prototype.get=function(n){var e=this.__data__,t=yi(e,n);return t<0?m:e[t][1]},Pt.prototype.has=function(n){return yi(this.__data__,n)>-1},Pt.prototype.set=function(n,e){var t=this.__data__,i=yi(t,n);return i<0?(++this.size,t.push([n,e])):t[i][1]=e,this},hn.prototype.clear=function(){this.size=0,this.__data__={hash:new ir,map:new(ve||Pt),string:new ir}},hn.prototype.delete=function(n){var e=Fa(this,n).delete(n);return this.size-=e?1:0,e},hn.prototype.get=function(n){return Fa(this,n).get(n)},hn.prototype.has=function(n){return Fa(this,n).has(n)},hn.prototype.set=function(n,e){var t=Fa(this,n),i=t.size;return t.set(n,e),this.size+=t.size==i?0:1,this},vr.prototype.add=vr.prototype.push=function(n){return this.__data__.set(n,E),this},vr.prototype.has=function(n){return this.__data__.has(n)},At.prototype.clear=function(){this.__data__=new Pt,this.size=0},At.prototype.delete=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t},At.prototype.get=function(n){return this.__data__.get(n)},At.prototype.has=function(n){return this.__data__.has(n)},At.prototype.set=function(n,e){var t=this.__data__;if(t instanceof Pt){var i=t.__data__;if(!ve||i.length<199)return i.push([n,e]),this.size=++t.size,this;t=this.__data__=new hn(i)}return t.set(n,e),this.size=t.size,this};var jn=lu(wn),uc=lu(Oa,!0);function au(n,e){var t=!0;return jn(n,function(i,o,u){return t=!!e(i,o,u)}),t}function co(n,e,t){for(var i=-1,o=n.length;++i<o;){var u=n[i],d=e(u);if(d!=null&&(h===m?d==d&&!Ct(d):t(d,h)))var h=d,_=u}return _}function lc(n,e){var t=[];return jn(n,function(i,o,u){e(i,o,u)&&t.push(i)}),t}function bt(n,e,t,i,o){var u=-1,d=n.length;for(t||(t=ki),o||(o=[]);++u<d;){var h=n[u];e>0&&t(h)?e>1?bt(h,e-1,t,i,o):lt(o,h):i||(o[o.length]=h)}return o}var Ra=du(),wa=du(!0);function wn(n,e){return n&&Ra(n,e,Bt)}function Oa(n,e){return n&&wa(n,e,Bt)}function ar(n,e){return ti(e,function(t){return fi(n[t])})}function sr(n,e){for(var t=0,i=(e=li(e,n)).length;n!=null&&t<i;)n=n[di(e[t++])];return t&&t==i?n:m}function Rs(n,e,t){var i=e(n);return Be(n)?i:lt(i,t(n))}function Mt(n){return n==null?n===m?"[object Undefined]":"[object Null]":Kn&&Kn in Qe(n)?function(e){var t=Ve.call(e,Kn),i=e[Kn];try{e[Kn]=m;var o=!0}catch{}var u=Je.call(e);return o&&(t?e[Kn]=i:delete e[Kn]),u}(n):function(e){return Je.call(e)}(n)}function Aa(n,e){return n>e}function Fu(n,e){return n!=null&&Ve.call(n,e)}function Vu(n,e){return n!=null&&e in Qe(n)}function ka(n,e,t){for(var i=t?Do:Gr,o=n[0].length,u=n.length,d=u,h=re(u),_=1/0,T=[];d--;){var C=n[d];d&&e&&(C=Qt(C,rr(e))),_=Ot(C.length,_),h[d]=!t&&(e||o>=120&&C.length>=120)?new vr(d&&C):m}C=n[0];var R=-1,w=h[0];e:for(;++R<o&&T.length<_;){var P=C[R],U=e?e(P):P;if(P=t||P!==0?P:0,!(w?no(w,U):i(T,U,t))){for(d=u;--d;){var j=h[d];if(!(j?no(j,U):i(n[d],U,t)))continue e}w&&w.push(U),T.push(P)}}return T}function Gi(n,e,t){var i=(n=Va(n,e=li(e,n)))==null?n:n[di(Kr(e))];return i==null?m:tr(i,n,t)}function dc(n){return st(n)&&Mt(n)==ne}function bi(n,e,t,i,o){return n===e||(n==null||e==null||!st(n)&&!st(e)?n!=n&&e!=e:function(u,d,h,_,T,C){var R=Be(u),w=Be(d),P=R?se:xn(u),U=w?se:xn(d),j=(P=P==ne?J:P)==J,B=(U=U==ne?J:U)==J,$=P==U;if($&&ft(u)){if(!ft(d))return!1;R=!0,j=!1}if($&&!j)return C||(C=new At),R||Zt(u)?dr(u,d,h,_,T,C):function(ae,te,pe,be,Ce,_e,Se){switch(pe){case Yt:if(ae.byteLength!=te.byteLength||ae.byteOffset!=te.byteOffset)return!1;ae=ae.buffer,te=te.buffer;case bn:return!(ae.byteLength!=te.byteLength||!_e(new oo(ae),new oo(te)));case he:case Oe:case ee:return Yr(+ae,+te);case H:return ae.name==te.name&&ae.message==te.message;case le:case De:return ae==te+"";case Ee:var Le=ro;case ge:var et=1&be;if(Le||(Le=Wr),ae.size!=te.size&&!et)return!1;var vt=Se.get(ae);if(vt)return vt==te;be|=2,Se.set(ae,te);var Et=dr(Le(ae),Le(te),be,Ce,_e,Se);return Se.delete(ae),Et;case Ie:if(Ei)return Ei.call(ae)==Ei.call(te)}return!1}(u,d,P,h,_,T,C);if(!(1&h)){var K=j&&Ve.call(u,"__wrapped__"),Q=B&&Ve.call(d,"__wrapped__");if(K||Q){var oe=K?u.value():u,ce=Q?d.value():d;return C||(C=new At),T(oe,ce,h,_,C)}}return $?(C||(C=new At),function(ae,te,pe,be,Ce,_e){var Se=1&pe,Le=Ai(ae),et=Le.length,vt=Ai(te),Et=vt.length;if(et!=Et&&!Se)return!1;for(var mt=et;mt--;){var It=Le[mt];if(!(Se?It in te:Ve.call(te,It)))return!1}var en=_e.get(ae),Ht=_e.get(te);if(en&&Ht)return en==te&&Ht==ae;var Ut=!0;_e.set(ae,te),_e.set(te,ae);for(var xt=Se;++mt<et;){var Nt=ae[It=Le[mt]],jt=te[It];if(be)var rn=Se?be(jt,Nt,It,te,ae,_e):be(Nt,jt,It,ae,te,_e);if(!(rn===m?Nt===jt||Ce(Nt,jt,pe,be,_e):rn)){Ut=!1;break}xt||(xt=It=="constructor")}if(Ut&&!xt){var kt=ae.constructor,Pn=te.constructor;kt==Pn||!("constructor"in ae)||!("constructor"in te)||typeof kt=="function"&&kt instanceof kt&&typeof Pn=="function"&&Pn instanceof Pn||(Ut=!1)}return _e.delete(ae),_e.delete(te),Ut}(u,d,h,_,T,C)):!1}(n,e,t,i,bi,o))}function ws(n,e,t,i){var o=t.length,u=o,d=!i;if(n==null)return!u;for(n=Qe(n);o--;){var h=t[o];if(d&&h[2]?h[1]!==n[h[0]]:!(h[0]in n))return!1}for(;++o<u;){var _=(h=t[o])[0],T=n[_],C=h[1];if(d&&h[2]){if(T===m&&!(_ in n))return!1}else{var R=new At;if(i)var w=i(T,C,_,n,e,R);if(!(w===m?bi(C,T,3,i,R):w))return!1}}return!0}function Re(n){return!(!Jt(n)||(e=n,ys&&ys in e))&&(fi(n)?Sl:ca).test(Qn(n));var e}function hc(n){return typeof n=="function"?n:n==null?yr:typeof n=="object"?Be(n)?Vo(n[0],n[1]):su(n):Wt(n)}function uo(n){if(!Qo(n))return xu(n);var e=[];for(var t in Qe(n))Ve.call(n,t)&&t!="constructor"&&e.push(t);return e}function On(n){if(!Jt(n))return function(o){var u=[];if(o!=null)for(var d in Qe(o))u.push(d);return u}(n);var e=Qo(n),t=[];for(var i in n)(i!="constructor"||!e&&Ve.call(n,i))&&t.push(i);return t}function Os(n,e){return n<e}function fc(n,e){var t=-1,i=fr(n)?re(n.length):[];return jn(n,function(o,u,d){i[++t]=e(o,u,d)}),i}function su(n){var e=Ji(n);return e.length==1&&e[0][2]?Ic(e[0][0],e[0][1]):function(t){return t===n||ws(t,n,e)}}function Vo(n,e){return Jo(n)&&Cc(e)?Ic(di(n),e):function(t){var i=na(t,n);return i===m&&i===e?Ws(t,n):bi(e,i,3)}}function Pa(n,e,t,i,o){n!==e&&Ra(e,function(u,d){if(o||(o=new At),Jt(u))(function(_,T,C,R,w,P,U){var j=Rc(_,C),B=Rc(T,C),$=U.get(B);if($)return void so(_,C,$);var K=P?P(j,B,C+"",_,T,U):m,Q=K===m;if(Q){var oe=Be(B),ce=!oe&&ft(B),ae=!oe&&!ce&&Zt(B);K=B,oe||ce||ae?Be(j)?K=j:yt(j)?K=fn(j):ce?(Q=!1,K=$o(B,!0)):ae?(Q=!1,K=Sc(B,!0)):K=[]:za(B)||hi(B)?(K=j,hi(j)?K=Lr(j):Jt(j)&&!fi(j)||(K=fu(B))):Q=!1}Q&&(U.set(B,K),w(K,B,R,P,U),U.delete(B)),so(_,C,K)})(n,e,d,t,Pa,i,o);else{var h=i?i(Rc(n,d),u,d+"",n,e,o):m;h===m&&(h=u),so(n,d,h)}},ct)}function pc(n,e){var t=n.length;if(t)return sn(e+=e<0?t:0,t)?n[e]:m}function lo(n,e,t){e=e.length?Qt(e,function(u){return Be(u)?function(d){return sr(d,u.length===1?u[0]:u)}:u}):[yr];var i=-1;e=Qt(e,rr(We()));var o=fc(n,function(u,d,h){var _=Qt(e,function(T){return T(u)});return{criteria:_,index:++i,value:u}});return function(u,d){var h=u.length;for(u.sort(d);h--;)u[h]=u[h].value;return u}(o,function(u,d){return function(h,_,T){for(var C=-1,R=h.criteria,w=_.criteria,P=R.length,U=T.length;++C<P;){var j=cu(R[C],w[C]);if(j)return C>=U?j:j*(T[C]=="desc"?-1:1)}return h.index-_.index}(u,d,t)})}function gc(n,e,t){for(var i=-1,o=e.length,u={};++i<o;){var d=e[i],h=sr(n,d);t(h,d)&&Wi(u,li(d,n),h)}return u}function mc(n,e,t,i){var o=i?_a:ri,u=-1,d=e.length,h=n;for(n===e&&(e=fn(e)),t&&(h=Qt(n,rr(t)));++u<d;)for(var _=0,T=e[u],C=t?t(T):T;(_=o(h,C,_,i))>-1;)h!==n&&oi.call(h,_,1),oi.call(n,_,1);return n}function As(n,e){for(var t=n?e.length:0,i=t-1;t--;){var o=e[t];if(t==i||o!==u){var u=o;sn(o)?oi.call(n,o,1):Wo(n,o)}}return n}function Da(n,e){return n+Bo(Ts()*(e-n+1))}function ht(n,e){var t="";if(!n||e<1||e>M)return t;do e%2&&(t+=n),(e=Bo(e/2))&&(n+=n);while(e);return t}function at(n,e){return Ga(An(n,e,yr),n+"")}function Na(n){return or(En(n))}function cr(n,e){var t=En(n);return Wa(t,_r(e,0,t.length))}function Wi(n,e,t,i){if(!Jt(n))return n;for(var o=-1,u=(e=li(e,n)).length,d=u-1,h=n;h!=null&&++o<u;){var _=di(e[o]),T=t;if(_==="__proto__"||_==="constructor"||_==="prototype")return n;if(o!=d){var C=h[_];(T=i?i(C,_,h):m)===m&&(T=Jt(C)?C:sn(e[o+1])?[]:{})}ci(h,_,T),h=h[_]}return n}var Fn=jo?function(n,e){return jo.set(n,e),n}:yr,ho=Lo?function(n,e){return Lo(n,"toString",{configurable:!0,enumerable:!1,value:Hn(e),writable:!0})}:yr;function dt(n){return Wa(En(n))}function kr(n,e,t){var i=-1,o=n.length;e<0&&(e=-e>o?0:o+e),(t=t>o?o:t)<0&&(t+=o),o=e>t?0:t-e>>>0,e>>>=0;for(var u=re(o);++i<o;)u[i]=n[i+e];return u}function Pr(n,e){var t;return jn(n,function(i,o,u){return!(t=e(i,o,u))}),!!t}function Go(n,e,t){var i=0,o=n==null?i:n.length;if(typeof e=="number"&&e==e&&o<=2147483647){for(;i<o;){var u=i+o>>>1,d=n[u];d!==null&&!Ct(d)&&(t?d<=e:d<e)?i=u+1:o=u}return o}return ks(n,e,yr,t)}function ks(n,e,t,i){var o=0,u=n==null?0:n.length;if(u===0)return 0;for(var d=(e=t(e))!=e,h=e===null,_=Ct(e),T=e===m;o<u;){var C=Bo((o+u)/2),R=t(n[C]),w=R!==m,P=R===null,U=R==R,j=Ct(R);if(d)var B=i||U;else B=T?U&&(i||w):h?U&&w&&(i||!P):_?U&&w&&!P&&(i||!j):!P&&!j&&(i?R<=e:R<e);B?o=C+1:u=C}return Ot(u,4294967294)}function vc(n,e){for(var t=-1,i=n.length,o=0,u=[];++t<i;){var d=n[t],h=e?e(d):d;if(!t||!Yr(h,_)){var _=h;u[o++]=d===0?0:d}}return u}function ur(n){return typeof n=="number"?n:Ct(n)?W:+n}function Dt(n){if(typeof n=="string")return n;if(Be(n))return Qt(n,Dt)+"";if(Ct(n))return ao?ao.call(n):"";var e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function Dr(n,e,t){var i=-1,o=Gr,u=n.length,d=!0,h=[],_=h;if(t)d=!1,o=Do;else if(u>=200){var T=e?null:Gu(n);if(T)return Wr(T);d=!1,o=no,_=new vr}else _=e?[]:h;e:for(;++i<u;){var C=n[i],R=e?e(C):C;if(C=t||C!==0?C:0,d&&R==R){for(var w=_.length;w--;)if(_[w]===R)continue e;e&&_.push(R),h.push(C)}else o(_,R,t)||(_!==h&&_.push(R),h.push(C))}return h}function Wo(n,e){return(n=Va(n,e=li(e,n)))==null||delete n[di(Kr(e))]}function Hi(n,e,t,i){return Wi(n,e,t(sr(n,e)),i)}function Ho(n,e,t,i){for(var o=n.length,u=i?o:-1;(i?u--:++u<o)&&e(n[u],u,n););return t?kr(n,i?0:u,i?u+1:o):kr(n,i?u+1:0,i?o:u)}function _c(n,e){var t=n;return t instanceof Ae&&(t=t.value()),ni(e,function(i,o){return o.func.apply(o.thisArg,lt([i],o.args))},t)}function Ti(n,e,t){var i=n.length;if(i<2)return i?Dr(n[0]):[];for(var o=-1,u=re(i);++o<i;)for(var d=n[o],h=-1;++h<i;)h!=o&&(u[o]=ui(u[o]||d,n[h],e,t));return Dr(bt(u,1),e,t)}function zr(n,e,t){for(var i=-1,o=n.length,u=e.length,d={};++i<o;){var h=i<u?e[i]:m;t(d,n[i],h)}return d}function $i(n){return yt(n)?n:[]}function Ln(n){return typeof n=="function"?n:yr}function li(n,e){return Be(n)?n:Jo(n,e)?[n]:Oc(pt(n))}var Nr=at;function zi(n,e,t){var i=n.length;return t=t===m?i:t,!e&&t>=i?n:kr(n,e,t)}var Ps=El||function(n){return Fe.clearTimeout(n)};function $o(n,e){if(e)return n.slice();var t=n.length,i=tu?tu(t):new n.constructor(t);return n.copy(i),i}function fo(n){var e=new n.constructor(n.byteLength);return new oo(e).set(new oo(n)),e}function Sc(n,e){var t=e?fo(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.length)}function cu(n,e){if(n!==e){var t=n!==m,i=n===null,o=n==n,u=Ct(n),d=e!==m,h=e===null,_=e==e,T=Ct(e);if(!h&&!T&&!u&&n>e||u&&d&&_&&!h&&!T||i&&d&&_||!t&&_||!o)return 1;if(!i&&!u&&!T&&n<e||T&&t&&o&&!i&&!u||h&&t&&o||!d&&o||!_)return-1}return 0}function uu(n,e,t,i){for(var o=-1,u=n.length,d=t.length,h=-1,_=e.length,T=gt(u-d,0),C=re(_+T),R=!i;++h<_;)C[h]=e[h];for(;++o<d;)(R||o<u)&&(C[t[o]]=n[o]);for(;T--;)C[h++]=n[o++];return C}function lr(n,e,t,i){for(var o=-1,u=n.length,d=-1,h=t.length,_=-1,T=e.length,C=gt(u-h,0),R=re(C+T),w=!i;++o<C;)R[o]=n[o];for(var P=o;++_<T;)R[P+_]=e[_];for(;++d<h;)(w||o<u)&&(R[P+t[d]]=n[o++]);return R}function fn(n,e){var t=-1,i=n.length;for(e||(e=re(i));++t<i;)e[t]=n[t];return e}function Sr(n,e,t,i){var o=!t;t||(t={});for(var u=-1,d=e.length;++u<d;){var h=e[u],_=i?i(t[h],n[h],h,t,n):m;_===m&&(_=n[h]),o?_n(t,h,_):ci(t,h,_)}return t}function Ci(n,e){return function(t,i){var o=Be(t)?Rr:iu,u=e?e():{};return o(t,n,We(i,2),u)}}function Ii(n){return at(function(e,t){var i=-1,o=t.length,u=o>1?t[o-1]:m,d=o>2?t[2]:m;for(u=n.length>3&&typeof u=="function"?(o--,u):m,d&&Bn(t[0],t[1],d)&&(u=o<3?m:u,o=1),e=Qe(e);++i<o;){var h=t[i];h&&n(e,h,i,u)}return e})}function lu(n,e){return function(t,i){if(t==null)return t;if(!fr(t))return n(t,i);for(var o=t.length,u=e?o:-1,d=Qe(t);(e?u--:++u<o)&&i(d[u],u,d)!==!1;);return t}}function du(n){return function(e,t,i){for(var o=-1,u=Qe(e),d=i(e),h=d.length;h--;){var _=d[n?h:++o];if(t(u[_],_,u)===!1)break}return e}}function zo(n){return function(e){var t=ya(e=pt(e))?vn(e):m,i=t?t[0]:e.charAt(0),o=t?zi(t,1).join(""):e.slice(1);return i[n]()+o}}function Ri(n){return function(e){return ni(Ja(Tu(e).replace($c,"")),n,"")}}function Ma(n){return function(){var e=arguments;switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3]);case 5:return new n(e[0],e[1],e[2],e[3],e[4]);case 6:return new n(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var t=ze(n.prototype),i=n.apply(t,e);return Jt(i)?i:t}}function Ec(n){return function(e,t,i){var o=Qe(e);if(!fr(e)){var u=We(t,3);e=Bt(e),t=function(h){return u(o[h],h,o)}}var d=n(e,t,i);return d>-1?o[u?e[d]:d]:m}}function La(n){return Vn(function(e){var t=e.length,i=t,o=Xt.prototype.thru;for(n&&e.reverse();i--;){var u=e[i];if(typeof u!="function")throw new wt(y);if(o&&!d&&Ki(u)=="wrapper")var d=new Xt([],!0)}for(i=d?i:t;++i<t;){var h=Ki(u=e[i]),_=h=="wrapper"?qi(u):m;d=_&&Tc(_[0])&&_[1]==424&&!_[4].length&&_[9]==1?d[Ki(_[0])].apply(d,_[3]):u.length==1&&Tc(u)?d[h]():d.thru(u)}return function(){var T=arguments,C=T[0];if(d&&T.length==1&&Be(C))return d.plant(C).value();for(var R=0,w=t?e[R].apply(this,T):C;++R<t;)w=e[R].call(this,w);return w}})}function Er(n,e,t,i,o,u,d,h,_,T){var C=e&x,R=1&e,w=2&e,P=24&e,U=512&e,j=w?m:Ma(n);return function B(){for(var $=arguments.length,K=re($),Q=$;Q--;)K[Q]=arguments[Q];if(P)var oe=$e(B),ce=function(be,Ce){for(var _e=be.length,Se=0;_e--;)be[_e]===Ce&&++Se;return Se}(K,oe);if(i&&(K=uu(K,i,o,P)),u&&(K=lr(K,u,d,P)),$-=ce,P&&$<T){var ae=Bi(K,oe);return yc(n,e,Er,B.placeholder,t,K,ae,h,_,T-$)}var te=R?t:this,pe=w?te[n]:n;return $=K.length,h?K=function(be,Ce){for(var _e=be.length,Se=Ot(Ce.length,_e),Le=fn(be);Se--;){var et=Ce[Se];be[Se]=sn(et,_e)?Le[et]:m}return be}(K,h):U&&$>1&&K.reverse(),C&&_<$&&(K.length=_),this&&this!==Fe&&this instanceof B&&(pe=j||Ma(pe)),pe.apply(te,K)}}function xa(n,e){return function(t,i){return function(o,u,d,h){return wn(o,function(_,T,C){u(h,d(_),T,C)}),h}(t,n,e(i),{})}}function qo(n,e){return function(t,i){var o;if(t===m&&i===m)return e;if(t!==m&&(o=t),i!==m){if(o===m)return i;typeof t=="string"||typeof i=="string"?(t=Dt(t),i=Dt(i)):(t=ur(t),i=ur(i)),o=n(t,i)}return o}}function Ba(n){return Vn(function(e){return e=Qt(e,rr(We())),at(function(t){var i=this;return n(e,function(o){return tr(o,i,t)})})})}function Ds(n,e){var t=(e=e===m?" ":Dt(e)).length;if(t<2)return t?ht(e,n):e;var i=ht(e,xo(n/ii(e)));return ya(e)?zi(vn(i),0,n).join(""):i.slice(0,n)}function Ns(n){return function(e,t,i){return i&&typeof i!="number"&&Bn(e,t,i)&&(t=i=m),e=nn(e),t===m?(t=e,e=0):t=nn(t),function(o,u,d,h){for(var _=-1,T=gt(xo((u-o)/(d||1)),0),C=re(T);T--;)C[h?T:++_]=o,o+=d;return C}(e,t,i=i===m?e<t?1:-1:nn(i),n)}}function Ms(n){return function(e,t){return typeof e=="string"&&typeof t=="string"||(e=pr(e),t=pr(t)),n(e,t)}}function yc(n,e,t,i,o,u,d,h,_,T){var C=8&e;e|=C?f:b,4&(e&=~(C?b:f))||(e&=-4);var R=[n,e,o,C?u:m,C?d:m,C?m:u,C?m:d,h,_,T],w=t.apply(m,R);return Tc(n)&&Xo(w,R),w.placeholder=i,wc(w,n,e)}function hu(n){var e=on[n];return function(t,i){if(t=pr(t),(i=i==null?0:Ot(Ne(i),292))&&Uo(t)){var o=(pt(t)+"e").split("e");return+((o=(pt(e(o[0]+"e"+(+o[1]+i)))+"e").split("e"))[0]+"e"+(+o[1]-i))}return e(t)}}var Gu=ai&&1/Wr(new ai([,-0]))[1]==A?function(n){return new ai(n)}:yn;function wi(n){return function(e){var t=xn(e);return t==Ee?ro(e):t==ge?oc(e):function(i,o){return Qt(o,function(u){return[u,i[u]]})}(e,n(e))}}function Oi(n,e,t,i,o,u,d,h){var _=2&e;if(!_&&typeof n!="function")throw new wt(y);var T=i?i.length:0;if(T||(e&=-97,i=o=m),d=d===m?d:gt(Ne(d),0),h=h===m?h:Ne(h),T-=o?o.length:0,e&b){var C=i,R=o;i=o=m}var w=_?m:qi(n),P=[n,e,t,i,o,C,R,u,d,h];if(w&&function(j,B){var $=j[1],K=B[1],Q=$|K,oe=Q<131,ce=K==x&&$==8||K==x&&$==D&&j[7].length<=B[8]||K==384&&B[7].length<=B[8]&&$==8;if(!oe&&!ce)return j;1&K&&(j[2]=B[2],Q|=1&$?0:4);var ae=B[3];if(ae){var te=j[3];j[3]=te?uu(te,ae,B[4]):ae,j[4]=te?Bi(j[3],I):B[4]}(ae=B[5])&&(te=j[5],j[5]=te?lr(te,ae,B[6]):ae,j[6]=te?Bi(j[5],I):B[6]),(ae=B[7])&&(j[7]=ae),K&x&&(j[8]=j[8]==null?B[8]:Ot(j[8],B[8])),j[9]==null&&(j[9]=B[9]),j[0]=B[0],j[1]=Q}(P,w),n=P[0],e=P[1],t=P[2],i=P[3],o=P[4],!(h=P[9]=P[9]===m?_?0:n.length:gt(P[9]-T,0))&&24&e&&(e&=-25),e&&e!=1)U=e==8||e==S?function(j,B,$){var K=Ma(j);return function Q(){for(var oe=arguments.length,ce=re(oe),ae=oe,te=$e(Q);ae--;)ce[ae]=arguments[ae];var pe=oe<3&&ce[0]!==te&&ce[oe-1]!==te?[]:Bi(ce,te);return(oe-=pe.length)<$?yc(j,B,Er,Q.placeholder,m,ce,pe,m,m,$-oe):tr(this&&this!==Fe&&this instanceof Q?K:j,this,ce)}}(n,e,h):e!=f&&e!=33||o.length?Er.apply(m,P):function(j,B,$,K){var Q=1&B,oe=Ma(j);return function ce(){for(var ae=-1,te=arguments.length,pe=-1,be=K.length,Ce=re(be+te),_e=this&&this!==Fe&&this instanceof ce?oe:j;++pe<be;)Ce[pe]=K[pe];for(;te--;)Ce[pe++]=arguments[++ae];return tr(_e,Q?$:this,Ce)}}(n,e,t,i);else var U=function(j,B,$){var K=1&B,Q=Ma(j);return function oe(){return(this&&this!==Fe&&this instanceof oe?Q:j).apply(K?$:this,arguments)}}(n,e,t);return wc((w?Fn:Xo)(U,P),n,e)}function Ua(n,e,t,i){return n===m||Yr(n,Ar[t])&&!Ve.call(i,t)?e:n}function ja(n,e,t,i,o,u){return Jt(n)&&Jt(e)&&(u.set(e,n),Pa(n,e,m,ja,u),u.delete(e)),n}function Ko(n){return za(n)?m:n}function dr(n,e,t,i,o,u){var d=1&t,h=n.length,_=e.length;if(h!=_&&!(d&&_>h))return!1;var T=u.get(n),C=u.get(e);if(T&&C)return T==e&&C==n;var R=-1,w=!0,P=2&t?new vr:m;for(u.set(n,e),u.set(e,n);++R<h;){var U=n[R],j=e[R];if(i)var B=d?i(j,U,R,e,n,u):i(U,j,R,n,e,u);if(B!==m){if(B)continue;w=!1;break}if(P){if(!Qc(e,function($,K){if(!no(P,K)&&(U===$||o(U,$,t,i,u)))return P.push(K)})){w=!1;break}}else if(U!==j&&!o(U,j,t,i,u)){w=!1;break}}return u.delete(n),u.delete(e),w}function Vn(n){return Ga(An(n,m,xs),n+"")}function Ai(n){return Rs(n,Bt,Ls)}function qr(n){return Rs(n,ct,gn)}var qi=jo?function(n){return jo.get(n)}:yn;function Ki(n){for(var e=n.name+"",t=$r[e],i=Ve.call($r,e)?t.length:0;i--;){var o=t[i],u=o.func;if(u==null||u==n)return o.name}return e}function $e(n){return(Ve.call(g,"placeholder")?g:n).placeholder}function We(){var n=g.iteratee||Xn;return n=n===Xn?hc:n,arguments.length?n(arguments[0],arguments[1]):n}function Fa(n,e){var t,i,o=n.__data__;return((i=typeof(t=e))=="string"||i=="number"||i=="symbol"||i=="boolean"?t!=="__proto__":t===null)?o[typeof e=="string"?"string":"hash"]:o.map}function Ji(n){for(var e=Bt(n),t=e.length;t--;){var i=e[t],o=n[i];e[t]=[i,o,Cc(o)]}return e}function Mr(n,e){var t=function(i,o){return i==null?m:i[o]}(n,e);return Re(t)?t:m}var Ls=Ta?function(n){return n==null?[]:(n=Qe(n),ti(Ta(n),function(e){return bs.call(n,e)}))}:oa,gn=Ta?function(n){for(var e=[];n;)lt(e,Ls(n)),n=Mo(n);return e}:oa,xn=Mt;function bc(n,e,t){for(var i=-1,o=(e=li(e,n)).length,u=!1;++i<o;){var d=di(e[i]);if(!(u=n!=null&&t(n,d)))break;n=n[d]}return u||++i!=o?u:!!(o=n==null?0:n.length)&&Qi(o)&&sn(d,o)&&(Be(n)||hi(n))}function fu(n){return typeof n.constructor!="function"||Qo(n)?{}:ze(Mo(n))}function ki(n){return Be(n)||hi(n)||!!(ru&&n&&n[ru])}function sn(n,e){var t=typeof n;return!!(e=e??M)&&(t=="number"||t!="symbol"&&Y.test(n))&&n>-1&&n%1==0&&n<e}function Bn(n,e,t){if(!Jt(t))return!1;var i=typeof e;return!!(i=="number"?fr(t)&&sn(e,t.length):i=="string"&&e in t)&&Yr(t[e],n)}function Jo(n,e){if(Be(n))return!1;var t=typeof n;return!(t!="number"&&t!="symbol"&&t!="boolean"&&n!=null&&!Ct(n))||eo.test(n)||!Mi.test(n)||e!=null&&n in Qe(e)}function Tc(n){var e=Ki(n),t=g[e];if(typeof t!="function"||!(e in Ae.prototype))return!1;if(n===t)return!0;var i=qi(t);return!!i&&n===i[0]}(Ca&&xn(new Ca(new ArrayBuffer(1)))!=Yt||ve&&xn(new ve)!=Ee||qt&&xn(qt.resolve())!=X||ai&&xn(new ai)!=ge||Fi&&xn(new Fi)!=_t)&&(xn=function(n){var e=Mt(n),t=e==J?n.constructor:m,i=t?Qn(t):"";if(i)switch(i){case Cl:return Yt;case Fo:return Ee;case Uu:return X;case Jn:return ge;case ju:return _t}return e});var Yo=Hr?fi:Ya;function Qo(n){var e=n&&n.constructor;return n===(typeof e=="function"&&e.prototype||Ar)}function Cc(n){return n==n&&!Jt(n)}function Ic(n,e){return function(t){return t!=null&&t[n]===e&&(e!==m||n in Qe(t))}}function An(n,e,t){return e=gt(e===m?n.length-1:e,0),function(){for(var i=arguments,o=-1,u=gt(i.length-e,0),d=re(u);++o<u;)d[o]=i[e+o];o=-1;for(var h=re(e+1);++o<e;)h[o]=i[o];return h[e]=t(d),tr(n,this,h)}}function Va(n,e){return e.length<2?n:sr(n,kr(e,0,-1))}function Rc(n,e){if((e!=="constructor"||typeof n[e]!="function")&&e!="__proto__")return n[e]}var Xo=Pi(Fn),po=Lu||function(n,e){return Fe.setTimeout(n,e)},Ga=Pi(ho);function wc(n,e,t){var i=e+"";return Ga(n,function(o,u){var d=u.length;if(!d)return o;var h=d-1;return u[h]=(d>1?"& ":"")+u[h],u=u.join(d>2?", ":" "),o.replace(Rt,`{
/* [wrapped with `+u+`] */
`)}(i,function(o,u){return wr(q,function(d){var h="_."+d[0];u&d[1]&&!Gr(o,h)&&o.push(h)}),o.sort()}(function(o){var u=o.match(Ft);return u?u[1].split(us):[]}(i),t)))}function Pi(n){var e=0,t=0;return function(){var i=sc(),o=16-(i-t);if(t=i,o>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(m,arguments)}}function Wa(n,e){var t=-1,i=n.length,o=i-1;for(e=e===m?i:e;++t<e;){var u=Da(t,o),d=n[u];n[u]=n[t],n[t]=d}return n.length=e,n}var Oc=function(n){var e=xc(n,function(i){return t.size===500&&t.clear(),i}),t=e.cache;return e}(function(n){var e=[];return n.charCodeAt(0)===46&&e.push(""),n.replace(ss,function(t,i,o,u){e.push(o?u.replace(Ke,"$1"):i||t)}),e});function di(n){if(typeof n=="string"||Ct(n))return n;var e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function Qn(n){if(n!=null){try{return xe.call(n)}catch{}try{return n+""}catch{}}return""}function go(n){if(n instanceof Ae)return n.clone();var e=new Xt(n.__wrapped__,n.__chain__);return e.__actions__=fn(n.__actions__),e.__index__=n.__index__,e.__values__=n.__values__,e}var Wu=at(function(n,e){return yt(n)?ui(n,bt(e,1,yt,!0)):[]}),Rl=at(function(n,e){var t=Kr(e);return yt(t)&&(t=m),yt(n)?ui(n,bt(e,1,yt,!0),We(t,2)):[]}),pu=at(function(n,e){var t=Kr(e);return yt(t)&&(t=m),yt(n)?ui(n,bt(e,1,yt,!0),m,t):[]});function Ac(n,e,t){var i=n==null?0:n.length;if(!i)return-1;var o=t==null?0:Ne(t);return o<0&&(o=gt(i+o,0)),vs(n,We(e,3),o)}function kc(n,e,t){var i=n==null?0:n.length;if(!i)return-1;var o=i-1;return t!==m&&(o=Ne(t),o=t<0?gt(i+o,0):Ot(o,i-1)),vs(n,We(e,3),o,!0)}function xs(n){return n!=null&&n.length?bt(n,1):[]}function gu(n){return n&&n.length?n[0]:m}var Hu=at(function(n){var e=Qt(n,$i);return e.length&&e[0]===n[0]?ka(e):[]}),wl=at(function(n){var e=Kr(n),t=Qt(n,$i);return e===Kr(t)?e=m:t.pop(),t.length&&t[0]===n[0]?ka(t,We(e,2)):[]}),$u=at(function(n){var e=Kr(n),t=Qt(n,$i);return(e=typeof e=="function"?e:m)&&t.pop(),t.length&&t[0]===n[0]?ka(t,m,e):[]});function Kr(n){var e=n==null?0:n.length;return e?n[e-1]:m}var hr=at(zu);function zu(n,e){return n&&n.length&&e&&e.length?mc(n,e):n}var qu=Vn(function(n,e){var t=n==null?0:n.length,i=Ia(n,e);return As(n,Qt(e,function(o){return sn(o,t)?+o:o}).sort(cu)),i});function Zo(n){return n==null?n:Bu.call(n)}var Ha=at(function(n){return Dr(bt(n,1,yt,!0))}),Ku=at(function(n){var e=Kr(n);return yt(e)&&(e=m),Dr(bt(n,1,yt,!0),We(e,2))}),Ol=at(function(n){var e=Kr(n);return e=typeof e=="function"?e:m,Dr(bt(n,1,yt,!0),m,e)});function mu(n){if(!n||!n.length)return[];var e=0;return n=ti(n,function(t){if(yt(t))return e=gt(t.length,e),!0}),Ss(e,function(t){return Qt(n,nr(t))})}function Pc(n,e){if(!n||!n.length)return[];var t=mu(n);return e==null?t:Qt(t,function(i){return tr(e,m,i)})}var Ju=at(function(n,e){return yt(n)?ui(n,e):[]}),Al=at(function(n){return Ti(ti(n,yt))}),kl=at(function(n){var e=Kr(n);return yt(e)&&(e=m),Ti(ti(n,yt),We(e,2))}),Yu=at(function(n){var e=Kr(n);return e=typeof e=="function"?e:m,Ti(ti(n,yt),m,e)}),Pl=at(mu),Dl=at(function(n){var e=n.length,t=e>1?n[e-1]:m;return t=typeof t=="function"?(n.pop(),t):m,Pc(n,t)});function vu(n){var e=g(n);return e.__chain__=!0,e}function Bs(n,e){return e(n)}var Dc=Vn(function(n){var e=n.length,t=e?n[0]:0,i=this.__wrapped__,o=function(u){return Ia(u,n)};return!(e>1||this.__actions__.length)&&i instanceof Ae&&sn(t)?((i=i.slice(t,+t+(e?1:0))).__actions__.push({func:Bs,args:[o],thisArg:m}),new Xt(i,this.__chain__).thru(function(u){return e&&!u.length&&u.push(m),u})):this.thru(o)}),Nl=Ci(function(n,e,t){Ve.call(n,t)?++n[t]:_n(n,t,1)}),Ml=Ec(Ac),Ll=Ec(kc);function Qu(n,e){return(Be(n)?wr:jn)(n,We(e,3))}function _u(n,e){return(Be(n)?Or:uc)(n,We(e,3))}var Xu=Ci(function(n,e,t){Ve.call(n,t)?n[t].push(e):_n(n,t,[e])}),xl=at(function(n,e,t){var i=-1,o=typeof e=="function",u=fr(n)?re(n.length):[];return jn(n,function(d){u[++i]=o?tr(e,d,t):Gi(d,e,t)}),u}),Zu=Ci(function(n,e,t){_n(n,t,e)});function ea(n,e){return(Be(n)?Qt:fc)(n,We(e,3))}var Gn=Ci(function(n,e,t){n[t?0:1].push(e)},function(){return[[],[]]}),Jr=at(function(n,e){if(n==null)return[];var t=e.length;return t>1&&Bn(n,e[0],e[1])?e=[]:t>2&&Bn(e[0],e[1],e[2])&&(e=[e[0]]),lo(n,bt(e,1),[])}),Lt=ba||function(){return Fe.Date.now()};function Us(n,e,t){return e=t?m:e,e=n&&e==null?n.length:e,Oi(n,x,m,m,m,m,e)}function Nc(n,e){var t;if(typeof e!="function")throw new wt(y);return n=Ne(n),function(){return--n>0&&(t=e.apply(this,arguments)),n<=1&&(e=m),t}}var Mc=at(function(n,e,t){var i=1;if(t.length){var o=Bi(t,$e(Mc));i|=f}return Oi(n,i,e,t,o)}),js=at(function(n,e,t){var i=3;if(t.length){var o=Bi(t,$e(js));i|=f}return Oi(e,i,n,t,o)});function Lc(n,e,t){var i,o,u,d,h,_,T=0,C=!1,R=!1,w=!0;if(typeof n!="function")throw new wt(y);function P(K){var Q=i,oe=o;return i=o=m,T=K,d=n.apply(oe,Q)}function U(K){var Q=K-_;return _===m||Q>=e||Q<0||R&&K-T>=u}function j(){var K=Lt();if(U(K))return B(K);h=po(j,function(Q){var oe=e-(Q-_);return R?Ot(oe,u-(Q-T)):oe}(K))}function B(K){return h=m,w&&i?P(K):(i=o=m,d)}function $(){var K=Lt(),Q=U(K);if(i=arguments,o=this,_=K,Q){if(h===m)return function(oe){return T=oe,h=po(j,e),C?P(oe):d}(_);if(R)return Ps(h),h=po(j,e),P(_)}return h===m&&(h=po(j,e)),d}return e=pr(e)||0,Jt(t)&&(C=!!t.leading,u=(R="maxWait"in t)?gt(pr(t.maxWait)||0,e):u,w="trailing"in t?!!t.trailing:w),$.cancel=function(){h!==m&&Ps(h),T=0,i=_=o=h=m},$.flush=function(){return h===m?d:B(Lt())},$}var el=at(function(n,e){return Is(n,1,e)}),Bl=at(function(n,e,t){return Is(n,pr(e)||0,t)});function xc(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new wt(y);var t=function(){var i=arguments,o=e?e.apply(this,i):i[0],u=t.cache;if(u.has(o))return u.get(o);var d=n.apply(this,i);return t.cache=u.set(o,d)||u,d};return t.cache=new(xc.Cache||hn),t}function ta(n){if(typeof n!="function")throw new wt(y);return function(){var e=arguments;switch(e.length){case 0:return!n.call(this);case 1:return!n.call(this,e[0]);case 2:return!n.call(this,e[0],e[1]);case 3:return!n.call(this,e[0],e[1],e[2])}return!n.apply(this,e)}}xc.Cache=hn;var Bc=Nr(function(n,e){var t=(e=e.length==1&&Be(e[0])?Qt(e[0],rr(We())):Qt(bt(e,1),rr(We()))).length;return at(function(i){for(var o=-1,u=Ot(i.length,t);++o<u;)i[o]=e[o].call(this,i[o]);return tr(n,this,i)})}),Su=at(function(n,e){var t=Bi(e,$e(Su));return Oi(n,f,m,e,t)}),$a=at(function(n,e){var t=Bi(e,$e($a));return Oi(n,b,m,e,t)}),Wn=Vn(function(n,e){return Oi(n,D,m,m,m,e)});function Yr(n,e){return n===e||n!=n&&e!=e}var Qr=Ms(Aa),Ul=Ms(function(n,e){return n>=e}),hi=dc(function(){return arguments}())?dc:function(n){return st(n)&&Ve.call(n,"callee")&&!bs.call(n,"callee")},Be=re.isArray,ut=ln?rr(ln):function(n){return st(n)&&Mt(n)==bn};function fr(n){return n!=null&&Qi(n.length)&&!fi(n)}function yt(n){return st(n)&&fr(n)}var ft=yl||Ya,Yi=gs?rr(gs):function(n){return st(n)&&Mt(n)==Oe};function Uc(n){if(!st(n))return!1;var e=Mt(n);return e==H||e=="[object DOMException]"||typeof n.message=="string"&&typeof n.name=="string"&&!za(n)}function fi(n){if(!Jt(n))return!1;var e=Mt(n);return e==me||e==ke||e=="[object AsyncFunction]"||e=="[object Proxy]"}function Kt(n){return typeof n=="number"&&n==Ne(n)}function Qi(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=M}function Jt(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}function st(n){return n!=null&&typeof n=="object"}var pn=Zs?rr(Zs):function(n){return st(n)&&xn(n)==Ee};function Eu(n){return typeof n=="number"||st(n)&&Mt(n)==ee}function za(n){if(!st(n)||Mt(n)!=J)return!1;var e=Mo(n);if(e===null)return!0;var t=Ve.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&xe.call(t)==vl}var pi=ec?rr(ec):function(n){return st(n)&&Mt(n)==le},Sn=ms?rr(ms):function(n){return st(n)&&xn(n)==ge};function mo(n){return typeof n=="string"||!Be(n)&&st(n)&&Mt(n)==De}function Ct(n){return typeof n=="symbol"||st(n)&&Mt(n)==Ie}var Zt=ma?rr(ma):function(n){return st(n)&&Qi(n.length)&&!!zt[Mt(n)]},qa=Ms(Os),Fs=Ms(function(n,e){return n<=e});function Vs(n){if(!n)return[];if(fr(n))return mo(n)?vn(n):fn(n);if(ji&&n[ji])return function(t){for(var i,o=[];!(i=t.next()).done;)o.push(i.value);return o}(n[ji]());var e=xn(n);return(e==Ee?ro:e==ge?Wr:En)(n)}function nn(n){return n?(n=pr(n))===A||n===-1/0?17976931348623157e292*(n<0?-1:1):n==n?n:0:n===0?n:0}function Ne(n){var e=nn(n),t=e%1;return e==e?t?e-t:e:0}function rt(n){return n?_r(Ne(n),0,z):0}function pr(n){if(typeof n=="number")return n;if(Ct(n))return W;if(Jt(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Jt(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=rc(n);var t=Io.test(n);return t||Ro.test(n)?Kc(n.slice(2),t?2:8):Ys.test(n)?W:+n}function Lr(n){return Sr(n,ct(n))}function pt(n){return n==null?"":Dt(n)}var Me=Ii(function(n,e){if(Qo(e)||fr(e))Sr(e,Bt(e),n);else for(var t in e)Ve.call(e,t)&&ci(n,t,e[t])}),tl=Ii(function(n,e){Sr(e,ct(e),n)}),Gs=Ii(function(n,e,t,i){Sr(e,ct(e),n,i)}),jc=Ii(function(n,e,t,i){Sr(e,Bt(e),n,i)}),jl=Vn(Ia),Fc=at(function(n,e){n=Qe(n);var t=-1,i=e.length,o=i>2?e[2]:m;for(o&&Bn(e[0],e[1],o)&&(i=1);++t<i;)for(var u=e[t],d=ct(u),h=-1,_=d.length;++h<_;){var T=d[h],C=n[T];(C===m||Yr(C,Ar[T])&&!Ve.call(n,T))&&(n[T]=u[T])}return n}),vo=at(function(n){return n.push(m,ja),tr(ra,m,n)});function na(n,e,t){var i=n==null?m:sr(n,e);return i===m?t:i}function Ws(n,e){return n!=null&&bc(n,e,Vu)}var yu=xa(function(n,e,t){e!=null&&typeof e.toString!="function"&&(e=Je.call(e)),n[e]=t},Hn(yr)),Fl=xa(function(n,e,t){e!=null&&typeof e.toString!="function"&&(e=Je.call(e)),Ve.call(n,e)?n[e].push(t):n[e]=[t]},We),Vl=at(Gi);function Bt(n){return fr(n)?de(n):uo(n)}function ct(n){return fr(n)?de(n,!0):On(n)}var mn=Ii(function(n,e,t){Pa(n,e,t)}),ra=Ii(function(n,e,t,i){Pa(n,e,t,i)}),gi=Vn(function(n,e){var t={};if(n==null)return t;var i=!1;e=Qt(e,function(u){return u=li(u,n),i||(i=u.length>1),u}),Sr(n,qr(n),t),i&&(t=an(t,7,Ko));for(var o=e.length;o--;)Wo(t,e[o]);return t}),nl=Vn(function(n,e){return n==null?{}:function(t,i){return gc(t,i,function(o,u){return Ws(t,u)})}(n,e)});function Vc(n,e){if(n==null)return{};var t=Qt(qr(n),function(i){return[i]});return e=We(e),gc(n,t,function(i,o){return e(i,o[0])})}var mi=wi(Bt),cn=wi(ct);function En(n){return n==null?[]:qn(n,Bt(n))}var ia=Ri(function(n,e,t){return e=e.toLowerCase(),n+(t?bu(e):e)});function bu(n){return Ka(pt(n).toLowerCase())}function Tu(n){return(n=pt(n))&&n.replace(ie,Mu).replace(Fr,"")}var Cu=Ri(function(n,e,t){return n+(t?"-":"")+e.toLowerCase()}),rl=Ri(function(n,e,t){return n+(t?" ":"")+e.toLowerCase()}),Gl=zo("toLowerCase"),il=Ri(function(n,e,t){return n+(t?"_":"")+e.toLowerCase()}),Iu=Ri(function(n,e,t){return n+(t?" ":"")+Ka(e)}),ol=Ri(function(n,e,t){return n+(t?" ":"")+e.toUpperCase()}),Ka=zo("toUpperCase");function Ja(n,e,t){return n=pt(n),(e=t?m:e)===m?function(i){return pl.test(i)}(n)?function(i){return i.match(ga)||[]}(n):function(i){return i.match(Wc)||[]}(n):n.match(e)||[]}var Ru=at(function(n,e){try{return tr(n,m,e)}catch(t){return Uc(t)?t:new Pe(t)}}),al=Vn(function(n,e){return wr(e,function(t){t=di(t),_n(n,t,Mc(n[t],n))}),n});function Hn(n){return function(){return n}}var Hs=La(),_o=La(!0);function yr(n){return n}function Xn(n){return hc(typeof n=="function"?n:an(n,1))}var Gc=at(function(n,e){return function(t){return Gi(t,n,e)}}),sl=at(function(n,e){return function(t){return Gi(n,t,e)}});function wu(n,e,t){var i=Bt(e),o=ar(e,i);t!=null||Jt(e)&&(o.length||!i.length)||(t=e,e=n,n=this,o=ar(e,Bt(e)));var u=!(Jt(t)&&"chain"in t&&!t.chain),d=fi(n);return wr(o,function(h){var _=e[h];n[h]=_,d&&(n.prototype[h]=function(){var T=this.__chain__;if(u||T){var C=n(this.__wrapped__);return(C.__actions__=fn(this.__actions__)).push({func:_,args:arguments,thisArg:n}),C.__chain__=T,C}return _.apply(n,lt([this.value()],arguments))})}),n}function yn(){}var Zn=Ba(Qt),So=Ba(tc),Wl=Ba(Qc);function Wt(n){return Jo(n)?nr(di(n)):function(e){return function(t){return sr(t,e)}}(n)}var Ou=Ns(),Hl=Ns(!0);function oa(){return[]}function Ya(){return!1}var Au=qo(function(n,e){return n+e},0),Eo=hu("ceil"),$l=qo(function(n,e){return n/e},1),s=hu("floor"),r,a=qo(function(n,e){return n*e},1),c=hu("round"),l=qo(function(n,e){return n-e},0);return g.after=function(n,e){if(typeof e!="function")throw new wt(y);return n=Ne(n),function(){if(--n<1)return e.apply(this,arguments)}},g.ary=Us,g.assign=Me,g.assignIn=tl,g.assignInWith=Gs,g.assignWith=jc,g.at=jl,g.before=Nc,g.bind=Mc,g.bindAll=al,g.bindKey=js,g.castArray=function(){if(!arguments.length)return[];var n=arguments[0];return Be(n)?n:[n]},g.chain=vu,g.chunk=function(n,e,t){e=(t?Bn(n,e,t):e===m)?1:gt(Ne(e),0);var i=n==null?0:n.length;if(!i||e<1)return[];for(var o=0,u=0,d=re(xo(i/e));o<i;)d[u++]=kr(n,o,o+=e);return d},g.compact=function(n){for(var e=-1,t=n==null?0:n.length,i=0,o=[];++e<t;){var u=n[e];u&&(o[i++]=u)}return o},g.concat=function(){var n=arguments.length;if(!n)return[];for(var e=re(n-1),t=arguments[0],i=n;i--;)e[i-1]=arguments[i];return lt(Be(t)?fn(t):[t],bt(e,1))},g.cond=function(n){var e=n==null?0:n.length,t=We();return n=e?Qt(n,function(i){if(typeof i[1]!="function")throw new wt(y);return[t(i[0]),i[1]]}):[],at(function(i){for(var o=-1;++o<e;){var u=n[o];if(tr(u[0],this,i))return tr(u[1],this,i)}})},g.conforms=function(n){return function(e){var t=Bt(e);return function(i){return Cs(i,e,t)}}(an(n,1))},g.constant=Hn,g.countBy=Nl,g.create=function(n,e){var t=ze(n);return e==null?t:ou(t,e)},g.curry=function n(e,t,i){var o=Oi(e,8,m,m,m,m,m,t=i?m:t);return o.placeholder=n.placeholder,o},g.curryRight=function n(e,t,i){var o=Oi(e,S,m,m,m,m,m,t=i?m:t);return o.placeholder=n.placeholder,o},g.debounce=Lc,g.defaults=Fc,g.defaultsDeep=vo,g.defer=el,g.delay=Bl,g.difference=Wu,g.differenceBy=Rl,g.differenceWith=pu,g.drop=function(n,e,t){var i=n==null?0:n.length;return i?kr(n,(e=t||e===m?1:Ne(e))<0?0:e,i):[]},g.dropRight=function(n,e,t){var i=n==null?0:n.length;return i?kr(n,0,(e=i-(e=t||e===m?1:Ne(e)))<0?0:e):[]},g.dropRightWhile=function(n,e){return n&&n.length?Ho(n,We(e,3),!0,!0):[]},g.dropWhile=function(n,e){return n&&n.length?Ho(n,We(e,3),!0):[]},g.fill=function(n,e,t,i){var o=n==null?0:n.length;return o?(t&&typeof t!="number"&&Bn(n,e,t)&&(t=0,i=o),function(u,d,h,_){var T=u.length;for((h=Ne(h))<0&&(h=-h>T?0:T+h),(_=_===m||_>T?T:Ne(_))<0&&(_+=T),_=h>_?0:rt(_);h<_;)u[h++]=d;return u}(n,e,t,i)):[]},g.filter=function(n,e){return(Be(n)?ti:lc)(n,We(e,3))},g.flatMap=function(n,e){return bt(ea(n,e),1)},g.flatMapDeep=function(n,e){return bt(ea(n,e),A)},g.flatMapDepth=function(n,e,t){return t=t===m?1:Ne(t),bt(ea(n,e),t)},g.flatten=xs,g.flattenDeep=function(n){return n!=null&&n.length?bt(n,A):[]},g.flattenDepth=function(n,e){return n!=null&&n.length?bt(n,e=e===m?1:Ne(e)):[]},g.flip=function(n){return Oi(n,512)},g.flow=Hs,g.flowRight=_o,g.fromPairs=function(n){for(var e=-1,t=n==null?0:n.length,i={};++e<t;){var o=n[e];i[o[0]]=o[1]}return i},g.functions=function(n){return n==null?[]:ar(n,Bt(n))},g.functionsIn=function(n){return n==null?[]:ar(n,ct(n))},g.groupBy=Xu,g.initial=function(n){return n!=null&&n.length?kr(n,0,-1):[]},g.intersection=Hu,g.intersectionBy=wl,g.intersectionWith=$u,g.invert=yu,g.invertBy=Fl,g.invokeMap=xl,g.iteratee=Xn,g.keyBy=Zu,g.keys=Bt,g.keysIn=ct,g.map=ea,g.mapKeys=function(n,e){var t={};return e=We(e,3),wn(n,function(i,o,u){_n(t,e(i,o,u),i)}),t},g.mapValues=function(n,e){var t={};return e=We(e,3),wn(n,function(i,o,u){_n(t,o,e(i,o,u))}),t},g.matches=function(n){return su(an(n,1))},g.matchesProperty=function(n,e){return Vo(n,an(e,1))},g.memoize=xc,g.merge=mn,g.mergeWith=ra,g.method=Gc,g.methodOf=sl,g.mixin=wu,g.negate=ta,g.nthArg=function(n){return n=Ne(n),at(function(e){return pc(e,n)})},g.omit=gi,g.omitBy=function(n,e){return Vc(n,ta(We(e)))},g.once=function(n){return Nc(2,n)},g.orderBy=function(n,e,t,i){return n==null?[]:(Be(e)||(e=e==null?[]:[e]),Be(t=i?m:t)||(t=t==null?[]:[t]),lo(n,e,t))},g.over=Zn,g.overArgs=Bc,g.overEvery=So,g.overSome=Wl,g.partial=Su,g.partialRight=$a,g.partition=Gn,g.pick=nl,g.pickBy=Vc,g.property=Wt,g.propertyOf=function(n){return function(e){return n==null?m:sr(n,e)}},g.pull=hr,g.pullAll=zu,g.pullAllBy=function(n,e,t){return n&&n.length&&e&&e.length?mc(n,e,We(t,2)):n},g.pullAllWith=function(n,e,t){return n&&n.length&&e&&e.length?mc(n,e,m,t):n},g.pullAt=qu,g.range=Ou,g.rangeRight=Hl,g.rearg=Wn,g.reject=function(n,e){return(Be(n)?ti:lc)(n,ta(We(e,3)))},g.remove=function(n,e){var t=[];if(!n||!n.length)return t;var i=-1,o=[],u=n.length;for(e=We(e,3);++i<u;){var d=n[i];e(d,i,n)&&(t.push(d),o.push(i))}return As(n,o),t},g.rest=function(n,e){if(typeof n!="function")throw new wt(y);return at(n,e=e===m?e:Ne(e))},g.reverse=Zo,g.sampleSize=function(n,e,t){return e=(t?Bn(n,e,t):e===m)?1:Ne(e),(Be(n)?Il:cr)(n,e)},g.set=function(n,e,t){return n==null?n:Wi(n,e,t)},g.setWith=function(n,e,t,i){return i=typeof i=="function"?i:m,n==null?n:Wi(n,e,t,i)},g.shuffle=function(n){return(Be(n)?cc:dt)(n)},g.slice=function(n,e,t){var i=n==null?0:n.length;return i?(t&&typeof t!="number"&&Bn(n,e,t)?(e=0,t=i):(e=e==null?0:Ne(e),t=t===m?i:Ne(t)),kr(n,e,t)):[]},g.sortBy=Jr,g.sortedUniq=function(n){return n&&n.length?vc(n):[]},g.sortedUniqBy=function(n,e){return n&&n.length?vc(n,We(e,2)):[]},g.split=function(n,e,t){return t&&typeof t!="number"&&Bn(n,e,t)&&(e=t=m),(t=t===m?z:t>>>0)?(n=pt(n))&&(typeof e=="string"||e!=null&&!pi(e))&&!(e=Dt(e))&&ya(n)?zi(vn(n),0,t):n.split(e,t):[]},g.spread=function(n,e){if(typeof n!="function")throw new wt(y);return e=e==null?0:gt(Ne(e),0),at(function(t){var i=t[e],o=zi(t,0,e);return i&&lt(o,i),tr(n,this,o)})},g.tail=function(n){var e=n==null?0:n.length;return e?kr(n,1,e):[]},g.take=function(n,e,t){return n&&n.length?kr(n,0,(e=t||e===m?1:Ne(e))<0?0:e):[]},g.takeRight=function(n,e,t){var i=n==null?0:n.length;return i?kr(n,(e=i-(e=t||e===m?1:Ne(e)))<0?0:e,i):[]},g.takeRightWhile=function(n,e){return n&&n.length?Ho(n,We(e,3),!1,!0):[]},g.takeWhile=function(n,e){return n&&n.length?Ho(n,We(e,3)):[]},g.tap=function(n,e){return e(n),n},g.throttle=function(n,e,t){var i=!0,o=!0;if(typeof n!="function")throw new wt(y);return Jt(t)&&(i="leading"in t?!!t.leading:i,o="trailing"in t?!!t.trailing:o),Lc(n,e,{leading:i,maxWait:e,trailing:o})},g.thru=Bs,g.toArray=Vs,g.toPairs=mi,g.toPairsIn=cn,g.toPath=function(n){return Be(n)?Qt(n,di):Ct(n)?[n]:fn(Oc(pt(n)))},g.toPlainObject=Lr,g.transform=function(n,e,t){var i=Be(n),o=i||ft(n)||Zt(n);if(e=We(e,4),t==null){var u=n&&n.constructor;t=o?i?new u:[]:Jt(n)&&fi(u)?ze(Mo(n)):{}}return(o?wr:wn)(n,function(d,h,_){return e(t,d,h,_)}),t},g.unary=function(n){return Us(n,1)},g.union=Ha,g.unionBy=Ku,g.unionWith=Ol,g.uniq=function(n){return n&&n.length?Dr(n):[]},g.uniqBy=function(n,e){return n&&n.length?Dr(n,We(e,2)):[]},g.uniqWith=function(n,e){return e=typeof e=="function"?e:m,n&&n.length?Dr(n,m,e):[]},g.unset=function(n,e){return n==null||Wo(n,e)},g.unzip=mu,g.unzipWith=Pc,g.update=function(n,e,t){return n==null?n:Hi(n,e,Ln(t))},g.updateWith=function(n,e,t,i){return i=typeof i=="function"?i:m,n==null?n:Hi(n,e,Ln(t),i)},g.values=En,g.valuesIn=function(n){return n==null?[]:qn(n,ct(n))},g.without=Ju,g.words=Ja,g.wrap=function(n,e){return Su(Ln(e),n)},g.xor=Al,g.xorBy=kl,g.xorWith=Yu,g.zip=Pl,g.zipObject=function(n,e){return zr(n||[],e||[],ci)},g.zipObjectDeep=function(n,e){return zr(n||[],e||[],Wi)},g.zipWith=Dl,g.entries=mi,g.entriesIn=cn,g.extend=tl,g.extendWith=Gs,wu(g,g),g.add=Au,g.attempt=Ru,g.camelCase=ia,g.capitalize=bu,g.ceil=Eo,g.clamp=function(n,e,t){return t===m&&(t=e,e=m),t!==m&&(t=(t=pr(t))==t?t:0),e!==m&&(e=(e=pr(e))==e?e:0),_r(pr(n),e,t)},g.clone=function(n){return an(n,4)},g.cloneDeep=function(n){return an(n,5)},g.cloneDeepWith=function(n,e){return an(n,5,e=typeof e=="function"?e:m)},g.cloneWith=function(n,e){return an(n,4,e=typeof e=="function"?e:m)},g.conformsTo=function(n,e){return e==null||Cs(n,e,Bt(e))},g.deburr=Tu,g.defaultTo=function(n,e){return n==null||n!=n?e:n},g.divide=$l,g.endsWith=function(n,e,t){n=pt(n),e=Dt(e);var i=n.length,o=t=t===m?i:_r(Ne(t),0,i);return(t-=e.length)>=0&&n.slice(t,o)==e},g.eq=Yr,g.escape=function(n){return(n=pt(n))&&sa.test(n)?n.replace(os,gl):n},g.escapeRegExp=function(n){return(n=pt(n))&&Co.test(n)?n.replace(Li,"\\$&"):n},g.every=function(n,e,t){var i=Be(n)?tc:au;return t&&Bn(n,e,t)&&(e=m),i(n,We(e,3))},g.find=Ml,g.findIndex=Ac,g.findKey=function(n,e){return In(n,We(e,3),wn)},g.findLast=Ll,g.findLastIndex=kc,g.findLastKey=function(n,e){return In(n,We(e,3),Oa)},g.floor=s,g.forEach=Qu,g.forEachRight=_u,g.forIn=function(n,e){return n==null?n:Ra(n,We(e,3),ct)},g.forInRight=function(n,e){return n==null?n:wa(n,We(e,3),ct)},g.forOwn=function(n,e){return n&&wn(n,We(e,3))},g.forOwnRight=function(n,e){return n&&Oa(n,We(e,3))},g.get=na,g.gt=Qr,g.gte=Ul,g.has=function(n,e){return n!=null&&bc(n,e,Fu)},g.hasIn=Ws,g.head=gu,g.identity=yr,g.includes=function(n,e,t,i){n=fr(n)?n:En(n),t=t&&!i?Ne(t):0;var o=n.length;return t<0&&(t=gt(o+t,0)),mo(n)?t<=o&&n.indexOf(e,t)>-1:!!o&&ri(n,e,t)>-1},g.indexOf=function(n,e,t){var i=n==null?0:n.length;if(!i)return-1;var o=t==null?0:Ne(t);return o<0&&(o=gt(i+o,0)),ri(n,e,o)},g.inRange=function(n,e,t){return e=nn(e),t===m?(t=e,e=0):t=nn(t),function(i,o,u){return i>=Ot(o,u)&&i<gt(o,u)}(n=pr(n),e,t)},g.invoke=Vl,g.isArguments=hi,g.isArray=Be,g.isArrayBuffer=ut,g.isArrayLike=fr,g.isArrayLikeObject=yt,g.isBoolean=function(n){return n===!0||n===!1||st(n)&&Mt(n)==he},g.isBuffer=ft,g.isDate=Yi,g.isElement=function(n){return st(n)&&n.nodeType===1&&!za(n)},g.isEmpty=function(n){if(n==null)return!0;if(fr(n)&&(Be(n)||typeof n=="string"||typeof n.splice=="function"||ft(n)||Zt(n)||hi(n)))return!n.length;var e=xn(n);if(e==Ee||e==ge)return!n.size;if(Qo(n))return!uo(n).length;for(var t in n)if(Ve.call(n,t))return!1;return!0},g.isEqual=function(n,e){return bi(n,e)},g.isEqualWith=function(n,e,t){var i=(t=typeof t=="function"?t:m)?t(n,e):m;return i===m?bi(n,e,m,t):!!i},g.isError=Uc,g.isFinite=function(n){return typeof n=="number"&&Uo(n)},g.isFunction=fi,g.isInteger=Kt,g.isLength=Qi,g.isMap=pn,g.isMatch=function(n,e){return n===e||ws(n,e,Ji(e))},g.isMatchWith=function(n,e,t){return t=typeof t=="function"?t:m,ws(n,e,Ji(e),t)},g.isNaN=function(n){return Eu(n)&&n!=+n},g.isNative=function(n){if(Yo(n))throw new Pe("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Re(n)},g.isNil=function(n){return n==null},g.isNull=function(n){return n===null},g.isNumber=Eu,g.isObject=Jt,g.isObjectLike=st,g.isPlainObject=za,g.isRegExp=pi,g.isSafeInteger=function(n){return Kt(n)&&n>=-9007199254740991&&n<=M},g.isSet=Sn,g.isString=mo,g.isSymbol=Ct,g.isTypedArray=Zt,g.isUndefined=function(n){return n===m},g.isWeakMap=function(n){return st(n)&&xn(n)==_t},g.isWeakSet=function(n){return st(n)&&Mt(n)=="[object WeakSet]"},g.join=function(n,e){return n==null?"":bl.call(n,e)},g.kebabCase=Cu,g.last=Kr,g.lastIndexOf=function(n,e,t){var i=n==null?0:n.length;if(!i)return-1;var o=i;return t!==m&&(o=(o=Ne(t))<0?gt(i+o,0):Ot(o,i-1)),e==e?function(u,d,h){for(var _=h+1;_--;)if(u[_]===d)return _;return _}(n,e,o):vs(n,Nu,o,!0)},g.lowerCase=rl,g.lowerFirst=Gl,g.lt=qa,g.lte=Fs,g.max=function(n){return n&&n.length?co(n,yr,Aa):m},g.maxBy=function(n,e){return n&&n.length?co(n,We(e,2),Aa):m},g.mean=function(n){return Xc(n,yr)},g.meanBy=function(n,e){return Xc(n,We(e,2))},g.min=function(n){return n&&n.length?co(n,yr,Os):m},g.minBy=function(n,e){return n&&n.length?co(n,We(e,2),Os):m},g.stubArray=oa,g.stubFalse=Ya,g.stubObject=function(){return{}},g.stubString=function(){return""},g.stubTrue=function(){return!0},g.multiply=a,g.nth=function(n,e){return n&&n.length?pc(n,Ne(e)):m},g.noConflict=function(){return Fe._===this&&(Fe._=_l),this},g.noop=yn,g.now=Lt,g.pad=function(n,e,t){n=pt(n);var i=(e=Ne(e))?ii(n):0;if(!e||i>=e)return n;var o=(e-i)/2;return Ds(Bo(o),t)+n+Ds(xo(o),t)},g.padEnd=function(n,e,t){n=pt(n);var i=(e=Ne(e))?ii(n):0;return e&&i<e?n+Ds(e-i,t):n},g.padStart=function(n,e,t){n=pt(n);var i=(e=Ne(e))?ii(n):0;return e&&i<e?Ds(e-i,t)+n:n},g.parseInt=function(n,e,t){return t||e==null?e=0:e&&(e=+e),Tl(pt(n).replace(ei,""),e||0)},g.random=function(n,e,t){if(t&&typeof t!="boolean"&&Bn(n,e,t)&&(e=t=m),t===m&&(typeof e=="boolean"?(t=e,e=m):typeof n=="boolean"&&(t=n,n=m)),n===m&&e===m?(n=0,e=1):(n=nn(n),e===m?(e=n,n=0):e=nn(e)),n>e){var i=n;n=e,e=i}if(t||n%1||e%1){var o=Ts();return Ot(n+o*(e-n+qc("1e-"+((o+"").length-1))),e)}return Da(n,e)},g.reduce=function(n,e,t){var i=Be(n)?ni:_s,o=arguments.length<3;return i(n,We(e,4),t,o,jn)},g.reduceRight=function(n,e,t){var i=Be(n)?Yc:_s,o=arguments.length<3;return i(n,We(e,4),t,o,uc)},g.repeat=function(n,e,t){return e=(t?Bn(n,e,t):e===m)?1:Ne(e),ht(pt(n),e)},g.replace=function(){var n=arguments,e=pt(n[0]);return n.length<3?e:e.replace(n[1],n[2])},g.result=function(n,e,t){var i=-1,o=(e=li(e,n)).length;for(o||(o=1,n=m);++i<o;){var u=n==null?m:n[di(e[i])];u===m&&(i=o,u=t),n=fi(u)?u.call(n):u}return n},g.round=c,g.runInContext=L,g.sample=function(n){return(Be(n)?or:Na)(n)},g.size=function(n){if(n==null)return 0;if(fr(n))return mo(n)?ii(n):n.length;var e=xn(n);return e==Ee||e==ge?n.size:uo(n).length},g.snakeCase=il,g.some=function(n,e,t){var i=Be(n)?Qc:Pr;return t&&Bn(n,e,t)&&(e=m),i(n,We(e,3))},g.sortedIndex=function(n,e){return Go(n,e)},g.sortedIndexBy=function(n,e,t){return ks(n,e,We(t,2))},g.sortedIndexOf=function(n,e){var t=n==null?0:n.length;if(t){var i=Go(n,e);if(i<t&&Yr(n[i],e))return i}return-1},g.sortedLastIndex=function(n,e){return Go(n,e,!0)},g.sortedLastIndexBy=function(n,e,t){return ks(n,e,We(t,2),!0)},g.sortedLastIndexOf=function(n,e){if(n!=null&&n.length){var t=Go(n,e,!0)-1;if(Yr(n[t],e))return t}return-1},g.startCase=Iu,g.startsWith=function(n,e,t){return n=pt(n),t=t==null?0:_r(Ne(t),0,n.length),e=Dt(e),n.slice(t,t+e.length)==e},g.subtract=l,g.sum=function(n){return n&&n.length?nc(n,yr):0},g.sumBy=function(n,e){return n&&n.length?nc(n,We(e,2)):0},g.template=function(n,e,t){var i=g.templateSettings;t&&Bn(n,e,t)&&(e=m),n=pt(n),e=Gs({},e,i,Ua);var o,u,d=Gs({},e.imports,i.imports,Ua),h=Bt(d),_=qn(d,h),T=0,C=e.interpolate||fe,R="__p += '",w=Es((e.escape||fe).source+"|"+C.source+"|"+(C===To?Js:fe).source+"|"+(e.evaluate||fe).source+"|$","g"),P="//# sourceURL="+(Ve.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++zc+"]")+`
`;n.replace(w,function(B,$,K,Q,oe,ce){return K||(K=Q),R+=n.slice(T,ce).replace(Te,ml),$&&(o=!0,R+=`' +
__e(`+$+`) +
'`),oe&&(u=!0,R+=`';
`+oe+`;
__p += '`),K&&(R+=`' +
((__t = (`+K+`)) == null ? '' : __t) +
'`),T=ce+B.length,B}),R+=`';
`;var U=Ve.call(e,"variable")&&e.variable;if(U){if(zn.test(U))throw new Pe("Invalid `variable` option passed into `_.template`")}else R=`with (obj) {
`+R+`
}
`;R=(u?R.replace(qe,""):R).replace(Zr,"$1").replace(Ks,"$1;"),R="function("+(U||"obj")+`) {
`+(U?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(o?", __e = _.escape":"")+(u?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var j=Ru(function(){return Ze(h,P+"return "+R).apply(m,_)});if(j.source=R,Uc(j))throw j;return j},g.times=function(n,e){if((n=Ne(n))<1||n>M)return[];var t=z,i=Ot(n,z);e=We(e),n-=z;for(var o=Ss(i,e);++t<n;)e(t);return o},g.toFinite=nn,g.toInteger=Ne,g.toLength=rt,g.toLower=function(n){return pt(n).toLowerCase()},g.toNumber=pr,g.toSafeInteger=function(n){return n?_r(Ne(n),-9007199254740991,M):n===0?n:0},g.toString=pt,g.toUpper=function(n){return pt(n).toUpperCase()},g.trim=function(n,e,t){if((n=pt(n))&&(t||e===m))return rc(n);if(!n||!(e=Dt(e)))return n;var i=vn(n),o=vn(e);return zi(i,Ea(i,o),Zc(i,o)+1).join("")},g.trimEnd=function(n,e,t){if((n=pt(n))&&(t||e===m))return n.slice(0,dn(n)+1);if(!n||!(e=Dt(e)))return n;var i=vn(n);return zi(i,0,Zc(i,vn(e))+1).join("")},g.trimStart=function(n,e,t){if((n=pt(n))&&(t||e===m))return n.replace(ei,"");if(!n||!(e=Dt(e)))return n;var i=vn(n);return zi(i,Ea(i,vn(e))).join("")},g.truncate=function(n,e){var t=30,i="...";if(Jt(e)){var o="separator"in e?e.separator:o;t="length"in e?Ne(e.length):t,i="omission"in e?Dt(e.omission):i}var u=(n=pt(n)).length;if(ya(n)){var d=vn(n);u=d.length}if(t>=u)return n;var h=t-ii(i);if(h<1)return i;var _=d?zi(d,0,h).join(""):n.slice(0,h);if(o===m)return _+i;if(d&&(h+=_.length-h),pi(o)){if(n.slice(h).search(o)){var T,C=_;for(o.global||(o=Es(o.source,pt(Si.exec(o))+"g")),o.lastIndex=0;T=o.exec(C);)var R=T.index;_=_.slice(0,R===m?h:R)}}else if(n.indexOf(Dt(o),h)!=h){var w=_.lastIndexOf(o);w>-1&&(_=_.slice(0,w))}return _+i},g.unescape=function(n){return(n=pt(n))&&as.test(n)?n.replace(un,ac):n},g.uniqueId=function(n){var e=++eu;return pt(n)+e},g.upperCase=ol,g.upperFirst=Ka,g.each=Qu,g.eachRight=_u,g.first=gu,wu(g,(r={},wn(g,function(n,e){Ve.call(g.prototype,e)||(r[e]=n)}),r),{chain:!1}),g.VERSION="4.17.21",wr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){g[n].placeholder=g}),wr(["drop","take"],function(n,e){Ae.prototype[n]=function(t){t=t===m?1:gt(Ne(t),0);var i=this.__filtered__&&!e?new Ae(this):this.clone();return i.__filtered__?i.__takeCount__=Ot(t,i.__takeCount__):i.__views__.push({size:Ot(t,z),type:n+(i.__dir__<0?"Right":"")}),i},Ae.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse()}}),wr(["filter","map","takeWhile"],function(n,e){var t=e+1,i=t==1||t==3;Ae.prototype[n]=function(o){var u=this.clone();return u.__iteratees__.push({iteratee:We(o,3),type:t}),u.__filtered__=u.__filtered__||i,u}}),wr(["head","last"],function(n,e){var t="take"+(e?"Right":"");Ae.prototype[n]=function(){return this[t](1).value()[0]}}),wr(["initial","tail"],function(n,e){var t="drop"+(e?"":"Right");Ae.prototype[n]=function(){return this.__filtered__?new Ae(this):this[t](1)}}),Ae.prototype.compact=function(){return this.filter(yr)},Ae.prototype.find=function(n){return this.filter(n).head()},Ae.prototype.findLast=function(n){return this.reverse().find(n)},Ae.prototype.invokeMap=at(function(n,e){return typeof n=="function"?new Ae(this):this.map(function(t){return Gi(t,n,e)})}),Ae.prototype.reject=function(n){return this.filter(ta(We(n)))},Ae.prototype.slice=function(n,e){n=Ne(n);var t=this;return t.__filtered__&&(n>0||e<0)?new Ae(t):(n<0?t=t.takeRight(-n):n&&(t=t.drop(n)),e!==m&&(t=(e=Ne(e))<0?t.dropRight(-e):t.take(e-n)),t)},Ae.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},Ae.prototype.toArray=function(){return this.take(z)},wn(Ae.prototype,function(n,e){var t=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),o=g[i?"take"+(e=="last"?"Right":""):e],u=i||/^find/.test(e);o&&(g.prototype[e]=function(){var d=this.__wrapped__,h=i?[1]:arguments,_=d instanceof Ae,T=h[0],C=_||Be(d),R=function($){var K=o.apply(g,lt([$],h));return i&&w?K[0]:K};C&&t&&typeof T=="function"&&T.length!=1&&(_=C=!1);var w=this.__chain__,P=!!this.__actions__.length,U=u&&!w,j=_&&!P;if(!u&&C){d=j?d:new Ae(this);var B=n.apply(d,h);return B.__actions__.push({func:Bs,args:[R],thisArg:m}),new Xt(B,w)}return U&&j?n.apply(this,h):(B=this.thru(R),U?i?B.value()[0]:B.value():B)})}),wr(["pop","push","shift","sort","splice","unshift"],function(n){var e=Ui[n],t=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",i=/^(?:pop|shift)$/.test(n);g.prototype[n]=function(){var o=arguments;if(i&&!this.__chain__){var u=this.value();return e.apply(Be(u)?u:[],o)}return this[t](function(d){return e.apply(Be(d)?d:[],o)})}}),wn(Ae.prototype,function(n,e){var t=g[e];if(t){var i=t.name+"";Ve.call($r,i)||($r[i]=[]),$r[i].push({name:e,func:t})}}),$r[Er(m,2).name]=[{name:"wrapper",func:m}],Ae.prototype.clone=function(){var n=new Ae(this.__wrapped__);return n.__actions__=fn(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=fn(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=fn(this.__views__),n},Ae.prototype.reverse=function(){if(this.__filtered__){var n=new Ae(this);n.__dir__=-1,n.__filtered__=!0}else(n=this.clone()).__dir__*=-1;return n},Ae.prototype.value=function(){var n=this.__wrapped__.value(),e=this.__dir__,t=Be(n),i=e<0,o=t?n.length:0,u=function(ce,ae,te){for(var pe=-1,be=te.length;++pe<be;){var Ce=te[pe],_e=Ce.size;switch(Ce.type){case"drop":ce+=_e;break;case"dropRight":ae-=_e;break;case"take":ae=Ot(ae,ce+_e);break;case"takeRight":ce=gt(ce,ae-_e)}}return{start:ce,end:ae}}(0,o,this.__views__),d=u.start,h=u.end,_=h-d,T=i?h:d-1,C=this.__iteratees__,R=C.length,w=0,P=Ot(_,this.__takeCount__);if(!t||!i&&o==_&&P==_)return _c(n,this.__actions__);var U=[];e:for(;_--&&w<P;){for(var j=-1,B=n[T+=e];++j<R;){var $=C[j],K=$.iteratee,Q=$.type,oe=K(B);if(Q==2)B=oe;else if(!oe){if(Q==1)continue e;break e}}U[w++]=B}return U},g.prototype.at=Dc,g.prototype.chain=function(){return vu(this)},g.prototype.commit=function(){return new Xt(this.value(),this.__chain__)},g.prototype.next=function(){this.__values__===m&&(this.__values__=Vs(this.value()));var n=this.__index__>=this.__values__.length;return{done:n,value:n?m:this.__values__[this.__index__++]}},g.prototype.plant=function(n){for(var e,t=this;t instanceof si;){var i=go(t);i.__index__=0,i.__values__=m,e?o.__wrapped__=i:e=i;var o=i;t=t.__wrapped__}return o.__wrapped__=n,e},g.prototype.reverse=function(){var n=this.__wrapped__;if(n instanceof Ae){var e=n;return this.__actions__.length&&(e=new Ae(this)),(e=e.reverse()).__actions__.push({func:Bs,args:[Zo],thisArg:m}),new Xt(e,this.__chain__)}return this.thru(Zo)},g.prototype.toJSON=g.prototype.valueOf=g.prototype.value=function(){return _c(this.__wrapped__,this.__actions__)},g.prototype.first=g.prototype.head,ji&&(g.prototype[ji]=function(){return this}),g}();Fe._=No,(v=(function(){return No}).call(k,p,k,O))===m||(O.exports=v)}).call(this)},5364:(O,k,p)=>{var v=p(5250),m=p(999)(function(y,E,I){v(y,E,I)});O.exports=m},9935:O=>{O.exports=function(){return!1}},9884:(O,k,p)=>{var v=p(1791),m=p(7241);O.exports=function(y){return v(y,m(y))}},5602:O=>{var k=O.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(p){return p.encoding?"rtpmap:%d %s/%s/%s":p.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(p){return p.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(p){return p.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(p){return"extmap:%d"+(p.direction?"/%s":"%v")+(p["encrypt-uri"]?" %s":"%v")+" %s"+(p.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(p){return p.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(p){var v="candidate:%s %d %s %d %s %d typ %s";return v+=p.raddr!=null?" raddr %s rport %d":"%v%v",v+=p.tcptype!=null?" tcptype %s":"%v",p.generation!=null&&(v+=" generation %d"),v+=p["network-id"]!=null?" network-id %d":"%v",v+=p["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(p){var v="ssrc:%d";return p.attribute!=null&&(v+=" %s",p.value!=null&&(v+=":%s")),v}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(p){return p.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(p){return p.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(p){return"imageattr:%s %s %s"+(p.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(p){return"simulcast:%s %s"+(p.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(p){return"ts-refclk:%s"+(p.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(p){var v="mediaclk:";return v+=p.id!=null?"id=%s %s":"%v%s",v+=p.mediaClockValue!=null?"=%s":"",v+=p.rateNumerator!=null?" rate=%s":"",v+=p.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(k).forEach(function(p){k[p].forEach(function(v){v.reg||(v.reg=/(.*)/),v.format||(v.format="%s")})})},7363:(O,k,p)=>{var v=p(5020),m=p(3804);k.M9=m,k.qg=v.parse,k.Sl=v.parseParams,v.parseFmtpConfig,v.parsePayloads,v.parseRemoteCandidates,v.parseImageAttributes,v.parseSimulcastStreamList},5020:(O,k,p)=>{var v=function(S){return String(Number(S))===S?Number(S):S},m=function(S,f,b){var x=S.name&&S.names;S.push&&!f[S.push]?f[S.push]=[]:x&&!f[S.name]&&(f[S.name]={});var D=S.push?{}:x?f[S.name]:f;(function(A,M,W,z){if(z&&!W)M[z]=v(A[1]);else for(var q=0;q<W.length;q+=1)A[q+1]!=null&&(M[W[q]]=v(A[q+1]))})(b.match(S.reg),D,S.names,S.name),S.push&&f[S.push].push(D)},y=p(5602),E=RegExp.prototype.test.bind(/^([a-z])=(.*)/);k.parse=function(S){var f={},b=[],x=f;return S.split(/(\r\n|\r|\n)/).filter(E).forEach(function(D){var A=D[0],M=D.slice(2);A==="m"&&(b.push({rtp:[],fmtp:[]}),x=b[b.length-1]);for(var W=0;W<(y[A]||[]).length;W+=1){var z=y[A][W];if(z.reg.test(M))return m(z,x,M)}}),f.media=b,f};var I=function(S,f){var b=f.split(/=(.+)/,2);return b.length===2?S[b[0]]=v(b[1]):b.length===1&&f.length>1&&(S[b[0]]=void 0),S};k.parseParams=function(S){return S.split(/;\s?/).reduce(I,{})},k.parseFmtpConfig=k.parseParams,k.parsePayloads=function(S){return S.toString().split(" ").map(Number)},k.parseRemoteCandidates=function(S){for(var f=[],b=S.split(" ").map(v),x=0;x<b.length;x+=3)f.push({component:b[x],ip:b[x+1],port:b[x+2]});return f},k.parseImageAttributes=function(S){return S.split(" ").map(function(f){return f.substring(1,f.length-1).split(",").reduce(I,{})})},k.parseSimulcastStreamList=function(S){return S.split(";").map(function(f){return f.split(",").map(function(b){var x,D=!1;return b[0]!=="~"?x=v(b):(x=v(b.substring(1,b.length)),D=!0),{scid:x,paused:D}})})}},3804:(O,k,p)=>{var v=p(5602),m=/%[sdv%]/g,y=function(f){var b=1,x=arguments,D=x.length;return f.replace(m,function(A){if(b>=D)return A;var M=x[b];switch(b+=1,A){case"%%":return"%";case"%s":return String(M);case"%d":return Number(M);case"%v":return""}})},E=function(f,b,x){var D=[f+"="+(b.format instanceof Function?b.format(b.push?x:x[b.name]):b.format)];if(b.names)for(var A=0;A<b.names.length;A+=1){var M=b.names[A];b.name?D.push(x[b.name][M]):D.push(x[b.names[A]])}else D.push(x[b.name]);return y.apply(null,D)},I=["v","o","s","i","u","e","p","c","b","t","r","z","a"],S=["i","c","b","a"];O.exports=function(f,b){b=b||{},f.version==null&&(f.version=0),f.name==null&&(f.name=" "),f.media.forEach(function(M){M.payloads==null&&(M.payloads="")});var x=b.outerOrder||I,D=b.innerOrder||S,A=[];return x.forEach(function(M){v[M].forEach(function(W){W.name in f&&f[W.name]!=null?A.push(E(M,W,f)):W.push in f&&f[W.push]!=null&&f[W.push].forEach(function(z){A.push(E(M,W,z))})})}),f.media.forEach(function(M){A.push(E("m",v.m[0],M)),D.forEach(function(W){v[W].forEach(function(z){z.name in M&&M[z.name]!=null?A.push(E(W,z,M)):z.push in M&&M[z.push]!=null&&M[z.push].forEach(function(q){A.push(E(W,z,q))})})})}),A.join(`\r
`)+`\r
`}},7963:O=>{const k={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};k.localCName=k.generateIdentifier(),k.splitLines=function(p){return p.trim().split(`
`).map(v=>v.trim())},k.splitSections=function(p){return p.split(`
m=`).map((v,m)=>(m>0?"m="+v:v).trim()+`\r
`)},k.getDescription=function(p){const v=k.splitSections(p);return v&&v[0]},k.getMediaSections=function(p){const v=k.splitSections(p);return v.shift(),v},k.matchPrefix=function(p,v){return k.splitLines(p).filter(m=>m.indexOf(v)===0)},k.parseCandidate=function(p){let v;v=p.indexOf("a=candidate:")===0?p.substring(12).split(" "):p.substring(10).split(" ");const m={foundation:v[0],component:{1:"rtp",2:"rtcp"}[v[1]]||v[1],protocol:v[2].toLowerCase(),priority:parseInt(v[3],10),ip:v[4],address:v[4],port:parseInt(v[5],10),type:v[7]};for(let y=8;y<v.length;y+=2)switch(v[y]){case"raddr":m.relatedAddress=v[y+1];break;case"rport":m.relatedPort=parseInt(v[y+1],10);break;case"tcptype":m.tcpType=v[y+1];break;case"ufrag":m.ufrag=v[y+1],m.usernameFragment=v[y+1];break;default:m[v[y]]===void 0&&(m[v[y]]=v[y+1])}return m},k.writeCandidate=function(p){const v=[];v.push(p.foundation);const m=p.component;m==="rtp"?v.push(1):m==="rtcp"?v.push(2):v.push(m),v.push(p.protocol.toUpperCase()),v.push(p.priority),v.push(p.address||p.ip),v.push(p.port);const y=p.type;return v.push("typ"),v.push(y),y!=="host"&&p.relatedAddress&&p.relatedPort&&(v.push("raddr"),v.push(p.relatedAddress),v.push("rport"),v.push(p.relatedPort)),p.tcpType&&p.protocol.toLowerCase()==="tcp"&&(v.push("tcptype"),v.push(p.tcpType)),(p.usernameFragment||p.ufrag)&&(v.push("ufrag"),v.push(p.usernameFragment||p.ufrag)),"candidate:"+v.join(" ")},k.parseIceOptions=function(p){return p.substring(14).split(" ")},k.parseRtpMap=function(p){let v=p.substring(9).split(" ");const m={payloadType:parseInt(v.shift(),10)};return v=v[0].split("/"),m.name=v[0],m.clockRate=parseInt(v[1],10),m.channels=v.length===3?parseInt(v[2],10):1,m.numChannels=m.channels,m},k.writeRtpMap=function(p){let v=p.payloadType;p.preferredPayloadType!==void 0&&(v=p.preferredPayloadType);const m=p.channels||p.numChannels||1;return"a=rtpmap:"+v+" "+p.name+"/"+p.clockRate+(m!==1?"/"+m:"")+`\r
`},k.parseExtmap=function(p){const v=p.substring(9).split(" ");return{id:parseInt(v[0],10),direction:v[0].indexOf("/")>0?v[0].split("/")[1]:"sendrecv",uri:v[1],attributes:v.slice(2).join(" ")}},k.writeExtmap=function(p){return"a=extmap:"+(p.id||p.preferredId)+(p.direction&&p.direction!=="sendrecv"?"/"+p.direction:"")+" "+p.uri+(p.attributes?" "+p.attributes:"")+`\r
`},k.parseFmtp=function(p){const v={};let m;const y=p.substring(p.indexOf(" ")+1).split(";");for(let E=0;E<y.length;E++)m=y[E].trim().split("="),v[m[0].trim()]=m[1];return v},k.writeFmtp=function(p){let v="",m=p.payloadType;if(p.preferredPayloadType!==void 0&&(m=p.preferredPayloadType),p.parameters&&Object.keys(p.parameters).length){const y=[];Object.keys(p.parameters).forEach(E=>{p.parameters[E]!==void 0?y.push(E+"="+p.parameters[E]):y.push(E)}),v+="a=fmtp:"+m+" "+y.join(";")+`\r
`}return v},k.parseRtcpFb=function(p){const v=p.substring(p.indexOf(" ")+1).split(" ");return{type:v.shift(),parameter:v.join(" ")}},k.writeRtcpFb=function(p){let v="",m=p.payloadType;return p.preferredPayloadType!==void 0&&(m=p.preferredPayloadType),p.rtcpFeedback&&p.rtcpFeedback.length&&p.rtcpFeedback.forEach(y=>{v+="a=rtcp-fb:"+m+" "+y.type+(y.parameter&&y.parameter.length?" "+y.parameter:"")+`\r
`}),v},k.parseSsrcMedia=function(p){const v=p.indexOf(" "),m={ssrc:parseInt(p.substring(7,v),10)},y=p.indexOf(":",v);return y>-1?(m.attribute=p.substring(v+1,y),m.value=p.substring(y+1)):m.attribute=p.substring(v+1),m},k.parseSsrcGroup=function(p){const v=p.substring(13).split(" ");return{semantics:v.shift(),ssrcs:v.map(m=>parseInt(m,10))}},k.getMid=function(p){const v=k.matchPrefix(p,"a=mid:")[0];if(v)return v.substring(6)},k.parseFingerprint=function(p){const v=p.substring(14).split(" ");return{algorithm:v[0].toLowerCase(),value:v[1].toUpperCase()}},k.getDtlsParameters=function(p,v){return{role:"auto",fingerprints:k.matchPrefix(p+v,"a=fingerprint:").map(k.parseFingerprint)}},k.writeDtlsParameters=function(p,v){let m="a=setup:"+v+`\r
`;return p.fingerprints.forEach(y=>{m+="a=fingerprint:"+y.algorithm+" "+y.value+`\r
`}),m},k.parseCryptoLine=function(p){const v=p.substring(9).split(" ");return{tag:parseInt(v[0],10),cryptoSuite:v[1],keyParams:v[2],sessionParams:v.slice(3)}},k.writeCryptoLine=function(p){return"a=crypto:"+p.tag+" "+p.cryptoSuite+" "+(typeof p.keyParams=="object"?k.writeCryptoKeyParams(p.keyParams):p.keyParams)+(p.sessionParams?" "+p.sessionParams.join(" "):"")+`\r
`},k.parseCryptoKeyParams=function(p){if(p.indexOf("inline:")!==0)return null;const v=p.substring(7).split("|");return{keyMethod:"inline",keySalt:v[0],lifeTime:v[1],mkiValue:v[2]?v[2].split(":")[0]:void 0,mkiLength:v[2]?v[2].split(":")[1]:void 0}},k.writeCryptoKeyParams=function(p){return p.keyMethod+":"+p.keySalt+(p.lifeTime?"|"+p.lifeTime:"")+(p.mkiValue&&p.mkiLength?"|"+p.mkiValue+":"+p.mkiLength:"")},k.getCryptoParameters=function(p,v){return k.matchPrefix(p+v,"a=crypto:").map(k.parseCryptoLine)},k.getIceParameters=function(p,v){const m=k.matchPrefix(p+v,"a=ice-ufrag:")[0],y=k.matchPrefix(p+v,"a=ice-pwd:")[0];return m&&y?{usernameFragment:m.substring(12),password:y.substring(10)}:null},k.writeIceParameters=function(p){let v="a=ice-ufrag:"+p.usernameFragment+`\r
a=ice-pwd:`+p.password+`\r
`;return p.iceLite&&(v+=`a=ice-lite\r
`),v},k.parseRtpParameters=function(p){const v={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},m=k.splitLines(p)[0].split(" ");v.profile=m[2];for(let E=3;E<m.length;E++){const I=m[E],S=k.matchPrefix(p,"a=rtpmap:"+I+" ")[0];if(S){const f=k.parseRtpMap(S),b=k.matchPrefix(p,"a=fmtp:"+I+" ");switch(f.parameters=b.length?k.parseFmtp(b[0]):{},f.rtcpFeedback=k.matchPrefix(p,"a=rtcp-fb:"+I+" ").map(k.parseRtcpFb),v.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":v.fecMechanisms.push(f.name.toUpperCase())}}}k.matchPrefix(p,"a=extmap:").forEach(E=>{v.headerExtensions.push(k.parseExtmap(E))});const y=k.matchPrefix(p,"a=rtcp-fb:* ").map(k.parseRtcpFb);return v.codecs.forEach(E=>{y.forEach(I=>{E.rtcpFeedback.find(S=>S.type===I.type&&S.parameter===I.parameter)||E.rtcpFeedback.push(I)})}),v},k.writeRtpDescription=function(p,v){let m="";m+="m="+p+" ",m+=v.codecs.length>0?"9":"0",m+=" "+(v.profile||"UDP/TLS/RTP/SAVPF")+" ",m+=v.codecs.map(E=>E.preferredPayloadType!==void 0?E.preferredPayloadType:E.payloadType).join(" ")+`\r
`,m+=`c=IN IP4 0.0.0.0\r
`,m+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,v.codecs.forEach(E=>{m+=k.writeRtpMap(E),m+=k.writeFmtp(E),m+=k.writeRtcpFb(E)});let y=0;return v.codecs.forEach(E=>{E.maxptime>y&&(y=E.maxptime)}),y>0&&(m+="a=maxptime:"+y+`\r
`),v.headerExtensions&&v.headerExtensions.forEach(E=>{m+=k.writeExtmap(E)}),m},k.parseRtpEncodingParameters=function(p){const v=[],m=k.parseRtpParameters(p),y=m.fecMechanisms.indexOf("RED")!==-1,E=m.fecMechanisms.indexOf("ULPFEC")!==-1,I=k.matchPrefix(p,"a=ssrc:").map(D=>k.parseSsrcMedia(D)).filter(D=>D.attribute==="cname"),S=I.length>0&&I[0].ssrc;let f;const b=k.matchPrefix(p,"a=ssrc-group:FID").map(D=>D.substring(17).split(" ").map(A=>parseInt(A,10)));b.length>0&&b[0].length>1&&b[0][0]===S&&(f=b[0][1]),m.codecs.forEach(D=>{if(D.name.toUpperCase()==="RTX"&&D.parameters.apt){let A={ssrc:S,codecPayloadType:parseInt(D.parameters.apt,10)};S&&f&&(A.rtx={ssrc:f}),v.push(A),y&&(A=JSON.parse(JSON.stringify(A)),A.fec={ssrc:S,mechanism:E?"red+ulpfec":"red"},v.push(A))}}),v.length===0&&S&&v.push({ssrc:S});let x=k.matchPrefix(p,"b=");return x.length&&(x=x[0].indexOf("b=TIAS:")===0?parseInt(x[0].substring(7),10):x[0].indexOf("b=AS:")===0?1e3*parseInt(x[0].substring(5),10)*.95-16e3:void 0,v.forEach(D=>{D.maxBitrate=x})),v},k.parseRtcpParameters=function(p){const v={},m=k.matchPrefix(p,"a=ssrc:").map(I=>k.parseSsrcMedia(I)).filter(I=>I.attribute==="cname")[0];m&&(v.cname=m.value,v.ssrc=m.ssrc);const y=k.matchPrefix(p,"a=rtcp-rsize");v.reducedSize=y.length>0,v.compound=y.length===0;const E=k.matchPrefix(p,"a=rtcp-mux");return v.mux=E.length>0,v},k.writeRtcpParameters=function(p){let v="";return p.reducedSize&&(v+=`a=rtcp-rsize\r
`),p.mux&&(v+=`a=rtcp-mux\r
`),p.ssrc!==void 0&&p.cname&&(v+="a=ssrc:"+p.ssrc+" cname:"+p.cname+`\r
`),v},k.parseMsid=function(p){let v;const m=k.matchPrefix(p,"a=msid:");if(m.length===1)return v=m[0].substring(7).split(" "),{stream:v[0],track:v[1]};const y=k.matchPrefix(p,"a=ssrc:").map(E=>k.parseSsrcMedia(E)).filter(E=>E.attribute==="msid");return y.length>0?(v=y[0].value.split(" "),{stream:v[0],track:v[1]}):void 0},k.parseSctpDescription=function(p){const v=k.parseMLine(p),m=k.matchPrefix(p,"a=max-message-size:");let y;m.length>0&&(y=parseInt(m[0].substring(19),10)),isNaN(y)&&(y=65536);const E=k.matchPrefix(p,"a=sctp-port:");if(E.length>0)return{port:parseInt(E[0].substring(12),10),protocol:v.fmt,maxMessageSize:y};const I=k.matchPrefix(p,"a=sctpmap:");if(I.length>0){const S=I[0].substring(10).split(" ");return{port:parseInt(S[0],10),protocol:S[1],maxMessageSize:y}}},k.writeSctpDescription=function(p,v){let m=[];return m=p.protocol!=="DTLS/SCTP"?["m="+p.kind+" 9 "+p.protocol+" "+v.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+v.port+`\r
`]:["m="+p.kind+" 9 "+p.protocol+" "+v.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+v.port+" "+v.protocol+` 65535\r
`],v.maxMessageSize!==void 0&&m.push("a=max-message-size:"+v.maxMessageSize+`\r
`),m.join("")},k.generateSessionId=function(){return Math.random().toString().substr(2,22)},k.writeSessionBoilerplate=function(p,v,m){let y;const E=v!==void 0?v:2;return y=p||k.generateSessionId(),`v=0\r
o=`+(m||"thisisadapterortc")+" "+y+" "+E+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},k.getDirection=function(p,v){const m=k.splitLines(p);for(let y=0;y<m.length;y++)switch(m[y]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return m[y].substring(2)}return v?k.getDirection(v):"sendrecv"},k.getKind=function(p){return k.splitLines(p)[0].split(" ")[0].substring(2)},k.isRejected=function(p){return p.split(" ",2)[1]==="0"},k.parseMLine=function(p){const v=k.splitLines(p)[0].substring(2).split(" ");return{kind:v[0],port:parseInt(v[1],10),protocol:v[2],fmt:v.slice(3).join(" ")}},k.parseOLine=function(p){const v=k.matchPrefix(p,"o=")[0].substring(2).split(" ");return{username:v[0],sessionId:v[1],sessionVersion:parseInt(v[2],10),netType:v[3],addressType:v[4],address:v[5]}},k.isValidSDP=function(p){if(typeof p!="string"||p.length===0)return!1;const v=k.splitLines(p);for(let m=0;m<v.length;m++)if(v[m].length<2||v[m].charAt(1)!=="=")return!1;return!0},O.exports=k},5512:O=>{O.exports=function(k,p,v,m){var y=self||window;try{try{var E;try{E=new y.Blob([k])}catch{(E=new(y.BlobBuilder||y.WebKitBlobBuilder||y.MozBlobBuilder||y.MSBlobBuilder)).append(k),E=E.getBlob()}var I=y.URL||y.webkitURL,S=I.createObjectURL(E),f=new y[p](S,v);return I.revokeObjectURL(S),f}catch{return new y[p]("data:application/javascript,".concat(encodeURIComponent(k)),v)}}catch{if(!m)throw Error("Inline worker is not supported");return new y[p](m,v)}}},8630:(O,k,p)=>{var v;(function(m){(function(){var y=typeof globalThis=="object"?globalThis:typeof p.g=="object"?p.g:typeof self=="object"?self:typeof this=="object"?this:function(){try{return Function("return this;")()}catch{}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch{}}(),E=I(m);function I(S,f){return function(b,x){Object.defineProperty(S,b,{configurable:!0,writable:!0,value:x}),f&&f(b,x)}}y.Reflect!==void 0&&(E=I(y.Reflect,E)),function(S,f){var b=Object.prototype.hasOwnProperty,x=typeof Symbol=="function",D=x&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",A=x&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",M=typeof Object.create=="function",W={__proto__:[]}instanceof Array,z=!M&&!W,q={create:M?function(){return Ro(Object.create(null))}:W?function(){return Ro({__proto__:null})}:function(){return Ro({})},has:z?function(Y,ie){return b.call(Y,ie)}:function(Y,ie){return ie in Y},get:z?function(Y,ie){return b.call(Y,ie)?Y[ie]:void 0}:function(Y,ie){return Y[ie]}},ne=Object.getPrototypeOf(Function),se=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ys(),he=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Io(),Oe=typeof WeakMap=="function"?WeakMap:ca(),H=x?Symbol.for("@reflect-metadata:registry"):void 0,me=zn(),ke=Ke(me);function Ee(Y,ie,fe,Te){if(qe(fe)){if(!To(Y))throw new TypeError;if(!eo(ie))throw new TypeError;return Yt(Y,ie)}if(!To(Y))throw new TypeError;if(!un(ie))throw new TypeError;if(!un(Te)&&!qe(Te)&&!Zr(Te))throw new TypeError;return Zr(Te)&&(Te=void 0),Nn(Y,ie,fe=er(fe),Te)}function ee(Y,ie){function fe(Te,Xe){if(!un(Te))throw new TypeError;if(!qe(Xe)&&!ss(Xe))throw new TypeError;$n(Y,ie,Te,Xe)}return fe}function J(Y,ie,fe,Te){if(!un(fe))throw new TypeError;return qe(Te)||(Te=er(Te)),$n(Y,ie,fe,Te)}function X(Y,ie,fe){if(!un(ie))throw new TypeError;return qe(fe)||(fe=er(fe)),kn(Y,ie,fe)}function le(Y,ie,fe){if(!un(ie))throw new TypeError;return qe(fe)||(fe=er(fe)),Ur(Y,ie,fe)}function ge(Y,ie,fe){if(!un(ie))throw new TypeError;return qe(fe)||(fe=er(fe)),Tr(Y,ie,fe)}function De(Y,ie,fe){if(!un(ie))throw new TypeError;return qe(fe)||(fe=er(fe)),gr(Y,ie,fe)}function Ie(Y,ie){if(!un(Y))throw new TypeError;return qe(ie)||(ie=er(ie)),jr(Y,ie)}function _t(Y,ie){if(!un(Y))throw new TypeError;return qe(ie)||(ie=er(ie)),Cr(Y,ie)}function bn(Y,ie,fe){if(!un(ie))throw new TypeError;if(qe(fe)||(fe=er(fe)),!un(ie))throw new TypeError;qe(fe)||(fe=er(fe));var Te=Si(ie,fe,!1);return!qe(Te)&&Te.OrdinaryDeleteMetadata(Y,ie,fe)}function Yt(Y,ie){for(var fe=Y.length-1;fe>=0;--fe){var Te=(0,Y[fe])(ie);if(!qe(Te)&&!Zr(Te)){if(!eo(Te))throw new TypeError;ie=Te}}return ie}function Nn(Y,ie,fe,Te){for(var Xe=Y.length-1;Xe>=0;--Xe){var tn=(0,Y[Xe])(ie,fe,Te);if(!qe(tn)&&!Zr(tn)){if(!un(tn))throw new TypeError;Te=tn}}return Te}function kn(Y,ie,fe){if(Ur(Y,ie,fe))return!0;var Te=us(ie);return!Zr(Te)&&kn(Y,Te,fe)}function Ur(Y,ie,fe){var Te=Si(ie,fe,!1);return!qe(Te)&&sa(Te.OrdinaryHasOwnMetadata(Y,ie,fe))}function Tr(Y,ie,fe){if(Ur(Y,ie,fe))return gr(Y,ie,fe);var Te=us(ie);return Zr(Te)?void 0:Tr(Y,Te,fe)}function gr(Y,ie,fe){var Te=Si(ie,fe,!1);if(!qe(Te))return Te.OrdinaryGetOwnMetadata(Y,ie,fe)}function $n(Y,ie,fe,Te){Si(fe,Te,!0).OrdinaryDefineOwnMetadata(Y,ie,fe,Te)}function jr(Y,ie){var fe=Cr(Y,ie),Te=us(Y);if(Te===null)return fe;var Xe=jr(Te,ie);if(Xe.length<=0)return fe;if(fe.length<=0)return Xe;for(var tn=new he,it=[],nt=0,Ue=fe;nt<Ue.length;nt++){var we=Ue[nt];tn.has(we)||(tn.add(we),it.push(we))}for(var Ge=0,He=Xe;Ge<He.length;Ge++)we=He[Ge],tn.has(we)||(tn.add(we),it.push(we));return it}function Cr(Y,ie){var fe=Si(Y,ie,!1);return fe?fe.OrdinaryOwnMetadataKeys(Y,ie):[]}function Ir(Y){if(Y===null)return 1;switch(typeof Y){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Y===null?1:6;default:return 6}}function qe(Y){return Y===void 0}function Zr(Y){return Y===null}function Ks(Y){return typeof Y=="symbol"}function un(Y){return typeof Y=="object"?Y!==null:typeof Y=="function"}function os(Y,ie){switch(Ir(Y)){case 0:case 1:case 2:case 3:case 4:case 5:return Y}var fe="string",Te=Co(Y,D);if(Te!==void 0){var Xe=Te.call(Y,fe);if(un(Xe))throw new TypeError;return Xe}return as(Y)}function as(Y,ie){var fe,Te;{var Xe=Y.toString;if(Mi(Xe)&&!un(Te=Xe.call(Y))||Mi(fe=Y.valueOf)&&!un(Te=fe.call(Y)))return Te}throw new TypeError}function sa(Y){return!!Y}function bo(Y){return""+Y}function er(Y){var ie=os(Y);return Ks(ie)?ie:bo(ie)}function To(Y){return Array.isArray?Array.isArray(Y):Y instanceof Object?Y instanceof Array:Object.prototype.toString.call(Y)==="[object Array]"}function Mi(Y){return typeof Y=="function"}function eo(Y){return typeof Y=="function"}function ss(Y){switch(Ir(Y)){case 3:case 4:return!0;default:return!1}}function Li(Y,ie){return Y===ie||Y!=Y&&ie!=ie}function Co(Y,ie){var fe=Y[ie];if(fe!=null){if(!Mi(fe))throw new TypeError;return fe}}function ei(Y){var ie=Co(Y,A);if(!Mi(ie))throw new TypeError;var fe=ie.call(Y);if(!un(fe))throw new TypeError;return fe}function cs(Y){return Y.value}function Rt(Y){var ie=Y.next();return!ie.done&&ie}function Ft(Y){var ie=Y.return;ie&&ie.call(Y)}function us(Y){var ie=Object.getPrototypeOf(Y);if(typeof Y!="function"||Y===ne||ie!==ne)return ie;var fe=Y.prototype,Te=fe&&Object.getPrototypeOf(fe);if(Te==null||Te===Object.prototype)return ie;var Xe=Te.constructor;return typeof Xe!="function"||Xe===Y?ie:Xe}function Wc(){var Y,ie,fe,Te;qe(H)||f.Reflect===void 0||H in f.Reflect||typeof f.Reflect.defineMetadata!="function"||(Y=Js(f.Reflect));var Xe=new Oe,tn={registerProvider:it,getProvider:Ue,setProvider:Ge};return tn;function it(He){if(!Object.isExtensible(tn))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case Y===He:break;case qe(ie):ie=He;break;case ie===He:break;case qe(fe):fe=He;break;case fe===He:break;default:Te===void 0&&(Te=new he),Te.add(He)}}function nt(He,St){if(!qe(ie)){if(ie.isProviderFor(He,St))return ie;if(!qe(fe)){if(fe.isProviderFor(He,St))return ie;if(!qe(Te))for(var Vt=ei(Te);;){var $t=Rt(Vt);if(!$t)return;var Tn=cs($t);if(Tn.isProviderFor(He,St))return Ft(Vt),Tn}}}if(!qe(Y)&&Y.isProviderFor(He,St))return Y}function Ue(He,St){var Vt,$t=Xe.get(He);return qe($t)||(Vt=$t.get(St)),qe(Vt)&&(qe(Vt=nt(He,St))||(qe($t)&&($t=new se,Xe.set(He,$t)),$t.set(St,Vt))),Vt}function we(He){if(qe(He))throw new TypeError;return ie===He||fe===He||!qe(Te)&&Te.has(He)}function Ge(He,St,Vt){if(!we(Vt))throw new Error("Metadata provider not registered.");var $t=Ue(He,St);if($t!==Vt){if(!qe($t))return!1;var Tn=Xe.get(He);qe(Tn)&&(Tn=new se,Xe.set(He,Tn)),Tn.set(St,Vt)}return!0}}function zn(){var Y;return!qe(H)&&un(f.Reflect)&&Object.isExtensible(f.Reflect)&&(Y=f.Reflect[H]),qe(Y)&&(Y=Wc()),!qe(H)&&un(f.Reflect)&&Object.isExtensible(f.Reflect)&&Object.defineProperty(f.Reflect,H,{enumerable:!1,configurable:!1,writable:!1,value:Y}),Y}function Ke(Y){var ie=new Oe,fe={isProviderFor:function(we,Ge){var He=ie.get(we);return!qe(He)&&He.has(Ge)},OrdinaryDefineOwnMetadata:it,OrdinaryHasOwnMetadata:Xe,OrdinaryGetOwnMetadata:tn,OrdinaryOwnMetadataKeys:nt,OrdinaryDeleteMetadata:Ue};return me.registerProvider(fe),fe;function Te(we,Ge,He){var St=ie.get(we),Vt=!1;if(qe(St)){if(!He)return;St=new se,ie.set(we,St),Vt=!0}var $t=St.get(Ge);if(qe($t)){if(!He)return;if($t=new se,St.set(Ge,$t),!Y.setProvider(we,Ge,fe))throw St.delete(Ge),Vt&&ie.delete(we),new Error("Wrong provider for target.")}return $t}function Xe(we,Ge,He){var St=Te(Ge,He,!1);return!qe(St)&&sa(St.has(we))}function tn(we,Ge,He){var St=Te(Ge,He,!1);if(!qe(St))return St.get(we)}function it(we,Ge,He,St){Te(He,St,!0).set(we,Ge)}function nt(we,Ge){var He=[],St=Te(we,Ge,!1);if(qe(St))return He;for(var Vt=ei(St.keys()),$t=0;;){var Tn=Rt(Vt);if(!Tn)return He.length=$t,He;var ua=cs(Tn);try{He[$t]=ua}catch(la){try{Ft(Vt)}finally{throw la}}$t++}}function Ue(we,Ge,He){var St=Te(Ge,He,!1);if(qe(St)||!St.delete(we))return!1;if(St.size===0){var Vt=ie.get(Ge);qe(Vt)||(Vt.delete(He),Vt.size===0&&ie.delete(Vt))}return!0}}function Js(Y){var ie=Y.defineMetadata,fe=Y.hasOwnMetadata,Te=Y.getOwnMetadata,Xe=Y.getOwnMetadataKeys,tn=Y.deleteMetadata,it=new Oe;return{isProviderFor:function(nt,Ue){var we=it.get(nt);return!(qe(we)||!we.has(Ue))||!!Xe(nt,Ue).length&&(qe(we)&&(we=new he,it.set(nt,we)),we.add(Ue),!0)},OrdinaryDefineOwnMetadata:ie,OrdinaryHasOwnMetadata:fe,OrdinaryGetOwnMetadata:Te,OrdinaryOwnMetadataKeys:Xe,OrdinaryDeleteMetadata:tn}}function Si(Y,ie,fe){var Te=me.getProvider(Y,ie);if(!qe(Te))return Te;if(fe){if(me.setProvider(Y,ie,ke))return ke;throw new Error("Illegal state.")}}function Ys(){var Y={},ie=[],fe=function(){function it(nt,Ue,we){this._index=0,this._keys=nt,this._values=Ue,this._selector=we}return it.prototype["@@iterator"]=function(){return this},it.prototype[A]=function(){return this},it.prototype.next=function(){var nt=this._index;if(nt>=0&&nt<this._keys.length){var Ue=this._selector(this._keys[nt],this._values[nt]);return nt+1>=this._keys.length?(this._index=-1,this._keys=ie,this._values=ie):this._index++,{value:Ue,done:!1}}return{value:void 0,done:!0}},it.prototype.throw=function(nt){throw this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),nt},it.prototype.return=function(nt){return this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),{value:nt,done:!0}},it}();return function(){function it(){this._keys=[],this._values=[],this._cacheKey=Y,this._cacheIndex=-2}return Object.defineProperty(it.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),it.prototype.has=function(nt){return this._find(nt,!1)>=0},it.prototype.get=function(nt){var Ue=this._find(nt,!1);return Ue>=0?this._values[Ue]:void 0},it.prototype.set=function(nt,Ue){var we=this._find(nt,!0);return this._values[we]=Ue,this},it.prototype.delete=function(nt){var Ue=this._find(nt,!1);if(Ue>=0){for(var we=this._keys.length,Ge=Ue+1;Ge<we;Ge++)this._keys[Ge-1]=this._keys[Ge],this._values[Ge-1]=this._values[Ge];return this._keys.length--,this._values.length--,Li(nt,this._cacheKey)&&(this._cacheKey=Y,this._cacheIndex=-2),!0}return!1},it.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Y,this._cacheIndex=-2},it.prototype.keys=function(){return new fe(this._keys,this._values,Te)},it.prototype.values=function(){return new fe(this._keys,this._values,Xe)},it.prototype.entries=function(){return new fe(this._keys,this._values,tn)},it.prototype["@@iterator"]=function(){return this.entries()},it.prototype[A]=function(){return this.entries()},it.prototype._find=function(nt,Ue){if(!Li(this._cacheKey,nt)){this._cacheIndex=-1;for(var we=0;we<this._keys.length;we++)if(Li(this._keys[we],nt)){this._cacheIndex=we;break}}return this._cacheIndex<0&&Ue&&(this._cacheIndex=this._keys.length,this._keys.push(nt),this._values.push(void 0)),this._cacheIndex},it}();function Te(it,nt){return it}function Xe(it,nt){return nt}function tn(it,nt){return[it,nt]}}function Io(){return function(){function Y(){this._map=new se}return Object.defineProperty(Y.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Y.prototype.has=function(ie){return this._map.has(ie)},Y.prototype.add=function(ie){return this._map.set(ie,ie),this},Y.prototype.delete=function(ie){return this._map.delete(ie)},Y.prototype.clear=function(){this._map.clear()},Y.prototype.keys=function(){return this._map.keys()},Y.prototype.values=function(){return this._map.keys()},Y.prototype.entries=function(){return this._map.entries()},Y.prototype["@@iterator"]=function(){return this.keys()},Y.prototype[A]=function(){return this.keys()},Y}()}function ca(){var Y=16,ie=q.create(),fe=Te();return function(){function Ue(){this._key=Te()}return Ue.prototype.has=function(we){var Ge=Xe(we,!1);return Ge!==void 0&&q.has(Ge,this._key)},Ue.prototype.get=function(we){var Ge=Xe(we,!1);return Ge!==void 0?q.get(Ge,this._key):void 0},Ue.prototype.set=function(we,Ge){return Xe(we,!0)[this._key]=Ge,this},Ue.prototype.delete=function(we){var Ge=Xe(we,!1);return Ge!==void 0&&delete Ge[this._key]},Ue.prototype.clear=function(){this._key=Te()},Ue}();function Te(){var Ue;do Ue="@@WeakMap@@"+nt();while(q.has(ie,Ue));return ie[Ue]=!0,Ue}function Xe(Ue,we){if(!b.call(Ue,fe)){if(!we)return;Object.defineProperty(Ue,fe,{value:q.create()})}return Ue[fe]}function tn(Ue,we){for(var Ge=0;Ge<we;++Ge)Ue[Ge]=255*Math.random()|0;return Ue}function it(Ue){if(typeof Uint8Array=="function"){var we=new Uint8Array(Ue);return typeof crypto<"u"?crypto.getRandomValues(we):typeof msCrypto<"u"?msCrypto.getRandomValues(we):tn(we,Ue),we}return tn(new Array(Ue),Ue)}function nt(){var Ue=it(Y);Ue[6]=79&Ue[6]|64,Ue[8]=191&Ue[8]|128;for(var we="",Ge=0;Ge<Y;++Ge){var He=Ue[Ge];Ge!==4&&Ge!==6&&Ge!==8||(we+="-"),He<16&&(we+="0"),we+=He.toString(16).toLowerCase()}return we}}function Ro(Y){return Y.__=void 0,delete Y.__,Y}S("decorate",Ee),S("metadata",ee),S("defineMetadata",J),S("hasMetadata",X),S("hasOwnMetadata",le),S("getMetadata",ge),S("getOwnMetadata",De),S("getMetadataKeys",Ie),S("getOwnMetadataKeys",_t),S("deleteMetadata",bn)}(E,y),y.Reflect===void 0&&(y.Reflect=m)})()})(v||(v={}))}},Z={};function ue(O){var k=Z[O];if(k!==void 0)return k.exports;var p=Z[O]={id:O,loaded:!1,exports:{}};return F[O].call(p.exports,p,p.exports,ue),p.loaded=!0,p.exports}ue.n=O=>{var k=O&&O.__esModule?()=>O.default:()=>O;return ue.d(k,{a:k}),k},ue.d=(O,k)=>{for(var p in k)ue.o(k,p)&&!ue.o(O,p)&&Object.defineProperty(O,p,{enumerable:!0,get:k[p]})},ue.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),ue.o=(O,k)=>Object.prototype.hasOwnProperty.call(O,k),ue.r=O=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})},ue.nmd=O=>(O.paths=[],O.children||(O.children=[]),O);var je={};return(()=>{ue.r(je),ue.d(je,{BASIC_FULL_HD_LANDSCAPE:()=>zt,BASIC_FULL_HD_PORTRAIT:()=>Ye,BASIC_LANDSCAPE:()=>ps,BASIC_PORTRAIT:()=>zc,BroadcastClientError:()=>Ke,BroadcastClientEvents:()=>mr,ConnectionState:()=>xe,Errors:()=>m,InitialLayerPreference:()=>Na,JitterBufferMinDelay:()=>Fn,LOG_LEVEL:()=>Rt,LocalStageStream:()=>bu,LocalStageStreamEvents:()=>gi,LogLevels:()=>Rt,RemoteStageStream:()=>ol,RemoteStageStreamEvents:()=>mn,SIMULCAST_DUPLICATE_LAYERS_CONFIGURED:()=>bc,SIMULCAST_LAYER_CONFIGURATION_CONFLICT:()=>Yo,SIMULCAST_LAYER_INPUT_FRAMERATE_INSUFFICIENT:()=>Ic,SIMULCAST_LAYER_INPUT_RESOLUTION_INSUFFICIENT:()=>Cc,SIMULCAST_LAYER_INVALID_TYPE:()=>gn,SIMULCAST_LAYER_ORIENTATION_MISMATCH:()=>Qo,SIMULCAST_MAX_LAYERS_EXCEEDED:()=>xn,SIMULCAST_MAX_LAYER_BITRATE_EXCEEDED:()=>fu,SIMULCAST_MAX_LAYER_DIMENSIONS_EXCEEDED:()=>Jo,SIMULCAST_MAX_LAYER_FRAMERATE_EXCEEDED:()=>sn,SIMULCAST_MIN_LAYER_BITRATE_EXCEEDED:()=>ki,SIMULCAST_MIN_LAYER_DIMENSIONS_EXCEEDED:()=>Tc,SIMULCAST_MIN_LAYER_FRAMERATE_EXCEEDED:()=>Bn,SIMULCAST_UNSUPPORTED:()=>Ls,STAGE_MAX_AUDIO_BITRATE_KBPS:()=>fo,STAGE_MAX_AUDIO_BITRATE_KBPS_DEFAULT:()=>Sc,STAGE_MAX_BITRATE:()=>zr,STAGE_MAX_FRAMERATE:()=>Ln,STAGE_MAX_RESOLUTION:()=>Nr,STAGE_MIN_AUDIO_BITRATE_KBPS:()=>$o,STAGE_MIN_BITRATE:()=>Ti,STAGE_MIN_FRAMERATE:()=>$i,STAGE_MIN_RESOLUTION:()=>li,STANDARD_LANDSCAPE:()=>Gt,STANDARD_PORTRAIT:()=>qc,SimulcastLayerPresets:()=>Wo,Stage:()=>Au,StageConnectionState:()=>Lt,StageErrorCategory:()=>pt,StageErrorCode:()=>Me,StageEvents:()=>Wt,StageLeftReason:()=>Eo,StageParticipantPublishState:()=>cn,StageParticipantSubscribeState:()=>En,StageStream:()=>Vc,StageStreamLayerSelectedReason:()=>ra,StreamType:()=>Je,SubscribeType:()=>Ne,__version:()=>Ca,create:()=>Bu,default:()=>$l,isSupported:()=>cs});var O={};ue.r(O),ue.d(O,{fixNegotiationNeeded:()=>le,shimAddTrackRemoveTrack:()=>J,shimAddTrackRemoveTrackWithNative:()=>ee,shimGetDisplayMedia:()=>he,shimGetSendersWithDtmf:()=>me,shimGetStats:()=>ke,shimGetUserMedia:()=>se,shimMediaStream:()=>Oe,shimOnTrack:()=>H,shimPeerConnection:()=>X,shimSenderReceiverGetStats:()=>Ee});var k={};ue.r(k),ue.d(k,{shimAddTransceiver:()=>Ur,shimCreateAnswer:()=>$n,shimCreateOffer:()=>gr,shimGetDisplayMedia:()=>De,shimGetParameters:()=>Tr,shimGetUserMedia:()=>ge,shimOnTrack:()=>Ie,shimPeerConnection:()=>_t,shimRTCDataChannel:()=>kn,shimReceiverGetStats:()=>Yt,shimRemoveStream:()=>Nn,shimSenderGetStats:()=>bn});var p={};ue.r(p),ue.d(p,{shimAudioContext:()=>as,shimCallbacksAPI:()=>Ir,shimConstraints:()=>Zr,shimCreateOfferLegacy:()=>os,shimGetUserMedia:()=>qe,shimLocalStreamsAPI:()=>jr,shimRTCIceServerUrls:()=>Ks,shimRemoteStreamsAPI:()=>Cr,shimTrackEventTransceiver:()=>un});var v={};ue.r(v),ue.d(v,{removeExtmapAllowMixed:()=>Li,shimAddIceCandidateNullOrEmpty:()=>Co,shimConnectionState:()=>ss,shimMaxMessageSize:()=>Mi,shimParameterlessSetLocalDescription:()=>ei,shimRTCIceCandidate:()=>er,shimRTCIceCandidateRelayProtocol:()=>To,shimSendThrowTypeError:()=>eo});var m={};ue.r(m),ue.d(m,{ADD_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Y,ADD_DEVICE_COMPOSITION_MISSING_ERROR:()=>Ro,ADD_DEVICE_CONSTRAINTS_ERROR:()=>Te,ADD_DEVICE_DEVICE_ERROR:()=>Io,ADD_DEVICE_NAME_EXISTS_ERROR:()=>ca,ADD_DEVICE_NAME_MISSING_ERROR:()=>ie,ADD_DEVICE_UNSUPPORTED:()=>fe,BROADCAST_CONFIGURATION_ERROR:()=>$t,BROADCAST_ERROR:()=>Js,CAMERA_ERROR:()=>Si,CLIENT_INVALID_ERROR:()=>ds,EXCHANGE_POSITION_DEVICE_NOT_FOUND_ERROR:()=>we,FAILED_TO_ADD_IMAGE_ERROR:()=>Ge,INGEST_ENDPOINT_TYPE_ERROR:()=>ua,INGEST_ENDPOINT_URL_ERROR:()=>la,INPUT_ERROR:()=>Ys,INVALID_STREAM_KEY:()=>Vt,LOGGER_TYPE_ERROR:()=>ls,LOG_LEVEL_TYPE_ERROR:()=>Qs,NETWORK_RECONNECT_CONFIGURATION_ERROR:()=>hs,NETWORK_RECONNECT_CONFIGURATION_INVALID_TIMEOUT_ERROR:()=>da,PEER_CONNECTION_ERROR:()=>St,PEER_SETUP_ERROR:()=>He,REMOVE_DEVICE_NOT_FOUND_ERROR:()=>Xe,REMOVE_IMAGE_NOT_FOUND_ERROR:()=>tn,STAGE_TOKEN_TYPE_ERROR:()=>wo,STAGE_WHIP_OVERRIDE_ERROR:()=>Hc,STREAM_CONFIGURATION_ERROR:()=>Tn,STREAM_KEY_INVALID_CHAR_ERROR:()=>xi,UPDATE_VIDEO_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>nt,UPDATE_VIDEO_DEVICE_COMPOSITION_MISSING_ERROR:()=>it,UPDATE_VIDEO_DEVICE_COMPOSITION_NAME_NOT_FOUND_ERROR:()=>Ue});var y={};ue.r(y),ue.d(y,{BASIC_FULL_HD_LANDSCAPE:()=>zt,BASIC_FULL_HD_PORTRAIT:()=>Ye,BASIC_LANDSCAPE:()=>ps,BASIC_PORTRAIT:()=>zc,BroadcastClientError:()=>Ke,BroadcastClientEvents:()=>mr,ConnectionState:()=>xe,Errors:()=>m,LOG_LEVEL:()=>Rt,LogLevels:()=>Rt,STANDARD_LANDSCAPE:()=>Gt,STANDARD_PORTRAIT:()=>qc,__version:()=>Ca,create:()=>Bu,isSupported:()=>cs});let E=!0,I=!0;function S(s,r,a){const c=s.match(r);return c&&c.length>=a&&parseInt(c[a],10)}function f(s,r,a){if(!s.RTCPeerConnection)return;const c=s.RTCPeerConnection.prototype,l=c.addEventListener;c.addEventListener=function(e,t){if(e!==r)return l.apply(this,arguments);const i=o=>{const u=a(o);u&&(t.handleEvent?t.handleEvent(u):t(u))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(t,i),l.apply(this,[e,i])};const n=c.removeEventListener;c.removeEventListener=function(e,t){if(e!==r||!this._eventMap||!this._eventMap[r])return n.apply(this,arguments);if(!this._eventMap[r].has(t))return n.apply(this,arguments);const i=this._eventMap[r].get(t);return this._eventMap[r].delete(t),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,n.apply(this,[e,i])},Object.defineProperty(c,"on"+r,{get(){return this["_on"+r]},set(e){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),e&&this.addEventListener(r,this["_on"+r]=e)},enumerable:!0,configurable:!0})}function b(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(E=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function x(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(I=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function D(){if(typeof window=="object"){if(E)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function A(s,r){I&&console.warn(s+" is deprecated, please use "+r+" instead.")}function M(s){return Object.prototype.toString.call(s)==="[object Object]"}function W(s){return M(s)?Object.keys(s).reduce(function(r,a){const c=M(s[a]),l=c?W(s[a]):s[a],n=c&&!Object.keys(l).length;return l===void 0||n?r:Object.assign(r,{[a]:l})},{}):s}function z(s,r,a){r&&!a.has(r.id)&&(a.set(r.id,r),Object.keys(r).forEach(c=>{c.endsWith("Id")?z(s,s.get(r[c]),a):c.endsWith("Ids")&&r[c].forEach(l=>{z(s,s.get(l),a)})}))}function q(s,r,a){const c=a?"outbound-rtp":"inbound-rtp",l=new Map;if(r===null)return l;const n=[];return s.forEach(e=>{e.type==="track"&&e.trackIdentifier===r.id&&n.push(e)}),n.forEach(e=>{s.forEach(t=>{t.type===c&&t.trackId===e.id&&z(s,t,l)})}),l}const ne=D;function se(s,r){const a=s&&s.navigator;if(!a.mediaDevices)return;const c=function(e){if(typeof e!="object"||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(i=>{if(i==="require"||i==="advanced"||i==="mediaSource")return;const o=typeof e[i]=="object"?e[i]:{ideal:e[i]};o.exact!==void 0&&typeof o.exact=="number"&&(o.min=o.max=o.exact);const u=function(d,h){return d?d+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(o.ideal!==void 0){t.optional=t.optional||[];let d={};typeof o.ideal=="number"?(d[u("min",i)]=o.ideal,t.optional.push(d),d={},d[u("max",i)]=o.ideal,t.optional.push(d)):(d[u("",i)]=o.ideal,t.optional.push(d))}o.exact!==void 0&&typeof o.exact!="number"?(t.mandatory=t.mandatory||{},t.mandatory[u("",i)]=o.exact):["min","max"].forEach(d=>{o[d]!==void 0&&(t.mandatory=t.mandatory||{},t.mandatory[u(d,i)]=o[d])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},l=function(e,t){if(r.version>=61)return t(e);if((e=JSON.parse(JSON.stringify(e)))&&typeof e.audio=="object"){const i=function(o,u,d){u in o&&!(d in o)&&(o[d]=o[u],delete o[u])};i((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),i(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=c(e.audio)}if(e&&typeof e.video=="object"){let i=e.video.facingMode;i=i&&(typeof i=="object"?i:{ideal:i});const o=r.version<66;if(i&&(i.exact==="user"||i.exact==="environment"||i.ideal==="user"||i.ideal==="environment")&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||o)){let u;if(delete e.video.facingMode,i.exact==="environment"||i.ideal==="environment"?u=["back","rear"]:i.exact!=="user"&&i.ideal!=="user"||(u=["front"]),u)return a.mediaDevices.enumerateDevices().then(d=>{let h=(d=d.filter(_=>_.kind==="videoinput")).find(_=>u.some(T=>_.label.toLowerCase().includes(T)));return!h&&d.length&&u.includes("back")&&(h=d[d.length-1]),h&&(e.video.deviceId=i.exact?{exact:h.deviceId}:{ideal:h.deviceId}),e.video=c(e.video),ne("chrome: "+JSON.stringify(e)),t(e)})}e.video=c(e.video)}return ne("chrome: "+JSON.stringify(e)),t(e)},n=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(a.getUserMedia=(function(e,t,i){l(e,o=>{a.webkitGetUserMedia(o,t,u=>{i&&i(n(u))})})}).bind(a),a.mediaDevices.getUserMedia){const e=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(t){return l(t,i=>e(i).then(o=>{if(i.audio&&!o.getAudioTracks().length||i.video&&!o.getVideoTracks().length)throw o.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return o},o=>Promise.reject(n(o))))}}}function he(s,r){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(typeof r=="function"?s.navigator.mediaDevices.getDisplayMedia=function(a){return r(a).then(c=>{const l=a.video&&a.video.width,n=a.video&&a.video.height,e=a.video&&a.video.frameRate;return a.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c,maxFrameRate:e||3}},l&&(a.video.mandatory.maxWidth=l),n&&(a.video.mandatory.maxHeight=n),s.navigator.mediaDevices.getUserMedia(a)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function Oe(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function H(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});const r=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=a=>{a.stream.addEventListener("addtrack",c=>{let l;l=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===c.track.id):{track:c.track};const n=new Event("track");n.track=c.track,n.receiver=l,n.transceiver={receiver:l},n.streams=[a.stream],this.dispatchEvent(n)}),a.stream.getTracks().forEach(c=>{let l;l=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===c.id):{track:c};const n=new Event("track");n.track=c,n.receiver=l,n.transceiver={receiver:l},n.streams=[a.stream],this.dispatchEvent(n)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else f(s,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function me(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const r=function(l,n){return{track:n,get dtmf(){return this._dtmf===void 0&&(n.kind==="audio"?this._dtmf=l.createDTMFSender(n):this._dtmf=null),this._dtmf},_pc:l}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const l=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(e,t){let i=l.apply(this,arguments);return i||(i=r(this,e),this._senders.push(i)),i};const n=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);t!==-1&&this._senders.splice(t,1)}}const a=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(n=>{this._senders.push(r(this,n))})};const c=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],c.apply(this,[l]),l.getTracks().forEach(n=>{const e=this._senders.find(t=>t.track===n);e&&this._senders.splice(this._senders.indexOf(e),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const r=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ke(s){if(!s.RTCPeerConnection)return;const r=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[a,c,l]=arguments;if(arguments.length>0&&typeof a=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof a!="function"))return r.apply(this,[]);const n=function(t){const i={};return t.result().forEach(o=>{const u={id:o.id,timestamp:o.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[o.type]||o.type};o.names().forEach(d=>{u[d]=o.stat(d)}),i[u.id]=u}),i},e=function(t){return new Map(Object.keys(t).map(i=>[i,t[i]]))};if(arguments.length>=2){const t=function(i){c(e(n(i)))};return r.apply(this,[t,a])}return new Promise((t,i)=>{r.apply(this,[function(o){t(e(n(o)))},i])}).then(c,l)}}function Ee(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const a=s.RTCPeerConnection.prototype.getSenders;a&&(s.RTCPeerConnection.prototype.getSenders=function(){const l=a.apply(this,[]);return l.forEach(n=>n._pc=this),l});const c=s.RTCPeerConnection.prototype.addTrack;c&&(s.RTCPeerConnection.prototype.addTrack=function(){const l=c.apply(this,arguments);return l._pc=this,l}),s.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(n=>q(n,l.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const a=s.RTCPeerConnection.prototype.getReceivers;a&&(s.RTCPeerConnection.prototype.getReceivers=function(){const c=a.apply(this,[]);return c.forEach(l=>l._pc=this),c}),f(s,"track",c=>(c.receiver._pc=c.srcElement,c)),s.RTCRtpReceiver.prototype.getStats=function(){const c=this;return this._pc.getStats().then(l=>q(l,c.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype)||!("getStats"in s.RTCRtpReceiver.prototype))return;const r=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const a=arguments[0];let c,l,n;return this.getSenders().forEach(e=>{e.track===a&&(c?n=!0:c=e)}),this.getReceivers().forEach(e=>(e.track===a&&(l?n=!0:l=e),e.track===a)),n||c&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):c?c.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function ee(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(n=>this._shimmedLocalStreams[n][0])};const r=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(n,e){if(!e)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const t=r.apply(this,arguments);return this._shimmedLocalStreams[e.id]?this._shimmedLocalStreams[e.id].indexOf(t)===-1&&this._shimmedLocalStreams[e.id].push(t):this._shimmedLocalStreams[e.id]=[e,t],t};const a=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(n){this._shimmedLocalStreams=this._shimmedLocalStreams||{},n.getTracks().forEach(i=>{if(this.getSenders().find(o=>o.track===i))throw new DOMException("Track already exists.","InvalidAccessError")});const e=this.getSenders();a.apply(this,arguments);const t=this.getSenders().filter(i=>e.indexOf(i)===-1);this._shimmedLocalStreams[n.id]=[n].concat(t)};const c=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(n){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[n.id],c.apply(this,arguments)};const l=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(n){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},n&&Object.keys(this._shimmedLocalStreams).forEach(e=>{const t=this._shimmedLocalStreams[e].indexOf(n);t!==-1&&this._shimmedLocalStreams[e].splice(t,1),this._shimmedLocalStreams[e].length===1&&delete this._shimmedLocalStreams[e]}),l.apply(this,arguments)}}function J(s,r){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&r.version>=65)return ee(s);const a=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const i=a.apply(this);return this._reverseStreams=this._reverseStreams||{},i.map(o=>this._reverseStreams[o.id])};const c=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(i){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.getTracks().forEach(o=>{if(this.getSenders().find(u=>u.track===o))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[i.id]){const o=new s.MediaStream(i.getTracks());this._streams[i.id]=o,this._reverseStreams[o.id]=i,i=o}c.apply(this,[i])};const l=s.RTCPeerConnection.prototype.removeStream;function n(i,o){let u=o.sdp;return Object.keys(i._reverseStreams||[]).forEach(d=>{const h=i._reverseStreams[d],_=i._streams[h.id];u=u.replace(new RegExp(_.id,"g"),h.id)}),new RTCSessionDescription({type:o.type,sdp:u})}s.RTCPeerConnection.prototype.removeStream=function(i){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[i.id]||i]),delete this._reverseStreams[this._streams[i.id]?this._streams[i.id].id:i.id],delete this._streams[i.id]},s.RTCPeerConnection.prototype.addTrack=function(i,o){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const u=[].slice.call(arguments,1);if(u.length!==1||!u[0].getTracks().find(h=>h===i))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(h=>h.track===i))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const d=this._streams[o.id];if(d)d.addTrack(i),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const h=new s.MediaStream([i]);this._streams[o.id]=h,this._reverseStreams[h.id]=o,this.addStream(h)}return this.getSenders().find(h=>h.track===i)},["createOffer","createAnswer"].forEach(function(i){const o=s.RTCPeerConnection.prototype[i],u={[i](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?o.apply(this,[h=>{const _=n(this,h);d[0].apply(null,[_])},h=>{d[1]&&d[1].apply(null,h)},arguments[2]]):o.apply(this,arguments).then(h=>n(this,h))}};s.RTCPeerConnection.prototype[i]=u[i]});const e=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(i,o){let u=o.sdp;return Object.keys(i._reverseStreams||[]).forEach(d=>{const h=i._reverseStreams[d],_=i._streams[h.id];u=u.replace(new RegExp(h.id,"g"),_.id)}),new RTCSessionDescription({type:o.type,sdp:u})}(this,arguments[0]),e.apply(this,arguments)):e.apply(this,arguments)};const t=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const i=t.get.apply(this);return i.type===""?i:n(this,i)}}),s.RTCPeerConnection.prototype.removeTrack=function(i){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!i._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(i._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let o;this._streams=this._streams||{},Object.keys(this._streams).forEach(u=>{this._streams[u].getTracks().find(d=>i.track===d)&&(o=this._streams[u])}),o&&(o.getTracks().length===1?this.removeStream(this._reverseStreams[o.id]):o.removeTrack(i.track),this.dispatchEvent(new Event("negotiationneeded")))}}function X(s,r){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const c=s.RTCPeerConnection.prototype[a],l={[a](){return arguments[0]=new(a==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};s.RTCPeerConnection.prototype[a]=l[a]})}function le(s,r){f(s,"negotiationneeded",a=>{const c=a.target;if(!(r.version<72||c.getConfiguration&&c.getConfiguration().sdpSemantics==="plan-b")||c.signalingState==="stable")return a})}function ge(s,r){const a=s&&s.navigator,c=s&&s.MediaStreamTrack;if(a.getUserMedia=function(l,n,e){A("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),a.mediaDevices.getUserMedia(l).then(n,e)},!(r.version>55&&"autoGainControl"in a.mediaDevices.getSupportedConstraints())){const l=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},n=a.mediaDevices.getUserMedia.bind(a.mediaDevices);if(a.mediaDevices.getUserMedia=function(e){return typeof e=="object"&&typeof e.audio=="object"&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),n(e)},c&&c.prototype.getSettings){const e=c.prototype.getSettings;c.prototype.getSettings=function(){const t=e.apply(this,arguments);return l(t,"mozAutoGainControl","autoGainControl"),l(t,"mozNoiseSuppression","noiseSuppression"),t}}if(c&&c.prototype.applyConstraints){const e=c.prototype.applyConstraints;c.prototype.applyConstraints=function(t){return this.kind==="audio"&&typeof t=="object"&&(t=JSON.parse(JSON.stringify(t)),l(t,"autoGainControl","mozAutoGainControl"),l(t,"noiseSuppression","mozNoiseSuppression")),e.apply(this,[t])}}}}function De(s,r){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(a){if(!a||!a.video){const c=new DOMException("getDisplayMedia without video constraints is undefined");return c.name="NotFoundError",c.code=8,Promise.reject(c)}return a.video===!0?a.video={mediaSource:r}:a.video.mediaSource=r,s.navigator.mediaDevices.getUserMedia(a)})}function Ie(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _t(s,r){if(typeof s!="object"||!s.RTCPeerConnection&&!s.mozRTCPeerConnection)return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const n=s.RTCPeerConnection.prototype[l],e={[l](){return arguments[0]=new(l==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};s.RTCPeerConnection.prototype[l]=e[l]});const a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},c=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[l,n,e]=arguments;return c.apply(this,[l||null]).then(t=>{if(r.version<53&&!n)try{t.forEach(i=>{i.type=a[i.type]||i.type})}catch(i){if(i.name!=="TypeError")throw i;t.forEach((o,u)=>{t.set(u,Object.assign({},o,{type:a[o.type]||o.type}))})}return t}).then(n,e)}}function bn(s){if(typeof s!="object"||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const r=s.RTCPeerConnection.prototype.getSenders;r&&(s.RTCPeerConnection.prototype.getSenders=function(){const c=r.apply(this,[]);return c.forEach(l=>l._pc=this),c});const a=s.RTCPeerConnection.prototype.addTrack;a&&(s.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Yt(s){if(typeof s!="object"||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const r=s.RTCPeerConnection.prototype.getReceivers;r&&(s.RTCPeerConnection.prototype.getReceivers=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a}),f(s,"track",a=>(a.receiver._pc=a.srcElement,a)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Nn(s){s.RTCPeerConnection&&!("removeStream"in s.RTCPeerConnection.prototype)&&(s.RTCPeerConnection.prototype.removeStream=function(r){A("removeStream","removeTrack"),this.getSenders().forEach(a=>{a.track&&r.getTracks().includes(a.track)&&this.removeTrack(a)})})}function kn(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function Ur(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const r=s.RTCPeerConnection.prototype.addTransceiver;r&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1]&&arguments[1].sendEncodings;a===void 0&&(a=[]),a=[...a];const c=a.length>0;c&&a.forEach(n=>{if("rid"in n&&!/^[a-z0-9]{0,16}$/i.test(n.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in n&&!(parseFloat(n.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in n&&!(parseFloat(n.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=r.apply(this,arguments);if(c){const{sender:n}=l,e=n.getParameters();(!("encodings"in e)||e.encodings.length===1&&Object.keys(e.encodings[0]).length===0)&&(e.encodings=a,n.sendEncodings=a,this.setParametersPromises.push(n.setParameters(e).then(()=>{delete n.sendEncodings}).catch(()=>{delete n.sendEncodings})))}return l})}function Tr(s){if(typeof s!="object"||!s.RTCRtpSender)return;const r=s.RTCRtpSender.prototype.getParameters;r&&(s.RTCRtpSender.prototype.getParameters=function(){const a=r.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function gr(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const r=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function $n(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const r=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function jr(s){if(typeof s=="object"&&s.RTCPeerConnection){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const r=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(c=>r.call(this,c,a)),a.getVideoTracks().forEach(c=>r.call(this,c,a))},s.RTCPeerConnection.prototype.addTrack=function(a,...c){return c&&c.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),r.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const a=this._localStreams.indexOf(r);if(a===-1)return;this._localStreams.splice(a,1);const c=r.getTracks();this.getSenders().forEach(l=>{c.includes(l.track)&&this.removeTrack(l)})})}}function Cr(s){if(typeof s=="object"&&s.RTCPeerConnection&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(a){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=c=>{c.streams.forEach(l=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(l))return;this._remoteStreams.push(l);const n=new Event("addstream");n.stream=l,this.dispatchEvent(n)})})}});const r=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){c.streams.forEach(l=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(l)>=0)return;a._remoteStreams.push(l);const n=new Event("addstream");n.stream=l,a.dispatchEvent(n)})}),r.apply(a,arguments)}}}function Ir(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const r=s.RTCPeerConnection.prototype,a=r.createOffer,c=r.createAnswer,l=r.setLocalDescription,n=r.setRemoteDescription,e=r.addIceCandidate;r.createOffer=function(i,o){const u=arguments.length>=2?arguments[2]:arguments[0],d=a.apply(this,[u]);return o?(d.then(i,o),Promise.resolve()):d},r.createAnswer=function(i,o){const u=arguments.length>=2?arguments[2]:arguments[0],d=c.apply(this,[u]);return o?(d.then(i,o),Promise.resolve()):d};let t=function(i,o,u){const d=l.apply(this,[i]);return u?(d.then(o,u),Promise.resolve()):d};r.setLocalDescription=t,t=function(i,o,u){const d=n.apply(this,[i]);return u?(d.then(o,u),Promise.resolve()):d},r.setRemoteDescription=t,t=function(i,o,u){const d=e.apply(this,[i]);return u?(d.then(o,u),Promise.resolve()):d},r.addIceCandidate=t}function qe(s){const r=s&&s.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const a=r.mediaDevices,c=a.getUserMedia.bind(a);r.mediaDevices.getUserMedia=l=>c(Zr(l))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(a,c,l){r.mediaDevices.getUserMedia(a).then(c,l)}).bind(r))}function Zr(s){return s&&s.video!==void 0?Object.assign({},s,{video:W(s.video)}):s}function Ks(s){if(!s.RTCPeerConnection)return;const r=s.RTCPeerConnection;s.RTCPeerConnection=function(a,c){if(a&&a.iceServers){const l=[];for(let n=0;n<a.iceServers.length;n++){let e=a.iceServers[n];e.urls===void 0&&e.url?(A("RTCIceServer.url","RTCIceServer.urls"),e=JSON.parse(JSON.stringify(e)),e.urls=e.url,delete e.url,l.push(e)):l.push(a.iceServers[n])}a.iceServers=l}return new r(a,c)},s.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function un(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function os(s){const r=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(a){if(a){a.offerToReceiveAudio!==void 0&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);const c=this.getTransceivers().find(n=>n.receiver.track.kind==="audio");a.offerToReceiveAudio===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):a.offerToReceiveAudio!==!0||c||this.addTransceiver("audio",{direction:"recvonly"}),a.offerToReceiveVideo!==void 0&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);const l=this.getTransceivers().find(n=>n.receiver.track.kind==="video");a.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):a.offerToReceiveVideo!==!0||l||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function as(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var sa=ue(7963),bo=ue.n(sa);function er(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const r=s.RTCIceCandidate;s.RTCIceCandidate=function(a){if(typeof a=="object"&&a.candidate&&a.candidate.indexOf("a=")===0&&((a=JSON.parse(JSON.stringify(a))).candidate=a.candidate.substring(2)),a.candidate&&a.candidate.length){const c=new r(a),l=bo().parseCandidate(a.candidate);for(const n in l)n in c||Object.defineProperty(c,n,{value:l[n]});return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new r(a)},s.RTCIceCandidate.prototype=r.prototype,f(s,"icecandidate",a=>(a.candidate&&Object.defineProperty(a,"candidate",{value:new s.RTCIceCandidate(a.candidate),writable:"false"}),a))}function To(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||f(s,"icecandidate",r=>{if(r.candidate){const a=bo().parseCandidate(r.candidate.candidate);a.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[a.priority>>24])}return r})}function Mi(s,r){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const a=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(c){if(!c||!c.sdp)return!1;const l=bo().splitSections(c.sdp);return l.shift(),l.some(n=>{const e=bo().parseMLine(n);return e&&e.kind==="application"&&e.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const c=function(i){const o=i.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(o===null||o.length<2)return-1;const u=parseInt(o[1],10);return u!=u?-1:u}(arguments[0]),l=function(i){let o=65536;return r.browser==="firefox"&&(o=r.version<57?i===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),o}(c),n=function(i,o){let u=65536;r.browser==="firefox"&&r.version===57&&(u=65535);const d=bo().matchPrefix(i.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substring(19),10):r.browser==="firefox"&&o!==-1&&(u=2147483637),u}(arguments[0],c);let e;e=l===0&&n===0?Number.POSITIVE_INFINITY:l===0||n===0?Math.max(l,n):Math.min(l,n);const t={};Object.defineProperty(t,"maxMessageSize",{get:()=>e}),this._sctp=t}return a.apply(this,arguments)}}function eo(s){if(!s.RTCPeerConnection||!("createDataChannel"in s.RTCPeerConnection.prototype))return;function r(c,l){const n=c.send;c.send=function(){const e=arguments[0],t=e.length||e.size||e.byteLength;if(c.readyState==="open"&&l.sctp&&t>l.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+l.sctp.maxMessageSize+" bytes)");return n.apply(c,arguments)}}const a=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const c=a.apply(this,arguments);return r(c,this),c},f(s,"datachannel",c=>(r(c.channel,c.target),c))}function ss(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(a){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),a&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=a)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(a=>{const c=r[a];r[a]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=l=>{const n=l.target;if(n._lastConnectionState!==n.connectionState){n._lastConnectionState=n.connectionState;const e=new Event("connectionstatechange",l);n.dispatchEvent(e)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),c.apply(this,arguments)}})}function Li(s,r){if(!s.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const a=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(c){if(c&&c.sdp&&c.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=c.sdp.split(`
`).filter(n=>n.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&c instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:c.type,sdp:l}):c.sdp=l}return a.apply(this,arguments)}}function Co(s,r){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const a=s.RTCPeerConnection.prototype.addIceCandidate;a&&a.length!==0&&(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ei(s,r){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const a=s.RTCPeerConnection.prototype.setLocalDescription;a&&a.length!==0&&(s.RTCPeerConnection.prototype.setLocalDescription=function(){let c=arguments[0]||{};if(typeof c!="object"||c.type&&c.sdp)return a.apply(this,arguments);if(c={type:c.type,sdp:c.sdp},!c.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":c.type="offer";break;default:c.type="answer"}return c.sdp||c.type!=="offer"&&c.type!=="answer"?a.apply(this,[c]):(c.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(l=>a.apply(this,[l]))})}(function({window:s}={},r={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const a=D,c=function(n){const e={browser:null,version:null};if(n===void 0||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.mozGetUserMedia)e.browser="firefox",e.version=S(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=S(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!n.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=S(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype}return e}(s),l={browserDetails:c,commonShim:v,extractVersion:S,disableLog:b,disableWarnings:x,sdp:sa};switch(c.browser){case"chrome":if(!O||!X||!r.shimChrome)return a("Chrome shim is not included in this adapter release."),l;if(c.version===null)return a("Chrome shim can not determine version, not shimming."),l;a("adapter.js shimming chrome."),l.browserShim=O,Co(s,c),ei(s),se(s,c),Oe(s),X(s,c),H(s),J(s,c),me(s),ke(s),Ee(s),le(s,c),er(s),To(s),ss(s),Mi(s,c),eo(s),Li(s,c);break;case"firefox":if(!k||!_t||!r.shimFirefox)return a("Firefox shim is not included in this adapter release."),l;a("adapter.js shimming firefox."),l.browserShim=k,Co(s,c),ei(s),ge(s,c),_t(s,c),Ie(s),Nn(s),bn(s),Yt(s),kn(s),Ur(s),Tr(s),gr(s),$n(s),er(s),ss(s),Mi(s,c),eo(s);break;case"safari":if(!p||!r.shimSafari)return a("Safari shim is not included in this adapter release."),l;a("adapter.js shimming safari."),l.browserShim=p,Co(s,c),ei(s),Ks(s),os(s),Ir(s),jr(s),Cr(s),un(s),qe(s),as(s),er(s),To(s),Mi(s,c),eo(s),Li(s,c);break;default:a("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),ue(8630);const cs=()=>typeof RTCPeerConnection=="function";var Rt,Ft;(function(s){s[s.TRACE=0]="TRACE",s[s.DEBUG=1]="DEBUG",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(Rt||(Rt={})),function(s){s.TIME="Time",s.WEBRTC="WebRTC",s.EMITTER="Emitter",s.MEDIA="Media",s.SUBSCRIPTION="StageSubscription",s.PUBLICATION="StagePublication",s.CONNECTION="StageConnection",s.SOCKET="StageSocket",s.BROADCAST_STAGE_CLIENT="BroadcastStageClient",s.STAGE="Stage",s.REMOTE_PARTICIPANT="RemoteParticipant",s.LOCAL_PARTICIPANT="LocalParticipant",s.CONFIGURATION="Configuration",s.REMOTE_PLAYBACK="RemotePlaybackController",s.REMOTE_STAGE_STREAM="RemoteStageStream"}(Ft||(Ft={}));const us=12e4,Wc=3e5,zn="no-rid";class Ke extends Error{constructor({name:r,message:a,code:c,details:l,cause:n,params:e}){super(a),Error.captureStackTrace&&Error.captureStackTrace(this,Ke),this.name=r||"BroadcastClientError",this.message=a,this.code=c,this.details=l,this.cause=n,this.params=e}}const Js={name:"BroadcastError",code:1e3,message:"Unable to broadcast"},Si={name:"CameraError",code:2e3,message:"Camera could not be captured"},Ys={name:"InputError",code:3e3,message:"Input could not be attached"},Io={name:"AddDeviceError",code:4e3,message:"Device is missing"},ca={name:"AddDeviceNameExistsError",code:4001,message:"Name is already registered"},Ro={name:"AddDeviceCompositionMissingError",code:4002,message:"VideoComposition is missing"},Y={name:"AddDeviceCompositionIndexMissingError",code:4003,message:`VideoComposition's "index" property is missing`},ie={name:"AddDeviceNameMissingError",code:4004,message:"Name property is missing"},fe={name:"AddDeviceUnsupported",code:4005,message:"Unsupported device"},Te={name:"AddDeviceConstraintsError",code:4006,message:"Constraints error"},Xe={name:"RemoveDeviceNotFoundError",code:5e3,message:"Device not found"},tn={name:"RemoveImageNotFoundError",code:6e3,message:"Image not found"},it={name:"UpdateVideoDeviceCompositionMissingError",code:7e3,message:"VideoComposition is missing"},nt={name:"UpdateVideoDeviceCompositionIndexMissingError",code:7001,message:`VideoComposition's "index" property is missing`},Ue={name:"UpdateVideoDeviceCompositionNameMissingError",code:7002,message:"Video device with that name is not found"},we={name:"ExchangePositionDeviceNotFoundError",code:8e3,message:"Device with that name is not found"},Ge={name:"FailedToAddImageError",code:9e3,message:"Failed to add image"},He={name:"PeerSetupError",code:1e4,message:"Unexpected return value from setup request"},St={name:"PeerConnectionError",code:10001,message:"Peer connection has failed."},Vt={name:"InvalidStreamKey",code:10003,message:"Invalid Stream Key."},$t={name:"BroadcastConfigurationError",code:11e3,message:"Error when configuring broadcast client"},Tn={name:"StreamConfigurationError",code:12e3,message:"Error when configuring stream"},ua={name:"IngestEndpointTypeError",code:13e3,message:"Ingest endpoint must be a string"},la={name:"IngestEndpointUrlError",code:13001,message:"Ingest endpoint must be a valid https or rtmps URL"},Qs={name:"LogLevelTypeError",code:14e3,message:"Log Level must be a valid integer between [0..5]"},ls={name:"LoggerTypeError",code:15e3,message:"Logger must be an object"},ds={name:"ClientInvalidError",code:16e3,message:"Client is no longer valid, possibly due to delete() invocation."},hs={name:"NetworkReconnectConfigurationError",code:17e3,message:"Error when configuring network reconnect"},da={name:"NetworkReconnectConfigurationInvalidTimeoutError",code:17001,message:"Network reconnect timeout value must be a number between [10000, 300000]"},xi={name:"StreamKeyInvalidCharError",code:18e3,message:"Streamkey must contain only [A-Za-z0-9_-] characters"},wo={name:"StageTokenTypeError",code:19e3,message:"Stage token must be a string"},Hc={name:"StageWhipUrlOverrideError",code:19001,message:"Stage WHIP override URL must be a string starting with http"};var ha,fa,Oo,Ao,ko,pa,fs,Xs,$c,Fr=function(s,r,a,c){if(a==="a"&&!c)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?s!==r||!c:!r.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?c:a==="a"?c.call(s):c?c.value:r.get(s)},Vr=function(s,r,a,c,l){if(typeof r=="function"?s!==r||!l:!r.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r.set(s,a),a};const ga=1920,Pu=1080,pl=Rt.ERROR,ps={maxResolution:{width:852,height:480},maxFramerate:30,maxBitrate:1500},zc={maxResolution:{width:480,height:852},maxFramerate:30,maxBitrate:1500},zt={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:3500},Ye={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:3500},Gt={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:8500},qc={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:8500},Kc={reconnect:!1,timeout:us};function Jc(s){var r,a;if(typeof s!="string"&&s!==void 0)throw new Ke(ua);if(s){if(s.startsWith("https"))return s;{const c=/(?<protocol>(rtmps|https):\/\/)?(?<id>.+)\.(?<environment>(?=\S*['-])([a-zA-Z'-]+))\.live-video\.net.*/.exec(s);if(((r=c==null?void 0:c.groups)===null||r===void 0?void 0:r.protocol)==="rtmps"&&console.warn("rtmps server url detected; please pass in the ingest endpoint (no rtmps:// protocol) instead"),(a=c==null?void 0:c.groups)===null||a===void 0?void 0:a.id)return`https://${c.groups.id}.webrtc.live-video.net:4443`;throw new Ke(la)}}return""}class Du{constructor(r,a,c=ps,l,n=Kc){this.LOG_LEVEL=Rt,this.BASIC_LANDSCAPE=ps,this.BASIC_PORTRAIT=zc,this.BASIC_FULL_HD_LANDSCAPE=zt,this.BASIC_FULL_HD_PORTRAIT=Ye,this.STANDARD_LANDSCAPE=Gt,this.STANDARD_PORTRAIT=qc,ha.set(this,void 0),fa.set(this,void 0),Oo.set(this,ps),Ao.set(this,void 0),ko.set(this,Kc),pa.set(this,e=>{if(!e)throw new Ke(Object.assign(Object.assign({},Tn),{details:"missing stream configuration"}));if(!(e.maxBitrate<=8500&&e.maxBitrate>=200))throw new Ke(Object.assign(Object.assign({},Tn),{details:"maxBitrate must be between 200 and 8500"}));if(!(e.maxFramerate<=60&&e.maxFramerate>=10))throw new Ke(Object.assign(Object.assign({},Tn),{details:"maxFramerate must be between 10 and 60"}));const t=e.maxResolution.width,i=e.maxResolution.height;if(t>ga||i>ga||t<160||i<160||t===ga&&i>Pu||i===ga&&t>Pu)throw new Ke(Object.assign(Object.assign({},Tn),{details:"maxResolution values must be between 1080x1920 or 1920x1080"}))}),fs.set(this,e=>{if(!e)return;const t=Number(e),i=Number.isInteger(t),o=t>=Rt.TRACE,u=t<=Rt.SILENT;if(!i||!o||!u)throw new Ke(Qs)}),Xs.set(this,e=>{if(e&&typeof e!="object")throw new Ke(ls)}),$c.set(this,e=>{if(!e)return;if(typeof e!="object"||typeof e.reconnect!="boolean")throw new Ke(hs);const{timeout:t}=e;if(t!==void 0&&(Number.isNaN(t)||typeof t!="number"||t<1e4||t>Wc))throw new Ke(da)}),Fr(this,Xs,"f").call(this,l),Fr(this,fs,"f").call(this,a),Fr(this,pa,"f").call(this,c),Vr(this,ha,r),Vr(this,fa,a),Vr(this,Oo,c),Vr(this,Ao,l),Vr(this,ko,n)}get ingestEndpoint(){return Fr(this,ha,"f")}set ingestEndpoint(r){Vr(this,ha,Jc(r))}get streamConfig(){return Fr(this,Oo,"f")}set streamConfig(r){Fr(this,pa,"f").call(this,r),Vr(this,Oo,r)}get logLevel(){return Fr(this,fa,"f")}set logLevel(r){Fr(this,fs,"f").call(this,r),Vr(this,fa,r)}get logger(){return Fr(this,Ao,"f")}set logger(r){Fr(this,Xs,"f").call(this,r),Vr(this,Ao,r)}get networkReconnectConfig(){return Fr(this,ko,"f")}set networkReconnectConfig(r){Fr(this,$c,"f").call(this,r),Vr(this,ko,r)}}ha=new WeakMap,fa=new WeakMap,Oo=new WeakMap,Ao=new WeakMap,ko=new WeakMap,pa=new WeakMap,fs=new WeakMap,Xs=new WeakMap,$c=new WeakMap;var Fe,Cn=ue(228);(function(s){s.PUBLISHED_VIDEO_STATS="ivs_broadcast_webrtc_published_video_stats",s.PUBLISHED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_published_video_stats_window",s.PUBLISHED_AUDIO_STATS="ivs_broadcast_webrtc_published_audio_stats",s.PUBLISHED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_published_audio_stats_window",s.SUBSCRIBED_VIDEO_STATS="ivs_broadcast_webrtc_subscribed_video_stats",s.SUBSCRIBED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_video_stats_window",s.SUBSCRIBED_AUDIO_STATS="ivs_broadcast_webrtc_subscribed_audio_stats",s.SUBSCRIBED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_audio_stats_window",s.PUBLISH="ivs_broadcast_multihost_publish",s.UNPUBLISH="ivs_broadcast_multihost_unpublish",s.SUBSCRIBE="ivs_broadcast_multihost_subscribe",s.UNSUBSCRIBE="ivs_broadcast_multihost_unsubscribe",s.PUBLISH_STARTED="ivs_broadcast_multihost_publish_started",s.PUBLISH_FAILED="ivs_broadcast_multihost_publish_failed",s.PUBLISH_ENDED="ivs_broadcast_multihost_publish_ended",s.STATE_UPDATED="ivs_broadcast_multihost_event_state_updated",s.SUBSCRIBE_STARTED="ivs_broadcast_multihost_subscribe_started",s.SUBSCRIBE_FAILED="ivs_broadcast_multihost_subscribe_failed",s.SUBSCRIBE_ENDED="ivs_broadcast_multihost_subscribe_ended",s.FIRST_FRAME="ivs_broadcast_multihost_first_frame",s.JOIN="ivs_broadcast_multihost_join",s.JOIN_ATTEMPT="ivs_broadcast_multihost_event_connect_attempt",s.JOIN_ATTEMPT_FAILED="ivs_broadcast_multihost_event_connect_failed",s.JOIN_ENDED="ivs_broadcast_multihost_join_ended",s.LEAVE="ivs_broadcast_multihost_leave",s.REASSIGNMENT_REQUEST="ivs_broadcast_multihost_reassignment_request",s.SERVER_REQUEST="ivs_broadcast_multihost_server_request",s.TRACE="ivs_broadcast_stage_trace",s.ERROR="ivs_broadcast_error",s.MINUTE="ivs_broadcast_multihost_minute",s.CONNECTION_STATE="ivs_broadcast_webrtc_connection_state",s.ICE_GATHERING_STATE="ivs_broadcast_webrtc_gathering_state",s.EDP_CONNECTED="ivs_broadcast_multihost_event_connected",s.EDP_DISCONNECTED="ivs_broadcast_multihost_event_disconnected",s.EDP_PONG="ivs_broadcast_multihost_edp_rtt",s.SIMULCAST_LAYER_INFO="ivs_broadcast_simulcast_layer_info",s.MULTIHOST_CONFIGURATION="ivs_broadcast_multihost_configuration",s.MULTIHOST_SUBSCRIBE_CONFIGURATION="ivs_broadcast_multihost_subscribe_configuration",s.PLAYBACK_LAYER_REQUEST="ivs_broadcast_multihost_playback_layer_request",s.PLAYBACK_LAYER_STATE="ivs_broadcast_multihost_playback_layer_state",s.SELECTED_PAIR_CHANGE="ivs_broadcast_webrtc_selected_pair_change",s.ANALYTICS_HEALTH_REPORT="ivs_broadcast_analytics_health_report",s.DEVCONF_ERROR="ivs_devconf_error",s.DEVCONF_OPS_METRICS="ivs_devconf_ops_metrics",s.DEVCONF_TRACE="ivs_devconf_trace",s.DEVCONF_VALUE="ivs_devconf_value"})(Fe||(Fe={}));class ot{constructor(r,a,c,l){this.event=r,this.properties={client_time:new Date().toISOString(),customer_id:a.customerId,device_software:window.navigator.userAgent,multihost_id:a.stageARN,participant_id:a.participantID,participant_user_id:a.userID,platform:"web",sdk_version:"1.28.0",stage_arn:a.stageARN,trace_id:c.value},a.attrGsRole&&(this.properties.token_attribute_0=a.attrGsRole),a.attrGsSessionId&&(this.properties.token_attribute_1=a.attrGsSessionId),this.critical=l}}class to extends ot{constructor(r){super(Fe.ERROR,r.token,r.traceId,!0),Object.assign(this.properties,{code:r.code,tag:r.tag,description:r.message,remote_participant_id:r.remoteParticipantId,request_uuid:r.requestUUID,is_nominal:r.nominal,is_fatal:r.fatal,details:r.details,location:r.location,event_count:r.count})}}function Po(s){const r=window.IVS_CLIENT_OVERRIDES;return typeof r=="object"?r[s]:s==="logLevel"?window.STAGES_LOG_LEVEL:s==="appLabel"?window.IVS_APP_LABEL:s==="whipUrl"?window.IVS_DATA_PLANE_ENDPOINT:void 0}function Mn(s){const r=Po(s);if(typeof r=="string")return r}function ln(s){const r=Po(s);if(typeof r=="boolean")return r}function gs(s){const r=Po(s);if(typeof r=="number")return r;if(typeof r=="string"){const a=parseFloat(r);if(!isNaN(a))return a}}function Zs(){const s=Po("logLevel");if(typeof s=="number"&&Object.values(Rt).includes(s))return s}function ec(){return ln("disableXdp")}function ms(){return ln("preferMainProfile")}function ma(){return ln("enableInitialLayerOnSdp")}function tr(){return ln("disableAudioRtcpRsize")}var Rr=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};function wr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const r=16*Math.random()|0;return(s==="x"?r:3&r|8).toString(16)})}function Or(s,r=a=>{}){Rr(this,void 0,void 0,function*(){try{yield s()}catch(a){r(a)}})}var tc=ue(6880),ti=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};function Gr(s,r,a={},c=""){return ti(this,void 0,void 0,function*(){const l=new XMLHttpRequest;return l.open(s,r,!0),a&&Object.keys(a).forEach(n=>{a.hasOwnProperty(n)&&l.setRequestHeader(n,a[n])}),new Promise((n,e)=>{l.onreadystatechange=()=>{l.readyState===4&&(l.status>=200&&l.status<300?n(l.responseText):e(new Error(`Ingest ${s} ${r} responded ${l.status}
${l.responseText}`)))},l.send(c)})})}function Do(s){const r=Date.now();for(const c of s)c.properties.batch_time_millis=r;var a;return{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:`data=${a=JSON.stringify(s),btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(c,l)=>String.fromCharCode(+`0x${l}`)))}`}}class Qt{send(r,a=!1){return ti(this,void 0,void 0,function*(){const{currentEndpoint:c}=nr,{headers:l,body:n}=Do(r),e="eventSenderResult",t=r.length;if(a){const i=navigator.sendBeacon(c,n);nr.trackEvent({type:e,success:i,count:t})}else Or(()=>ti(this,void 0,void 0,function*(){yield Gr("POST",c,l,n),nr.trackEvent({type:e,success:!0,count:t})}),()=>{nr.trackEvent({type:e,success:!1,count:t})})})}}class lt{constructor(){this.emitter=new Cn}hasListenersFor(r){return this.emitter.listenerCount(r)>0}on(r,a,c){a.call=function(l,n){return function(e,...t){try{n.apply(e,t)}catch(i){let o=`Error in callback for ${l}`;const u=n.name;return u&&(o+=` for function ${u}`),void console.error(`${o}
`,i)}}}(r,a),this.emitter.on(r,a,c)}off(r,a,c){this.emitter.off(r,a,c)}emit(r,...a){this.emitter.emit(r,...a)}removeAllListeners(){this.emitter.removeAllListeners()}}const ni="https://broadcast.stats.live-video.net/";class Yc{constructor({totalEvents:r,totalEventsLost:a,windowedEvents:c,windowedEventsLost:l,currentEndpoint:n}){this.transformProperties=(t,i,o,u,d)=>({total_events:t,total_events_lost:i,windowed_events:o,windowed_events_lost:u,current_endpoint:d??ni});const e=this.transformProperties(r,a,c,l,n);this.data={event:Fe.ANALYTICS_HEALTH_REPORT,properties:Object.assign({},e)}}}const Qc={totalEvents:0,totalEventsSent:0,totalEventsLost:0,windowedEvents:0,windowedEventsSent:0,windowedEventsLost:0};var va,In;(function(s){s.ANALYTICS_EVENT="ANALYTICS_EVENT"})(va||(va={}));class vs extends lt{constructor(){super(),this.eventSenderMetrics=Object.assign({},Qc),this.scheduleHealthReport=()=>{this.reportTimer=window.setTimeout(this.onHealthReportInterval,6e4)},this.onHealthReportInterval=()=>{const r=Object.assign({},this.eventSenderMetrics);if(this.eventSenderMetrics.windowedEvents===0?this.emptyWindows++:this.emptyWindows=0,this.emptyWindows>3)return window.clearTimeout(this.reportTimer),void(this.reportTimer=void 0);this.postHealthReport(r),this.eventSenderMetrics.windowedEvents=0,this.eventSenderMetrics.windowedEventsSent=0,this.eventSenderMetrics.windowedEventsLost=0,this.scheduleHealthReport()},this.emptyWindows=0}trackEventSendResult(r){const{count:a,success:c}=r;this.eventSenderMetrics.totalEvents+=a,this.eventSenderMetrics.windowedEvents+=a,c?(this.eventSenderMetrics.totalEventsSent+=a,this.eventSenderMetrics.windowedEventsSent+=a):(this.eventSenderMetrics.totalEventsLost+=a,this.eventSenderMetrics.windowedEventsLost+=a),this.isHealthReportScheduled()||this.scheduleHealthReport()}isHealthReportScheduled(){return typeof this.reportTimer=="number"}postHealthReport(r){const a=new Yc(r);this.emit(va.ANALYTICS_EVENT,a)}}(function(s){s[s.EXCELLENT=4]="EXCELLENT",s[s.GOOD=3]="GOOD",s[s.NORMAL=2]="NORMAL",s[s.POOR=1]="POOR",s[s.DOWN=0]="DOWN"})(In||(In={}));var ri;(function(s){s.NETWORK_QUALITY_CHANGE="networkQualityChange"})(ri||(ri={}));class _a extends lt{constructor(){super(),this.lastNetworkStatus={},this.networkAssessment={networkQuality:In.NORMAL,reason:"no-data"},this.checkNetworkStatus=()=>{var r,a;const c=(r=navigator==null?void 0:navigator.connection)!==null&&r!==void 0?r:{},l={downlink:c.downlink,effectiveType:c.effectiveType,rtt:c.rtt,isOnline:(a=navigator.onLine)===null||a===void 0||a};if(!this.isChangedNetworkStatus(this.lastNetworkStatus,l))return;this.lastNetworkStatus=l;const n=this.networkAssessment,e=function(t){const{rtt:i,downlink:o,isOnline:u}=t;if(!u)return{networkQuality:In.DOWN,reason:"offline"};if(typeof i!="number"||typeof o!="number")return{networkQuality:In.NORMAL,reason:"no-data"};let d=0;i>800?d+=2:i>300&&(d+=1),o<2.5?d+=2:o<5&&(d+=1);const h="score";switch(d){case 4:return{networkQuality:In.POOR,reason:h};case 0:return{networkQuality:In.EXCELLENT,reason:h};default:return{networkQuality:d<=2?In.GOOD:In.NORMAL,reason:h}}}(l);n.networkQuality!==e.networkQuality&&this.emit(ri.NETWORK_QUALITY_CHANGE,n.networkQuality,e.networkQuality),this.networkAssessment=e},this.getNetworkQuality=()=>this.networkAssessment.networkQuality,this.setupWindowListeners(),this.checkNetworkStatus()}setupWindowListeners(){window.addEventListener("online",()=>{this.checkNetworkStatus()}),window.addEventListener("offline",()=>{this.checkNetworkStatus()}),window.navigator.connection&&window.navigator.connection.addEventListener("change",()=>{this.checkNetworkStatus()})}isChangedNetworkStatus(r,a){const{downlink:c,effectiveType:l,rtt:n,isOnline:e}=a;return r.effectiveType!==l||r.downlink!==c||r.rtt!==n||r.isOnline!==e}}var Nu=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class Xc{constructor(){this.globalSessionId=wr(),this.currentGlobalEndpoint=ni,this.healthReporter=new vs,this.networkMonitor=new _a,this.healthReporter.on(va.ANALYTICS_EVENT,c=>{this.trackGlobalEvent(c)});const r=tc.getParser(navigator.userAgent),a=function(c){const l=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/.exec(c)||/^(\d+)\.(\d+)[+|-]?(.*)?$/.exec(c)||/^(\d+)$/.exec(c)||[];return{major:parseInt(l[1],10)||0,minor:parseInt(l[2],10)||0,patch:parseInt(l[3],10)||0}}(String(r.getBrowserVersion()));this.globalProperties={browser:navigator.appVersion,browser_family:r.getBrowserName().toLowerCase(),browser_version:`${a.major}.${a.minor}`,customer_id:"ivs",host:window.location.hostname,os_name:r.getOSName(),os_version:String(r.getOSVersion()),platform:"web",global_session_id:this.getGlobalSessionId(),sdk_version:"1.28.0",user_agent:navigator.userAgent,is_backgrounded:(document==null?void 0:document.visibilityState)==="hidden"}}trackGlobalEvent(r){const a=this.getGlobalProperties();r.data.properties=Object.assign(Object.assign(Object.assign({},a),r.data.properties),{current_endpoint:this.currentEndpoint});const{headers:c,body:l}=Do([r.data]);Or(()=>Nu(this,void 0,void 0,function*(){yield Gr("POST",this.currentEndpoint,c,l)}))}updateGlobalProperties(){this.globalProperties=Object.assign(Object.assign({},this.globalProperties),{is_backgrounded:(document==null?void 0:document.visibilityState)==="hidden"})}getGlobalSessionId(){return this.globalSessionId}getGlobalProperties(){return this.updateGlobalProperties(),this.globalProperties}set currentEndpoint(r){this.currentGlobalEndpoint=r}get currentEndpoint(){var r;return!((r=window.IVS_CLIENT_OVERRIDES)===null||r===void 0)&&r.analyticsPostUrl?window.IVS_CLIENT_OVERRIDES.analyticsPostUrl:this.currentGlobalEndpoint}trackEvent(r){r.type==="eventSenderResult"&&this.healthReporter.trackEventSendResult(r)}getNetworkQuality(){return this.networkMonitor.getNetworkQuality()}}window.IVS_CLIENT_GLOBAL_STATE||(window.IVS_CLIENT_GLOBAL_STATE={}),window.IVS_CLIENT_GLOBAL_STATE.session||(window.IVS_CLIENT_GLOBAL_STATE.session=new Xc);const nr=window.IVS_CLIENT_GLOBAL_STATE.session;function Sa(s){if(!s)throw new Error("eventSender is not defined")}class _s{constructor(){this.sharedProperties={},this.eventSender={},this.queuedEvents=[],this.genSessionId();const r=function(){const a=Mn("appLabel");if(a!==void 0)return a.substring(0,64)}();this.eventSender=new Qt,this.initSharedProperties({appLabel:r}),this.errorReports=new Map}start(){this.flushInterval||(this.flushInterval=window.setInterval(()=>{this.queueAggregateErrors({force:!1}),this.flushEvents()},1e3))}stop(r){let a=!1;clearInterval(this.flushInterval),this.flushInterval=void 0,this.queueAggregateErrors({force:!0}),r&&(this.queuedEvents=this.queuedEvents.filter(c=>c.critical),a=!0),this.flushEvents(a),this.genSessionId()}trackEvent(r,a=!1){let c=this.sharedProperties;a&&(c={global_session_id:this.sharedProperties.global_session_id,session_id:this.sharedProperties.session_id,browser:this.sharedProperties.browser,browser_family:this.sharedProperties.browser_family,browser_version:this.sharedProperties.browser_version,os_name:this.sharedProperties.os_name,os_version:this.sharedProperties.os_version,is_backgrounded:this.sharedProperties.is_backgrounded}),(document==null?void 0:document.visibilityState)==="hidden"&&(c.is_backgrounded=!0),"data"in r?(r.data.properties=Object.assign({},c,r.data.properties),this.queuedEvents.push(r.data)):(r.properties=Object.assign({},c,r.properties),this.queuedEvents.push(r))}trackEventNoSharedProps(r){this.trackEvent(r,!0)}trackErrorAndThrow(r){throw this.trackError(r),r}trackError(r){const a=`${r.code}${r.fatal}${r.nominal}${r.tag}${r.traceId.value}`,c=this.errorReports.get(a),l={error:r,queuedAt:Date.now(),count:0};return c?(c.count===0&&(c.error=r),c.count+=1,c.queuedAt+6e4<=Date.now()?(this.trackErrorReportIfNeeded(c),void this.errorReports.set(a,l)):void 0):(this.errorReports.set(a,l),void this.trackEvent(new to(r)))}queueAggregateErrors({force:r=!1}){this.errorReports.forEach((a,c)=>{const l=a.queuedAt+6e4;!r&&l>Date.now()||(this.trackErrorReportIfNeeded(a),this.errorReports.delete(c))})}trackErrorReportIfNeeded(r){if(r.count===0)return;const a=r.error;a.count=r.count,this.trackEvent(new to(a))}batchEvents(r){Sa(this.eventSender);const a=r.map(c=>(c.data.properties=Object.assign({},this.sharedProperties,c.data.properties),c.data));this.eventSender.send(a)}initSharedProperties({appLabel:r}){const a=nr.getGlobalProperties();this.sharedProperties=Object.assign(Object.assign({},a),{session_id:this.sessionId}),r&&(this.sharedProperties.app_label=r)}genSessionId(){this.sessionId=wr(),this.sharedProperties.session_id=this.sessionId}flushEvents(r=!1){Sa(this.eventSender),this.queuedEvents.length>0&&this.eventSender.send(this.queuedEvents,r),this.queuedEvents=[]}getSessionId(){return this.sessionId}}class nc{constructor(r,a){this.transformProperties=(l,n)=>({sum:l.sum,median:l.median(),min:l.min,max:l.max,p90:l.percentile(.9),event_count:l.data.length,period:n});const c=this.transformProperties(r,a);this.data={event:dn.CONGESTION_TIME,properties:c}}}class Ss{constructor(r,a,c){this.transformProperties=(n,e,t)=>({duration:(n.getTime()-((e==null?void 0:e.getTime())||0))/1e3,ecn_negotiated:!1,ingest_session_id:t});const l=this.transformProperties(r,a,c);this.data={event:dn.CONNECTION_ESTABLISHED,properties:l}}}class rc{constructor(r,a){this.transformProperties=(l,n)=>({sum:l.sum,median:l.median(),min:l.min,max:l.max,p90:l.percentile(.9),event_count:l.data.length,period:n});const c=this.transformProperties(r,a);this.data={event:dn.CONNECTION_RTT,properties:c}}}class rr{constructor(r){this.transformProperties=c=>{var l;return{is_fatal:(l=c.isFatal)!==null&&l!==void 0&&l,value:c.value,code:c.code,description:c.description}};const a=this.transformProperties(r);this.data={event:dn.ERROR,properties:a}}}class qn{constructor(r,a){this.transformProperties=(l,n)=>({type:l,input_device_id:n.deviceId,position:n.facingMode||"unknown"});const c=this.transformProperties(r,a);this.data={event:dn.INPUT_DEVICE_ATTACHED,properties:c}}}class no{constructor(r,a){this.transformProperties=(l,n)=>({type:l,input_device_id:n.deviceId,position:n.facingMode||"unknown"});const c=this.transformProperties(r,a);this.data={event:dn.INPUT_DEVICE_DETACHED,properties:c}}}class Ea{constructor(r,a){this.transformProperties=(l,n)=>({sum:l.sum,median:l.median(),min:l.min,max:l.max,p90:l.percentile(.9),event_count:l.data.length,period:n});const c=this.transformProperties(r,a);this.data={event:dn.MEASURED_BITRATE,properties:c}}}class Zc{constructor(r,a){this.transformProperties=(l,n)=>({minutes_logged:Math.round((l.timestamp-n)/6e4)});const c=this.transformProperties(r,a);this.data={event:dn.MINUTE_BROADCAST,properties:c}}}class Mu{constructor(r,a){this.transformProperties=(l,n)=>({sum:l.sum,median:l.median(),min:l.min,max:l.max,p90:l.percentile(.9),event_count:l.data.length,period:n});const c=this.transformProperties(r,a);this.data={event:dn.RECOMMENDED_BITRATE,properties:c}}}class gl{constructor(r){this.transformProperties=c=>({codec:c.mimeType,bitrate:0,sample_rate:c.clockRate,channel_count:c.channels});const a=this.transformProperties(r);this.data={event:dn.SESSION_AUDIO_ENCODER_CONFIGURED,properties:a}}}class ml{constructor(r){this.transformProperties=c=>({codec:"audio",bitrate:32e3,sample_rate:c.sampleRate,channel_count:c.channelCount});const a=this.transformProperties(r);this.data={event:dn.SESSION_AUDIO_PROPERTIES,properties:a}}}class ya{constructor(r,a,c){this.transformProperties=(n,e,t)=>({codec:t.mimeType,codec_profile:e.profile,codec_level:e.level,rate_mode:"vbr",initial_bitrate:0,keyframe_interval:2,width:n.width,height:n.height,bframe_count:0,target_fps:n.frameRate});const l=this.transformProperties(r,a,c);this.data={event:dn.SESSION_VIDEO_ENCODER_CONFIGURED,properties:l}}}class ro{constructor(r){this.transformProperties=c=>({codec:"video",initial_bitrate:32e3,min_bitrate:0,max_bitrate:0,keyframe_interval:2,width:c.width,height:c.height,auto_bitrate_enabled:!0,bframes_enabled:!1,target_fps:c.frameRate});const a=this.transformProperties(r);this.data={event:dn.SESSION_VIDEO_PROPERTIES,properties:a}}}class ic{constructor(r,a){this.transformProperties=(l,n)=>({sum:l.sum,median:l.median(),min:l.min,max:l.max,p90:l.percentile(.9),event_count:l.data.length,period:n});const c=this.transformProperties(r,a);this.data={event:dn.SOURCE_AUDIO_LATENCY,properties:c}}}class Bi{constructor(r,a){this.transformProperties=(l,n)=>({sum:l.sum,median:l.median(),min:l.min,max:l.max,p90:l.percentile(.9),event_count:l.data.length,period:n});const c=this.transformProperties(r,a);this.data={event:dn.SOURCE_VIDEO_LATENCY,properties:c}}}class Wr{constructor(r,a){this.transformProperties=({protocol:l,hostname:n,port:e},t)=>({protocol:l,endpoint_host:n,endpoint_port:e,reason:t});const c=this.transformProperties(r,a);this.data={event:dn.START_BROADCAST,properties:c}}}class oc{constructor(r){this.transformProperties=({protocol:c,hostname:l,port:n})=>({protocol:c,endpoint_host:l,endpoint_port:n});const a=this.transformProperties(r);this.data={event:dn.STOP_BROADCAST,properties:a}}}class ii{constructor(r){this.transformProperties=c=>({bytes_sent:c.bytesSent,header_bytes_sent:c.headerBytesSent,nack_count:c.nackCount,packets_sent:c.packetsSent,retransmitted_bytes_sent:c.retransmittedBytesSent,retransmitted_packets_sent:c.retransmittedPacketsSent});const a=this.transformProperties(r);this.data={event:dn.WEBRTC_AUDIO_STATS,properties:a}}}class vn{constructor(r){this.transformProperties=c=>({bytes_sent:c.bytesSent,fir_count:c.firCount,frames_encoded:c.framesEncoded,frames_sent:c.framesSent,header_bytes_sent:c.headerBytesSent,huge_frames_sent:c.hugeFramesSent,key_frames_encoded:c.keyFramesEncoded,nack_count:c.nackCount,packets_sent:c.packetsSent,pli_count:c.pliCount,quality_limitation_reason:c.qualityLimitationReason,quality_limitation_resolution_changes:c.qualityLimitationResolutionChanges,retransmitted_bytes_sent:c.retransmittedBytesSent,retransmitted_packets_sent:c.retransmittedPacketsSent,total_encode_time:c.totalEncodeTime,total_encoded_bytes_target:c.totalEncodedBytesTarget,total_packet_send_delay:c.totalPacketSendDelay});const a=this.transformProperties(r);this.data={event:dn.WEBRTC_VIDEO_STATS,properties:a}}}var dn,ac;(function(s){s.START_BROADCAST="ivs_broadcast_start_broadcast",s.STOP_BROADCAST="ivs_broadcast_stop_broadcast",s.MINUTE_BROADCAST="ivs_broadcast_minute_broadcast",s.WEBRTC_AUDIO_STATS="ivs_broadcast_webrtc_audio_stats",s.WEBRTC_VIDEO_STATS="ivs_broadcast_webrtc_video_stats",s.WEBRTC_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_audio_stats_window",s.WEBRTC_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_video_stats_window",s.CONNECTION_ESTABLISHED="ivs_broadcast_connection_established",s.SESSION_VIDEO_PROPERTIES="ivs_broadcast_session_video_properties",s.SESSION_AUDIO_PROPERTIES="ivs_broadcast_session_audio_properties",s.SESSION_VIDEO_ENCODER_CONFIGURED="ivs_broadcast_session_video_encoder_configured",s.SESSION_AUDIO_ENCODER_CONFIGURED="ivs_broadcast_session_audio_encoder_configured",s.SOURCE_AUDIO_LATENCY="ivs_broadcast_source_audio_latency",s.SOURCE_VIDEO_LATENCY="ivs_broadcast_source_video_latency",s.INPUT_DEVICE_ATTACHED="ivs_broadcast_input_device_attached",s.INPUT_DEVICE_DETACHED="ivs_broadcast_input_device_detached",s.CONGESTION_TIME="ivs_broadcast_congestion_time",s.BUFFER_DURATION="ivs_broadcast_buffer_duration",s.MEASURED_BITRATE="ivs_broadcast_measured_bitrate",s.RECOMMENDED_BITRATE="ivs_broadcast_recommended_bitrate",s.CONNECTION_RTT="ivs_broadcast_connection_rtt",s.ERROR="ivs_broadcast_error"})(dn||(dn={})),function(s){s.USER_INITIATED="user-initiated",s.NETWORK_DISCONNECT="network-disconnect"}(ac||(ac={}));const No={[Rt.INFO]:"#528bff",[Rt.WARN]:"#ffb31a",[Rt.DEBUG]:"#00f593",[Rt.ERROR]:"#ff4f4d",[Rt.TRACE]:"",[Rt.SILENT]:"",[Ft.TIME]:"#53535f",[Ft.WEBRTC]:"#0e9bd8",[Ft.SUBSCRIPTION]:"#ffc400",[Ft.CONNECTION]:"#ff5edb",[Ft.SOCKET]:"#8585ff",[Ft.EMITTER]:"#adadb8",[Ft.LOCAL_PARTICIPANT]:"#1DD21D",[Ft.STAGE]:"#EC9806",[Ft.REMOTE_PARTICIPANT]:"#0680EC",details:"#808080"},L=({label:s})=>`background: ${No[s]||"#333333"}; color: white; padding: 3px; margin-left: 3px;`,V=Object.entries(Rt),G=(s,r,a)=>{const c=L({label:s}),[l]=V.find(([,T])=>T===Number(s))||[],n=`%c${l}`,e=L({label:r}),t=`%c${r}`,i=L({label:Ft.TIME}),o=`%c[${new Date().toISOString()}]`,u=L({label:"details"}),d=`%c[${a}]`,h=[o,n,t],_=[i,c,e];return a&&(h.push(d),_.push(u)),[h.join(""),..._]},re={debug(s){console.groupCollapsed(...G(Rt.DEBUG,s.scope,s.label)),console.debug(s.msg,Object.assign(Object.assign({},s),{level:"debug"})),console.groupEnd()},info(s){console.groupCollapsed(...G(Rt.INFO,s.scope,s.label)),console.info(s.msg,Object.assign(Object.assign({},s),{level:"info"})),console.groupEnd()},warn(s){console.groupCollapsed(...G(Rt.WARN,s.scope,s.label)),console.warn(s.msg,Object.assign(Object.assign({},s),{level:"warn"})),console.groupEnd()},error(s){console.groupCollapsed(...G(Rt.ERROR,s.scope,s.label)),console.error(s),console.groupEnd()}};var ye=function(s,r){var a={};for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&r.indexOf(c)<0&&(a[c]=s[c]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var l=0;for(c=Object.getOwnPropertySymbols(s);l<c.length;l++)r.indexOf(c[l])<0&&Object.prototype.propertyIsEnumerable.call(s,c[l])&&(a[c[l]]=s[c[l]])}return a};Object.entries(Rt);class Pe{constructor(r=pl,a=re){this.logLevel=r,this.loggerInstance=a}debug(r){var a,c;this.logLevel>Rt.DEBUG||(c=(a=this.loggerInstance).debug)===null||c===void 0||c.call(a,JSON.parse(JSON.stringify(Object.assign(Object.assign({},r),{level:"debug"}))))}info(r){var a,c;this.logLevel>Rt.INFO||(c=(a=this.loggerInstance).info)===null||c===void 0||c.call(a,JSON.parse(JSON.stringify(Object.assign(Object.assign({},r),{level:"info"}))))}warn(r){var a,c;this.logLevel>Rt.WARN||(c=(a=this.loggerInstance).warn)===null||c===void 0||c.call(a,JSON.parse(JSON.stringify(Object.assign(Object.assign({},r),{level:"warn"}))))}error(r){var a,c,{err:l}=r,n=ye(r,["err"]);this.logLevel>Rt.ERROR||(c=(a=this.loggerInstance).error)===null||c===void 0||c.call(a,Object.assign({err:l},n))}}class Ze{constructor(r,a){this.logger=r,this.scope=a}debug(r){var a,c;(c=(a=this.logger).debug)===null||c===void 0||c.call(a,JSON.parse(JSON.stringify(Object.assign(Object.assign({},r),{scope:this.scope}))))}info(r){var a,c;(c=(a=this.logger).info)===null||c===void 0||c.call(a,JSON.parse(JSON.stringify(Object.assign(Object.assign({},r),{scope:this.scope}))))}warn(r){var a,c;(c=(a=this.logger).warn)===null||c===void 0||c.call(a,JSON.parse(JSON.stringify(Object.assign(Object.assign({},r),{scope:this.scope}))))}error(r){var a,c,{err:l}=r,n=ye(r,["err"]);(c=(a=this.logger).error)===null||c===void 0||c.call(a,Object.assign(Object.assign({err:l},n),{scope:this.scope}))}unwrap(){return this.logger}}class on{constructor(){this.min=0,this.max=0,this.sum=0,this.data=[]}push(r){(this.min===0||r<this.min)&&(this.min=r),r>=this.max&&(this.max=r),this.data.push(r),this.sum+=r}median(){this.data.sort();const r=this.data.length>>1;return this.data.length%2==0?this.data[r-1]+this.data[r]>>1:this.data[r]}percentile(r){if(this.data.length===0)return 0;if(r<=0)return this.data[0];if(r>=1)return this.data[this.data.length-1];const a=(this.data.length-1)*r,c=Math.floor(a),l=c+1,n=a%1;return l>=this.data.length?this.data[c]:this.data[c]*(1-n)+this.data[l]*n}}var Qe=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class Es{constructor(r,a,c,l){this.peerClient=r,this.broadcastCanvasManager=a,this.analyticsTracker=l,this.logger=new Ze(c,Ft.EMITTER),this.previousBytesSent=0,this.startTimestamp=0,this.initializeSamples()}start(){this.logger.info({msg:"start emitter"}),this.collectSamplesTimerId=window.setInterval(()=>{this.collectSamples()},1e3),this.trackSamplesTimerId=window.setInterval(()=>{this.trackSamples()},3e4),this.trackPeerConnectionStatsTimerId=window.setInterval(()=>{this.trackPeerConnectionStats()},6e4),this.trackSamples()}stop(){clearInterval(this.collectSamplesTimerId),clearInterval(this.trackSamplesTimerId),clearInterval(this.trackPeerConnectionStatsTimerId),this.collectSamplesTimerId=void 0,this.trackSamplesTimerId=void 0,this.trackPeerConnectionStatsTimerId=void 0}trackPeerConnectionStats(){return Qe(this,void 0,void 0,function*(){(yield this.peerClient.getReports()).forEach(r=>{if(r.type==="outbound-rtp")switch(r.kind){case"audio":this.analyticsTracker.trackEvent(new ii(r));break;case"video":{const a=new vn(r),c=new Zc(r,this.startTimestamp);this.analyticsTracker.batchEvents([a,c]);break}default:this.logger.warn({msg:"unknown report kind: ",reportKind:r.kind})}})})}collectSamples(){return Qe(this,void 0,void 0,function*(){let r=0;this.audioLatencySamples.push(this.broadcastCanvasManager.getAudioLatency()),this.videoLatencySamples.push(this.broadcastCanvasManager.getVideoLatency()),(yield this.peerClient.getReports()).forEach(c=>{switch(c.type){case"candidate-pair":c.nominated&&(this.rttSamples.push(c.currentRoundTripTime),this.recommendedBitrateSamples.push(c.availableOutgoingBitrate));break;case"outbound-rtp":r+=c.bytesSent||0,this.startTimestamp===0&&c.kind==="video"&&(this.startTimestamp=c.timestamp)}});const a=8*Math.round(r-this.previousBytesSent);this.previousBytesSent=r,this.measuredBitrateSamples.push(a)})}trackSamples(){const a=new ic(this.audioLatencySamples,30),c=new Bi(this.videoLatencySamples,30),l=new nc(this.congestionTimeSamples,30),n=new Ea(this.measuredBitrateSamples,30),e=new Mu(this.recommendedBitrateSamples,30),t=new rc(this.rttSamples,30);this.analyticsTracker.batchEvents([a,c,l,n,e,t]),this.initializeSamples()}initializeSamples(){this.audioLatencySamples=new on,this.videoLatencySamples=new on,this.congestionTimeSamples=new on,this.measuredBitrateSamples=new on,this.recommendedBitrateSamples=new on,this.rttSamples=new on}}const mr={CONNECTION_STATE_CHANGE:"connectionStateChange",ERROR:"clientError",ACTIVE_STATE_CHANGE:"activeStateChange"},wt="connectionStateChange",Ui="sdpNegotiated",io="clientError",Ar="seiMessageReceived",Hr="transformError";var xe;(function(s){s.CLOSED="closed",s.COMPLETED="completed",s.CONNECTED="connected",s.CONNECTING="connecting",s.DISCONNECTED="disconnected",s.FAILED="failed",s.IDLE="idle",s.NEW="new",s.NONE="none"})(xe||(xe={}));const Ve=s=>{const r=n=>{var e;return!((e=n.deviceId)===null||e===void 0)&&e.startsWith("web-contents-media-stream")?"tab":void 0},a=n=>{var e;return!((e=n.deviceId)===null||e===void 0)&&e.startsWith("window")&&n.displaySurface==="window"?"window":void 0},c=n=>{var e;return!((e=n.deviceId)===null||e===void 0)&&e.startsWith("screen")&&n.displaySurface==="monitor"?"screen":void 0};return(r(l=s)||a(l)||c(l)?void 0:"camera")||c(s)||a(s)||r(s)||"unknown";var l};function eu(s,r){return s.find(a=>a.kind===r)}function ys(s){return(s==null?void 0:s.readyState)==="live"}var Je;(function(s){s.VIDEO="video",s.AUDIO="audio"})(Je||(Je={}));class vl{constructor(){this.mediaTracks=new Map([[Je.VIDEO,void 0],[Je.AUDIO,void 0]])}setTrack(r,a){this.mediaTracks.set(r,a)}getTrack(r){return this.mediaTracks.get(r)}}class _l{constructor(){this.levelAsymmetryAllowed=!1,this.packetisationMode=!1,this.profile="",this.level=0}extractVideoSdpFmtpLine(r){return r?(r.split("\r").join(";").split(`
`).join(";").split(" ").join(";").split(";").map(a=>a.trim()).filter(Boolean).forEach(a=>{const c=a.split("=");if(c.length===2)switch(c[0]){case"level-asymmetry-allowed":c[1]==="1"?this.levelAsymmetryAllowed=!0:this.levelAsymmetryAllowed=!1;break;case"packetization-mode":c[1]==="1"?this.packetisationMode=!0:this.packetisationMode=!1;break;case"profile-level-id":this.profile=this.getProfileFromId(c[1]),this.level=this.getLevelFromId(c[1])}}),{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}):{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}}getProfileFromId(r){const a=r.substr(0,2),c=r.substr(2,2);switch(a.substr(0,2)){case"42":return"baseline";case"4d":return"main";case"58":return"extended";case"64":return"high";case"6e":return c==="00"?"high 10":"high 10 intra";case"7a":return c==="00"?"high 42":"high 42 intra";case"f4":return c==="00"?"high 44":"high 44 intra";default:return"unknown"}}getLevelFromId(r){return parseInt(r.substr(4,2),16)}}function Sl(s){return btoa(JSON.stringify(s))}var Rn,Un=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};(function(s){s.IDLE="idle",s.EXECUTING="executing",s.RECONNECTING="reconnecting"})(Rn||(Rn={}));class oo{constructor(r,a=12e4,c,l){this.state=Rn.IDLE,this.failureCallback=()=>{},this.peerClient=r,this.timeout=a,this.logger=c,this.emitter=l}onFailure(r){this.failureCallback=r}setStartConfig(r,a){this.ingestEndpoint=r,this.streamKey=a}execute(){const{id:r}=this;this.state===Rn.IDLE&&(this.state=Rn.EXECUTING,this.emitter.emit(mr.CONNECTION_STATE_CHANGE,xe.CONNECTING),this.logger.info({msg:"Starting execution of reconnect strategy.",id:r}),this.startTimeoutTimer(this.timeout),this.executeStrategy())}startTimeoutTimer(r){this.timeoutTimerId=window.setTimeout(()=>{this.state!==Rn.IDLE&&(this.logger.info({msg:"Reconnect strategy timed out."}),this.stop(),this.emitter.emit(mr.CONNECTION_STATE_CHANGE,xe.FAILED),this.failureCallback())},r)}stop(){this.state=Rn.IDLE,clearTimeout(this.timeoutTimerId),this.stopStrategy()}reconnect(){return Un(this,void 0,void 0,function*(){if(this.ingestEndpoint&&this.streamKey){const r=this.peerClient.getConnectionState();try{this.logger.info({msg:"Attempting reconnect."}),r===xe.CONNECTED?this.logger.info({msg:"Already connected! Stopping reconnect strategy."}):(yield this.peerClient.start(this.ingestEndpoint,this.streamKey),this.logger.info({msg:"Reconnect succeeded!"})),this.stop()}catch(a){throw this.logger.error({err:a}),a}}})}isActive(){return this.state!==Rn.IDLE}}class tu extends oo{constructor(){super(...arguments),this.id="ExponentialBackoffStrategy"}executeStrategy(){let r=5e3;const a=()=>Un(this,void 0,void 0,function*(){if(this.state===Rn.EXECUTING)try{this.state=Rn.RECONNECTING,yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed. Trying again in: ",nextRetry:r}),this.state=Rn.EXECUTING,this.currentTimeoutId=window.setTimeout(a,r),r*=2}});this.currentTimeoutId=window.setTimeout(a,0)}stopStrategy(){clearTimeout(this.currentTimeoutId)}}class Mo extends oo{constructor(){super(...arguments),this.id="NetworkApiStrategy",this.onConnectionChange=()=>Un(this,void 0,void 0,function*(){if(navigator.onLine&&this.state===Rn.EXECUTING){this.state=Rn.RECONNECTING;try{yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed."}),this.state=Rn.EXECUTING}}})}executeStrategy(){navigator.connection.addEventListener("change",this.onConnectionChange),this.onConnectionChange()}stopStrategy(){navigator.connection.removeEventListener("change",this.onConnectionChange)}}class nu{static create(r,a=Kc,c,l){const{reconnect:n,timeout:e}=a;if(n){const t=tc.getParser(navigator.userAgent).getBrowserName().toLowerCase();return["edge","chrome"].includes(t)&&navigator.connection?new Mo(r,e,c,l):new tu(r,e,c,l)}}}var bs,oi=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})},ru=function(s,r,a,c){if(a==="a"&&!c)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?s!==r||!c:!r.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?c:a==="a"?c.call(s):c?c.value:r.get(s)};const ji=s=>!!s;function Kn(s){if(!s)throw new Error("PeerConnection is not defined")}const Lo={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",enableDtlsSrtp:{exact:!0},enableRtpDataChannels:{exact:!1},optional:[{googHighStartBitrate:{exact:0}},{googPayloadPadding:{exact:!0}},{googScreencastMinBitrate:{exact:100}},{googCpuOveruseDetection:{exact:!0}},{googCpuOveruseEncodeUsage:{exact:!0}},{googCpuUnderuseThreshold:{exact:55}},{googCpuOveruseThreshold:{exact:85}},{enableDscp:{exact:!0}}]};class El{constructor(r,a,c,l,n){this.config=r,this.emitter=a,this.mediaStreamManager=c,this.analyticsTracker=n,this.establishConnection=(e,t)=>oi(this,void 0,void 0,function*(){var i,o,u;Kn(this.peerConnection);try{const d=yield this.peerConnection.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});yield this.handleLocalDescription(d),yield this.sendSetupRequest(e,t,d)}catch(d){if(d instanceof Error){(i=(u=d).code)!==null&&i!==void 0||(u.code=He.code);const h=new Ke(Object.assign(Object.assign({},He),{name:d.name,message:d.message,code:d==null?void 0:d.code,cause:d}));throw!((o=this.reconnectStrategy)===null||o===void 0)&&o.isActive()||this.handleError(d.code,d.message),this.stop(),h}}}),this.getSessionId=()=>this.ingestSessionId,this.getConnectionState=()=>{var e;if(!this.peerConnection)return xe.NONE;const t=(e=this.reconnectStrategy)===null||e===void 0?void 0:e.isActive(),i=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;switch(i){case"new":return xe.NEW;case"closed":return xe.CLOSED;case"disconnected":return t?xe.CONNECTING:xe.DISCONNECTED;case"failed":return t?xe.CONNECTING:xe.FAILED;case"idle":return xe.IDLE;case"checking":case"connecting":return xe.CONNECTING;case"completed":case"connected":return xe.CONNECTED;default:return this.logger.warn({msg:"Unhandled connection state:",rawState:i}),xe.IDLE}},this.onConnectionStateChange=()=>{var e;const t=this.getConnectionState();switch(t){case xe.CONNECTED:{this.emitter.emit(mr.CONNECTION_STATE_CHANGE,t);const i=new Date;this.analyticsTracker.trackEvent(new Ss(i,this.connectionStartDate,this.ingestSessionId));const o=this.mediaStreamManager.getTrack(Je.AUDIO),u=this.mediaStreamManager.getTrack(Je.VIDEO);if(u){const d=u.getSettings();this.analyticsTracker.trackEvent(new ro(d))}if(o){const d=o.getSettings();this.analyticsTracker.trackEvent(new ml(d))}(((e=this.peerConnection)===null||e===void 0?void 0:e.getSenders())||[]).forEach(d=>{var h;(((h=d.getParameters())===null||h===void 0?void 0:h.codecs)||[]).forEach(_=>{var T;switch((T=d.track)===null||T===void 0?void 0:T.kind){case"video":{if(!u)break;const C=new _l().extractVideoSdpFmtpLine(_.sdpFmtpLine),R=u.getSettings();this.analyticsTracker.trackEvent(new ya(R,C,_));break}case"audio":if(!o)break;this.analyticsTracker.trackEvent(new gl(_))}})});break}case xe.CONNECTING:this.emitter.emit(mr.CONNECTION_STATE_CHANGE,t),this.connectionStartDate=new Date,this.disconnectionStartDate=void 0;break;case xe.FAILED:this.reconnectStrategy?this.reconnectStrategy.execute():(this.emitter.emit(mr.CONNECTION_STATE_CHANGE,t),this.handleTerminalConnectionFailure());break;case xe.DISCONNECTED:this.emitter.emit(mr.CONNECTION_STATE_CHANGE,t),this.disconnectionStartDate=new Date;break;default:this.emitter.emit(mr.CONNECTION_STATE_CHANGE,t)}},this.handleLocalDescription=e=>oi(this,void 0,void 0,function*(){var t;return(t=this.peerConnection)===null||t===void 0?void 0:t.setLocalDescription(e)}),bs.set(this,e=>{if(typeof e!="string")throw new Ke(ua);try{new URL(e)}catch{throw new Ke(la)}}),this.logger=new Ze(l,Ft.WEBRTC),this.createReconnectStrategy(r)}start(r,a){var c;return oi(this,void 0,void 0,function*(){ru(this,bs,"f").call(this,r);const l=[this.mediaStreamManager.getTrack(Je.VIDEO),this.mediaStreamManager.getTrack(Je.AUDIO)].filter(ji);if(this.createPeerConnection(),this.addTracks({tracks:l}),this.reconnectStrategy&&this.reconnectStrategy.setStartConfig(r,a),yield this.establishConnection(r,a),!((c=this.reconnectStrategy)===null||c===void 0)&&c.isActive()){const n=new URL(r);this.analyticsTracker.trackEvent(new Wr({protocol:"webrtc",hostname:n.hostname,port:n.port},ac.NETWORK_DISCONNECT))}})}stop(){var r,a,c,l;this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stopStreamDataChannel&&this.stopStreamDataChannel.readyState==="open"&&this.stopStreamDataChannel.send(" "),[xe.NEW,xe.CONNECTING,xe.CONNECTED].includes(this.getConnectionState())&&this.emitter.emit(mr.CONNECTION_STATE_CHANGE,xe.CLOSED),(r=this.peerConnection)===null||r===void 0||r.close(),(a=this.peerConnection)===null||a===void 0||a.removeEventListener("connectionstatechange",this.onConnectionStateChange),(c=this.peerConnection)===null||c===void 0||c.removeEventListener("iceconnectionstatechange",this.onConnectionStateChange),this.ingestSessionId=void 0,(l=this.reconnectStrategy)===null||l===void 0||l.stop()}addTracks(r){var a;if(Kn(this.peerConnection),!r)return;const c=this.peerConnection.getSenders().map(n=>{var e;return(e=n.track)===null||e===void 0?void 0:e.id}),l=r.tracks.filter(n=>!c.includes(n.id));for(const n of l)(a=this.peerConnection)===null||a===void 0||a.addTrack(n)}getReports(){var r;return oi(this,void 0,void 0,function*(){try{const a=(yield(r=this.peerConnection)===null||r===void 0?void 0:r.getStats())||[],c=[];return a.forEach(l=>{c.push(l)}),c}catch{return[]}})}sendSetupRequest(r,a,c){var l;return oi(this,void 0,void 0,function*(){const n=yield fetch(`${r}/v1/offer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({offer:Sl(c),streamKey:a},this.config.streamConfig))});if(!n.ok)throw function(t){let i=new Ke(Object.assign({},He));return(t==null?void 0:t.code)===1007&&(i=new Ke(Object.assign({},Vt))),t!=null&&t.message&&(i.message=t.message),i}(yield n.json());const e=yield n.json();e!=null&&e.answer&&(yield(l=this.peerConnection)===null||l===void 0?void 0:l.setRemoteDescription(function(t){return JSON.parse(atob(t))}(e.answer)),this.ingestSessionId=e.ingestSessionId)})}handleTerminalConnectionFailure(){const r=new Ke(St);this.handleError(r.code,r.message)}handleError(r,a){this.analyticsTracker.trackEvent(new rr({code:r,description:a,isFatal:!0})),this.emitter.emit(mr.ERROR,{code:r,message:a})}createPeerConnection(){var r;const a=this.getConnectionState(),c=a!==xe.NONE,l=a!==xe.CLOSED,n=(r=this.reconnectStrategy)===null||r===void 0?void 0:r.isActive();c&&l&&!n||(this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stateCheckInterval=window.setInterval(()=>{const e=this.getConnectionState();if(this.reconnectStrategy&&e===xe.DISCONNECTED&&this.disconnectionStartDate){const t=Date.now()-this.disconnectionStartDate.getTime();this.logger.info({msg:"Time since disconnected:",timeSinceDisconnect:t}),t>1e4&&(this.disconnectionStartDate=void 0,this.reconnectStrategy.execute())}else e===xe.CLOSED&&(this.handleTerminalConnectionFailure(),clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0)},1e3),this.peerConnection=new RTCPeerConnection(Lo),this.stopStreamDataChannel=this.peerConnection.createDataChannel("stopStream"),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onConnectionStateChange))}createReconnectStrategy(r){if(this.reconnectStrategy=nu.create(this,r.networkReconnectConfig,this.logger,this.emitter),this.reconnectStrategy){this.reconnectStrategy.onFailure(this.handleTerminalConnectionFailure.bind(this));const a=this.reconnectStrategy.id;this.logger.info({msg:"Using reconnect strategy:",strategyId:a})}}}bs=new WeakMap;var ba,Lu,xo=ue(5364);(function(s){s.CONFIG="config",s.UPDATE="update",s.START="start",s.STOP="stop"})(ba||(ba={})),function(s){s.VIDEO_SEND="video/send",s.VIDEO_RECEIVE="video/receive",s.INSERT_SEI="insertSei"}(Lu||(Lu={}));var Bo=ue(5512),Ta=ue.n(Bo);function yl(){return Ta()(`/*! For license information please see scheduler.worker.worker.js.LICENSE.txt */
(()=>{"use strict";var i,t;!function(i){i.CONFIG="config",i.UPDATE="update",i.START="start",i.STOP="stop"}(i||(i={})),function(i){i.VIDEO_SEND="video/send",i.VIDEO_RECEIVE="video/receive",i.INSERT_SEI="insertSei"}(t||(t={}));const s=self;const n=new class Scheduler{constructor(){this.config={frameRate:60,isRunning:!1}}setConfig(i){this.config=Object.assign(Object.assign({},this.config),i),this.config.isRunning&&(this.stop(),this.start())}start(){this.config.isRunning||(this.intervalId=setInterval((()=>{s.postMessage({type:i.UPDATE})}),1e3/this.config.frameRate),this.config.isRunning=!0)}stop(){this.config.isRunning&&(clearInterval(this.intervalId),this.intervalId=void 0,this.config.isRunning=!1)}};s.addEventListener("message",(function(t){var s;if(null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.type)switch(t.data.type){case i.CONFIG:n.setConfig(t.data.payload||{});break;case i.START:n.start();break;case i.STOP:n.stop()}}))})();`,"Worker",void 0,void 0)}var Uo=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class bl{constructor(r,a,c){this.config=r,this.mediaStreamManager=a,this.analyticsTracker=c,this.handleWorkerEvent=t=>{var i;((i=t.data)===null||i===void 0?void 0:i.type)===ba.UPDATE&&this.drawComposite()},this.mixer={video:[],audio:[]},this.schedulerWorker=new yl,this.running=!1,this.compositeEl=document.createElement("canvas"),this.compositeEl.height=this.config.streamConfig.maxResolution.height,this.compositeEl.width=this.config.streamConfig.maxResolution.width;const l=this.compositeEl.getContext("2d");if(l===null)throw new Ke(Object.assign({},Js));this.compositeContext=l,this.compositeStream=this.compositeEl.captureStream(typeof CanvasCaptureMediaStreamTrack!==void 0?0:30);const n=eu(this.compositeStream.getTracks(),Je.VIDEO);this.audioContext=new AudioContext,this.unlockAudioContext(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.setupSilence();const e=eu(this.audioDestination.stream.getTracks(),Je.AUDIO);n&&this.mediaStreamManager.setTrack(Je.VIDEO,n),e&&this.mediaStreamManager.setTrack(Je.AUDIO,e),this.schedulerWorker.addEventListener("message",this.handleWorkerEvent),this.schedulerWorker.postMessage({type:ba.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.previewElement=null,this.previewCtx=null,this.nextMix=new Date().getTime()}attachPreview(r){this.previewElement=r;const{width:a,height:c}=this.config.streamConfig.maxResolution;this.previewElement.width=a,this.previewElement.height=c,this.previewCtx=this.previewElement.getContext("2d")}detachPreview(){this.previewElement=null,this.previewCtx=null}setupSilence(){const r=this.audioContext.createConstantSource(),a=this.audioContext.createGain();a.gain.value=.001,r.connect(a),a.connect(this.audioDestination),r.start()}unlockAudioContext(){if(this.audioContext.state!=="suspended")return;const r=document.body,a=["touchstart","touchend","mousedown","keydown"],c=()=>{a.forEach(n=>{r.removeEventListener(n,l)})},l=()=>{this.audioContext.resume().then(c)};a.forEach(n=>{r.addEventListener(n,l,!1)})}getTracks(){return[this.mediaStreamManager.getTrack(Je.VIDEO),this.mediaStreamManager.getTrack(Je.AUDIO)]}getCanvasVideoTrack(){return this.mediaStreamManager.getTrack(Je.VIDEO)}getAudioInputDevice(r){if(typeof r!="string")return;const a=this.mixer.audio.find(c=>{if(c.name===r)return c.source});return a==null?void 0:a.source}getVideoInputDevice(r){if(typeof r=="string")return this.mixer.video.find(a=>a.name===r)}getCanvasDimensions(){return{height:this.compositeEl.height,width:this.compositeEl.width}}addVideoInputDevice(r,a,c){var l;return Uo(this,void 0,void 0,function*(){if(typeof r!="object")throw new Ke(Object.assign({},Io));if(!a||typeof a!="string")throw new Ke(Object.assign({},ie));if(this.mixer.video.some(h=>h.name===a))throw new Ke(Object.assign({},ca));if(!c)throw new Ke(Object.assign({},Ro));if(typeof c.index!="number")throw new Ke(Object.assign({},Y));const n=function(){const h=document.createElement("video");return h.autoplay=!0,h.muted=!0,h.setAttribute("playsinline",""),h.setAttribute("webkit-playsinline",""),h}(),e=r.getVideoTracks(),[t]=e;if(!e.length)throw new Ke(Object.assign({},Si));const i=t.getConstraints(),o=xo({},i,{frameRate:this.config.streamConfig.maxFramerate});try{yield t.applyConstraints(o)}catch(h){let _="Unknown constraints error";h instanceof Error&&(_=h.message),this.analyticsTracker.trackEvent(new rr({description:`${Te.message}: ${_}`,isFatal:!1,code:Te.code}))}const u=()=>Uo(this,void 0,void 0,function*(){let h=0;for(;h<5;)try{return void(yield n.play())}catch(_){if(!(_ instanceof Error))throw new Error("unknown error trying to add video to broadcast");h++,yield new Promise(T=>setTimeout(T,150))}throw new Error("Error playing video, tries exceeded")}),d=new MediaStream([t]);n.srcObject=d;try{yield u();const h={name:a,element:n,position:c,source:d,render:!0},_=((l=t.getSettings)===null||l===void 0?void 0:l.call(t))||{};this.analyticsTracker.trackEvent(new qn(Ve(_),_)),this.mixer.video.push(h)}catch(h){throw new Ke(Object.assign(Object.assign({},Si),{cause:h}))}})}addImageSource(r,a,c){var l;return Uo(this,void 0,void 0,function*(){if(!r)throw new Ke(Object.assign({},Io));if(!a||typeof a!="string")throw new Ke(Object.assign({},ie));if(r.tagName==="image")throw new Ke(Object.assign({},fe));if(this.mixer.video.some(e=>e.name===a))throw new Ke(Object.assign({},ca));if(!c)throw new Ke(Object.assign({},Ro));if(typeof c.index!="number")throw new Ke(Object.assign({},Y));if(r instanceof Image){const e=(l=r.src)===null||l===void 0?void 0:l.slice();try{const t=r.src?new URL(r.src):{};if(t.host&&t.hostname){const i=yield fetch(r.src).then(u=>Uo(this,void 0,void 0,function*(){return u.blob()})),o=yield new Promise(u=>{const d=new FileReader;d.onload=()=>{u(d.result)},d.readAsDataURL(i)});r.src=o}}catch{throw new Ke(Object.assign(Object.assign({},Ge),{params:{details:`Image URL: ${e}`}}))}}const n={name:a,element:r,position:c,render:!0};this.mixer.video.push(n)})}addAudioInputDevice(r,a){return Uo(this,void 0,void 0,function*(){if(typeof r!="object")throw new Ke(Object.assign({},Io));if(!a||typeof a!="string")throw new Ke(Object.assign({},ie));if(this.mixer.audio.some(t=>t.name===a))throw new Ke(Object.assign({},ca));const c=r.getAudioTracks();if(!c.length)throw new Ke(Object.assign({},Ys));const l=this.audioContext.createMediaStreamSource(new MediaStream(c)),n=this.audioContext.createGain();n.gain.value=1,l.connect(n),n.connect(this.audioDestination);const e={name:a,source:r,audioTrackSource:l,gainNode:n};this.analyticsTracker.trackEvent(new qn("audio",{deviceId:r.id})),this.mixer.audio.push(e)})}removeImage(r){const a=this.mixer.video.findIndex(c=>c.name===r);if(a<0)throw new Ke(Object.assign({},tn));this.mixer.video.splice(a,1)}removeVideoInputDevice(r){var a;const c=this.removeDevice(r,this.mixer.video);if(!c)throw new Ke(Object.assign({},Xe));{const l=eu(c.source.getTracks(),Je.VIDEO);if(!l)throw new Ke(Object.assign({},Xe));c.element.srcObject=null,l.stop();const n=((a=l==null?void 0:l.getSettings)===null||a===void 0?void 0:a.call(l))||{};this.analyticsTracker.trackEvent(new no(Ve(n),n))}}removeAudioInputDevice(r){const a=this.removeDevice(r,this.mixer.audio);if(a!=null&&a.audioTrackSource){for(const c of a.source.getTracks())c.stop(),this.analyticsTracker.trackEvent(new no("audio",{deviceId:c.id}));a.gainNode.disconnect(this.audioDestination)}else if(!a)throw new Ke(Object.assign({},Xe))}updateVideoDeviceComposition(r,a){if(!r||typeof r!="string")throw new Ke(Object.assign({},Ue));if(!a)throw new Ke(Object.assign({},it));if(typeof a.index!="number")throw new Ke(Object.assign({},nt));this.mixer.video.forEach((c,l)=>{c.name===r&&(c.position=a)})}exchangeVideoDevicePositions(r,a){const c=this.getVideoInputDevice(r),l=this.getVideoInputDevice(a);if(!c)throw new Ke(Object.assign(Object.assign({},we),{params:{details:`device with name: "${r}" not found`}}));if(!l)throw new Ke(Object.assign(Object.assign({},we),{params:{details:`device with name: "${a}" not found`}}));const n=Object.assign({},c.position),e=Object.assign({},l.position);for(const t of this.mixer.video)t.name===r&&(xu(e.x)?t.position=Object.assign(Object.assign({},t.position),e):t.position={index:e.index}),t.name===a&&(xu(n.x)?t.position=Object.assign(Object.assign({},t.position),n):t.position={index:n.index})}start(){this.running||(this.running=!0,this.schedulerWorker.postMessage({type:ba.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.schedulerWorker.postMessage({type:ba.START}))}stop(){this.running&&(this.running=!1,this.schedulerWorker.removeEventListener("message",this.handleWorkerEvent))}isCapturing(){return this.running}getAudioLatency(){return this.audioContext.baseLatency}getVideoLatency(){var r;return((r=this.mediaStreamManager.getTrack(Je.VIDEO))===null||r===void 0?void 0:r.getConstraints().latency)||0}disableVideo(){this.mixer.video.forEach(r=>{r.render=!1})}enableVideo(){this.mixer.video.forEach(r=>{r.render=!0})}disableAudio(){this.mixer.audio.forEach(r=>{r.audioTrackSource&&(r.gainNode.gain.value=0)})}enableAudio(){this.mixer.audio.forEach(r=>{r.audioTrackSource&&(r.gainNode.gain.value=1)})}getDrawRegion(r,a,c){var l,n,e,t;let i=(l=r.position.x)!==null&&l!==void 0?l:0,o=(n=r.position.y)!==null&&n!==void 0?n:0;const u=(e=r.position.width)!==null&&e!==void 0?e:a-i,d=(t=r.position.height)!==null&&t!==void 0?t:c-o,h=u/d;let _=r.element.width,T=r.element.height;r.element instanceof HTMLVideoElement&&(_=r.element.videoWidth,T=r.element.videoHeight);const C=_/T;let R=u,w=d;return C>h?(R=u,w=2*Math.round(u/C/2),o+=(d-w)/2):C<h&&(w=d,R=2*Math.round(d*C/2),i+=(u-R)/2),{x:i,y:o,width:R,height:w}}drawComposite(){if(!this.shouldMix(new Date))return;this.compositeContext.clearRect(0,0,this.compositeEl.width,this.compositeEl.height),this.drawBlackScreen();const r=this.mixer.video.filter(a=>a.render);r.sort((a,c)=>a.position.index-c.position.index);for(const a of r){const{x:c,y:l,width:n,height:e}=this.getDrawRegion(a,this.compositeEl.width,this.compositeEl.height);this.compositeContext.drawImage(a.element,c,l,n,e)}this.previewElement&&this.previewCtx&&this.previewCtx.drawImage(this.compositeEl,0,0,this.previewElement.width,this.previewElement.height),this.requestCanvasCapture()}requestCanvasCapture(){typeof CanvasCaptureMediaStreamTrack!==void 0&&(typeof this.compositeStream.requestFrame=="function"?this.compositeStream.requestFrame():this.mediaStreamManager.getTrack(Je.VIDEO).requestFrame())}drawBlackScreen(){this.compositeContext.fillStyle="#000000",this.compositeContext.fillRect(0,0,this.compositeEl.width,this.compositeEl.height)}removeDevice(r,a){const c=a.findIndex(l=>(n=>n.name===r)(l));if(!(c<0))return a.splice(c,1)[0]}shouldMix(r){if(r.getTime()<this.nextMix)return!1;for(;this.nextMix<=r.getTime();)this.nextMix+=1e3/this.config.streamConfig.maxFramerate;return!0}}function xu(s){return Number.isSafeInteger(s)}var gt,Ot,sc=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})},Tl=function(s,r,a,c){if(a==="a"&&!c)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?s!==r||!c:!r.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?c:a==="a"?c.call(s):c?c.value:r.get(s)};class Ts{constructor(r){this.config=r,gt.add(this),this.emitter=new Cn,this.isValid=!0,this.emitter.on(mr.ERROR,this.stopBroadcast),this.config.ingestEndpoint&&(this.url=new URL(this.config.ingestEndpoint)),this.analyticsTracker=new _s,this.mediaStreamManager=new vl;const a=new Pe(r.logLevel,r.logger);this.peerClient=new El(this.config,this.emitter,this.mediaStreamManager,a,this.analyticsTracker),this.broadcastCanvasManager=new bl(r,this.mediaStreamManager,this.analyticsTracker),this.peerStatsTracker=new Es(this.peerClient,this.broadcastCanvasManager,a,this.analyticsTracker),this.broadcastCanvasManager.start(),Object.getOwnPropertyNames(Ts.prototype).forEach(c=>{this[c]=new Proxy(this[c],{apply:(l,n,e)=>{if(!n.isValid)throw new Ke(Object.assign({},ds));return Reflect.apply(l,n,e)}})}),window.addEventListener("beforeunload",()=>{this.analyticsTracker.stop(!0)})}delete(){this.isValid=!1,this.peerClient.stop(),this.broadcastCanvasManager.stop(),this.emitter.removeAllListeners()}startBroadcast(r,a){return sc(this,void 0,void 0,function*(){Tl(this,gt,"m",Ot).call(this,r);const c=Jc(a||this.config.ingestEndpoint);this.analyticsTracker.start(),this.peerStatsTracker.start(),yield this.peerClient.start(c,r),this.emitter.emit(mr.ACTIVE_STATE_CHANGE,!0),this.url=new URL(c),this.url&&this.analyticsTracker.trackEvent(new Wr({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port},ac.USER_INITIATED))})}stopBroadcast(){var r,a,c;this.url&&this.analyticsTracker.trackEvent(new oc({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port})),(r=this.peerStatsTracker)===null||r===void 0||r.stop(),(a=this.peerClient)===null||a===void 0||a.stop(),(c=this.emitter)===null||c===void 0||c.emit(mr.ACTIVE_STATE_CHANGE,!1)}getCanvasDimensions(){return this.broadcastCanvasManager.getCanvasDimensions()}addVideoInputDevice(r,a,c){return sc(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addVideoInputDevice(r,a,c)})}addImageSource(r,a,c){return sc(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addImageSource(r,a,c)})}addAudioInputDevice(r,a){return sc(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addAudioInputDevice(r,a)})}removeVideoInputDevice(r){this.broadcastCanvasManager.removeVideoInputDevice(r)}removeAudioInputDevice(r){this.broadcastCanvasManager.removeAudioInputDevice(r)}removeImage(r){this.broadcastCanvasManager.removeImage(r)}updateVideoDeviceComposition(r,a){this.broadcastCanvasManager.updateVideoDeviceComposition(r,a)}exchangeVideoDevicePositions(r,a){this.broadcastCanvasManager.exchangeVideoDevicePositions(r,a)}getAudioInputDevice(r){return this.broadcastCanvasManager.getAudioInputDevice(r)}getVideoInputDevice(r){return this.broadcastCanvasManager.getVideoInputDevice(r)}getConnectionState(){return this.peerClient.getConnectionState()}getSessionId(){return this.peerClient.getSessionId()}on(r,a){this.emitter.on(r,a)}off(r,a){this.emitter.off(r,a)}getAudioContext(){return this.broadcastCanvasManager.audioContext}attachPreview(r){this.broadcastCanvasManager.attachPreview(r)}detachPreview(){this.broadcastCanvasManager.detachPreview()}disableVideo(){this.broadcastCanvasManager.disableVideo()}enableVideo(){this.broadcastCanvasManager.enableVideo()}disableAudio(){this.broadcastCanvasManager.disableAudio()}enableAudio(){this.broadcastCanvasManager.enableAudio()}}function Bu(s){return new Ts(function(r){const a=new Du;return a.streamConfig=r.streamConfig,a.ingestEndpoint=r.ingestEndpoint,a.logger=r.logger,a.logLevel=r.logLevel,a.networkReconnectConfig=r.networkReconnectConfig,a}(s))}gt=new WeakSet,Ot=function(s){if(typeof s!="string"||!/^[a-zA-Z0-9_-]+$/.test(s))throw new Ke(xi)};const Ca="1.28.0";var ve,qt=ue(2543);(function(s){s.PUBLISH="publish",s.SUBSCRIBE="subscribe",s.JOIN="join",s.LEAVE="leave"})(ve||(ve={}));const ai=2,Fi="X-Stages-Options",Vi="cap";class jo extends ot{constructor(r){super(Fe.LEAVE,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.LEAVE,event_endpoint:r.eventEndpoint,whip_endpoint:r.whipEndpoint,reason:r.reason}),this.critical=!0}}function $r(s){const r="0123456789abcdef";let a="";for(let c=0;c<s;c+=1)a+=r.charAt(Math.floor(16*Math.random()));return a}class Cl{constructor(){const r=$r;this.value=`${r(8)}-${r(4)}-${r(4)}-${r(4)}-${r(12)}`}}function Fo(){return new Cl}class Uu{constructor(){const r=(Date.now()/1e3|0).toString(16);this.value=`1-${r}-${$r(24)}`}}function Jn(){return new Uu}var ju,Yn,Ei,ao=ue(2505),g=ue.n(ao);(function(s){s.MESSAGE="message",s.RESPONSE="response"})(ju||(ju={})),function(s){s.STAGE_DELETED="STAGE_DELETED",s.PARTICIPANT_DISCONNECTED="PARTICIPANT_DISCONNECTED",s.TOKEN_INVALID="TOKEN_INVALID",s.TOKEN_EXPIRED="TOKEN_EXPIRED",s.TOKEN_INVALID_SIGNATURE="TOKEN_INVALID_SIGNATURE",s.TOKEN_MISSING="TOKEN_MISSING",s.INTERNAL="INTERNAL",s.BAD_REQUEST="BAD_REQUEST"}(Yn||(Yn={})),function(s){s[s.BAD_REQUEST=400]="BAD_REQUEST",s[s.UNAUTHORIZED=401]="UNAUTHORIZED",s[s.FORBIDDEN=403]="FORBIDDEN",s[s.NOT_FOUND=404]="NOT_FOUND",s[s.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR"}(Ei||(Ei={}));class ze extends Ke{constructor({token:r,traceId:a,code:c,tag:l,location:n,message:e,details:t,remoteParticipantId:i,requestUUID:o,fatal:u,nominal:d,action:h,count:_=1}){super({name:"StageClientError",message:e,code:c}),Error.captureStackTrace&&Error.captureStackTrace(this,ze),this.action=h,this.token=r,this.traceId=a,this.code=c,this.tag=l,this.location=n,this.message=e,this.details=t,this.remoteParticipantId=i,this.requestUUID=o,this.fatal=u,this.nominal=d,this.count=_}}const si="signalling_session",Xt="webrtc_sink",Ae="webrtc_unsink",ir="webrtc_source";function Pt(s,r){switch(s){case ve.PUBLISH:return Xt;case ve.SUBSCRIBE:return`webrtc_source:${r}`;default:return"unknown"}}function hn(s,r){var a,c,l,n;const e={code:s.code,message:`${s.message}: ${r.name} ${r.message}`,fatal:(a=s.fatal)!==null&&a!==void 0&&a,nominal:(c=s.nominal)!==null&&c!==void 0&&c};return r instanceof ze&&(e.fatal=(l=r.fatal)!==null&&l!==void 0&&l,e.nominal=(n=r.nominal)!==null&&n!==void 0&&n),e}function vr(s,r){if(s===0)return de.UNKNOWN_SERVER_ERROR;if(!(s<400))if(s>=400&&s<=403)switch(r){case At.TokenExpired:return de.EXPIRED_TOKEN;case At.NoPermissions:return de.TOKEN_PERMISSIONS_DENIED;case At.StageAtCapacity:return de.STAGE_AT_CAPACITY;case At.NoMatchingCodec:return de.NO_MATCHING_CODEC;default:return de.UNKNOWN_SERVER_ERROR}else{if(s===404)return r===At.RemoteStreamNotFound?de.REMOTE_STREAM_NOT_FOUND:de.UNKNOWN_SERVER_ERROR;if(s===412)return r===At.AbortedMHCPError?de.MHCP_ABORTED:de.UNKNOWN_SERVER_ERROR;if(s===429)return r===At.StageAuthThrottled?de.STAGE_AUTH_THROTTLED:de.WHIP_TOO_MANY_REQUESTS;if(s!==500)return de.UNKNOWN_SERVER_ERROR;switch(r){case At.InternalMHCPError:return de.INTERNAL_MHCP_ERROR;case At.UnreachableMHCP:return de.UNREACHABLE_MHCP;case At.InvalidSessionStatus:return de.INVALID_SESSION_STATUS;default:return de.INTERNAL_SERVER_ERROR}}}var At;(function(s){s[s.Unspecified=2001]="Unspecified",s[s.TokenExpired=2002]="TokenExpired",s[s.NoPermissions=2003]="NoPermissions",s[s.RemoteStreamNotFound=2004]="RemoteStreamNotFound",s[s.StageAtCapacity=2005]="StageAtCapacity",s[s.InternalMHCPError=2006]="InternalMHCPError",s[s.UncategorizedMHCPError=2007]="UncategorizedMHCPError",s[s.UnreachableMHCP=2008]="UnreachableMHCP",s[s.InvalidSessionStatus=2010]="InvalidSessionStatus",s[s.PostWithoutOptions=2011]="PostWithoutOptions",s[s.AbortedMHCPError=2012]="AbortedMHCPError",s[s.StageAuthThrottled=2013]="StageAuthThrottled",s[s.NoMatchingCodec=2014]="NoMatchingCodec"})(At||(At={}));const de={MALFORMED_TOKEN:{code:1e3,message:"Token is malformed",fatal:!0,nominal:!0},EXPIRED_TOKEN:{code:1001,message:"Token expired and is no longer valid",fatal:!0,nominal:!0},STAGE_DELETED:{code:1037,message:"Stage has been deleted",fatal:!0,nominal:!0},PARTICIPANT_DISCONNECTED:{code:1038,message:"Participant has been disconnected",fatal:!0,nominal:!0},JOIN_SERVER_INTERNAL_ERROR:{code:1039,message:"Internal server error during join",fatal:!1,nominal:!1},JOIN_SERVER_BAD_REQUEST:{code:1040,message:"Bad request during join",fatal:!0,nominal:!1},UNPUBLISH_FAILURE:{code:1013,message:"Failed to unpublish",fatal:!1,nominal:!1},UNSUBSCRIBE_FAILURE:{code:1014,message:"Failed to unsubscribe",fatal:!1,nominal:!1},PUBLISH_FAILURE:{code:1015,message:"Failed to publish",fatal:!1,nominal:!1},SUBSCRIBE_FAILURE:{code:1016,message:"Failed to subscribe",fatal:!1,nominal:!1},JOIN_FAILURE:{code:1017,message:"Failed to join",fatal:!0,nominal:!1},JOIN_TIMED_OUT:{code:1019,message:"Join timed out",fatal:!0,nominal:!1},PUBLISH_TIMED_OUT:{code:1020,message:"Publish timed out",fatal:!1,nominal:!1},SUBSCRIBE_TIMED_OUT:{code:1021,message:"Subscribe timed out",fatal:!1,nominal:!1},NO_CANDIDATES:{code:1022,message:"No ICE candidates",fatal:!1,nominal:!1},OPERATION_ABORTED:{code:1023,message:"Request aborted",fatal:!1,nominal:!0},STAGE_AT_CAPACITY:{code:1024,message:"Stage at capacity",fatal:!0,nominal:!0},INTERNAL_SERVER_ERROR:{code:1025,message:"Internal server error",fatal:!0,nominal:!1},TOKEN_PERMISSIONS_DENIED:{code:1026,message:"Token permissions are not valid for the operation",fatal:!0,nominal:!1},REMOTE_STREAM_NOT_FOUND:{code:1027,message:"Contributor group (PUBLISH) or remote stream (SUBSCRIBE) not found",fatal:!0,nominal:!1},INTERNAL_MHCP_ERROR:{code:1028,message:"Authorization failed due to internal MHCP error",fatal:!0,nominal:!1},UNCATEGORIZED_MHCP_ERROR:{code:1029,message:"Authorization failed due to uncategorized MHCP error",fatal:!0,nominal:!1},UNREACHABLE_MHCP:{code:1030,message:"Authorization failed due to MHCP unreachable",fatal:!0,nominal:!1},INVALID_SESSION_STATUS:{code:1031,message:"Stream has already been published (PUBLISH) or subscribed to (SUBSCRIBE)",fatal:!0,nominal:!1},POST_WITHOUT_OPTIONS:{code:1032,message:"Cannot POST without OPTIONS in mandatory TURN",fatal:!0,nominal:!1},MHCP_ABORTED:{code:1033,message:"Publisher state conflict",fatal:!0,nominal:!1},STAGE_AUTH_THROTTLED:{code:1034,message:"Too many requests",fatal:!1,nominal:!1},NO_MATCHING_CODEC:{code:1035,message:"No matching codec found",fatal:!0,nominal:!1},CHIME_MEETING_NOT_FOUND:{code:1098,message:"Meeting or Attendee was deleted",fatal:!0,nominal:!0},UNKNOWN_SERVER_ERROR:{code:1099,message:"Service error code unknown or not found",fatal:!0,nominal:!1},XDP_CONNECTION_LOST:{code:1221,message:"Connection lost during SDP exchange",fatal:!1,nominal:!1},XDP_INVALID_ANSWER_MSG:{code:1222,message:"Invalid answer message received by client",fatal:!1,nominal:!1},XDP_TIMEOUT:{code:1223,message:"Failed to receive SDP answer within timeout period",fatal:!1,nominal:!1},XDP_UNEXPECTED_ERROR:{code:1224,message:"Unexpected error encountered",fatal:!1,nominal:!1},WEBSOCKET_MESSAGE_PARSE_FAILURE:{code:1204,message:"Failed to parse websocket message",fatal:!1,nominal:!1},WHIP_SESSION_RESOURCE_DELETED:{code:1206,message:"WHIP signaling session resource not found",fatal:!0,nominal:!0},WHIP_TOO_MANY_REQUESTS:{code:1207,message:"WHIP endpoint received too many requests",fatal:!1,nominal:!1},WHIP_OPTIONS_FAILURE:{code:1501,message:"Failed to get ICE Servers from OPTIONS",fatal:!1,nominal:!1},WHIP_POST_FAILURE:{code:1502,message:"WHIP post failure",fatal:!1,nominal:!1},WHIP_DELETE_FAILURE:{code:1503,message:"WHIP delete failure",fatal:!1,nominal:!1},WHIP_URL_MISSING:{code:1504,message:"WHIP delete failure",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_FAILED:{code:1510,message:"Set layer request failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_THROTTLED:{code:1511,message:"Too many set layer requests",fatal:!1,nominal:!0},WHEP_GET_LAYER_STATE_FAILED:{code:1512,message:"Get layer state failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_GET_LAYER_STATE_THROTTLED:{code:1513,message:"Too many get layer state requests",fatal:!1,nominal:!0},EVENT_PLANE_WS_CREATE_FAILED:{code:1300,message:"Error creating WebSocket",fatal:!0,nominal:!1},EVENT_PLANE_WS_UNEXPECTED_CLOSE:{code:1302,message:"Unexpectedly not connected to event plane",fatal:!1,nominal:!1},EVENT_PLANE_PING_SEND_FAIL:{code:1303,message:"Ping send fail",fatal:!1,nominal:!1},EVENT_PLANE_PONG_TIMEOUT:{code:1304,message:"Pong timed out",fatal:!1,nominal:!1},EVENT_PLANE_WS_CLOSE_BEFORE_OPEN:{code:1305,message:"Connect attempt closed by server",fatal:!1,nominal:!1},PEER_CONNECTION_NETWORK_FAILURE:{code:1400,message:"PeerConnection is lost due to unknown network error",fatal:!1,nominal:!1},CREATE_OFFER_FAILURE:{code:1402,message:"Failed to set local description",fatal:!1,nominal:!1},CREATE_PEER_CONNECTION_FAILURE:{code:1403,message:"Failed to create a peer connection",fatal:!1,nominal:!1},ICE_CANDIDATE_ERROR:{code:1404,message:"ICE candidate error",fatal:!1,nominal:!1},SET_ANSWER_FAILURE:{code:1405,message:"Failed to set remote answer",fatal:!1,nominal:!1},NETWORK_FAILURE:{code:1406,message:"Failed due to network problem",fatal:!1,nominal:!1},SEI_INSERT_NOT_PUBLISHING_VIDEO:{code:1460,message:"SEI failed to insert due to not publishing video",fatal:!1,nominal:!0},SEI_INSERT_INBAND_NOT_ENABLED:{code:1461,message:"SEI failed to insert due to in-band messaging not being enabled",fatal:!1,nominal:!0},REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID:{code:1470,message:"Invalid participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID:{code:1471,message:"Invalid remote participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE:{code:1472,message:"Invalid subscriber peer connection state for reassignment",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS:{code:1473,message:"Request rejected because client is already processing a previous reassignment request",fatal:!1,nominal:!1},UNEXPECTED_ERROR:{code:9999,message:"Encountered unexpected error condition. Expected StageClientError type.",fatal:!1,nominal:!1},TRANSFORM_UNEXPECTED_ERROR:{code:1480,message:"Unexpected error occurred during transform execution",fatal:!1,nominal:!1},TRANSFORM_TOO_MANY_ERRORS:{code:1481,message:"Transformer encountered too many consecutive errors",fatal:!1,nominal:!1},TRANSFORM_NOT_SUPPORTED_BY_PLATFORM:{code:1482,message:"Transforms are not supported by this platform",fatal:!1,nominal:!1},CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR:{code:1490,message:"Unexpected error occurred when handling incompatible codecs",fatal:!1,nominal:!1}};var or;(function(s){s.UNPUBLISH="unpublish",s.UNSUBSCRIBE="unsubscribe",s.UNLOAD="unload",s.CONNECTION_FAIL="connection fail",s.REASSIGNMENT="reassignment"})(or||(or={}));const Il="stageJoined",cc="stageParticipantJoined",so="stageParticipantLeft",ci="stageParticipantKicked",yi="stageParticipantUpdated",iu="localPublishingChanged",ou="stageRefresh",_n="stateChange",Ia="error",_r="reassignmentRequest",an="incompatibleCodecs",Cs="connectionStateChange",Is="mediaStreamCreated",ui="mediaStreamRemoved",jn="error",uc="stageStreamSeiMessageReceived",au="transformError",co="reassignmentStarted",lc="reassignmentSuccess",bt="reassignmentFailed",Ra="open",wa="closed",wn="messageParseError",Oa="refresh",ar="error",sr="stageStateMessage",Rs="sdpAnswer",Mt="disconnectMessage",Aa="reassignmentMessage",Fu="incompatibleCodecs",Vu="ssu";function ka(s){return a=function(c){return c.replace(/-/g,"+").replace(/_/g,"/").padEnd(c.length+(4-c.length%4)%4,"=")}(s),window.atob(a);var a}class Gi{constructor(r,a){var c;this.analyticsTracker=a,this.rawToken=r;const l=r.split(".");if(l.length!==3)throw Error(`Token format incorrect. length: ${l.length}`);try{this.header=JSON.parse(ka(l[0]))}catch(t){const i=t instanceof Error?`: ${t.message}`:"";throw Error(`Error parsing Stage Token header${i}`)}try{this.claims=JSON.parse(ka(l[1]))}catch(t){const i=t instanceof Error?`: ${t.message}`:"";throw Error(`Error parsing Stage Token claims${i}`)}this.signature=l[2];const{claims:n}=this;this.stageARN=n.resource,this.customerId=(c=function(t){if(t.indexOf("arn:aws:")<0)return;const i=t.split(":");return i.length>=5?i[4]:void 0}(this.stageARN))!==null&&c!==void 0?c:"unknown",this.participantID=n.jti,this.eventsURL=n.events_url,this.whipURL=Mn("whipUrl")||n.whip_url,this.userID=n.user_id,this.expirationTime=n.exp,this.topic=n.topic,this.parseVersionFlags(n.version);const{attributes:e}=n;e&&(this.attrGsRole=e.gs_role,this.attrGsSessionId=e.gs_session_id)}getPublishEndpoint(){let r="";return this.whipURL&&this.participantID&&(r=`${this.whipURL}/publish/${this.participantID}`),r}getSubscribeEndpoint(r){let a="";return this.whipURL&&(a=`${this.whipURL}/subscribe/${r}`),a}assertTokenIsUnexpired(r,a,c,l){ln("disableTokenValidation")||(!this.expirationTime||Date.now()/1e3>=this.expirationTime)&&this.analyticsTracker.trackErrorAndThrow(new ze(Object.assign(Object.assign({},de.EXPIRED_TOKEN),{action:ve.JOIN,location:c,tag:a,token:this,traceId:r,remoteParticipantId:l,message:de.EXPIRED_TOKEN.message,details:`Token expired at ${this.expirationTime} and is no longer valid`})))}parseVersionFlags(r){if(!r)return;const a=r.split(".");a.length===2&&(this.versionFlags=parseInt(a[1],10))}shouldSendSilentAudio(){return this.versionFlags===void 0||!!(this.versionFlags&ai)}}function dc(s,r){return new Gi(s,r)}var bi;(function(s){s.PUBLISH="publish",s.SUBSCRIBE="subscribe"})(bi||(bi={}));class ws{constructor(r,a){this.throttleDuration=0,this.throttled=!1,this.timeout=0,this.unthrottle=()=>{this.trailing&&this.trailingFn&&this.trailingFn(...this.trailingFnArgs),this.clear()},this.throttleDuration=r,this.trailing=!(a&&a.skipTrailing)}invoke(r,...a){return this.throttled?(this.trailingFn=r,this.trailingFnArgs=a,!1):(this.throttled=!0,this.timeout=window.setTimeout(this.unthrottle,this.throttleDuration),r(...a),!0)}clear(){clearTimeout(this.timeout),this.timeout=0,this.throttled=!1,delete this.trailingFn,delete this.trailingFnArgs}}var Re=ue(8954);class hc extends ot{constructor(r,a,c,l,n,e,t,i){super(Fe.SERVER_REQUEST,a,t,!0),Object.assign(this.properties,{action:r,http_method:l,remote_participant_id:e,request_uuid:n,url:c,transport:i})}}const uo="draft-ietf-wish-whip-04";var On,Os=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};function fc(s,r){return Os(this,void 0,void 0,function*(){s.validateStatus=c=>c>=200&&c<300||c===403;const a=yield g()(s);if(a.status===403){if(a.data.code===2003)throw new ao.AxiosError("Request failed with status code 403","ERR_BAD_REQUEST",s,a.request,a);return s.url===a.request.responseURL?(s.validateStatus=c=>c>=200&&c<300,g()(s)):(s.url=a.request.responseURL,r<5?fc(s,r+1):(s.validateStatus=c=>c>=200&&c<300,g()(s)))}return a})}function su(s){return Os(this,void 0,void 0,function*(){return fc(s,0)})}function Vo(){}function Pa(s){switch(s){case"new":return xe.NEW;case"closed":return xe.CLOSED;case"disconnected":return xe.DISCONNECTED;case"failed":return xe.FAILED;case"idle":return xe.IDLE;case"checking":case"connecting":return xe.CONNECTING;case"completed":case"connected":return xe.CONNECTED;default:throw new Error(`unknown connecion state: ${s}`)}}function pc(s,r,a){let c=document.createElement(r);const l=()=>{c&&(c.removeEventListener("loadeddata",n),c.removeEventListener("error",l),c.srcObject=null,c.src="",c=null)},n=()=>{l(),a(r)};return c.addEventListener("loadeddata",n),c.addEventListener("error",l),c.srcObject=s,l}class lo extends ot{constructor(r,a,c,l,n){super(Fe.TRACE,r,a,!1),Object.assign(this.properties,{action:l,message:c,remote_participant_id:n})}}class gc extends ot{constructor(r,a,c,l,n){super(Fe.CONNECTION_STATE,a,c,!1),Object.assign(this.properties,{action:r,remote_participant_id:n,state:l})}}class mc extends ot{constructor(r,a,c,l,n){super(Fe.ICE_GATHERING_STATE,a,c,!1),Object.assign(this.properties,{action:r,remote_participant_id:n,state:l})}}(function(s){s.POST="post",s.CONNECTED="connected",s.ICE_GATHERING="icegathering",s.SDP_EXCHANGE="sdpExchange",s.SET_REMOTE_DESC="setRemoteDesc",s.PEER_CONNECTION="peerConnection"})(On||(On={}));const As="start",Da="stop";class ht{constructor(r,a){this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0,this.action=r,this.traceId=a}markActionStart(){this.markStart(On.CONNECTED)}markPostStart(){this.markStart(On.POST)}markPostStop(){this.markStop(On.POST),this.postDuration=this.measure(On.POST)}markIceGatheringStart(){this.markStart(On.ICE_GATHERING)}markIceGatheringStop(){this.markStop(On.ICE_GATHERING),this.timeToCandidate=this.measure(On.ICE_GATHERING)}markActionStop(){this.markStop(On.CONNECTED),this.timeToConnected=this.measure(On.CONNECTED),this.markStop(On.PEER_CONNECTION),this.peerConnectionDuration=this.measure(On.PEER_CONNECTION)}markSetRemoteDescStart(){this.markStart(On.SET_REMOTE_DESC)}markSetRemoteDescStop(){const r=On.SET_REMOTE_DESC;this.markStop(r),this.setRemoteDescDuration=this.measure(r),this.markStart(On.PEER_CONNECTION)}markSdpExchangeStart(){this.markStart(On.SDP_EXCHANGE)}markSdpExchangeStop(){const r=On.SDP_EXCHANGE;this.markStop(r),this.sdpExchangeDuration=this.measure(r)}setTransport(r){this.sdpExchangeTransport=r}markStart(r){this.marks[`${this.namespace}.${r}.${As}`]=performance.now()}markStop(r){this.marks[`${this.namespace}.${r}.${Da}`]=performance.now()}measure(r){const a=`${this.namespace}.${r}.${As}`,c=`${this.namespace}.${r}.${Da}`,l=this.marks[a],n=this.marks[c];return l===void 0||n===void 0?0:n-l}get namespace(){return`ivswb.peerclient.${this.action}.${this.traceId.value}`}getMeasurements(){const{optionsDuration:r,postDuration:a,timeToCandidate:c,timeToConnected:l,sdpExchangeDuration:n,sdpExchangeTransport:e,setRemoteDescDuration:t,peerConnectionDuration:i}=this;return{optionsDuration:r,postDuration:a,timeToCandidate:c,timeToConnected:l,sdpExchangeDuration:n,sdpExchangeTransport:e,setRemoteDescDuration:t,peerConnectionDuration:i}}resetMeasurements(r){this.traceId=r,this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0}}var at,Na,cr,Wi,Fn;(function(s){s.VIDEO="video",s.AUDIO="audio"})(at||(at={})),function(s){s.LOWEST_QUALITY="lowest_quality",s.HIGHEST_QUALITY="highest_quality"}(Na||(Na={})),function(s){s.HI="hi",s.MID="mid",s.LOW="low"}(cr||(cr={})),function(s){s.PORTRAIT="portrait",s.LANDSCAPE="landscape"}(Wi||(Wi={})),function(s){s.DEFAULT="default",s.LOW="low",s.MEDIUM="medium",s.HIGH="high"}(Fn||(Fn={}));var ho=ue(7363);class dt{constructor(r){this.sdp=r}static splitLines(r){return r.trim().split(`
`).map(a=>a.trim())}static splitSections(r){return r.split(`
m=`).map((a,c)=>(c>0?`m=${a}`:a).trim()+dt.CRLF)}getUniqueRtpHeaderExtensionId(r){const a=[];for(const l of r)if(/^a=extmap:/.test(l.trim())){const n=+l.split("a=extmap:")[1].split(" ")[0];a.includes(n)||a.push(n)}a.sort((l,n)=>l-n);let c=0;for(const l of a){if(l-c>1)return c+1;c=l}return c===14?-1:c+1}withVideoLayersAllocationRtpHeaderExtension(r){const a="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",c=r?r.getRtpHeaderExtensionId(a):-1,l=c===-1?this.getUniqueRtpHeaderExtensionId(dt.splitLines(this.sdp)):c,n=dt.splitSections(this.sdp),e=[];for(let i of n){if(/^m=video/.test(i)&&dt.getRtpHeaderExtensionIdInSection(i,a)===-1){const o=dt.splitLines(i),u=[];if(l===-1||this.hasRtpHeaderExtensionId(l)){e.push(i);continue}for(const d of o)if(u.push(d),/^a=sendrecv/.test(d.trim())){const h=`a=extmap:${l} ${a}`;u.push(h)}i=u.join(dt.CRLF)+dt.CRLF}else if(c!==-1&&/^m=video/.test(i)&&dt.getRtpHeaderExtensionIdInSection(i,a)!==c){const o=dt.splitLines(i),u=[];for(const d of o){if(/^a=extmap:/.test(d.trim())&&d.split("a=extmap:")[1].split(" ")[1]===a){if(!this.hasRtpHeaderExtensionId(c)){const h=`a=extmap:${c} ${a}`;u.push(h)}continue}u.push(d)}i=u.join(dt.CRLF)+dt.CRLF}e.push(i)}const t=e.join("");return new dt(t)}withOpusAudioConfig(r,a){const c=ho.qg(this.sdp);for(const l of c.media)if(l.type==="audio"){const{payload:n}=l.rtp.find(o=>o.codec==="opus");if(!n)continue;let e=l.fmtp.find(o=>o.payload===n);e||(e={payload:n,config:""});const t=ho.Sl(e.config);if(t.maxaveragebitrate=r,typeof a=="boolean"){const o=a?1:0;t["sprop-stereo"]=o,t.stereo=o}let i="";for(const o of Object.keys(t))i+=`${o}=${t[o]}; `;e.config=i.trim()}return new dt(ho.M9(c))}withoutAudioRtcpRSize(){var r;const a=ho.qg(this.sdp);for(const c of a.media){if(c.type!=="audio")continue;const l=tr()!==void 0,n=(r=tr())!==null&&r!==void 0&&r;l&&(c.rtcpRsize=n?void 0:"rtcp-rsize")}return new dt(ho.M9(a))}withFilteredCandidates(r){const a=ho.qg(this.sdp);return a.media.forEach(c=>{const l=c.candidates;if(l){const n=l.filter(e=>e.transport===r);c.candidates=n}}),new dt(ho.M9(a))}static getRtpHeaderExtensionIdInSection(r,a){const c=dt.splitLines(r);for(const l of c)if(/^a=extmap:/.test(l.trim())){const n=l.split("a=extmap:")[1].split(" "),e=+n[0];if(n[1]===a)return e}return-1}getRtpHeaderExtensionId(r){const a=dt.splitSections(this.sdp);for(const c of a)if(/^m=video/.test(c)){const l=dt.getRtpHeaderExtensionIdInSection(c,r);if(l!==-1)return l}return-1}hasRtpHeaderExtensionId(r){const a=dt.splitLines(this.sdp);for(const c of a)if(/^a=extmap:/.test(c.trim())&&+c.split("a=extmap:")[1].split(" ")[0]===r)return!0;return!1}hasAudioNacksEnabled(){var r,a,c;return((c=(a=((r=ho.qg(this.sdp).media.filter(l=>l.type==="audio")[0])!==null&&r!==void 0?r:{}).rtcpFb)===null||a===void 0?void 0:a.filter(l=>l.type==="nack"))!==null&&c!==void 0?c:[]).length>0}}function kr(s){const{config:r}=s;return[{maxBitrate:r.maxBitrateBps}]}dt.CRLF=`\r
`,dt.rfc7587LowestBitrate=6e3,dt.rfc7587HighestBitrate=51e4;function Pr(s){return 1e3*s}const Go=(s,...r)=>{const a=r.map(c=>typeof c!="object").filter(Boolean).length>0;if(typeof s=="object"&&!a)return(0,qt.merge)({},s,...r)},ks=s=>vc(s),vc=s=>(0,qt.cloneDeep)(s),ur=s=>{switch(s){case Na.HIGHEST_QUALITY:return"highest";case Na.LOWEST_QUALITY:default:return"lowest"}},Dt=s=>Object.freeze(s),Dr=Object.freeze({DEFAULT_1080:Dt({maxBitrateKbps:2500,maxFramerate:30,width:1920,height:1080}),INACTIVE:Dt({maxBitrateKbps:0,maxFramerate:0,width:0,height:0})}),Wo=Object.freeze({DEFAULT_720:Dt({maxBitrateKbps:2500,maxFramerate:30,width:1280,height:720}),DEFAULT_540:Dt({maxBitrateKbps:1400,maxFramerate:15,width:960,height:540}),DEFAULT_480:Dt({maxBitrateKbps:1100,maxFramerate:15,width:854,height:480}),DEFAULT_360:Dt({maxBitrateKbps:600,maxFramerate:15,width:640,height:360}),DEFAULT_270:Dt({maxBitrateKbps:350,maxFramerate:15,width:480,height:270}),DEFAULT_180:Dt({maxBitrateKbps:150,maxFramerate:15,width:320,height:180}),DEFAULT_160:Dt({maxBitrateKbps:120,maxFramerate:15,width:284,height:160})}),Hi=Object.freeze({HI:Dt(Object.assign({},Wo.DEFAULT_720)),MID:Dt(Object.assign(Object.assign({},Wo.DEFAULT_360),{maxBitrateKbps:700,maxFramerate:20})),LOW:Dt(Object.assign(Object.assign({},Wo.DEFAULT_180),{maxBitrateKbps:200,maxFramerate:15}))}),Ho=s=>({rid:s,active:!1,scaleFactor:_c(s),maxBitrateBps:Pr(Dr.INACTIVE.maxBitrateKbps),maxFramerate:Dr.INACTIVE.maxFramerate,width:Dr.INACTIVE.width,height:Dr.INACTIVE.height}),_c=s=>{switch(s){case cr.HI:return 1;case cr.MID:return 2;case cr.LOW:return 4;default:return 1}},Ti=50,zr=2500,$i=10,Ln=30,li=160,Nr=1280,zi=720*Nr,Ps=16/9,$o=12,fo=128,Sc=64,cu={[Fn.DEFAULT]:0,[Fn.LOW]:50,[Fn.MEDIUM]:150,[Fn.HIGH]:250},uu={[Fn.DEFAULT]:0,[Fn.LOW]:100,[Fn.MEDIUM]:200,[Fn.HIGH]:300};function lr(s){const{outbound:r,remoteInbound:a,networkQuality:c}=s;return{networkQuality:c,nackCount:r.nackCount,packetsSent:r.packetsSent,packetsLost:a==null?void 0:a.packetsLost,retransmittedPacketsSent:r.retransmittedPacketsSent,bytesSent:r.bytesSent,headerBytesSent:r.headerBytesSent,retransmittedBytesSent:r.retransmittedBytesSent,totalPacketSendDelay:r.totalPacketSendDelay}}function fn(s){var r,a,c;const{outbound:l,remoteInbound:n,networkQuality:e}=s;return{networkQuality:e,nackCount:l.nackCount,packetsSent:l.packetsSent,packetsLost:n==null?void 0:n.packetsLost,retransmittedPacketsSent:l.retransmittedPacketsSent,bytesSent:l.bytesSent,headerBytesSent:l.headerBytesSent,retransmittedBytesSent:l.retransmittedBytesSent,totalPacketSendDelay:l.totalPacketSendDelay,firCount:l.firCount,pliCount:l.pliCount,framesEncoded:l.framesEncoded,keyFramesEncoded:l.keyFramesEncoded,totalEncodeTime:l.totalEncodeTime,totalEncodedBytesTarget:l.totalEncodedBytesTarget,framesSent:l.framesSent,hugeFramesSent:l.hugeFramesSent,active:((r=l.framesPerSecond)!==null&&r!==void 0?r:0)!==0,qualityLimitationReason:l.qualityLimitationReason,qualityLimitationResolutionChanges:l.qualityLimitationResolutionChanges,qualityLimitationCpuDuration:(a=l.qualityLimitationDurations)===null||a===void 0?void 0:a.cpu,qualityLimitationBandwidthDuration:(c=l.qualityLimitationDurations)===null||c===void 0?void 0:c.bandwidth,frameWidth:l.frameWidth,frameHeight:l.frameHeight,framesPerSecond:l.framesPerSecond,rid:l.rid,ssrc:l.ssrc}}function Sr(s,r){const a=new Map,c=new Map;for(const l of r.values())if(l.kind===s&&l.type==="outbound-rtp"&&l.ssrc){const n=l.rid||zn;c.set(l.ssrc,n);let e=a.get(n);e||(e={},a.set(n,e)),e.outbound=l}for(const l of r.values())if(l.kind===s&&l.type==="remote-inbound-rtp"&&l.ssrc){const n=c.get(l.ssrc)||zn,e=a.get(n);e&&(e.remoteInbound=l)}return a}function Ci(s,r){const a=new Map;for(const c of r.values())if(c.kind===s&&c.type==="inbound-rtp"){const l=c.rid||zn;a.set(l,{inbound:c})}return a}function Ii(s,r){return s!==In.DOWN&&r!=null?r:s}const lu=(s,r)=>{const a=[],c=nr.getNetworkQuality(),l=Sr("audio",s);for(const n of l.values())if(n.outbound){const e=n.outbound.rid||zn,t=Ii(c,r.get(e)),i=lr({outbound:n.outbound,remoteInbound:n.remoteInbound,networkQuality:t});a.push(i)}if(a.length)return a},du=(s,r)=>{const a=[],c=nr.getNetworkQuality(),l=Sr("video",s);for(const n of l.values())if(n.outbound){const e=n.outbound.rid||zn,t=fn({outbound:n.outbound,remoteInbound:n.remoteInbound});if(t.active){const i=Ii(c,r.get(e));t.networkQuality=i}a.push(t)}if(a.length)return a},zo=(s,r)=>{const a=[],c=nr.getNetworkQuality(),l=Ci("audio",s);for(const e of l.values())if(e.inbound){const t=e.inbound.id;if(!t)continue;const i=Ii(c,r.get(t)),o={networkQuality:(n={inbound:e.inbound,networkQuality:i}).networkQuality,nackCount:n.inbound.nackCount,packetsReceived:n.inbound.packetsReceived,packetsLost:n.inbound.packetsLost,packetsDiscarded:n.inbound.packetsDiscarded,bytesReceived:n.inbound.bytesReceived,headerBytesReceived:n.inbound.headerBytesReceived,jitterBufferDelay:n.inbound.jitterBufferDelay,jitterBufferEmittedCount:n.inbound.jitterBufferEmittedCount,jitter:n.inbound.jitter,totalSamplesReceived:n.inbound.totalSamplesReceived,concealedSamples:n.inbound.concealedSamples,silentConcealedSamples:n.inbound.silentConcealedSamples,concealmentEvents:n.inbound.concealmentEvents,insertedSamplesForDeceleration:n.inbound.insertedSamplesForDeceleration,removedSamplesForAcceleration:n.inbound.removedSamplesForAcceleration,audioLevel:n.inbound.audioLevel};a.push(o)}var n;if(a.length)return a},Ri=(s,r)=>{const a=[],c=nr.getNetworkQuality(),l=Ci("video",s);for(const e of l.values())if(e.inbound){const t=e.inbound.id;if(!t)continue;const i={networkQuality:(n={inbound:e.inbound,networkQuality:Ii(c,r.get(t))}).networkQuality,nackCount:n.inbound.nackCount,packetsReceived:n.inbound.packetsReceived,packetsLost:n.inbound.packetsLost,packetsDiscarded:n.inbound.packetsDiscarded,bytesReceived:n.inbound.bytesReceived,headerBytesReceived:n.inbound.headerBytesReceived,jitterBufferDelay:n.inbound.jitterBufferDelay,jitterBufferEmittedCount:n.inbound.jitterBufferEmittedCount,jitter:n.inbound.jitter,pliCount:n.inbound.pliCount,firCount:n.inbound.firCount,framesReceived:n.inbound.framesReceived,framesDecoded:n.inbound.framesDecoded,keyFramesDecoded:n.inbound.keyFramesDecoded,framesDropped:n.inbound.framesDropped,totalDecodeTime:n.inbound.totalDecodeTime,totalInterFrameDelay:n.inbound.totalInterFrameDelay,totalSquaredInterFrameDelay:n.inbound.totalSquaredInterFrameDelay,pauseCount:n.inbound.pauseCount,totalPausesDuration:n.inbound.totalPausesDuration,freezeCount:n.inbound.freezeCount,totalFreezesDuration:n.inbound.totalFreezesDuration,frameWidth:n.inbound.frameWidth,frameHeight:n.inbound.frameHeight,framesPerSecond:n.inbound.framesPerSecond,ssrc:n.inbound.ssrc};a.push(i)}var n;if(a.length)return a};var Ma=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};const Ec="H264",La=s=>{const r=s==null?void 0:s.split("/");if((r==null?void 0:r.length)===2)return r[1]},Er=(s,r)=>{const a=La(s);if(s===void 0||a===void 0)return;const c={mimeSubtype:a};if(r){const l=(n=>{const e=n.split(";"),t=new Map;for(const i of e){const[o,u]=i.split("=");t.set(o,u)}return t})(r);switch(a){case Ec:{const n=l.get("profile-level-id");n&&((e,t)=>{if(t.length<6)return;const i=t.substring(0,4),o=parseInt(t.substring(4,6),16);e.profile=i,e.level=o})(c,n);break}case"H265":((n,e)=>{const t=e.get("profile-id")||"0",i=e.get("tier-flag")||"0",o=parseInt(e.get("level-id")||"0",10),u=[i,t].join("_");n.profile=u,n.level=o})(c,l)}}return c},xa=(s,r)=>s.sort((a,c)=>{if(La(a.mimeType)===Ec){const l=Er(a.mimeType,a.sdpFmtpLine);if((l==null?void 0:l.profile)===r)return-1}return 0}),qo=(s,r)=>{var a;const c=Er(s.mimeType,s.sdpFmtpLine);return(c==null?void 0:c.mimeSubtype.toLowerCase())===r.mime.toLowerCase()&&((a=c==null?void 0:c.profile)===null||a===void 0?void 0:a.toLowerCase().indexOf(r.config.toLowerCase()))===0},Ba=(s,r)=>r.filter(a=>!a.mimeType.endsWith("rtx")).filter(a=>a.mimeType.indexOf("packetization-mode=0")===-1).find(a=>s.reduce((c,l)=>c&&qo(a,l)===!1,!0));class Ds extends ot{constructor(r,a,c,l,n,e,t,i,o){var u,d;super(Fe.PUBLISHED_VIDEO_STATS,r,a,!1),Object.assign(this.properties,Object.assign({action:ve.PUBLISH,node:(u=c==null?void 0:c.node)!==null&&u!==void 0?u:"",cluster:(d=c==null?void 0:c.cluster)!==null&&d!==void 0?d:""},((h,_,T,C,R,w)=>{var P,U,j,B,$,K,Q,oe,ce,ae,te,pe,be,Ce,_e,Se,Le,et,vt,Et,mt,It,en,Ht,Ut,xt,Nt,jt,rn,kt,Pn,xr,br;const vi=(U=(P=h==null?void 0:h.qualityLimitationDurations)===null||P===void 0?void 0:P.cpu)!==null&&U!==void 0?U:0,_i=(B=(j=h==null?void 0:h.qualityLimitationDurations)===null||j===void 0?void 0:j.bandwidth)!==null&&B!==void 0?B:0,Br=Math.max(($=h==null?void 0:h.bytesSent)!==null&&$!==void 0?$:0,0),Xi=8*Br/(w??1),Di=Math.max((K=_==null?void 0:_.packetsLost)!==null&&K!==void 0?K:0,0),Zi=Math.max((Q=h==null?void 0:h.packetsSent)!==null&&Q!==void 0?Q:0,0),yo=Di/Math.max(Zi,1),Xr=Er(C==null?void 0:C.mimeType,C==null?void 0:C.sdpFmtpLine);return{active:!!(h!=null&&h.framesPerSecond)&&h.framesPerSecond!==0,bytes_sent:Br,codec_mime_type:Xr==null?void 0:Xr.mimeSubtype,codec_profile:Xr==null?void 0:Xr.profile,codec_level:Xr==null?void 0:Xr.level,configured_bitrate:R==null?void 0:R.max_bitrate,connection_bandwidth:(ce=(oe=T==null?void 0:T.candidatePair)===null||oe===void 0?void 0:oe.availableOutgoingBitrate)!==null&&ce!==void 0?ce:0,encode_bitrate:Xi,encoder_implementation:(ae=h==null?void 0:h.encoderImplementation)!==null&&ae!==void 0?ae:"unknown",fir_count:(te=h==null?void 0:h.firCount)!==null&&te!==void 0?te:0,fraction_packets_lost:yo,frame_height:Math.max((pe=h==null?void 0:h.frameHeight)!==null&&pe!==void 0?pe:0,0),frame_width:Math.max((be=h==null?void 0:h.frameWidth)!==null&&be!==void 0?be:0,0),frames_encoded:(Ce=h==null?void 0:h.framesEncoded)!==null&&Ce!==void 0?Ce:0,frames_per_second:Math.max((_e=h==null?void 0:h.framesPerSecond)!==null&&_e!==void 0?_e:0,0),frames_sent:(Se=h==null?void 0:h.framesSent)!==null&&Se!==void 0?Se:0,header_bytes_sent:(Le=h==null?void 0:h.headerBytesSent)!==null&&Le!==void 0?Le:0,huge_frames_sent:(et=h==null?void 0:h.hugeFramesSent)!==null&&et!==void 0?et:0,key_frames_encoded:(vt=h==null?void 0:h.keyFramesEncoded)!==null&&vt!==void 0?vt:0,nack_count:(Et=h==null?void 0:h.nackCount)!==null&&Et!==void 0?Et:0,packets_lost:Di,packets_sent:Zi,power_efficient_encoder:(mt=h==null?void 0:h.powerEfficientEncoder)!==null&&mt!==void 0&&mt,pli_count:(It=h==null?void 0:h.pliCount)!==null&&It!==void 0?It:0,quality_limitation_reason:(en=h==null?void 0:h.qualityLimitationReason)!==null&&en!==void 0?en:"none",quality_limitation_resolution_changes:(Ht=h==null?void 0:h.qualityLimitationResolutionChanges)!==null&&Ht!==void 0?Ht:0,quality_limitation_cpu_duration:vi,quality_limitation_bandwidth_duration:_i,retransmitted_bytes_sent:(Ut=h==null?void 0:h.retransmittedBytesSent)!==null&&Ut!==void 0?Ut:0,retransmitted_packets_sent:(xt=h==null?void 0:h.retransmittedPacketsSent)!==null&&xt!==void 0?xt:0,rid:(Nt=h==null?void 0:h.rid)!==null&&Nt!==void 0?Nt:zn,scalability_mode:(jt=h==null?void 0:h.scalabilityMode)!==null&&jt!==void 0?jt:"unknown",target_bitrate:Math.max((rn=h==null?void 0:h.targetBitrate)!==null&&rn!==void 0?rn:0,0),total_encode_time:(kt=h==null?void 0:h.totalEncodeTime)!==null&&kt!==void 0?kt:0,total_encoded_bytes_target:(Pn=h==null?void 0:h.totalEncodedBytesTarget)!==null&&Pn!==void 0?Pn:0,total_packet_send_delay:(xr=h==null?void 0:h.totalPacketSendDelay)!==null&&xr!==void 0?xr:0,protocol:(br=T==null?void 0:T.localCandidate)===null||br===void 0?void 0:br.protocol}})(l,n,e,t,i,o)))}}class Ns extends ot{constructor(r,a,c,l,n,e,t,i,o,u,d,h){var _,T,C,R;super(Fe.PUBLISHED_VIDEO_STATS_WINDOW,r,a,!1);const w=Math.max(((_=l==null?void 0:l.timestamp)!==null&&_!==void 0?_:0)-((T=n==null?void 0:n.timestamp)!==null&&T!==void 0?T:0),0);Object.assign(this.properties,Object.assign({action:ve.PUBLISH,node:(C=c==null?void 0:c.node)!==null&&C!==void 0?C:"",cluster:(R=c==null?void 0:c.cluster)!==null&&R!==void 0?R:"",window_size_ms:w},((P,U,j,B,$,K,Q,oe,ce,ae)=>{var te,pe,be,Ce,_e,Se,Le,et,vt,Et,mt,It,en,Ht,Ut,xt,Nt,jt,rn,kt,Pn,xr,br,vi,_i,Br,Xi,Di,Zi,yo,Xr,Qa,$s,aa,Xa,zs,Za,es,qs,ts,ns,rs,cl,ul,ll,dl,zl,ql,Kl,Jl,ku,hl,Yl,is;const Zl=(pe=(te=P==null?void 0:P.qualityLimitationDurations)===null||te===void 0?void 0:te.cpu)!==null&&pe!==void 0?pe:0,Ql=(Ce=(be=U==null?void 0:U.qualityLimitationDurations)===null||be===void 0?void 0:be.cpu)!==null&&Ce!==void 0?Ce:0,Xl=(Se=(_e=P==null?void 0:P.qualityLimitationDurations)===null||_e===void 0?void 0:_e.bandwidth)!==null&&Se!==void 0?Se:0,cd=(et=(Le=U==null?void 0:U.qualityLimitationDurations)===null||Le===void 0?void 0:Le.bandwidth)!==null&&et!==void 0?et:0,td=Math.max(((vt=P==null?void 0:P.bytesSent)!==null&&vt!==void 0?vt:0)-((Et=U==null?void 0:U.bytesSent)!==null&&Et!==void 0?Et:0),0),nd=typeof oe!="number"?1:oe/1e3,ud=8*td/nd,rd=Math.max(((mt=j==null?void 0:j.packetsLost)!==null&&mt!==void 0?mt:0)-((It=B==null?void 0:B.packetsLost)!==null&&It!==void 0?It:0),0),id=Math.max(((en=P==null?void 0:P.packetsSent)!==null&&en!==void 0?en:0)-((Ht=U==null?void 0:U.packetsSent)!==null&&Ht!==void 0?Ht:0),0),ld=rd/Math.max(id,1),fl=Er(K==null?void 0:K.mimeType,K==null?void 0:K.sdpFmtpLine),dd=8*(ae||0)/nd;return{active:!!(P!=null&&P.framesPerSecond)&&(P==null?void 0:P.framesPerSecond)!==0,bytes_sent:td,codec_mime_type:fl==null?void 0:fl.mimeSubtype,codec_profile:fl==null?void 0:fl.profile,codec_level:fl==null?void 0:fl.level,configured_bitrate:Q==null?void 0:Q.max_bitrate,connection_bandwidth:(xt=(Ut=$==null?void 0:$.candidatePair)===null||Ut===void 0?void 0:Ut.availableOutgoingBitrate)!==null&&xt!==void 0?xt:0,encode_bitrate:ud,encoder_implementation:(Nt=P==null?void 0:P.encoderImplementation)!==null&&Nt!==void 0?Nt:"unknown",fir_count:Math.max(((jt=P==null?void 0:P.firCount)!==null&&jt!==void 0?jt:0)-((rn=U==null?void 0:U.firCount)!==null&&rn!==void 0?rn:0),0),fraction_packets_lost:ld,frame_height:Math.max((kt=P==null?void 0:P.frameHeight)!==null&&kt!==void 0?kt:0,0),frame_width:Math.max((Pn=P==null?void 0:P.frameWidth)!==null&&Pn!==void 0?Pn:0,0),frames_encoded:Math.max(((xr=P==null?void 0:P.framesEncoded)!==null&&xr!==void 0?xr:0)-((br=U==null?void 0:U.framesEncoded)!==null&&br!==void 0?br:0),0),frames_per_second:Math.max((vi=P==null?void 0:P.framesPerSecond)!==null&&vi!==void 0?vi:0,0),frames_sent:Math.max(((_i=P==null?void 0:P.framesSent)!==null&&_i!==void 0?_i:0)-((Br=U==null?void 0:U.framesSent)!==null&&Br!==void 0?Br:0),0),header_bytes_sent:Math.max(((Xi=P==null?void 0:P.headerBytesSent)!==null&&Xi!==void 0?Xi:0)-((Di=U==null?void 0:U.headerBytesSent)!==null&&Di!==void 0?Di:0),0),huge_frames_sent:Math.max(((Zi=P==null?void 0:P.hugeFramesSent)!==null&&Zi!==void 0?Zi:0)-((yo=U==null?void 0:U.hugeFramesSent)!==null&&yo!==void 0?yo:0),0),key_frames_encoded:Math.max(((Xr=P==null?void 0:P.keyFramesEncoded)!==null&&Xr!==void 0?Xr:0)-((Qa=U==null?void 0:U.keyFramesEncoded)!==null&&Qa!==void 0?Qa:0),0),nack_count:Math.max((($s=P==null?void 0:P.nackCount)!==null&&$s!==void 0?$s:0)-((aa=U==null?void 0:U.nackCount)!==null&&aa!==void 0?aa:0),0),packets_lost:rd,packets_sent:id,power_efficient_encoder:(Xa=P==null?void 0:P.powerEfficientEncoder)!==null&&Xa!==void 0&&Xa,pli_count:Math.max(((zs=P==null?void 0:P.pliCount)!==null&&zs!==void 0?zs:0)-((Za=U==null?void 0:U.pliCount)!==null&&Za!==void 0?Za:0),0),quality_limitation_reason:(es=P==null?void 0:P.qualityLimitationReason)!==null&&es!==void 0?es:"none",quality_limitation_resolution_changes:Math.max(((qs=P==null?void 0:P.qualityLimitationResolutionChanges)!==null&&qs!==void 0?qs:0)-((ts=U==null?void 0:U.qualityLimitationResolutionChanges)!==null&&ts!==void 0?ts:0),0),quality_limitation_cpu_duration:Math.max(Zl-Ql,0),quality_limitation_bandwidth_duration:Math.max(Xl-cd,0),retransmitted_bytes_sent:Math.max(((ns=P==null?void 0:P.retransmittedBytesSent)!==null&&ns!==void 0?ns:0)-((rs=U==null?void 0:U.retransmittedBytesSent)!==null&&rs!==void 0?rs:0),0),rid:(cl=P==null?void 0:P.rid)!==null&&cl!==void 0?cl:zn,retransmitted_packets_sent:Math.max(((ul=P==null?void 0:P.retransmittedPacketsSent)!==null&&ul!==void 0?ul:0)-((ll=U==null?void 0:U.retransmittedPacketsSent)!==null&&ll!==void 0?ll:0),0),scalability_mode:(dl=P==null?void 0:P.scalabilityMode)!==null&&dl!==void 0?dl:"unknown",target_bitrate:Math.max((zl=P==null?void 0:P.targetBitrate)!==null&&zl!==void 0?zl:0,0),total_encode_time:Math.max(((ql=P==null?void 0:P.totalEncodeTime)!==null&&ql!==void 0?ql:0)-((Kl=U==null?void 0:U.totalEncodeTime)!==null&&Kl!==void 0?Kl:0),0),total_encoded_bytes_target:Math.max(((Jl=P==null?void 0:P.totalEncodedBytesTarget)!==null&&Jl!==void 0?Jl:0)-((ku=U==null?void 0:U.totalEncodedBytesTarget)!==null&&ku!==void 0?ku:0),0),total_packet_send_delay:Math.max(((hl=P==null?void 0:P.totalPacketSendDelay)!==null&&hl!==void 0?hl:0)-((Yl=U==null?void 0:U.totalPacketSendDelay)!==null&&Yl!==void 0?Yl:0),0),sei_write_count:ce,sei_bytes_sent:ae,sei_bitrate:dd,protocol:(is=$==null?void 0:$.localCandidate)===null||is===void 0?void 0:is.protocol}})(l,n,e,t,i,o,u,w,d,h)))}}class Ms extends ot{constructor(r,a,c,l,n,e,t,i,o,u){var d,h;super(Fe.PUBLISHED_AUDIO_STATS,r,a,!1),Object.assign(this.properties,Object.assign({action:ve.PUBLISH,node:(d=c==null?void 0:c.node)!==null&&d!==void 0?d:"",cluster:(h=c==null?void 0:c.cluster)!==null&&h!==void 0?h:""},((_,T,C,R,w,P,U)=>{var j,B,$,K,Q,oe,ce,ae,te,pe,be,Ce,_e;const Se=Math.max((j=_==null?void 0:_.bytesSent)!==null&&j!==void 0?j:0,0),Le=8*Se/(P??1),et=Math.max((B=T==null?void 0:T.packetsLost)!==null&&B!==void 0?B:0,0),vt=Math.max(($=_==null?void 0:_.packetsSent)!==null&&$!==void 0?$:0,0),Et=et/Math.max(vt,1),mt=Er(R==null?void 0:R.mimeType,R==null?void 0:R.sdpFmtpLine);return{audio_nacks_enabled:(K=U==null?void 0:U.audioNacks)!==null&&K!==void 0&&K,bytes_sent:Se,codec_mime_type:mt==null?void 0:mt.mimeSubtype,configured_bitrate:(Q=w==null?void 0:w.max_audio_bitrate_bps)!==null&&Q!==void 0?Q:0,connection_bandwidth:(ce=(oe=C==null?void 0:C.candidatePair)===null||oe===void 0?void 0:oe.availableOutgoingBitrate)!==null&&ce!==void 0?ce:0,encode_bitrate:Le,fraction_packets_lost:Et,header_bytes_sent:(ae=_==null?void 0:_.headerBytesSent)!==null&&ae!==void 0?ae:0,nack_count:(te=_==null?void 0:_.nackCount)!==null&&te!==void 0?te:0,packets_lost:et,packets_sent:vt,retransmitted_bytes_sent:(pe=_==null?void 0:_.retransmittedBytesSent)!==null&&pe!==void 0?pe:0,retransmitted_packets_sent:(be=_==null?void 0:_.retransmittedPacketsSent)!==null&&be!==void 0?be:0,target_bitrate:(Ce=_==null?void 0:_.targetBitrate)!==null&&Ce!==void 0?Ce:0,protocol:(_e=C==null?void 0:C.localCandidate)===null||_e===void 0?void 0:_e.protocol}})(l,n,e,t,i,o,u)))}}class yc extends ot{constructor(r,a,c,l,n,e,t,i,o,u,d){var h,_,T,C;super(Fe.PUBLISHED_AUDIO_STATS_WINDOW,r,a,!1);const R=Math.max(((h=l==null?void 0:l.timestamp)!==null&&h!==void 0?h:0)-((_=n==null?void 0:n.timestamp)!==null&&_!==void 0?_:0),0);Object.assign(this.properties,Object.assign({action:ve.PUBLISH,node:(T=c==null?void 0:c.node)!==null&&T!==void 0?T:"",cluster:(C=c==null?void 0:c.cluster)!==null&&C!==void 0?C:"",window_size_ms:R},((w,P,U,j,B,$,K,Q,oe)=>{var ce,ae,te,pe,be,Ce,_e,Se,Le,et,vt,Et,mt,It,en,Ht,Ut,xt,Nt,jt,rn,kt;const Pn=Math.max(((ce=w==null?void 0:w.bytesSent)!==null&&ce!==void 0?ce:0)-((ae=P==null?void 0:P.bytesSent)!==null&&ae!==void 0?ae:0),0),xr=8*Pn/(typeof Q!="number"?1:Q/1e3),br=Math.max(((te=U==null?void 0:U.packetsLost)!==null&&te!==void 0?te:0)-((pe=j==null?void 0:j.packetsLost)!==null&&pe!==void 0?pe:0),0),vi=Math.max(((be=w==null?void 0:w.packetsSent)!==null&&be!==void 0?be:0)-((Ce=P==null?void 0:P.packetsSent)!==null&&Ce!==void 0?Ce:0),0),_i=br/Math.max(vi,1),Br=Er($==null?void 0:$.mimeType,$==null?void 0:$.sdpFmtpLine);return{audio_nacks_enabled:(_e=oe==null?void 0:oe.audioNacks)!==null&&_e!==void 0&&_e,bytes_sent:Pn,codec_mime_type:Br==null?void 0:Br.mimeSubtype,configured_bitrate:(Se=K==null?void 0:K.max_audio_bitrate_bps)!==null&&Se!==void 0?Se:0,connection_bandwidth:(et=(Le=B==null?void 0:B.candidatePair)===null||Le===void 0?void 0:Le.availableOutgoingBitrate)!==null&&et!==void 0?et:0,encode_bitrate:xr,fraction_packets_lost:_i,header_bytes_sent:Math.max(((vt=w==null?void 0:w.headerBytesSent)!==null&&vt!==void 0?vt:0)-((Et=P==null?void 0:P.headerBytesSent)!==null&&Et!==void 0?Et:0),0),nack_count:Math.max(((mt=w==null?void 0:w.nackCount)!==null&&mt!==void 0?mt:0)-((It=P==null?void 0:P.nackCount)!==null&&It!==void 0?It:0),0),packets_lost:br,packets_sent:Math.max(((en=w==null?void 0:w.packetsSent)!==null&&en!==void 0?en:0)-((Ht=P==null?void 0:P.packetsSent)!==null&&Ht!==void 0?Ht:0),0),retransmitted_bytes_sent:Math.max(((Ut=w==null?void 0:w.retransmittedBytesSent)!==null&&Ut!==void 0?Ut:0)-((xt=P==null?void 0:P.retransmittedBytesSent)!==null&&xt!==void 0?xt:0),0),retransmitted_packets_sent:Math.max(((Nt=w==null?void 0:w.retransmittedPacketsSent)!==null&&Nt!==void 0?Nt:0)-((jt=P==null?void 0:P.retransmittedPacketsSent)!==null&&jt!==void 0?jt:0),0),target_bitrate:Math.max((rn=w==null?void 0:w.targetBitrate)!==null&&rn!==void 0?rn:0,0),protocol:(kt=B==null?void 0:B.localCandidate)===null||kt===void 0?void 0:kt.protocol}})(l,n,e,t,i,o,u,R,d)))}}class hu extends ot{constructor(r,a,c,l,n,e,t,i){var o,u;super(Fe.SUBSCRIBED_VIDEO_STATS,r,a,!1),Object.assign(this.properties,Object.assign({action:ve.SUBSCRIBE,node:(o=l==null?void 0:l.node)!==null&&o!==void 0?o:"",cluster:(u=l==null?void 0:l.cluster)!==null&&u!==void 0?u:"",remote_participant_id:c},((d,h,_,T)=>{var C,R,w,P,U,j,B,$,K,Q,oe,ce,ae,te,pe,be,Ce,_e,Se,Le,et,vt,Et,mt;let It=0;d!=null&&d.jitterBufferDelay&&(d!=null&&d.jitterBufferEmittedCount)&&d.jitterBufferEmittedCount>0&&(It=d.jitterBufferDelay/d.jitterBufferEmittedCount);const en=T??1,Ht=Math.max((C=d==null?void 0:d.bytesReceived)!==null&&C!==void 0?C:0,0),Ut=8*Ht/en;let xt=0;d!=null&&d.totalDecodeTime&&(d!=null&&d.framesDecoded)&&(xt=d.totalDecodeTime/Math.max(d==null?void 0:d.framesDecoded,1));const Nt=Math.max((R=d==null?void 0:d.packetsLost)!==null&&R!==void 0?R:0,0),jt=Math.max((w=d==null?void 0:d.packetsReceived)!==null&&w!==void 0?w:0,0),rn=Nt/Math.max(jt+Nt,1),kt=Er(_==null?void 0:_.mimeType,_==null?void 0:_.sdpFmtpLine);return{bytes_received:Ht,codec_mime_type:kt==null?void 0:kt.mimeSubtype,codec_profile:kt==null?void 0:kt.profile,codec_level:kt==null?void 0:kt.level,connection_bandwidth:(U=(P=h==null?void 0:h.candidatePair)===null||P===void 0?void 0:P.availableIncomingBitrate)!==null&&U!==void 0?U:0,decode_bitrate:Ut,decoder_implementation:(j=d==null?void 0:d.decoderImplementation)!==null&&j!==void 0?j:"unknown",fir_count:Math.max((B=d==null?void 0:d.firCount)!==null&&B!==void 0?B:0,0),fraction_packets_lost:rn,frame_decode_time_avg:xt,frame_height:Math.max(($=d==null?void 0:d.frameHeight)!==null&&$!==void 0?$:0,0),frame_width:Math.max((K=d==null?void 0:d.frameWidth)!==null&&K!==void 0?K:0,0),frames_decoded:Math.max((Q=d==null?void 0:d.framesDecoded)!==null&&Q!==void 0?Q:0,0),frames_dropped:Math.max((oe=d==null?void 0:d.framesDropped)!==null&&oe!==void 0?oe:0,0),frames_received:Math.max((ce=d==null?void 0:d.framesReceived)!==null&&ce!==void 0?ce:0,0),freeze_count:Math.max((ae=d==null?void 0:d.freezeCount)!==null&&ae!==void 0?ae:0,0),frames_rendered:Math.max((te=d==null?void 0:d.framesRendered)!==null&&te!==void 0?te:0,0),frames_per_second:Math.max((pe=d==null?void 0:d.framesPerSecond)!==null&&pe!==void 0?pe:0,0),header_bytes_received:Math.max((be=d==null?void 0:d.headerBytesReceived)!==null&&be!==void 0?be:0,0),jitter_buffer_delay_avg:It,key_frames_decoded:Math.max((Ce=d==null?void 0:d.keyFramesDecoded)!==null&&Ce!==void 0?Ce:0,0),nack_count:Math.max((_e=d==null?void 0:d.nackCount)!==null&&_e!==void 0?_e:0,0),packets_discarded:Math.max((Se=d==null?void 0:d.packetsDiscarded)!==null&&Se!==void 0?Se:0,0),packets_lost:Nt,packets_received:jt,pause_count:Math.max((Le=d==null?void 0:d.pauseCount)!==null&&Le!==void 0?Le:0,0),pli_count:Math.max((et=d==null?void 0:d.pliCount)!==null&&et!==void 0?et:0,0),power_efficient_decoder:(vt=d==null?void 0:d.powerEfficientDecoder)!==null&&vt!==void 0&&vt,total_freezes_duration:Math.max((Et=d==null?void 0:d.totalFreezesDuration)!==null&&Et!==void 0?Et:0,0),total_pauses_duration:Math.max((mt=d==null?void 0:d.totalPausesDuration)!==null&&mt!==void 0?mt:0,0)}})(n,e,t,i)))}}class Gu extends ot{constructor(r,a,c,l,n,e,t,i,o,u,d){var h,_,T,C;super(Fe.SUBSCRIBED_VIDEO_STATS_WINDOW,r,a,!1);const R=Math.max(((h=n==null?void 0:n.timestamp)!==null&&h!==void 0?h:0)-((_=e==null?void 0:e.timestamp)!==null&&_!==void 0?_:0),0);Object.assign(this.properties,Object.assign({action:ve.SUBSCRIBE,node:(T=l==null?void 0:l.node)!==null&&T!==void 0?T:"",cluster:(C=l==null?void 0:l.cluster)!==null&&C!==void 0?C:"",window_size_ms:R,remote_participant_id:c},((w,P,U,j,B,$,K,Q)=>{var oe,ce,ae,te,pe,be,Ce,_e,Se,Le,et,vt,Et,mt,It,en,Ht,Ut,xt,Nt,jt,rn,kt,Pn,xr,br,vi,_i,Br,Xi,Di,Zi,yo,Xr,Qa,$s,aa,Xa,zs,Za,es,qs,ts,ns,rs;let cl=0,ul=0;if(w!=null&&w.jitterBufferEmittedCount&&(P!=null&&P.jitterBufferEmittedCount)&&w.jitterBufferEmittedCount>P.jitterBufferEmittedCount){w!=null&&w.jitterBufferDelay&&(P!=null&&P.jitterBufferDelay)&&(cl=(w.jitterBufferDelay-P.jitterBufferDelay)/(w.jitterBufferEmittedCount-P.jitterBufferEmittedCount));const Ql=P==null?void 0:P.jitterBufferMinimumDelay,Xl=w==null?void 0:w.jitterBufferMinimumDelay;Ql&&Xl&&(ul=(Xl-Ql)/(w.jitterBufferEmittedCount-P.jitterBufferEmittedCount))}const ll=Math.max(((oe=w==null?void 0:w.bytesReceived)!==null&&oe!==void 0?oe:0)-((ce=P==null?void 0:P.bytesReceived)!==null&&ce!==void 0?ce:0),0),dl=typeof B!="number"?1:B/1e3,zl=8*ll/dl,ql=Math.max(((ae=w==null?void 0:w.totalDecodeTime)!==null&&ae!==void 0?ae:0)-((te=P==null?void 0:P.totalDecodeTime)!==null&&te!==void 0?te:0),0),Kl=Math.max(((pe=w==null?void 0:w.framesDecoded)!==null&&pe!==void 0?pe:0)-((be=P==null?void 0:P.framesDecoded)!==null&&be!==void 0?be:0),0),Jl=ql/Math.max(Kl,1),ku=Math.max(((Ce=w==null?void 0:w.packetsLost)!==null&&Ce!==void 0?Ce:0)-((_e=P==null?void 0:P.packetsLost)!==null&&_e!==void 0?_e:0),0),hl=Math.max(((Se=w==null?void 0:w.packetsReceived)!==null&&Se!==void 0?Se:0)-((Le=P==null?void 0:P.packetsReceived)!==null&&Le!==void 0?Le:0),0),Yl=ku/Math.max(hl+ku,1),is=Er(j==null?void 0:j.mimeType,j==null?void 0:j.sdpFmtpLine),Zl=8*(Q||0)/dl;return{bytes_received:ll,codec_mime_type:is==null?void 0:is.mimeSubtype,codec_profile:is==null?void 0:is.profile,codec_level:is==null?void 0:is.level,connection_bandwidth:(vt=(et=U==null?void 0:U.candidatePair)===null||et===void 0?void 0:et.availableIncomingBitrate)!==null&&vt!==void 0?vt:0,decode_bitrate:zl,decoder_implementation:(Et=w==null?void 0:w.decoderImplementation)!==null&&Et!==void 0?Et:"unknown",fir_count:Math.max(((mt=w==null?void 0:w.firCount)!==null&&mt!==void 0?mt:0)-((It=P==null?void 0:P.firCount)!==null&&It!==void 0?It:0),0),fraction_packets_lost:Yl,frame_decode_time_avg:Jl,frame_height:Math.max((en=w==null?void 0:w.frameHeight)!==null&&en!==void 0?en:0,0),frame_width:Math.max((Ht=w==null?void 0:w.frameWidth)!==null&&Ht!==void 0?Ht:0,0),frames_decoded:Math.max(((Ut=w==null?void 0:w.framesDecoded)!==null&&Ut!==void 0?Ut:0)-((xt=P==null?void 0:P.framesDecoded)!==null&&xt!==void 0?xt:0),0),frames_dropped:Math.max(((Nt=w==null?void 0:w.framesDropped)!==null&&Nt!==void 0?Nt:0)-((jt=P==null?void 0:P.framesDropped)!==null&&jt!==void 0?jt:0),0),frames_received:Math.max(((rn=w==null?void 0:w.framesReceived)!==null&&rn!==void 0?rn:0)-((kt=P==null?void 0:P.framesReceived)!==null&&kt!==void 0?kt:0),0),freeze_count:Math.max(((Pn=w==null?void 0:w.freezeCount)!==null&&Pn!==void 0?Pn:0)-((xr=P==null?void 0:P.freezeCount)!==null&&xr!==void 0?xr:0),0),frames_rendered:Math.max((br=w==null?void 0:w.framesRendered)!==null&&br!==void 0?br:0,0),frames_per_second:Math.max((vi=w==null?void 0:w.framesPerSecond)!==null&&vi!==void 0?vi:0,0),header_bytes_received:Math.max(((_i=w==null?void 0:w.headerBytesReceived)!==null&&_i!==void 0?_i:0)-((Br=P==null?void 0:P.headerBytesReceived)!==null&&Br!==void 0?Br:0),0),configured_jitter_buffer_min_delay_ms:$??0,jitter_buffer_min_obtainable_delay:ul,jitter_buffer_delay_avg:cl,key_frames_decoded:Math.max(((Xi=w==null?void 0:w.keyFramesDecoded)!==null&&Xi!==void 0?Xi:0)-((Di=P==null?void 0:P.keyFramesDecoded)!==null&&Di!==void 0?Di:0),0),nack_count:Math.max(((Zi=w==null?void 0:w.nackCount)!==null&&Zi!==void 0?Zi:0)-((yo=P==null?void 0:P.nackCount)!==null&&yo!==void 0?yo:0),0),packets_discarded:Math.max(((Xr=w==null?void 0:w.packetsDiscarded)!==null&&Xr!==void 0?Xr:0)-((Qa=P==null?void 0:P.packetsDiscarded)!==null&&Qa!==void 0?Qa:0),0),packets_lost:ku,packets_received:hl,pause_count:Math.max((($s=w==null?void 0:w.pauseCount)!==null&&$s!==void 0?$s:0)-((aa=P==null?void 0:P.pauseCount)!==null&&aa!==void 0?aa:0),0),pli_count:Math.max(((Xa=w==null?void 0:w.pliCount)!==null&&Xa!==void 0?Xa:0)-((zs=P==null?void 0:P.pliCount)!==null&&zs!==void 0?zs:0),0),power_efficient_decoder:(Za=w==null?void 0:w.powerEfficientDecoder)!==null&&Za!==void 0&&Za,total_freezes_duration:Math.max(((es=w==null?void 0:w.totalFreezesDuration)!==null&&es!==void 0?es:0)-((qs=P==null?void 0:P.totalFreezesDuration)!==null&&qs!==void 0?qs:0),0),total_pauses_duration:Math.max(((ts=w==null?void 0:w.totalPausesDuration)!==null&&ts!==void 0?ts:0)-((ns=P==null?void 0:P.totalPausesDuration)!==null&&ns!==void 0?ns:0),0),sei_read_count:K,sei_bytes_received:Q,sei_bitrate:Zl,protocol:(rs=U==null?void 0:U.localCandidate)===null||rs===void 0?void 0:rs.protocol}})(n,e,t,i,R,o,u,d)))}}class wi extends ot{constructor(r,a,c,l,n,e,t,i,o){var u,d;super(Fe.SUBSCRIBED_AUDIO_STATS,r,a,!1),Object.assign(this.properties,Object.assign({action:ve.SUBSCRIBE,node:(u=l==null?void 0:l.node)!==null&&u!==void 0?u:"",cluster:(d=l==null?void 0:l.cluster)!==null&&d!==void 0?d:"",remote_participant_id:c},((h,_,T,C,R)=>{var w,P,U,j,B,$,K,Q,oe,ce,ae,te,pe,be,Ce,_e,Se,Le;let et=0;h!=null&&h.jitterBufferDelay&&(h!=null&&h.jitterBufferEmittedCount)&&h.jitterBufferEmittedCount>0&&(et=h.jitterBufferDelay/h.jitterBufferEmittedCount);const vt=C??1,Et=Math.max((w=h==null?void 0:h.bytesReceived)!==null&&w!==void 0?w:0,0),mt=8*Et/vt,It=Math.max((P=h==null?void 0:h.packetsLost)!==null&&P!==void 0?P:0,0),en=Math.max((U=h==null?void 0:h.packetsReceived)!==null&&U!==void 0?U:0,0),Ht=It/Math.max(en+It,1),Ut=Math.max((j=h==null?void 0:h.concealedSamples)!==null&&j!==void 0?j:0,0),xt=Math.max((B=h==null?void 0:h.totalSamplesReceived)!==null&&B!==void 0?B:0,0),Nt=Ut/Math.max(xt,1),jt=Er(T==null?void 0:T.mimeType,T==null?void 0:T.sdpFmtpLine);return{audio_level:($=h==null?void 0:h.audioLevel)!==null&&$!==void 0?$:0,audio_nacks_enabled:(K=R==null?void 0:R.audioNacks)!==null&&K!==void 0&&K,bytes_received:Et,codec_mime_type:jt==null?void 0:jt.mimeSubtype,connection_bandwidth:(oe=(Q=_==null?void 0:_.candidatePair)===null||Q===void 0?void 0:Q.availableIncomingBitrate)!==null&&oe!==void 0?oe:0,concealed_samples:Ut,concealment_events:Math.max((ce=h==null?void 0:h.concealmentEvents)!==null&&ce!==void 0?ce:0,0),silent_concealed_samples:Math.max((ae=h==null?void 0:h.silentConcealedSamples)!==null&&ae!==void 0?ae:0,0),decode_bitrate:mt,fraction_audio_concealed:Nt,fraction_packets_lost:Ht,header_bytes_received:Math.max((te=h==null?void 0:h.headerBytesReceived)!==null&&te!==void 0?te:0,0),inserted_samples_for_deceleration:Math.max((pe=h==null?void 0:h.insertedSamplesForDeceleration)!==null&&pe!==void 0?pe:0,0),jitter_buffer_delay_avg:et,packets_discarded:Math.max((be=h==null?void 0:h.packetsDiscarded)!==null&&be!==void 0?be:0,0),retransmitted_packets_received:Math.max((Ce=h==null?void 0:h.retransmittedPacketsReceived)!==null&&Ce!==void 0?Ce:0,0),retransmitted_bytes_received:Math.max((_e=h==null?void 0:h.retransmittedBytesReceived)!==null&&_e!==void 0?_e:0,0),packets_lost:It,packets_received:en,nack_count:Math.max((Se=h==null?void 0:h.nackCount)!==null&&Se!==void 0?Se:0,0),removed_samples_for_acceleration:Math.max((Le=h==null?void 0:h.removedSamplesForAcceleration)!==null&&Le!==void 0?Le:0,0),total_samples_received:xt}})(n,e,t,i,o)))}}class Oi extends ot{constructor(r,a,c,l,n,e,t,i,o,u){var d,h,_,T;super(Fe.SUBSCRIBED_AUDIO_STATS_WINDOW,r,a,!1);const C=Math.max(((d=n==null?void 0:n.timestamp)!==null&&d!==void 0?d:0)-((h=e==null?void 0:e.timestamp)!==null&&h!==void 0?h:0),0);Object.assign(this.properties,Object.assign({action:ve.SUBSCRIBE,window_size_ms:C,node:(_=l==null?void 0:l.node)!==null&&_!==void 0?_:"",cluster:(T=l==null?void 0:l.cluster)!==null&&T!==void 0?T:"",remote_participant_id:c},((R,w,P,U,j,B,$)=>{var K,Q,oe,ce,ae,te,pe,be,Ce,_e,Se,Le,et,vt,Et,mt,It,en,Ht,Ut,xt,Nt,jt,rn,kt,Pn,xr,br,vi,_i,Br,Xi,Di;let Zi=0,yo=0;if(R!=null&&R.jitterBufferEmittedCount&&(w!=null&&w.jitterBufferEmittedCount)&&R.jitterBufferEmittedCount>w.jitterBufferEmittedCount){R!=null&&R.jitterBufferDelay&&(w!=null&&w.jitterBufferDelay)&&(Zi=(R.jitterBufferDelay-w.jitterBufferDelay)/(R.jitterBufferEmittedCount-w.jitterBufferEmittedCount));const ns=w==null?void 0:w.jitterBufferMinimumDelay,rs=R==null?void 0:R.jitterBufferMinimumDelay;ns&&rs&&(yo=(rs-ns)/(R.jitterBufferEmittedCount-w.jitterBufferEmittedCount))}const Xr=typeof j!="number"?1:j/1e3,Qa=Math.max(((K=R==null?void 0:R.bytesReceived)!==null&&K!==void 0?K:0)-((Q=w==null?void 0:w.bytesReceived)!==null&&Q!==void 0?Q:0),0),$s=8*Qa/Xr,aa=Math.max(((oe=R==null?void 0:R.packetsLost)!==null&&oe!==void 0?oe:0)-((ce=w==null?void 0:w.packetsLost)!==null&&ce!==void 0?ce:0),0),Xa=Math.max(((ae=R==null?void 0:R.packetsReceived)!==null&&ae!==void 0?ae:0)-((te=w==null?void 0:w.packetsReceived)!==null&&te!==void 0?te:0),0),zs=aa/Math.max(Xa+aa,1),Za=Math.max(((pe=R==null?void 0:R.concealedSamples)!==null&&pe!==void 0?pe:0)-((be=w==null?void 0:w.concealedSamples)!==null&&be!==void 0?be:0),0),es=Math.max(((Ce=R==null?void 0:R.totalSamplesReceived)!==null&&Ce!==void 0?Ce:0)-((_e=w==null?void 0:w.totalSamplesReceived)!==null&&_e!==void 0?_e:0),0),qs=Za/Math.max(es,1),ts=Er(U==null?void 0:U.mimeType,U==null?void 0:U.sdpFmtpLine);return{audio_level:(Se=R==null?void 0:R.audioLevel)!==null&&Se!==void 0?Se:0,audio_nacks_enabled:(Le=B==null?void 0:B.audioNacks)!==null&&Le!==void 0&&Le,bytes_received:Qa,codec_mime_type:ts==null?void 0:ts.mimeSubtype,connection_bandwidth:(vt=(et=P==null?void 0:P.candidatePair)===null||et===void 0?void 0:et.availableIncomingBitrate)!==null&&vt!==void 0?vt:0,decode_bitrate:$s,concealed_samples:Za,concealment_events:Math.max(((Et=R==null?void 0:R.concealmentEvents)!==null&&Et!==void 0?Et:0)-((mt=w==null?void 0:w.concealmentEvents)!==null&&mt!==void 0?mt:0),0),silent_concealed_samples:Math.max(((It=R==null?void 0:R.silentConcealedSamples)!==null&&It!==void 0?It:0)-((en=w==null?void 0:w.silentConcealedSamples)!==null&&en!==void 0?en:0),0),fraction_audio_concealed:qs,fraction_packets_lost:zs,header_bytes_received:Math.max(((Ht=R==null?void 0:R.headerBytesReceived)!==null&&Ht!==void 0?Ht:0)-((Ut=w==null?void 0:w.headerBytesReceived)!==null&&Ut!==void 0?Ut:0),0),inserted_samples_for_deceleration:Math.max(((xt=R==null?void 0:R.insertedSamplesForDeceleration)!==null&&xt!==void 0?xt:0)-((Nt=w==null?void 0:w.insertedSamplesForDeceleration)!==null&&Nt!==void 0?Nt:0),0),configured_jitter_buffer_min_delay_ms:$??0,jitter_buffer_min_obtainable_delay:yo,jitter_buffer_delay_avg:Zi,packets_discarded:Math.max(((jt=R==null?void 0:R.packetsDiscarded)!==null&&jt!==void 0?jt:0)-((rn=w==null?void 0:w.packetsDiscarded)!==null&&rn!==void 0?rn:0),0),packets_lost:aa,packets_received:Xa,nack_count:Math.max(((kt=R==null?void 0:R.nackCount)!==null&&kt!==void 0?kt:0)-((Pn=w==null?void 0:w.nackCount)!==null&&Pn!==void 0?Pn:0),0),removed_samples_for_acceleration:Math.max(((xr=R==null?void 0:R.removedSamplesForAcceleration)!==null&&xr!==void 0?xr:0)-((br=w==null?void 0:w.removedSamplesForAcceleration)!==null&&br!==void 0?br:0),0),retransmitted_packets_received:Math.max(((vi=R==null?void 0:R.retransmittedPacketsReceived)!==null&&vi!==void 0?vi:0)-((_i=w==null?void 0:w.retransmittedPacketsReceived)!==null&&_i!==void 0?_i:0),0),retransmitted_bytes_received:Math.max(((Br=R==null?void 0:R.retransmittedBytesReceived)!==null&&Br!==void 0?Br:0)-((Xi=w==null?void 0:w.retransmittedBytesReceived)!==null&&Xi!==void 0?Xi:0),0),total_samples_received:es,protocol:(Di=P==null?void 0:P.localCandidate)===null||Di===void 0?void 0:Di.protocol}})(n,e,t,i,C,o,u)))}}class Ua extends ot{constructor(r,a,c,l,n=ve.PUBLISH,e=!1,t=""){super(Fe.SIMULCAST_LAYER_INFO,r,a,!1),Object.assign(this.properties,{rid:c,active:l,selected:e,source:n===ve.PUBLISH?"publisher":"subscriber",remote_participant_id:t})}}const ja=s=>{console.warn(`[IVS Stages] ${s}`)};var Ko,dr,Vn;(function(s){s.Mobile="mobile",s.Tablet="tablet",s.Desktop="desktop",s.Tv="tv"})(Ko||(Ko={})),function(s){s.IOS="iOS",s.MacOS="macOS",s.Windows="Windows",s.Android="Android"}(dr||(dr={})),function(s){s.Safari="Safari",s.Firefox="Firefox",s.Chrome="Chrome",s.IE="Internet Explorer",s.Edge="Microsoft Edge"}(Vn||(Vn={}));const Ai=function(s){const r=qr(s);return{platform:{isMobile:qi(Ko.Mobile,r),isTablet:qi(Ko.Tablet,r),isDesktop:qi(Ko.Desktop,r),isTv:qi(Ko.Tv,r)},os:{name:$e(r),version:Ki(r),isIOS:We(dr.IOS,r),isMacOS:We(dr.MacOS,r),isWindows:We(dr.Windows,r),isAndroid:We(dr.Android,r)},browser:{name:Ji(r),version:Fa(r),isSafari:Mr(Vn.Safari,r),isFirefox:Mr(Vn.Firefox,r),isChrome:Mr(Vn.Chrome,r),isIE:Mr(Vn.IE,r),isEdge:Mr(Vn.Edge,r)}}}(window.navigator.userAgent);function qr(s){try{return tc.getParser(s||window.navigator.userAgent)}catch{}}function qi(s,r){return()=>(r||(r=qr()),!(!r||r.getPlatformType(!0)!==s.toLowerCase()))}function Ki(s){return()=>(s||(s=qr()),s&&s.getOSVersion()||"")}function $e(s){return()=>(s||(s=qr()),s&&s.getOSName()||"")}function We(s,r){return()=>(r||(r=qr()),!(!r||r.getOSName(!0)!==s.toLowerCase()))}function Fa(s){return()=>(s||(s=qr()),s&&s.getBrowserVersion()||"")}function Ji(s){return()=>(s||(s=qr()),s&&s.getBrowserName()||"")}function Mr(s,r){return()=>(r||(r=qr()),!(!r||r.getBrowserName().toLowerCase()!==s.toLowerCase()))}const Ls={name:"SimulcastUnsupported",message:`Simulcast is only supported on Chromium browsers at bitrates over ${Hi.MID.maxBitrateKbps}Kbps`,code:100},gn={name:"SimulcastLayerInvalidType",message:"Layer configuration is invalid: ",code:101},xn={name:"SimulcastMaxLayersExceeded",message:"No more than 3 simulcast layers may be configured",code:102},bc={name:"SimulcastDuplicateLayersConfigured",message:"Two duplicate layers are configured. At minimum bitrate, framerate, or dimensions must differ",code:103},fu={name:"SimulcastMaxLayerBitrateExceeded",message:`maxBitrateKbps cannot exceed ${zr} Kbps`,code:105},ki={name:"SimulcastMinLayerBitrateExceeded",message:`maxBitrateKbps cannot be less than ${Ti} Kbps`,code:106},sn={name:"SimulcastMaxLayerFramerateExceeded",message:`maxFramerate cannot exceed ${Ln} fps`,code:107},Bn={name:"SimulcastMinLayerFramerateExceeded",message:`maxFramerate cannot be less than ${$i} fps`,code:108},Jo={name:"SimulcastMaxLayerDimensionsExceeded",message:`dimensions cannot exceed max resolution of ${Nr}x720`,code:109},Tc={name:"SimulcastMinLayerDimensionsExceeded",message:`width or height cannot be lower than ${li}`,code:110},Yo={name:"SimulcastLayerConfigurationConflict",message:"Layer configuration conflict: ",code:111},Qo={name:"SimulcastLayerOrientationMismatch",message:"Layer orientation different from input video track: ",code:112},Cc={name:"SimulcastLayerInputResolutionInsufficient",message:"Input video resolution is lower than the configured layer: ",code:113},Ic={name:"SimulcastLayerInputFramerateInsufficient",message:"Input video framerate is lower than the configured layer: ",code:114};class An extends Error{constructor({name:r,message:a,code:c,details:l,cause:n,params:e}){super(a),Error.captureStackTrace&&Error.captureStackTrace(this,An),this.name=r,this.message=a,this.code=c,this.details=l,this.cause=n,this.params=e}}const Va=s=>({rid:s.rid,active:s.active,scaleResolutionDownBy:s.scaleFactor,maxBitrate:s.maxBitrateBps,maxFramerate:s.maxFramerate}),Rc=(s,r)=>s.width*s.height>r.width*r.height||s.maxBitrateKbps>r.maxBitrateKbps||s.maxFramerate>r.maxFramerate?1:Xo(s,r)?0:-1,Xo=(s,r)=>{if(typeof s!="object"||typeof r!="object")return!1;const a=Object.keys(s);for(const c of a)if(s[c]!==r[c])return!1;return!0},po=s=>{const{width:r,height:a}=Ga(s);return r*a},Ga=s=>{const{height:r,width:a}=s;let c=Nr/Ps,l=Nr;return r!==void 0&&(c=r),a!==void 0&&(l=a),r&&!a&&(l=r*Ps),!r&&a&&(c=a/Ps),{height:c,width:l}},wc=s=>{const{width:r,height:a}=s;return r/a>=1?Wi.LANDSCAPE:Wi.PORTRAIT},Pi=(s,r,a)=>{var c;const l=(c=s.getSettings().frameRate)!==null&&c!==void 0?c:Ln;return Object.assign(Object.assign({},a),{active:!0,height:r.height,width:r.width,maxBitrateBps:Pr(r.maxBitrateKbps),maxFramerate:Math.min(r.maxFramerate,l),scaleFactor:Wa(r,s)})},Wa=(s,r)=>{const a=po(r.getSettings()),c=po(s);if(c>=a)return 1;const l=1/Math.sqrt(c/a);return Math.max(l,1)},Oc=s=>{if(typeof s!="object"){const r=Object.assign({},gn);throw r.message+=" is not an object",new An(r)}},di=(s,r)=>{if(typeof s!="number"){const a=Object.assign({},gn);throw a.message+="maxBitrateKbps is not a number",new An(a)}if(s<Ti)throw new An(Object.assign({},ki));if(s>zr)throw new An(Object.assign({},fu));if(r&&s>r){const a=Object.assign({},Yo);throw a.message+=`maxBitrateKbps cannot be greater than stage maxVideoBitrateKbps of ${r}`,new An(a)}},Qn=(s,r)=>{if(typeof s!="number"){const a=Object.assign({},gn);throw a.message+="maxFramerate is not a number",new An(a)}if(s<$i)throw new An(Object.assign({},Bn));if(s>Ln)throw new An(Object.assign({},sn));if(r&&s>r){const a=Object.assign({},Yo);throw a.message+=`maxFramerate cannot be greater than stage maxFramerate of ${r} `,new An(a)}},go=(s,r)=>{var a;if(typeof s!="number"||typeof r!="number"){const n=Object.assign({},gn);throw n.message+="width and height must be numbers",new An(n)}if(s<li||r<li)throw new An(Object.assign({},Tc));const c=(a=ln("enable1080pResolution"))!==null&&a!==void 0&&a,l=c?1920:Nr;if(s>l||r>l)throw new An(Object.assign({},Jo));if(s*r>(c?2073600:zi))throw new An(Object.assign({},Jo))},Wu=(s,r)=>{const a=Ga(r.getSettings()),c=wc(a);c!==wc(s)&&ja(`${Qo.message}forcing orientation to ${c}`)},Rl=(s,r)=>{var a,c,l,n,e;let t=(0,qt.cloneDeep)(r);const i=(a=t.simulcast)!==null&&a!==void 0?a:{},o=!Ai.browser.isChrome()&&!Ai.browser.isEdge(),u=(l=(c=s.getSettings())===null||c===void 0?void 0:c.displaySurface)!==null&&l!==void 0&&l,d=(n=t.maxVideoBitrateKbps)!==null&&n!==void 0?n:zr,h=!(Array.isArray((e=r.simulcast)===null||e===void 0?void 0:e.layers)||!r.maxVideoBitrateKbps)&&d<Hi.MID.maxBitrateKbps;if(typeof i.enabled=="boolean"&&i.enabled&&(o||u||h)){t.simulcast={enabled:!1};const{name:_,message:T}=Ls;ja(`${_}${T}, disabling the feature`)}return t=((_,T)=>{var C,R;const w=T,P=(C=T.simulcast)===null||C===void 0?void 0:C.layers;if(P===void 0)return w;if(!Array.isArray(P)){const U=Object.assign({},gn);throw U.message+=" layers is not an array",new An(U)}if(P.length===0)return(R=w.simulcast)===null||R===void 0||delete R.layers,w;if(P.length>3)throw new An(Object.assign({},xn));if((0,qt.uniqWith)(P,Xo).length!==P.length)throw new An(Object.assign({},bc));for(const U of P)Oc(U),di(U.maxBitrateKbps,T.maxVideoBitrateKbps),Qn(U.maxFramerate,T.maxFramerate),go(U.width,U.height),Wu(U,_);return w})(s,t),t};function pu(s){return s.track.kind===at.AUDIO}function Ac(s){return s.track.kind===at.VIDEO&&typeof s.config=="object"}function kc(s){if(s!==void 0&&(s<Ti||s>zr))throw new Error(`Stage bitrate must be a number between ${Ti} kbps and ${zr} kbps inclusive`)}function xs(s){return s!==void 0&&("maxBitrate"in s||"maxVideoBitrateKbps"in s||"maxFramerate"in s||"simulcast"in s||"inBandMessaging"in s||"minBitrate"in s)}function gu(s,r){if(r===void 0)return r;let a=(0,qt.cloneDeep)(r);return xs(a)?(a.maxBitrate!==void 0&&(a.maxVideoBitrateKbps=a.maxBitrate,ja("maxBitrate is deprecated in favor of maxVideoBitrateKbps")),a=Rl(s,a),kc(a.maxVideoBitrateKbps),kc(a.minBitrate),function(c){if(c!==void 0&&(c>Ln||c<$i))throw new Error(`Stage framerate must be between ${$i} fps and ${Ln} fps inclusive`)}(a.maxFramerate),function(c){if(c!==void 0){if(typeof c!="object")throw new Error("In-band messaging config must be an object");if(typeof c.enabled!="boolean")throw new Error("In-band messaging config enabled property must be a boolean")}}(a.inBandMessaging)):(function(c){if(c!==void 0&&(c<$o||c>fo))throw new Error(`Stage audio bitrate must be between ${$o} Kbps and ${fo} Kbps inclusive`)}(a.maxAudioBitrateKbps),function(c){if(c!==void 0&&typeof c!="boolean")throw new Error("Stage stereo prop must be a boolean")}(a.stereo)),a}const Hu=(s,r,a)=>{var c;const l={[cr.HI]:Ho(cr.HI),[cr.MID]:Ho(cr.MID),[cr.LOW]:Ho(cr.LOW)},n=r.simulcast,e=a==null?void 0:a.simulcast;let t=n.layers.sort(Rc);const i=(c=e==null?void 0:e.layers)!==null&&c!==void 0?c:[],o=t.length,u=i.length;return t=t.map(d=>{((_,T)=>{const{width:C,height:R}=Ga(T.getSettings()),{width:w,height:P}=_;if(w*P>C*R){const U=`forcing layer of ${w}x${P} to the input dimensions ${C}x${R}`,{name:j,message:B}=Cc;ja(`${j}${B}${U}`)}})(d,s),((_,T)=>{var C;const R=(C=T.getSettings().frameRate)!==null&&C!==void 0?C:Ln,w=_.maxFramerate;if(w>R){const P=`forcing layer of ${w}fps to the input framerate of ${R}`,{name:U,message:j}=Ic;ja(`${U}${j}${P}`)}})(d,s);let h=((_,T)=>{const{maxVideoBitrateKbps:C}=T,R=_;return C&&_.maxBitrateKbps>C&&(R.maxBitrateKbps=C),R})(d,r);return h=((_,T)=>{const{maxFramerate:C}=T,R=_;return C&&_.maxFramerate>C&&(R.maxFramerate=C),R})(d,r),h}),(u===0||u===3)&&o===3?(l.hi=Pi(s,t[2],l.hi),l.mid=Pi(s,t[1],l.mid),l.low=Pi(s,t[0],l.low),Re.ok(l)):u===1&&o===1?(l.hi=Pi(s,t[0],l.hi),Re.ok(l)):u===2&&o===2?(l.hi=Pi(s,t[1],l.hi),l.low=Pi(s,t[0],l.low),Re.ok(l)):Re.err(null)},wl=(s,r,a)=>{const c=r.simulcast,l=r.inBandMessaging,n=Pr(r.minBitrate),e=Pr(r.maxVideoBitrateKbps),t=r.maxFramerate;let i=[{maxBitrate:e,maxFramerate:t}];const o=Hu(s,r,a??{});return c.enabled&&o.ok&&(i=(u=>{const{hi:d,mid:h,low:_}=u;return[Va(_),Va(h),Va(d)]})(o.value)),{track:s,config:{minBitrateBps:n,maxBitrateBps:e,maxFramerate:t,inBandMessagingEnabled:l.enabled,simulcastEnabled:c.enabled,simulcastLayers:o.ok?o.value:void 0,encodingLayers:i}}},$u=s=>{const r=s.mediaStreamTrack,a=s.normalizedConfig;let c={};const l=s.validatedExternalConfig;return xs(l)&&(c=l),function(n){return n.kind===at.AUDIO}(r)?((n,e)=>{const t={maxBitrateBps:Pr(e.maxAudioBitrateKbps)},i=e==null?void 0:e.stereo;return typeof i=="boolean"&&(t.stereo=i),{track:n,config:t}})(r,a):wl(r,a,c)},Kr=(s,r)=>{const a={minBitrate:Ti,maxBitrate:zr,maxVideoBitrateKbps:zr,maxFramerate:Ln,simulcast:{enabled:!1,layers:[Object.assign({},Hi.HI),Object.assign({},Hi.MID),Object.assign({},Hi.LOW)]},maxAudioBitrateKbps:Sc,stereo:!1,inBandMessaging:{enabled:!1}},c=(0,qt.cloneDeep)(r),l=Object.assign(Object.assign({},a),c);return xs(c)&&(c.simulcast&&(l.simulcast=Object.assign(Object.assign({},a.simulcast),c.simulcast)),c.inBandMessaging&&(l.inBandMessaging=Object.assign(Object.assign({},a.inBandMessaging),c.inBandMessaging))),l},hr=(s,r)=>{if(typeof s=="number")return s;const a=r?cu:uu;return a[s]!==void 0?a[s]:0};class zu extends ot{constructor(r,a,c,l){super(Fe.MULTIHOST_CONFIGURATION,r,a,!1),Object.assign(this.properties,Object.assign(Object.assign({},c),{action:l}))}}class qu extends ot{constructor(r,a,c,l,n){super(Fe.MULTIHOST_SUBSCRIBE_CONFIGURATION,r,a,!1);const e={trigger:c,remote_participant_id:l,min_delay_when_publishing:hr(n.jitterBuffer.minDelayWhenPublishing,!0),min_delay_when_subscribe_only:hr(n.jitterBuffer.minDelayWhenSubscribeOnly,!1),in_band_messaging_enabled:n.inBandMessaging.enabled,simulcast_initial_layer_preference:n.simulcast.initialLayerPreference,simulcast_layer_poll_interval_ms:n.simulcast.layerPollingIntervalMs,simulcast_layer_poll_enabled:n.simulcast.layerPollingEnabled};Object.assign(this.properties,e)}}var Zo=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class Ha{constructor(r,a,c,l,n){this.analyticsTracker=n,this.simulcastEnabled=!1,this.simulcastState={low:!1,mid:!1,hi:!1},this.sdp=new dt(""),this.sdpFeatures={audioNacks:!1},this.multihostConfiguration=Ha.defaultMultihostConfiguration(),this.prevOutboundVideoStats=new Map,this.prevInboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.sfuResource={node:"",cluster:""},this.connectionStartedTimestamp=Date.now(),this.seiStats={seiReadCnt:0,seiBytesRead:0,seiWriteCnt:0,seiBytesWritten:0},this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0},this.vidNetworkQualityMap=new Map,this.audioNetworkQualityMap=new Map,this.onPeerConnectionStateChange=()=>{switch(this.getConnectionState()){case xe.CONNECTED:this.connectionStartedTimestamp=Date.now(),this.setupIntervals();break;case xe.FAILED:this.flushStats()}},this.action=r,this.token=a,this.traceId=c,this.identifier=l}static defaultMultihostConfiguration(){return{video_codec:"unknown",width:0,height:0,max_bitrate:0,min_bitrate:0,target_fps:0,echo_cancellation:!1,auto_gain:!1,noise_suppression:!1,enable_simulcast:!1,max_audio_bitrate_bps:Pr(fo),hi_video_layer:"",mid_video_layer:"",low_video_layer:""}}set sdpAnswer(r){try{this.sdp=new dt(r),this.sdpFeatures.audioNacks=this.sdp.hasAudioNacksEnabled()}catch{}}start(r,a=!1){this.peerConnection=r,this.simulcastEnabled=a,this.prevOutboundAudioStats=void 0,this.prevOutboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.peerConnection.addEventListener("connectionstatechange",this.onPeerConnectionStateChange)}stop(){var r;clearInterval(this.uploadStatsInterval),this.uploadStatsInterval=void 0,(r=this.peerConnection)===null||r===void 0||r.removeEventListener("connectionstatechange",this.onPeerConnectionStateChange)}updateSfuResource(r){this.sfuResource=r}updateMultihostConfiguration(r,a){var c,l,n,e,t,i,o,u,d;return Zo(this,void 0,void 0,function*(){if(this.action!==ve.PUBLISH||!this.peerConnection)return;const h=Ha.defaultMultihostConfiguration();if(a){const _=this.peerConnection.getSenders().filter(R=>R.track!==null&&R.track.kind==="video");let T="unknown";_.length>0&&(yield _[0].getStats()).forEach(R=>{if(R.type==="codec"&&(h.video_codec=R.mimeType,R.sdpFmtpLine)){const w=R.sdpFmtpLine.match(/profile-level-id=([a-f0-9]+)/);w&&w.length>0&&(T=w[1])}});const C=a.track.getSettings();h.width=(c=C.width)!==null&&c!==void 0?c:0,h.height=(l=C.height)!==null&&l!==void 0?l:0,h.target_fps=(n=C.frameRate)!==null&&n!==void 0?n:0,a.config?(h.max_bitrate=a.config.maxBitrateBps,h.min_bitrate=a.config.minBitrateBps,h.enable_simulcast=a.config.simulcastEnabled):(h.max_bitrate=Pr(zr),h.min_bitrate=Pr(Ti),h.enable_simulcast=!1),a.config.simulcastEnabled&&(h.hi_video_layer=this.mapLayerToMetric(T,(e=a.config.simulcastLayers)===null||e===void 0?void 0:e.hi),h.mid_video_layer=this.mapLayerToMetric(T,(t=a.config.simulcastLayers)===null||t===void 0?void 0:t.mid),h.low_video_layer=this.mapLayerToMetric(T,(i=a.config.simulcastLayers)===null||i===void 0?void 0:i.low))}if(r){const _=r.track.getSettings();h.auto_gain=(o=_.autoGainControl)!==null&&o!==void 0&&o,h.echo_cancellation=(u=_.echoCancellation)!==null&&u!==void 0&&u,h.noise_suppression=(d=_.noiseSuppression)!==null&&d!==void 0&&d,h.max_audio_bitrate_bps=r.config.maxBitrateBps,h.stereo=r.config.stereo}(0,qt.isEqual)(h,this.multihostConfiguration)||(this.analyticsTracker.trackEventNoSharedProps(new zu(this.token,this.traceId,h,this.action)),this.multihostConfiguration=h)})}resetTransformers(r,a){this.senderVideoTransformer=a,this.receiveVideoTransformer=r,this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0}}getStats(r){var a;return Zo(this,void 0,void 0,function*(){const c=yield(a=this.peerConnection)===null||a===void 0?void 0:a.getStats(r),{action:l}=this;if(c)if(r.kind==="audio"){if(l===ve.PUBLISH)return{action:l,rawReport:c,stats:lu(c,this.audioNetworkQualityMap)};if(l===ve.SUBSCRIBE)return{action:l,rawReport:c,stats:zo(c,this.audioNetworkQualityMap)}}else{if(l===ve.PUBLISH)return{action:l,rawReport:c,stats:du(c,this.vidNetworkQualityMap)};if(l===ve.SUBSCRIBE)return{action:l,rawReport:c,stats:Ri(c,this.vidNetworkQualityMap)}}})}mapLayerToMetric(r,a){return!a||!a.active?"":`${`${a.height}x${a.width}`}_${`${a.maxFramerate}fps`}_${a.maxBitrateBps/1e3+"kbps"}_${r}`}updateJitterBufferMinDelay(r){this.jitterBufferMinDelayInMs=r}setupIntervals(){this.action===ve.PUBLISH&&this.simulcastEnabled&&!this.pollSimulcastLayerInterval&&(this.pollSimulcastLayers(),this.pollSimulcastLayerInterval=this.startInterval(this.pollSimulcastLayers,5e3)),this.uploadStatsInterval||(this.uploadStats(),this.uploadStatsInterval=this.startInterval(this.uploadStats,1e4))}startInterval(r,a){return setInterval(r.bind(this),a)}getConnectionState(){var r;if(!this.peerConnection)return xe.NONE;const a=(r=this.peerConnection.connectionState)!==null&&r!==void 0?r:this.peerConnection.iceConnectionState;try{return Pa(a)}catch{return xe.IDLE}}pollSimulcastLayers(){var r;return Zo(this,void 0,void 0,function*(){if(this.getConnectionState()===xe.CONNECTED){const a=yield(r=this.peerConnection)===null||r===void 0?void 0:r.getStats();if(!a)return;a.forEach(c=>{var l;if(c.type==="outbound-rtp"){const n=((l=c.framesPerSecond)!==null&&l!==void 0?l:0)!==0;switch(c.rid){case"low":n!==this.simulcastState.low&&(this.simulcastState.low=n,this.analyticsTracker.trackEventNoSharedProps(new Ua(this.token,this.traceId,c.rid,n)));break;case"mid":n!==this.simulcastState.mid&&(this.simulcastState.mid=n,this.analyticsTracker.trackEventNoSharedProps(new Ua(this.token,this.traceId,c.rid,n)));break;case"hi":n!==this.simulcastState.hi&&(this.simulcastState.hi=n,this.analyticsTracker.trackEventNoSharedProps(new Ua(this.token,this.traceId,c.rid,n)))}}})}})}flushStats(){var r;return Zo(this,void 0,void 0,function*(){const a=yield(r=this.peerConnection)===null||r===void 0?void 0:r.getStats();a&&(this.action===ve.PUBLISH?this.uploadPublisherStats(a):this.action===ve.SUBSCRIBE&&this.uploadSubscriberStats(a))})}uploadStats(){var r;return Zo(this,void 0,void 0,function*(){if(this.getConnectionState()===xe.CONNECTED){const a=yield(r=this.peerConnection)===null||r===void 0?void 0:r.getStats();if(!a)return;this.action===ve.PUBLISH?this.uploadPublisherStats(a):this.action===ve.SUBSCRIBE&&this.uploadSubscriberStats(a)}})}uploadPublisherStats(r){var a,c;const l={audio:{},video:[],candidateStats:{}},n=new Map,e=(Date.now()-this.connectionStartedTimestamp)/1e3,t=Object.assign({},this.multihostConfiguration),{seiWriteCnt:i,seiBytesWritten:o}=this.updateAndDiffSeiPublishStatsSinceLastUpdate((a=this.senderVideoTransformer)===null||a===void 0?void 0:a.getSenderStats());if(this.seiStats.seiWriteCnt+=i,this.seiStats.seiBytesWritten+=o,r.forEach(u=>{if(u.type==="outbound-rtp"){const d=r.get(u.remoteId),h=this.prevRemoteInboundStats.get(u.remoteId);switch(d&&this.prevRemoteInboundStats.set(d.id,d),u.kind){case"audio":l.audio=this.updateOutboundAudio(u),l.audio.remoteInbound=d,l.audio.prevRemoteInbound=h,l.audio.codec=n.get(u.codecId);break;case"video":l.video.push(Object.assign({},this.updateOutboundVideo(u),{remoteInbound:d,prevRemoteInbound:h,codec:n.get(u.codecId)}))}}u.type==="candidate-pair"&&u.nominated&&(l.candidateStats.candidatePair=u,l.candidateStats.localCandidate=r.get(u.localCandidateId),l.candidateStats.remoteCandidate=r.get(u.remoteCandidate)),u.type==="codec"&&n.set(u.id,u)}),l.video.forEach(u=>{var d,h;const{outbound:_,prevOutbound:T}=u;if(!_)return;const C=(h=(d=u.outbound)===null||d===void 0?void 0:d.rid)!==null&&h!==void 0?h:zn;this.updateNetworkQualityPublish(C,this.vidNetworkQualityMap,_,T)}),l.audio.outbound){const u=(c=l.audio.outbound.rid)!==null&&c!==void 0?c:zn;this.updateNetworkQualityPublish(u,this.audioNetworkQualityMap,l.audio.outbound,l.audio.prevOutbound)}this.analyticsTracker.trackEventNoSharedProps(new Ms(this.token,this.traceId,this.sfuResource,l.audio.outbound,l.audio.remoteInbound,l.candidateStats,l.audio.codec,t,e,this.sdpFeatures)),l.audio.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new yc(this.token,this.traceId,this.sfuResource,l.audio.outbound,l.audio.prevOutbound,l.audio.remoteInbound,l.audio.prevRemoteInbound,l.candidateStats,l.audio.codec,t,this.sdpFeatures)),l.video.forEach(u=>{this.analyticsTracker.trackEventNoSharedProps(new Ds(this.token,this.traceId,this.sfuResource,u.outbound,u.remoteInbound,l.candidateStats,u.codec,t,e)),u.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new Ns(this.token,this.traceId,this.sfuResource,u.outbound,u.prevOutbound,u.remoteInbound,u.prevRemoteInbound,l.candidateStats,u.codec,t,this.seiStats.seiWriteCnt,this.seiStats.seiBytesWritten))})}updateNetworkQualityPublish(r,a,c,l){var n,e,t,i;let o=0;const u=nr.getNetworkQuality(),d=(n=c.packetsSent)!==null&&n!==void 0?n:0,h=(e=c.nackCount)!==null&&e!==void 0?e:0;if(l)if(u===In.DOWN)a.set(r,In.DOWN);else{o=(h-((t=l==null?void 0:l.nackCount)!==null&&t!==void 0?t:0))/(d-((i=l==null?void 0:l.packetsSent)!==null&&i!==void 0?i:0));const _=this.convertLostRatioToQuality(o);a.set(r,_)}else a.set(r,u)}updateNetworkQualitySubscribe(r,a,c){var l,n,e,t;let i=0;const o=nr.getNetworkQuality(),u=(l=a==null?void 0:a.packetsReceived)!==null&&l!==void 0?l:0,d=(n=a==null?void 0:a.nackCount)!==null&&n!==void 0?n:0;if(!a)return;const h=a.id;if(h)if(c)if(o===In.DOWN)r.set(h,In.DOWN);else{i=(d-((e=c==null?void 0:c.nackCount)!==null&&e!==void 0?e:0))/(u-((t=c==null?void 0:c.packetsReceived)!==null&&t!==void 0?t:0));const _=this.convertLostRatioToQuality(i);r.set(h,_)}else r.set(h,o)}uploadSubscriberStats(r){var a,c;const l={audio:{},video:{},candidateStats:{}},n=new Map,e=(Date.now()-this.connectionStartedTimestamp)/1e3,t=(a=this.jitterBufferMinDelayInMs)!==null&&a!==void 0?a:0,{seiReadCnt:i,seiBytesRead:o}=this.updateAndDiffSeiSubscribeStatsSinceLastUpdate((c=this.receiveVideoTransformer)===null||c===void 0?void 0:c.getReceiverStats());this.seiStats.seiReadCnt+=i,this.seiStats.seiBytesRead+=o,r.forEach(u=>{if(u.type==="inbound-rtp")switch(u.kind){case"audio":l.audio=this.updateInboundAudio(u),l.audio.codec=n.get(u.codecId),this.updateNetworkQualitySubscribe(this.audioNetworkQualityMap,l.audio.inbound,l.audio.prevInbound);break;case"video":l.video=this.updateInboundVideo(u),l.video.codec=n.get(u.codecId),this.updateNetworkQualitySubscribe(this.vidNetworkQualityMap,l.video.inbound,l.video.prevInbound)}u.type==="candidate-pair"&&u.nominated&&(l.candidateStats.candidatePair=u,l.candidateStats.localCandidate=r.get(u.localCandidateId),l.candidateStats.remoteCandidate=r.get(u.remoteCandidate)),u.type==="codec"&&n.set(u.id,u)}),this.analyticsTracker.trackEventNoSharedProps(new wi(this.token,this.traceId,this.identifier,this.sfuResource,l.audio.inbound,l.candidateStats,l.audio.codec,e,this.sdpFeatures)),l.audio.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new Oi(this.token,this.traceId,this.identifier,this.sfuResource,l.audio.inbound,l.audio.prevInbound,l.candidateStats,l.audio.codec,this.sdpFeatures,t)),this.analyticsTracker.trackEventNoSharedProps(new hu(this.token,this.traceId,this.identifier,this.sfuResource,l.video.inbound,l.candidateStats,l.video.codec,e)),l.video.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new Gu(this.token,this.traceId,this.identifier,this.sfuResource,l.video.inbound,l.video.prevInbound,l.candidateStats,l.video.codec,t,this.seiStats.seiReadCnt,this.seiStats.seiBytesRead))}updateAndDiffSeiSubscribeStatsSinceLastUpdate(r){const a=this.prevVideoReceiverTransformerStats;if(!r)return{seiReadCnt:a.seiReadCnt,seiBytesRead:a.seiBytesRead};const c=r.seiReadCnt-a.seiReadCnt,l=r.seiBytesRead-a.seiBytesRead;return this.prevVideoReceiverTransformerStats={seiReadCnt:r.seiReadCnt,seiBytesRead:r.seiBytesRead},{seiReadCnt:c,seiBytesRead:l}}updateAndDiffSeiPublishStatsSinceLastUpdate(r){const a=this.prevVideoSenderTransformerStats;if(!r)return{seiWriteCnt:a.seiWriteCnt,seiBytesWritten:a.seiBytesWritten};const c=r.seiWriteCnt-a.seiWriteCnt,l=r.seiBytesWritten-a.seiBytesWritten;return this.prevVideoSenderTransformerStats={seiWriteCnt:r.seiWriteCnt,seiBytesWritten:r.seiBytesWritten},{seiWriteCnt:c,seiBytesWritten:l}}updateOutboundAudio(r){const a=r,c=this.prevOutboundAudioStats,l=r.id===(c==null?void 0:c.id)?c:void 0;return this.prevOutboundAudioStats=r,{outbound:a,prevOutbound:l}}updateInboundAudio(r){const a=r,c=this.prevInboundAudioStats,l=r.id===(c==null?void 0:c.id)?c:void 0;return this.prevInboundAudioStats=r,{inbound:a,prevInbound:l}}updateInboundVideo(r){const a=r,c=this.prevInboundVideoStats.get(zn),l=r.id===(c==null?void 0:c.id)?c:void 0;return this.prevInboundVideoStats.set(zn,r),{inbound:a,prevInbound:l}}updateOutboundVideo(r){const a=r,c=this.getPrevOutboundVideo(r),l=r.id===(c==null?void 0:c.id)?c:void 0;return this.setPrevVideoStat(r),{outbound:a,prevOutbound:l}}getPrevOutboundVideo(r){return this.simulcastEnabled&&r.rid&&this.prevOutboundVideoStats.has(r.rid)?this.prevOutboundVideoStats.get(r.rid):!this.simulcastEnabled&&this.prevOutboundVideoStats.has(zn)?this.prevOutboundVideoStats.get(zn):void 0}setPrevVideoStat(r){this.simulcastEnabled&&r.rid?this.prevOutboundVideoStats.set(r.rid,r):this.simulcastEnabled||this.prevOutboundVideoStats.set(zn,r)}convertLostRatioToQuality(r){return r<=0?In.EXCELLENT:r<=.01?In.GOOD:r<=.03?In.NORMAL:r<=.1?In.POOR:In.DOWN}}class Ku extends ot{constructor(r,a,c,l,n){super(Fe.MINUTE,r,a,!1),Object.assign(this.properties,{action:l?ve.PUBLISH:ve.SUBSCRIBE,is_publishing:l,minutes_logged:c,subscribed_number:n})}}class Ol extends ot{constructor(r){super(Fe.PUBLISH,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.PUBLISH,remote_participant_id:r.token.participantID})}}class mu extends ot{constructor(r){super(Fe.UNPUBLISH,r.token,r.traceId,!0),Object.assign(this.properties,{action:ve.PUBLISH,remote_participant_id:r.token.participantID})}}class Pc extends ot{constructor(r){var a,c,l,n;super(Fe.SUBSCRIBE,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.SUBSCRIBE,remote_participant_id:r.subscribedId,subscribed_id:r.subscribedId,is_edp_connected:r.isEdpConnected,is_reassignment:r.isReassignment,node:(c=(a=r.preAttemptSfuResource)===null||a===void 0?void 0:a.node)!==null&&c!==void 0?c:"",cluster:(n=(l=r.preAttemptSfuResource)===null||l===void 0?void 0:l.cluster)!==null&&n!==void 0?n:""})}}class Ju extends ot{constructor(r){super(Fe.UNSUBSCRIBE,r.token,r.traceId,!0),Object.assign(this.properties,{action:ve.SUBSCRIBE,remote_participant_id:r.unsubscribedId,unsubscribed_id:r.unsubscribedId})}}class Al extends ot{constructor(r){var a,c,l,n;super(Fe.PUBLISH_STARTED,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.PUBLISH,options_duration:r.optionsDuration,post_duration:r.postDuration,remote_participant_id:r.token.participantID,time_to_candidate:r.timeToCandidate,total_duration:r.totalDuration,edp_initial_connect_duration:r.edpInitialConnectDuration,edp_initial_connect_retry_times:r.edpInitialConnectRetries,edp_initial_state_duration:r.edpInitialStateDuration,edp_state_update_count:r.edpStateUpdateCount,sdp_exchange_duration:r.sdpExchangeDuration,sdp_exchange_transport:r.sdpExchangeTransport,set_remote_desc_duration:r.setRemoteDescDuration,peer_connection_duration:r.peerConnectionDuration,node:(c=(a=r.sfuResource)===null||a===void 0?void 0:a.node)!==null&&c!==void 0?c:"",cluster:(n=(l=r.sfuResource)===null||l===void 0?void 0:l.cluster)!==null&&n!==void 0?n:"",publish_retry_times:r.publishRetries,total_duration_with_retries:r.totalDurationWithRetries,protocol:r.protocol})}}class kl extends ot{constructor(r){super(Fe.PUBLISH_FAILED,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.PUBLISH,code:r.code,message:r.message,fatal:r.fatal,nominal:r.nominal,protocol:r.protocol})}}class Yu extends ot{constructor(r){super(Fe.PUBLISH_ENDED,r.token,r.traceId,!0),Object.assign(this.properties,{action:ve.PUBLISH,remote_participant_id:r.token.participantID,unpublish_successful:r.isUnpublishSuccessful,reason:r.reason,protocol:r.protocol})}}class Pl extends ot{constructor(r){var a,c,l,n;super(Fe.SUBSCRIBE_STARTED,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.SUBSCRIBE,options_duration:r.optionsDuration,post_duration:r.postDuration,remote_participant_id:r.remoteParticipantId,time_to_candidate:r.timeToCandidate,total_duration:r.totalDuration,edp_initial_connect_duration:r.edpInitialConnectDuration,edp_initial_connect_retry_times:r.edpInitialConnectRetries,edp_initial_state_duration:r.edpInitialStateDuration,edp_initial_state_publishing_count:r.edpInitialStatePublishingCount,edp_state_update_count:r.edpStateUpdateCount,sdp_exchange_duration:r.sdpExchangeDuration,sdp_exchange_transport:r.sdpExchangeTransport,set_remote_desc_duration:r.setRemoteDescDuration,peer_connection_duration:r.peerConnectionDuration,node:(c=(a=r.sfuResource)===null||a===void 0?void 0:a.node)!==null&&c!==void 0?c:"",cluster:(n=(l=r.sfuResource)===null||l===void 0?void 0:l.cluster)!==null&&n!==void 0?n:"",total_duration_with_retries:r.totalDurationWithRetries,subscribe_retry_times:r.subscribeRetryTimes,is_reassignment:r.isReassignment,protocol:r.protocol})}}class Dl extends ot{constructor(r){super(Fe.SUBSCRIBE_FAILED,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.SUBSCRIBE,remote_participant_id:r.remoteParticipantId,code:r.code,message:r.message,fatal:r.fatal,nominal:r.nominal,is_reassignment:r.isReassignment,protocol:r.protocol})}}class vu extends ot{constructor(r){super(Fe.SUBSCRIBE_ENDED,r.token,r.traceId,!0),Object.assign(this.properties,{action:ve.SUBSCRIBE,remote_participant_id:r.remoteParticipantId,unsubscribe_successful:r.isUnsubscribeSuccessful,reason:r.reason,protocol:r.protocol}),this.critical=!0}}class Bs extends ot{constructor(r){super(Fe.STATE_UPDATED,r.token,r.traceId,!1),Object.assign(this.properties,{audio_muted:r.isAudioMuted,is_disconnected:r.isDisconnected,is_publishing:r.isPublishing,other_participant_id:r.otherParticipantId,other_participant_user_id:r.otherParticipantUserId,video_stopped:r.isVideoStopped})}}class Dc extends ot{constructor(r){var a,c,l,n,e;super(Fe.FIRST_FRAME,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.SUBSCRIBE,remote_participant_id:r.remoteParticipantId,edp_initial_connect_duration:r.edpInitialConnectDuration,edp_initial_connect_retry_times:r.edpInitialConnectRetries,edp_initial_state_duration:r.edpInitialStateDuration,edp_initial_state_publishing_count:r.edpInitialStatePublishingCount,edp_state_update_count:r.edpStateUpdateCount,sdp_exchange_duration:r.sdpExchangeDuration,sdp_exchange_transport:r.sdpExchangeTransport,set_remote_desc_duration:r.setRemoteDescDuration,peer_connection_duration:r.peerConnectionDuration,node:(c=(a=r.sfuResource)===null||a===void 0?void 0:a.node)!==null&&c!==void 0?c:"",cluster:(n=(l=r.sfuResource)===null||l===void 0?void 0:l.cluster)!==null&&n!==void 0?n:"",video_was_paused:r.videoWasPaused,first_frame_duration:r.firstFrameDuration,total_duration_with_retries:r.totalDurationWithRetries,subscribe_retry_times:r.subscribeRetryTimes,media_type:r.mediaType,configured_jitter_buffer_min_delay_ms:(e=r.currentJitterBufferMinDelayInMs)!==null&&e!==void 0?e:0,protocol:r.protocol})}}class Nl extends ot{constructor(r){super(Fe.EDP_PONG,r.token,r.traceId,!1),Object.assign(this.properties,{event_endpoint:r.eventEndpoint,protocol:r.protocol,edp_rtt:r.edpRttMs})}}class Ml extends ot{constructor(r){super(Fe.JOIN,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.JOIN,event_endpoint:r.eventEndpoint,whip_endpoint:r.whipEndpoint})}}class Ll extends ot{constructor(r){super(Fe.JOIN_ATTEMPT,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.JOIN,event_endpoint:r.eventEndpoint,whip_endpoint:r.whipEndpoint})}}class Qu extends ot{constructor(r){super(Fe.JOIN_ATTEMPT_FAILED,r.token,r.traceId,!1),Object.assign(this.properties,{action:ve.JOIN,event_endpoint:r.eventEndpoint,whip_endpoint:r.whipEndpoint,code:r.code,message:r.message,fatal:r.fatal,nominal:r.nominal,connect_retry_times:r.retryCnt})}}class _u extends ot{constructor(r){super(Fe.EDP_DISCONNECTED,r.token,r.traceId,!1),Object.assign(this.properties,{event_endpoint:r.eventEndpoint,protocol:r.protocol}),this.critical=!0}}class Xu extends ot{constructor(r){super(Fe.EDP_CONNECTED,r.token,r.traceId,!1),Object.assign(this.properties,{event_endpoint:r.eventEndpoint,protocol:r.protocol,connect_retry_times:r.numRetries}),this.critical=!0}}class xl{constructor(r,a,c){this.token=r,this.analyticsTracker=c,this.protocol="",this.connecting=!1,this.closing=!1,this.windowUnloading=!1,this.maxConnectRetries=6,this.connectionAttempts=0,this.latestSequenceNumber=0,this.nextConnectionAttemptId=0,this.connectTimeoutId=0,this.latestPingTimestamp=0,this.pingIntervalId=0,this.pongTimeoutId=0,this.pingIntervalMs=15e3,this.pongTimeoutMs=3e4,this.attemptConnect=t=>{this.latestSequenceNumber=0,this.traceId=t||Jn(),this.connectionAttempts++,this.trackJoinAttempt(this.connectionAttempts);const{topic:i,rawToken:o}=this.token;this.connecting=!0,this.closing=!1;try{const u=encodeURIComponent(this.traceId.value),d=`topic=${i}/publishers`,h=`traceid=${u}`,_="error_over_ws=1",T=`${this.addr}?${_}&${d}&${h}`;this.socket=this.createWebSocket(T,o),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onopen=this.onOpen.bind(this),this.protocol=this.socket.protocol}catch(u){const d=u instanceof Error?u.message:void 0,h=this.createError(de.EVENT_PLANE_WS_CREATE_FAILED,d);this.trackJoinFailed(h,this.getRetryCount()),this.emitter.emit(ar,h)}},this.triggerSocketOpen=t=>{this.clearConnectionAttemptTimeouts();const i=this.getRetryCount();this.connectionAttempts=0,this.connecting=!1,this.trackJoinStarted(i),this.emitter.emit(Ra,{retryCnt:i,traceId:this.traceId,initialStageState:t}),this.pingIntervalId=window.setInterval(this.ping,this.pingIntervalMs)},this.ping=()=>{var t;if(this.logger.debug({msg:`${this.id}sending PING`}),!this.isSocketOpen()){const i=`${this.id} attempting to ping an unopened socket`;return this.logger.warn({msg:i}),void this.traceJoinOp(i)}this.latestPingTimestamp=performance.now(),this.pongTimeoutId===0&&(this.pongTimeoutId=window.setTimeout(this.pongTimedOut,this.pongTimeoutMs)),(t=this.socket)===null||t===void 0||t.send(JSON.stringify({type:"PING"}))},this.pongTimedOut=()=>{if(!this.isSocketOpen()){const i=`${this.id} attempting pong timeout on an unopened socket`;return this.logger.warn({msg:i}),void this.traceJoinOp(i)}this.logger.debug({msg:`${this.id} Pong timed out!`}),this.clearPingPongTracking();const t=this.createError(de.EVENT_PLANE_PONG_TIMEOUT);this.emitter.emit(ar,t)},this.beforeUnload=()=>{this.emitter.emit(wa,"beforeunload"),this.windowUnloading=!0},this.sendSdpOffer=(t,i,o,u,d,h,_,T)=>{var C;const R={type:"aws:ivs:SDP_OFFER",payload:{whipUrl:i,requestId:u,traceId:o,platform:"web",sdk:"1.28.0",whipVersion:uo,content:t,contentType:"application/sdp"}};d&&(R.payload.forceNode=d),h&&(R.payload.assignmentToken=h),_&&(R.payload.multiCodec=_);const w=ma()===void 0,P=ma()||w;T&&P&&(R.payload.initialLayerPref=ur(T)),(C=this.socket)===null||C===void 0||C.send(JSON.stringify(R))},this.checkNonFatalRetriesLimit=t=>{if(t.fatal||this.connectionAttempts<=this.maxConnectRetries)return Re.ok(!0);this.logger.debug({msg:`${this.id} maximum non-fatal retries of ${this.maxConnectRetries} exceeded`});const i=this.createError(de.JOIN_TIMED_OUT);return Re.err(i)},this.getRetryCount=()=>Math.max(this.connectionAttempts-1,0),this.trackSocketError=t=>{this.connecting&&this.trackJoinFailed(t,this.getRetryCount()),this.analyticsTracker.trackError(t)},this.trackJoinEnded=()=>{this.analyticsTracker.trackEventNoSharedProps(new _u({token:this.token,eventEndpoint:this.token.eventsURL,traceId:this.traceId,protocol:this.protocol}))},this.traceJoinOp=t=>{this.analyticsTracker.trackEventNoSharedProps(new lo(this.token,this.traceId,t,ve.JOIN))},this.logger=new Ze(a,Ft.SOCKET),this.emitter=new Cn.EventEmitter,this.traceId=Jn(),this.id=`[${Fo().value}] `;const l=gs("socketPingMs");l!==void 0&&(this.pingIntervalMs=l);const n=gs("socketPongMs");n!==void 0&&(this.pongTimeoutMs=n);const e=gs("socketConnectMaxRetries");e!==void 0&&(this.maxConnectRetries=e),window.addEventListener("beforeunload",this.beforeUnload)}connect(r,a,c=!1){this.close(),this.logger.debug({msg:`${this.id}connecting to ${this.addr}`}),this.addr=r,this.traceId=a,c&&!this.connecting&&(window.clearTimeout(this.connectTimeoutId),this.connectTimeoutId=window.setTimeout(this.connectTimedOut.bind(this),12e3)),this.attemptConnect(a)}send(r){var a;this.logger.debug({msg:`${this.id}sending ${JSON.stringify(r)}`}),this.logger.debug({msg:`${this.id}isReady called`}),this.isSocketOpen()?(a=this.socket)===null||a===void 0||a.send(JSON.stringify(r)):this.logger.warn({msg:"Trying to send data over stage socket that is not ready"})}close(){this.logger.debug({msg:`${this.id}closing`});const r=this.connecting,a=this.isSocketOpen(),c=this.socket&&this.socket.readyState===this.socket.CLOSING,l=this.getRetryCount();if(this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.connectionAttempts=0,this.socket){if(this.cleanupWebSocket(),a&&this.isStateMessageReceived())this.trackJoinEnded(),this.emitter.emit(wa,"intentional-close");else if(r&&!c){const n=this.createError(de.OPERATION_ABORTED);this.trackJoinFailed(n,l),this.analyticsTracker.trackError(n),this.emitter.emit(ar,n)}}}markSocketAsClosed(){this.closing=!0,this.connecting=!1}removeAllListeners(){window.removeEventListener("beforeunload",this.beforeUnload),this.emitter.removeAllListeners()}createWebSocket(r,a){return new WebSocket(r,a)}cleanupWebSocket(){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onopen=null,this.socket=void 0)}createError(r,a){return new ze(Object.assign({action:ve.JOIN,traceId:this.traceId,token:this.token,location:"StageSocket.connection",tag:si,details:a},r))}on(r,a){this.emitter.on(r,a)}off(r,a){this.emitter.off(r,a)}onMessage(r){this.logger.debug({msg:`${this.id}received message: ${r.data}`});try{const a=JSON.parse(r.data);switch(a.type){case"STAGE_STATE":case"aws:ivs:STAGE_STATE":{const c=a.payload.sequenceNumber;c>this.latestSequenceNumber&&(this.latestSequenceNumber===0&&this.connectTimeoutId>0?(this.triggerSocketOpen(a),window.setTimeout(()=>{this.emitter.emit(sr,a)})):this.emitter.emit(sr,a),this.latestSequenceNumber=c);break}case"PONG":window.clearTimeout(this.pongTimeoutId),this.pongTimeoutId=0,this.analyticsTracker.trackEventNoSharedProps(new Nl({token:this.token,eventEndpoint:this.token.eventsURL,protocol:this.protocol,traceId:this.traceId,edpRttMs:performance.now()-this.latestPingTimestamp}));break;case"REFRESH":this.emitter.emit(Oa);break;case"aws:ivs:SDP_ANSWER":this.emitter.emit(Rs,a.payload);break;case"aws:ivs:DISCONNECT":this.emitter.emit(Mt,a.payload);break;case"aws:ivs:REASSIGN":this.emitter.emit(Aa,a.payload);break;case"aws:ivs:INCOMPATIBLE_CODECS":this.emitter.emit(Fu,a.payload);break;case"aws:ivs:SSU":this.emitter.emit(Vu,a.payload);break;case"aws:ivs:JOIN_ERROR":this.handleJoinError(a.payload);break;default:(0,qt.noop)()}}catch(a){this.logger.debug({msg:`onMessage JSON Parse error: ${a}`}),this.emitter.emit(wn,a)}}onError(r){this.logger.debug({msg:`${this.id}error: ${JSON.stringify(r)}`})}onClose(r){if(this.logger.debug({msg:`${this.id} onClose triggered with code (closing = ${this.closing}, connecting = ${this.connecting})`}),this.clearPingPongTracking(),this.closing)return void(this.closing=!1);if(this.windowUnloading)return;const a=`code: ${r==null?void 0:r.code}, reason: ${r==null?void 0:r.reason}, wasClean: ${r==null?void 0:r.wasClean}`;if(this.connecting){const l=this.createError(de.EVENT_PLANE_WS_CLOSE_BEFORE_OPEN,a);return void this.handleSocketError(l)}this.logger.debug({msg:`${this.id}unexpected close`}),this.emitter.emit(wa,"unknown");const c=this.createError(de.EVENT_PLANE_WS_UNEXPECTED_CLOSE,a);this.trackJoinEnded(),this.emitter.emit(ar,c)}onOpen(){this.logger.debug({msg:`${this.id} socket opened`}),this.clearConnectionAttemptTimeouts(),this.connectTimeoutId=window.setTimeout(this.triggerSocketOpen,12e3)}clearConnectionAttemptTimeouts(){window.clearTimeout(this.nextConnectionAttemptId),window.clearTimeout(this.connectTimeoutId),this.nextConnectionAttemptId=0,this.connectTimeoutId=0}clearConnectionAttempts(){this.connectionAttempts=0}connectTimedOut(){this.connecting=!1,this.logger.debug({msg:`${this.id} Connect timed out!`});const r=this.createError(de.JOIN_TIMED_OUT);this.isSocketConnecting()&&this.trackJoinFailed(r,this.getRetryCount()),this.emitter.emit(ar,r),this.close()}clearPingPongTracking(){window.clearInterval(this.pingIntervalId),window.clearTimeout(this.pongTimeoutId),this.pingIntervalId=0,this.pongTimeoutId=0}handleJoinError(r){const a=function(l){var n,e;let t;switch(l.code){case Yn.TOKEN_EXPIRED:t=de.EXPIRED_TOKEN;break;case Yn.TOKEN_INVALID:case Yn.TOKEN_INVALID_SIGNATURE:case Yn.TOKEN_MISSING:t=de.MALFORMED_TOKEN;break;case Yn.STAGE_DELETED:t=de.STAGE_DELETED;break;case Yn.PARTICIPANT_DISCONNECTED:t=de.PARTICIPANT_DISCONNECTED;break;case Yn.INTERNAL:t=de.JOIN_SERVER_INTERNAL_ERROR;break;case Yn.BAD_REQUEST:t=de.JOIN_SERVER_BAD_REQUEST;break;default:t=Object.assign(Object.assign({},de.JOIN_FAILURE),{message:l.message||de.JOIN_FAILURE.message})}return Object.assign(Object.assign({},t),{fatal:(n=l.fatal)!==null&&n!==void 0?n:t.fatal,nominal:(e=l.nominal)!==null&&e!==void 0?e:t.nominal})}(r),c=this.createError(a,`JOIN_ERROR: ${r.code}`);this.logger.debug({msg:`${this.id} received JOIN_ERROR: ${JSON.stringify(r)}`}),this.handleSocketError(c)}handleSocketError(r){const a=this.checkNonFatalRetriesLimit(r);let c=r;a.ok||(c=a.error,c.details=`Timeout triggered by ${r.code}`),this.trackSocketError(c),this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.cleanupWebSocket(),c.fatal?(this.clearConnectionAttempts(),this.emitter.emit(ar,c)):this.queueExponentialBackoffRetry()}queueExponentialBackoffRetry(){let r=Math.pow(2,this.connectionAttempts-1);r>32&&(r=32),this.logger.debug({msg:`${this.id} reconnecting in ${r} seconds`}),window.clearTimeout(this.nextConnectionAttemptId),this.nextConnectionAttemptId=window.setTimeout(this.attemptConnect,1e3*r)}isSocketConnecting(){return this.socket&&this.socket.readyState===this.socket.CONNECTING}isSocketOpen(){return this.socket&&this.socket.readyState===this.socket.OPEN}isStateMessageReceived(){return this.latestSequenceNumber!==0}trackJoinStarted(r){this.analyticsTracker.trackEventNoSharedProps(new Xu({token:this.token,eventEndpoint:this.token.eventsURL,numRetries:r,protocol:this.protocol,traceId:this.traceId}))}trackJoinAttempt(r){const{token:a,traceId:c}=this;this.analyticsTracker.trackEvent(new Ll({token:a,eventEndpoint:(a==null?void 0:a.eventsURL)||"",whipEndpoint:(a==null?void 0:a.whipURL)||"",traceId:c}))}trackJoinFailed(r,a){const{token:c,traceId:l,code:n,message:e,fatal:t,nominal:i}=r;this.analyticsTracker.trackEvent(new Qu({token:c,eventEndpoint:c.eventsURL,whipEndpoint:c.whipURL,traceId:l,code:n,message:e,fatal:t,nominal:i,retryCnt:a}))}}var Zu=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})},ea,Gn,Jr,Lt;(function(s){s.SDP_EXCHANGE="xdp",s.JITTER_BUFFER_MIN_DELAY_MS="jit_buf_min_delay_ms"})(ea||(ea={})),function(s){s.USER_INITIATED="user-initiated",s.CLIENT_RECONNECT="reconnect",s.TOKEN_REUSED="token-reused",s.UNKNOWN="unknown",s.PARTICIPANT_DISCONNECTED="participant-disconnected",s.STAGE_DELETED="stage-deleted",s.TOKEN_EXPIRED="token-expired"}(Gn||(Gn={})),function(s){s[s.NOT_CONNECTED=0]="NOT_CONNECTED",s[s.CONNECTION_LOST=1]="CONNECTION_LOST",s[s.TIMEDOUT=2]="TIMEDOUT",s[s.ABORTED=3]="ABORTED",s[s.INVALID_MESSAGE=4]="INVALID_MESSAGE",s[s.UNEXPECTED_ERROR=5]="UNEXPECTED_ERROR"}(Jr||(Jr={})),function(s){s.DISCONNECTED="disconnected",s.CONNECTING="connecting",s.CONNECTED="connected",s.ERRORED="errored"}(Lt||(Lt={}));class Us extends lt{constructor(r,a,c){super(),this.token=r,this.nonScopedLogger=a,this.analyticsTracker=c,this.participants=new Map,this.disconnected=[],this.state={value:Lt.DISCONNECTED,context:{connectStartTime:0,hasConnected:!1}},this.features={sdpExchange:!1},this.stats=this.resetStats(),this.stageMinutesLogged=0,this.isStagePublishing=!1,this.onConnecting=(l,n)=>{this.logger.debug({msg:"onConnecting",context:l,event:n}),l.connectStartTime=performance.now();const e=n.type==="RECONNECT";e&&this.stageSocket.close();const{eventsURL:t}=this.token;this.emit(_n,Lt.CONNECTING),this.state.value=Lt.CONNECTING;const i=!e;this.stageSocket.connect(t,this.traceId,i)},this.onConnected=(l,n)=>{this.logger.debug({msg:"onConnected",context:l,event:n}),l.hasConnected=!0,this.emit(Il),this.emit(_n,Lt.CONNECTED),this.state.value=Lt.CONNECTED},this.onDisconnected=(l,n)=>{this.logger.debug({msg:"onDisconnected",context:l}),this.state.value=Lt.DISCONNECTED,this.stopStageMinuteLoggedInterval(!0),this.stageSocket.close(),l.hasConnected=!1,this.participants=new Map,this.disconnected=[],this.stageSocket.removeAllListeners(),this.resetStats(),this.emit(_n,Lt.DISCONNECTED,n)},this.onErrored=(l,n)=>{var e;this.logger.error({msg:"Connection failure occurred",err:n.payload.error}),this.emit(_n,Lt.ERRORED),this.emit(Ia,n.payload.error),this.state.value=Lt.ERRORED;const t=n.payload.error;if(t instanceof ze&&t.fatal&&(!((e=t.details)===null||e===void 0)&&e.includes("JOIN_ERROR"))&&l.hasConnected){const i=this.mapJoinErrorCodeToDisconnectReason(t);this.processStateUpdate({type:"DISCONNECT",reason:i})}else l.hasConnected?this.processStateUpdate({type:"RECONNECT"}):this.stageSocket.close()},this.processStateUpdate=l=>{const n=this.state.value,e=this.state.context;switch(n){case Lt.DISCONNECTED:l.type==="CONNECT"&&this.onConnecting(e,l);break;case Lt.CONNECTING:l.type==="RECONNECT"?this.onConnecting(e,l):l.type==="DISCONNECT"?this.onDisconnected(e,l.reason):l.type==="CONNECT_SUCCESS"?this.onConnected(e,l):l.type==="ERROR"&&this.onErrored(e,l);break;case Lt.CONNECTED:l.type==="RECONNECT"?this.onConnecting(e,l):l.type==="DISCONNECT"?this.onDisconnected(e,l.reason):l.type==="ERROR"&&this.onErrored(e,l);break;case Lt.ERRORED:l.type==="RECONNECT"?this.onConnecting(e,l):l.type==="DISCONNECT"&&this.onDisconnected(e,l.reason)}},this.measureConnect=(l,n)=>{const e=this.stats.edpConnectCount,t=e+1,i=performance.now(),o=i-n;return Object.assign(this.stats,{edpConnectCount:t,edpConnectDuration:o}),e===0&&Object.assign(this.stats,{edpInitialStartConnectTime:n,edpInitialFinishConnectTime:i,edpInitialConnectDuration:o,edpInitialConnectRetries:l}),this.stats},this.measureStateUpdate=l=>{const{edpInitialFinishConnectTime:n}=this.stats,e=this.stats.edpStateUpdateCount,t=e+1;return Object.assign(this.stats,{edpStateUpdateCount:t}),e===0&&Object.assign(this.stats,{edpInitialStateDuration:performance.now()-n,edpInitialStatePublishingCount:l}),this.stats},this.trackMessageParseError=l=>{this.logger.error({msg:"Message Parse Error occurred",err:l.err});const n=new ze({token:l.token,traceId:l.traceId,code:de.WEBSOCKET_MESSAGE_PARSE_FAILURE.code,tag:l.tag,location:l.location,message:l.message,details:l.err.message});this.analyticsTracker.trackEvent(new to(n))},this.trackStageSocketMessageParseError=(l,n,e)=>{this.trackMessageParseError({token:l,traceId:n,tag:si,location:"StageConnection.onMessage",message:de.WEBSOCKET_MESSAGE_PARSE_FAILURE.message,err:e})},this.trackStageStateMessageParseError=(l,n,e,t)=>{this.trackMessageParseError({token:l,traceId:n,tag:si,location:"StageConnection.onStageStateMessage",message:t,err:e})},this.onDisconnectMessage=l=>{this.analyticsTracker.trackEventNoSharedProps(new lo(this.token,this.traceId,`DISCONNECT message received: ${l.code}:${l.reason}`,ve.JOIN));let n=Gn.UNKNOWN;if(l.code==="PARTICIPANT_DISCONNECTED")n=Gn.PARTICIPANT_DISCONNECTED;else if(l.code==="STAGE_DELETED")n=Gn.STAGE_DELETED;else if(l.code==="TOKEN_REUSED"&&(n=Gn.TOKEN_REUSED,ln("disableTokenReuseMessage")))return void console.warn("Token reuse is detected, but skipping as feature is disabled");console.warn(`Disconnecting client due to: ${l.reason}`),this.processStateUpdate({type:"DISCONNECT",reason:n})},this.onReassignmentMessage=l=>{this.emit(_r,l)},this.onIncompatibleCodecsMessage=l=>{this.emit(an,l)},this.onSsuMessage=l=>{var n;const e=window.atob((n=l.A)!==null&&n!==void 0?n:"").trim();e&&e.startsWith("http")?nr.currentEndpoint=e:this.logger.warn({msg:"SSU Url invalid"})},this.onStageStateMessage=(l,n,e)=>{var t,i;this.logger.debug({msg:"State Stage Message occurred",state:e});const o=e.payload,u=(t=o.participants)!==null&&t!==void 0?t:[],d=(i=o.disconnected)!==null&&i!==void 0?i:[],h=[],_=[];this.measureStateUpdate(u.length),this.enableFeaturesBasedOnServerFeatures(o.serverFeatures||[]);const T=(C,R)=>{this.analyticsTracker.trackEventNoSharedProps(new Bs({token:l,otherParticipantId:C.id,otherParticipantUserId:C.userId,isAudioMuted:C.audioMuted,isVideoStopped:C.videoStopped,isPublishing:C.isPublishing,isDisconnected:R,traceId:n}))};this.participants.forEach(C=>{const R=u.find(w=>w.id===C.id);if(R){let w=!0,P=!1;["isPublishing","id","audioMuted","joinedAt","userId","videoStopped"].forEach(U=>{w=w&&R[U.toString()]===C[U.toString()],w||(C[U.toString()]=R[U.toString()],P=!0)}),Object.keys(C.attributes).forEach(U=>{w=w&&R.attributes[U]===C.attributes[U],w||(C.attributes=R.attributes,P=!0)}),P&&(T(C,!1),this.emit(yi,R))}else _.push(C)}),u.forEach(C=>{this.participants.get(C.id)||h.push(C)}),_.forEach(C=>{this.participants.delete(C.id),T(C,!0),this.emit(so,C)}),h.forEach(C=>{this.participants.set(C.id,C),T(C,!1),this.emit(cc,C)}),d.forEach(C=>{this.disconnected.find(R=>R.id===C.id)||(this.disconnected.push(C),C.status==="KICKED"&&this.emit(ci,C))}),this.disconnected=d},this.nonScopedLogger=a,this.logger=new Ze(a,Ft.CONNECTION),this.stageSocket=new xl(r,this.nonScopedLogger,c),this.token=r,this.traceId=Jn()}resetStats(){return this.stats={isConnected:!1,edpInitialStartConnectTime:0,edpInitialFinishConnectTime:0,edpConnectCount:0,edpInitialConnectDuration:0,edpConnectDuration:0,edpInitialStateDuration:0,edpInitialStatePublishingCount:0,edpStateUpdateCount:0,edpInitialConnectRetries:0},this.stats}connect(r){return Zu(this,void 0,void 0,function*(){return this.logger.debug({msg:"connect invoked",token:this.token,traceId:r}),this.traceId=r,this.state.value!==Lt.DISCONNECTED&&(this.logger.debug({msg:"Disconnecting previous connection"}),this.processStateUpdate({type:"DISCONNECT",reason:Gn.CLIENT_RECONNECT})),new Promise((a,c)=>{this.stageSocket.on(Ra,l=>{var n,e;const{retryCnt:t,initialStageState:i}=l;i&&this.enableFeaturesBasedOnServerFeatures((e=(n=i.payload)===null||n===void 0?void 0:n.serverFeatures)!==null&&e!==void 0?e:[]),this.traceId=l.traceId||Jn(),this.measureConnect(t,this.state.context.connectStartTime),this.processStateUpdate({type:"CONNECT_SUCCESS"}),this.startStageMinuteLoggedInterval(this.token,this.traceId),a(this.traceId)}),this.stageSocket.on(ar,l=>{c(l),this.processStateUpdate({type:"ERROR",payload:{error:l}})}),this.stageSocket.on(Oa,()=>{this.logger.debug({msg:"Refresh event occurred"}),this.emit(ou),this.processStateUpdate({type:"RECONNECT"})}),this.stageSocket.on(sr,l=>this.onStageStateMessage(this.token,this.traceId,l)),this.stageSocket.on(wn,l=>this.trackStageSocketMessageParseError(this.token,this.traceId,l)),this.stageSocket.on(Mt,this.onDisconnectMessage),this.stageSocket.on(Aa,this.onReassignmentMessage),this.stageSocket.on(Fu,this.onIncompatibleCodecsMessage),this.stageSocket.on(Vu,this.onSsuMessage),this.stageSocket.on(wa,l=>{this.stopStageMinuteLoggedInterval()}),this.processStateUpdate({type:"CONNECT",payload:{token:this.token,traceId:r}})})})}disconnect(){return this.logger.debug({msg:"disconnect invoked"}),this.processStateUpdate({type:"DISCONNECT",reason:Gn.USER_INITIATED}),this.traceId}getParticipant(r){return this.participants.get(r)}listConnectedParticipants(){const r=[];return this.participants.forEach(a=>{a.subscribed&&r.push(a)}),r}listAvailableParticipants(){return Array.from(this.participants.values())}emitStageState(r,a){this.stageSocket.send({audioMuted:r,type:"SET_STATE",version:"0",videoStopped:a})}setStagePublishing(r){this.isStagePublishing=r,this.emit(iu,this.isStagePublishing)}getIsStagePublishing(){return this.isStagePublishing}startStageMinuteLoggedInterval(r,a){this.uploadStageMinutesBroadcastInterval||(this.analyticsTracker.trackEvent(new Ku(r,a,this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++,this.uploadStageMinutesBroadcastInterval=setInterval(()=>{this.analyticsTracker.trackEvent(new Ku(r,a??Jn(),this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++},6e4))}stopStageMinuteLoggedInterval(r=!1){this.uploadStageMinutesBroadcastInterval&&(clearInterval(this.uploadStageMinutesBroadcastInterval),this.uploadStageMinutesBroadcastInterval=void 0),r&&(this.stageMinutesLogged=0)}enableFeaturesBasedOnServerFeatures(r){const a=(e,t)=>{this.trackStageStateMessageParseError(this.token,this.traceId,t,`Could not parse "${e}" from the Eevee server features list`)},c=r.includes(ea.SDP_EXCHANGE);this.features.sdpExchange!==c&&(this.logger.debug({msg:`XDP SDP exchange feature toggled: ${c}`}),this.features.sdpExchange=c);const l=r.find(e=>e.indexOf(ea.JITTER_BUFFER_MIN_DELAY_MS)!==-1),n=e=>{this.logger.debug({msg:`jitterBufferMinDelay feature updated to: ${e}`}),this.features.jitterBufferMinDelayInMs=e};if(l!==void 0)try{const e=l.split("=")[1],t=parseInt(e,10);if(isNaN(t))throw new Error("Unable to parse - result is NaN");if(t<0)throw new Error("Unable to apply - result is negative");this.features.jitterBufferMinDelayInMs!==void 0&&this.features.jitterBufferMinDelayInMs===t||n(t)}catch(e){a(l,e),n(void 0)}else n(void 0)}mapJoinErrorCodeToDisconnectReason(r){switch(r.code){case de.PARTICIPANT_DISCONNECTED.code:return Gn.PARTICIPANT_DISCONNECTED;case de.STAGE_DELETED.code:return Gn.STAGE_DELETED;case de.EXPIRED_TOKEN.code:return Gn.TOKEN_EXPIRED;default:return Gn.UNKNOWN}}isConnected(){return this.state.value===Lt.CONNECTED}supportsSdpExchange(){return this.features.sdpExchange}jitterBufferMinDelayInMs(){return this.features.jitterBufferMinDelayInMs}getConnectionStats(){return Object.assign({},this.stats,{isConnected:this.isConnected()})}exchangeSdp(r,a,c,l,n,e,t,i,o){return Zu(this,void 0,void 0,function*(){return this.isConnected()?new Promise((u,d)=>{const h=window.setTimeout(()=>{_(),d(Jr.TIMEDOUT)},12e3),_=()=>{window.clearTimeout(h),this.stageSocket.off(Rs,T),this.stageSocket.off(ar,C)},T=R=>{R.requestId===l&&(_(),u(R))},C=()=>{_(),d(Jr.CONNECTION_LOST)};n==null||n.addEventListener("abort",()=>{_(),d(Jr.ABORTED)}),this.stageSocket.on(Rs,T),this.stageSocket.on(ar,C),this.stageSocket.sendSdpOffer(r,a,c,l,e,t,i,o)}):Promise.reject(Jr.NOT_CONNECTED)})}}class Nc{constructor(r){this.token=r}}const Mc=new RegExp("^(?:[a-z+]+:)?//","i");function js(s){return Mc.test(s)}function Lc({sdpExchangeTransport:s,serverHttpResponse:r,serverErrorCode:a}){return`sdpExchangeTransport: ${s}, serverHttpResponse: ${r}, serverErrorCode: ${a}`}var el=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};const Bl={[Jr.ABORTED]:de.OPERATION_ABORTED,[Jr.NOT_CONNECTED]:de.EVENT_PLANE_WS_UNEXPECTED_CLOSE,[Jr.CONNECTION_LOST]:de.XDP_CONNECTION_LOST,[Jr.TIMEDOUT]:de.XDP_TIMEOUT,[Jr.INVALID_MESSAGE]:de.XDP_INVALID_ANSWER_MSG,[Jr.UNEXPECTED_ERROR]:de.XDP_UNEXPECTED_ERROR};class xc extends Nc{constructor(r,a,c,l){super(r),this.token=r,this.stageConnection=a,this.contextData=c,this.analyticsTracker=l}exchange(r){return el(this,void 0,void 0,function*(){const a=Fo(),{action:c}=this.contextData,{sdpOffer:l,url:n,traceId:e,forceNode:t,assignmentToken:i,multiCodec:o,abortController:u,initialLayerPreference:d}=r;let h;this.trackAttempt(n,a,e);try{h=yield this.stageConnection.exchangeSdp(l,n,e.value,a.value,u==null?void 0:u.signal,t,i,o,d)}catch(j){if(typeof j=="number")throw this.createClientSideErrorFromReasonCode(j,e,a,c)}if(!h)return;const{httpStatusCode:_,errorCode:T,location:C,content:R,sessionDeleteLink:w,subscriberControlLink:P,videoLayersLink:U}=h;if(_>=200&&_<300)return{sdpAnswer:R,url:n,location:C,sessionDeleteLink:w,mediaControls:P,layerControls:U};throw this.createServerSideError(e,a,_,T,c)})}trackAttempt(r,a,c){const{remoteParticipantId:l,action:n}=this.contextData;this.analyticsTracker.trackEventNoSharedProps(new hc(n,this.token,r,"POST",a.value,l,c,"xdp"))}createServerSideError(r,a,c,l,n){const e=this.baseErrorProps(r,a);let t=vr(c,l);return t||(t=de.UNKNOWN_SERVER_ERROR),new ze(Object.assign(Object.assign(Object.assign({action:n},e),t),{details:Lc({sdpExchangeTransport:"xdp",serverHttpResponse:c,serverErrorCode:l})}))}baseErrorProps(r,a){const{remoteParticipantId:c,action:l}=this.contextData;return{token:this.token,traceId:r,tag:Pt(l,c),location:"EdpSdpExchanger.exchange",requestUUID:a,remoteParticipantId:c}}createClientSideErrorFromReasonCode(r,a,c,l){const n=this.baseErrorProps(a,c),e=Bl[r];return new ze(e?Object.assign(Object.assign({action:l},n),e):Object.assign(Object.assign({action:l},n),de.XDP_INVALID_ANSWER_MSG))}getTransport(){return"sdp"}}var ta=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class Bc extends Nc{constructor(r,a,c){super(r),this.contextData=a,this.analyticsTracker=c}exchange(r){var a,c,l;return ta(this,void 0,void 0,function*(){const n=Fo(),{token:e}=this,{action:t,remoteParticipantId:i}=this.contextData,{sdpOffer:o,url:u,traceId:d,forceNode:h,assignmentToken:_,multiCodec:T,abortController:C,initialLayerPreference:R}=r;try{const P="POST",U="http";this.analyticsTracker.trackEventNoSharedProps(new hc(t,e,u,P,n.value,i,d,U));const j={data:o,headers:{Authorization:`Bearer ${e.rawToken}`,"Content-Type":"application/sdp","X-Stages-Platform":"web","X-Stages-Request-ID":n.value,"X-Stages-SDK":"1.28.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":d.value,"X-Stages-WHIP-Version":uo,[Fi]:(w=JSON.stringify({[Vi]:["sau"]}),btoa(w).replace(/[^A-Za-z0-9+/]/g,""))},method:P,responseType:"text",url:u,signal:C==null?void 0:C.signal,params:{}};h&&(j.params.force_node=h),_&&(j.params.assignment_token=_),T&&(j.params.multi_codec=!0);const B=ma()===void 0,$=ma()||B;R&&j.headers&&$&&(j.headers["X-Stages-Initial-Layer-Pref"]=ur(R));const{data:K,headers:Q,request:oe}=yield su(j),ce=this.parseWhipResource(u,Q.location,Q.link);return{url:oe.responseURL,sdpAnswer:K,location:ce==null?void 0:ce.location,sessionDeleteLink:ce==null?void 0:ce.sessionDeleteLink,mediaControls:ce==null?void 0:ce.mediaControls,layerControls:ce==null?void 0:ce.layerControls}}catch(P){if(g().isCancel(P))throw new ze(Object.assign(Object.assign({},hn(de.OPERATION_ABORTED,P)),{action:t,token:e,traceId:d,tag:Pt(t,i),location:"StagePeerClient.start",requestUUID:n,remoteParticipantId:i}));const U=Number((a=P==null?void 0:P.response)===null||a===void 0?void 0:a.status)||-1,j=((l=(c=P==null?void 0:P.response)===null||c===void 0?void 0:c.data)===null||l===void 0?void 0:l.code)||-1,B=function($,K){var Q;return $ instanceof ao.AxiosError&&$.response&&typeof $.response.status=="number"?$ instanceof ao.AxiosError&&$.code==="ERR_NETWORK"?de.NETWORK_FAILURE:vr(Number($.response.status),(Q=$.response.data)===null||Q===void 0?void 0:Q.code)||K:K}(P,de.WHIP_POST_FAILURE);throw new ze(Object.assign(Object.assign({},hn(B,P)),{action:t,token:e,traceId:d,tag:Pt(t,i),details:Lc({sdpExchangeTransport:"http",serverHttpResponse:U,serverErrorCode:j}),location:"StagePeerClient.start",requestUUID:n,remoteParticipantId:i}))}var w})}parseWhipResource(r,a,c){const l=new URL(r);let n;return n=function(e,t,i){if(!i)return e;if(e||(e={}),js(i))return e.location=i,e;const o=t.port?`:${t.port}`:"";return e.location=`${t.protocol}//${t.hostname}${o}${i}`,e}(n,l,a),n=function(e,t,i){if(!i)return e;e||(e={});const o=e;return i.split(",").forEach(u=>{const d=/<(.+)>;\s?rel="([a-z:-]+)"/.exec(u);if((d==null?void 0:d.length)!==3)return;let h;if(js(d[1]))h=d[1];else{const _=t.port?`:${t.port}`:"";h=`${t.protocol}//${t.hostname}${_}${d[1]}`}switch(d[2]){case"urn:ietf:params:whip:ivs-stages:session-delete":o.sessionDeleteLink=h;break;case"urn:ietf:params:whep:core:playback-controls":o.mediaControls=h;break;case"urn:ietf:params:whep:ext:core:layer":o.layerControls=h;break;default:return}}),o}(n,l,c),n}getTransport(){return"http"}}function Su(s){const{connection:r,token:a,action:c,identifier:l,tracker:n}=s,e=r&&r.supportsSdpExchange()&&r.isConnected(),t=c===ve.SUBSCRIBE&&e&&!ec()&&!ln("disableXdpSubscribe"),i=c===ve.PUBLISH&&e&&!ec()&&!ln("disableXdpPublish");return t||i?new xc(a,r,{action:c,remoteParticipantId:l},n):new Bc(a,{action:c,remoteParticipantId:l},n)}function $a({stageErrorValue:s,action:r,token:a,traceId:c,tag:l,identifier:n,details:e}){return new ze(Object.assign(Object.assign({},s),{token:a,traceId:c,location:"peer-client",tag:l,action:r,remoteParticipantId:n,details:e}))}var Wn;function Yr(s){var r;return!((r=s==null?void 0:s.sender)===null||r===void 0)&&r.createEncodedStreams?Wn.INSERTABLE_STREAMS:window.RTCRtpSender&&"transform"in RTCRtpSender.prototype&&window.RTCRtpScriptTransform?Wn.ENCODED_TRANSFORMS:Wn.NONE}function Qr(s){var r;return!((r=s==null?void 0:s.receiver)===null||r===void 0)&&r.createEncodedStreams?Wn.INSERTABLE_STREAMS:window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&window.RTCRtpScriptTransform?Wn.ENCODED_TRANSFORMS:Wn.NONE}function Ul(){return Ta()(`/*! For license information please see transform.worker.worker.js.LICENSE.txt */
(()=>{"use strict";const e=new Uint8Array([158,80,78,165,238,90,79,2,148,159,176,51,163,118,141,162]);var t;!function(e){e.VIDEO_SEND="video/send",e.VIDEO_RECEIVE="video/receive",e.INSERT_SEI="insertSei"}(t||(t={}));function n(t,n){const{transformerId:s,type:r,payloads:a}=n;let o=[];if("sei"===n.type){const{value:n,messages:s}=function(t,n){function s(e,t,n){return n+t.length<=e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function r(e,t){const n=function(e,t){return new Uint8Array([0,0,1,6,5,...t,...e])}(e,function(e){const t=[];for(;e>=255;)t.push(255),e-=255;return t.push(e),new Uint8Array(t)}(t.length+e.length)),s=function(e){const t=[...e];let n=3;for(;n<t.length-2;)0!==t[n]||0!==t[n+1]||0!==t[n+2]&&1!==t[n+2]&&2!==t[n+2]&&3!==t[n+2]?n+=1:(t.splice(n+2,0,3),n+=3);return t}(new Uint8Array([...n,...t,128]));return new Uint8Array(s)}function a(e,n){const r=function(e){const t=new DataView(e);for(let e=0;e<t.byteLength-4;e++)if(s(t,[0,0,1],e)){const n=31&t.getUint8(e+3);if(n>=1&&n<=5)return e}return-1}(t.data);if(r>=0){const e=new ArrayBuffer(t.data.byteLength+n.byteLength),s=new Uint8Array(e);return s.set(new Uint8Array(t.data.slice(0,r)),0),s.set(n,r),s.set(new Uint8Array(t.data.slice(r)),r+n.byteLength),e}return e}return function(){const s=[];for(let o=0;o<n.length;o+=1){const i=r(e,new Uint8Array(n[o]));t.data=a(t.data,i),s.push({uuid:e,payload:n[o]})}return{value:t,messages:s}}()}(t,a||[]);t=n,o=s}return{success:!0,frame:t,transformerId:s,type:r,seiResult:o}}const s=function(){let e=[];const t=new Map;return{add:({payload:t,repeatCount:n})=>(e.push({payload:t,repeatCount:n}),!0),poll(n){t.has(n)||t.set(n,[]),t.size>0&&(t.forEach((t=>{t.push(...e)})),e=[]);const s=t.get(n)||[],r=s.filter((e=>e.repeatCount>0)).map((e=>Object.assign(Object.assign({},e),{repeatCount:e.repeatCount-1})));return t.set(n,r),s}}}(),r=e=>(t,r)=>{try{const a=t.getMetadata().synchronizationSource,o=(s?s.poll(a):[]).map((e=>e.payload)),i=n(t,Object.assign(Object.assign({},e),{payloads:o}));r.enqueue(i.frame),self.postMessage(Object.assign({success:i.success,seiResult:i.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}},a=e=>(t,n)=>{try{const s=function(e,t){const{type:n,transformerId:s}=t;if("sei"===n){const t=function(e){function t(e,t,n){return n+t.length<e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function n(e){const t=[];let n=0;for(;n<e.length;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(t.push(e[n]),t.push(e[n+1]),n+=3):(t.push(e[n]),n+=1);return new Uint8Array(t)}function s(e){let t=2;const n=e.byteLength;for(;t<n;){let s=0;for(;t<n&&255===e[t];)s+=255,t++;s+=e[t],t++;const r=Math.min(t+s,n),a=new Uint8Array(e.slice(t,r));return{uuid:a.slice(0,16),payload:a.slice(16)}}}return{messages:function(e){const r=new DataView(e.data),a=[];let o=0;if(!t(r,[0,0,1],0)&&!t(r,[0,0,0,1],0))return[];for(;o<r.byteLength-5;)if(t(r,[0,0,1],o)){const i=o+3;o=i;const c=31&r.getUint8(o),u=31&r.getUint8(o+1);if(6===c&&5===u){for(;o<r.byteLength&&!t(r,[0,0,1],o);)o++;const c=o,u=s(n(new Uint8Array(e.data.slice(i,c))));u&&a.push(Object.assign({},u))}else o++}else o++;return a}(e),frame:e}}(e),{frame:r,messages:a}=t;return{success:!0,frame:r,type:n,transformerId:s,seiResult:a}}return{success:!0,frame:e,transformerId:s,type:n}}(t,e);n.enqueue(s.frame),self.postMessage(Object.assign({success:s.success,seiResult:s.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}};function o(e,t,n,s){const o=new TransformStream({transform:"video/send"===e?r(t):a(t)});n.pipeThrough(o).pipeTo(s)}const i=self;i.addEventListener("message",(function(e){var n,r,a;if(!(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.operation)||!(null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.transformerId))return;const{operation:i,transformerId:c}=e.data;switch(i){case t.VIDEO_SEND:case t.VIDEO_RECEIVE:o(i,{method:i,transformerId:c,type:"sei"},e.data.readable,e.data.writable);break;case t.INSERT_SEI:s.add({payload:e.data.payload,repeatCount:null!==(a=e.data.repeatCount)&&void 0!==a?a:0})}})),i.addEventListener("rtctransform",(function(e){const t=e.transformer;if(!t)return;o(t.options.method,t.options,t.readable,t.writable)}))})();`,"Worker",void 0,void 0)}(function(s){s.NONE="none",s.ENCODED_TRANSFORMS="encodedTransforms",s.INSERTABLE_STREAMS="insertableStreams"})(Wn||(Wn={}));const hi=(()=>{const s={};return{getWorker:r=>(s[r]||(s[r]=new Ul),s[r]),destroy:r=>{var a;(a=s[r])===null||a===void 0||a.terminate(),s[r]=void 0}}})();var Be;(function(s){s.NOT_PUBLISHING_VIDEO="NOT_PUBLISHING_VIDEO",s.INBAND_MESSAGING_NOT_ENABLED="INBAND_MESSAGING_NOT_ENABLED",s.INVALID_REPEAT_COUNT="INVALID_REPEAT_COUNT",s.PAYLOAD_SIZE_INVALID="PAYLOAD_SIZE_INVALID",s.PAYLOAD_RATE_EXCEEDED="PAYLOAD_RATE_EXCEEDED",s.INVALID_TRACK_TYPE="INVALID_TRACK_TYPE"})(Be||(Be={}));class ut{constructor(r){this.maxFramerate=r,this.queued=[]}validateMessagePayload(r,a){if(r.byteLength<=0)return Re.err(Be.PAYLOAD_SIZE_INVALID);if(a<0||a>30)return Re.err(Be.INVALID_REPEAT_COUNT);if(r.byteLength>1024)return Re.err(Be.PAYLOAD_SIZE_INVALID);this.queued=this.trimPastPayloads(this.queued,1e3);const{before:c,after:l}=this.getPayloadSums(this.queued);if(c+r.byteLength>10240||l+r.byteLength*Math.max(1,a)>10240)return Re.err(Be.PAYLOAD_RATE_EXCEEDED);if(this.queued.push({byteLength:r.byteLength,timestamp:Date.now()}),a>0){const n=1e3/this.maxFramerate;let e=Date.now()+n;for(let t=0;t<a;t+=1)this.queued.push({byteLength:r.byteLength,timestamp:e}),e+=n}return Re.ok(!0)}trimPastPayloads(r,a){const c=Date.now()-a;return r.filter(l=>l.timestamp>c)}getPayloadSums(r){const a=Date.now();return r.reduce((c,l)=>{const{before:n,after:e}=c;return l.timestamp<=a?{before:n+l.byteLength,after:e}:{before:n,after:e+l.byteLength}},{before:0,after:0})}}const fr="seiMessageReceived",yt="error";var ft;(function(s){s.CREATED="created",s.INITIALIZED="initialized",s.DESTROYED="destroyed"})(ft||(ft={}));class Yi extends lt{constructor(r){super(),this.sessionId=r,this.state=ft.CREATED,this.transformerId=Fo().value,this.prevResultWasError=!1,this.consecutiveErrorResults=0,this.seiReadCnt=0,this.seiBytesRead=0,this.onMessage=a=>{this.onTransformResult(a.data)}}initializeInsertableStreams(r){var a,c;this.worker=hi.getWorker(this.sessionId);const l=r.receiver.createEncodedStreams(),{readable:n,writable:e}=l;(a=this.worker)===null||a===void 0||a.postMessage({operation:"video/receive",transformerId:this.transformerId,readable:n,writable:e},[n,e]),(c=this.worker)===null||c===void 0||c.addEventListener("message",this.onMessage)}initializeEncodedTransforms(r){var a;this.worker=hi.getWorker(this.sessionId);const c={method:"video/receive",type:"sei",transformerId:this.transformerId};r.receiver.transform=new RTCRtpScriptTransform(this.worker,c),(a=this.worker)===null||a===void 0||a.addEventListener("message",this.onMessage)}initialize(r,a){if(this.state!==ft.CREATED)return!1;const c=Qr(r);if(c===Wn.NONE)return!1;if(a&&c===Wn.INSERTABLE_STREAMS)this.initializeInsertableStreams(r);else{if(a||c!==Wn.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(r)}return this.transceiver=r,this.state=ft.INITIALIZED,!0}onTransceiverAdd(r){return this.initialize(r,!0)}onTrackEvent(r){return r.track.kind==="video"&&this.initialize(r.transceiver,!1)}static isSupported(r){return Qr(r)!==Wn.NONE}onTransformResult(r){return r.transformerId===this.transformerId&&(r.success?(this.prevResultWasError=!1,this.consecutiveErrorResults=0,!!r.seiResult&&(r.seiResult.forEach(a=>{const{payload:c,uuid:l}=a;this.updateReadStats(a),this.emit(fr,{uuid:l,payload:c})}),r.seiResult.length>0)):(this.prevResultWasError&&this.consecutiveErrorResults++,this.consecutiveErrorResults>=300&&this.onError(r,de.TRANSFORM_TOO_MANY_ERRORS),this.prevResultWasError=!0,this.onError(r,de.TRANSFORM_UNEXPECTED_ERROR),!1))}updateReadStats(r){this.seiReadCnt++,this.seiBytesRead+=r.payload.byteLength}getReceiverStats(){const{seiBytesRead:r,seiReadCnt:a}=this;return{seiReadCnt:a,seiBytesRead:r}}onError(r,a){const{type:c}=r;this.emit(yt,{type:c,stageErrorValue:a})}destroy(){var r,a;this.state!==ft.DESTROYED&&(this.removeAllListeners(),(r=this.worker)===null||r===void 0||r.removeEventListener("message",this.onMessage),!((a=this.transceiver)===null||a===void 0)&&a.receiver&&(this.transceiver.receiver.transform=null),this.state=ft.DESTROYED)}getState(){return this.state}}class Uc{constructor(r){this.sessionId=r,this.state=ft.CREATED,this.transformerId=Fo().value,this.seiWriteCnt=0,this.seiBytesWritten=0,this.onMessage=a=>{this.onTransformResult(a.data)}}initializeInsertableStreams(r,a){var c,l;this.worker=hi.getWorker(this.sessionId);const n=r.sender.createEncodedStreams(),{readable:e,writable:t}=n;(c=this.worker)===null||c===void 0||c.postMessage({operation:"video/send",transformerId:this.transformerId,readable:e,writable:t},[e,t]),(l=this.worker)===null||l===void 0||l.addEventListener("message",this.onMessage)}initializeEncodedTransforms(r,a){var c;this.worker=hi.getWorker(this.sessionId);const l={method:"video/send",type:"sei",transformerId:this.transformerId,encodingLayers:a};r.sender.transform=new RTCRtpScriptTransform(this.worker,l),(c=this.worker)===null||c===void 0||c.addEventListener("message",this.onMessage)}initialize(r){var a;if(this.state!==ft.CREATED)return!1;const c=Yr(r);if(c===Wn.NONE)return!1;const l=r.sender.getParameters(),n=((a=l==null?void 0:l.encodings)===null||a===void 0?void 0:a.length)||1;if(c===Wn.INSERTABLE_STREAMS)this.initializeInsertableStreams(r,n);else{if(c!==Wn.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(r,n)}return this.transceiver=r,this.state=ft.INITIALIZED,!0}static isSupported(r){return Yr(r)!==Wn.NONE}sendSeiMessage(r,a){var c;return this.state===ft.INITIALIZED&&this.transceiver?((c=this.worker)===null||c===void 0||c.postMessage({operation:"insertSei",transformerId:this.transformerId,payload:r,repeatCount:a}),Re.ok(!0)):Re.err(Be.NOT_PUBLISHING_VIDEO)}onTransceiverAdd(r){return this.initialize(r)}onTrackEvent(r){return!1}onTransformResult(r){return r.transformerId===this.transformerId&&(r.success&&this.updateSendStats(r),r.success)}updateSendStats(r){r.seiResult&&r.seiResult.forEach(a=>{this.seiWriteCnt++,this.seiBytesWritten+=a.payload.byteLength})}getSenderStats(){const{seiBytesWritten:r,seiWriteCnt:a}=this;return{seiWriteCnt:a,seiBytesWritten:r}}destroy(){var r;this.state!==ft.DESTROYED&&(!((r=this.transceiver)===null||r===void 0)&&r.receiver&&(this.transceiver.receiver.transform=null),this.state=ft.DESTROYED)}getState(){return this.state}}class fi extends ot{constructor(r,a,c,l,n,e,t,i,o){super(Fe.SELECTED_PAIR_CHANGE,a,c,!1),Object.assign(this.properties,{action:r,protocol:l,local_type:n,local_addr:e,remote_addr:t,local_candidate_priority:i,remote_participant_id:o})}}var Kt=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};let Qi=null;class Jt extends lt{constructor(r,a,c,l,n,e,t,i,o){var u;if(super(),this.analyticsTracker=e,this.subscribeConfig=o,this.sfuResource={node:"",cluster:""},this.protocol="",this.incompatibleCodecs=new Set,this.connect=({audioOnly:d=!1,traceId:h,iceRestartOptions:_})=>Kt(this,void 0,void 0,function*(){const{token:T,tag:C,identifier:R,action:w}=this,P=!!_,U=new AbortController;let j,B,$;this.abortController=U,this.traceId=h,this.protocol="",this.perfTracker.resetMeasurements(h);const K=()=>{j&&this.off(io,j),B&&this.off(wt,B)},Q=new Promise((oe,ce)=>{const ae=function({action:be,token:Ce,traceId:_e,tag:Se,identifier:Le}){const et=be===ve.SUBSCRIBE?de.SUBSCRIBE_TIMED_OUT:de.PUBLISH_TIMED_OUT;return new ze(Object.assign(Object.assign({},et),{action:be,token:Ce,traceId:_e,tag:Se,location:"connect",remoteParticipantId:Le}))}({action:w,token:T,traceId:h,tag:C,identifier:R}),te=function({action:be,token:Ce,traceId:_e,tag:Se}){const Le=de.OPERATION_ABORTED;return new ze(Object.assign(Object.assign({},Le),{token:Ce,traceId:_e,location:"peer-client.connect",tag:Se,action:be}))}({action:w,token:T,traceId:h,tag:C}),pe=setTimeout(()=>{this.stop(),this.analyticsTracker.trackError(ae),ce(ae)},1e4);j=be=>{clearTimeout(pe),P||this.stop(),ce(be)},B=be=>{if(be===xe.CONNECTED)clearTimeout(pe),oe();else if(be===xe.FAILED){const Ce=function({action:_e,token:Se,traceId:Le,tag:et}){return new ze(Object.assign(Object.assign({},de.PEER_CONNECTION_NETWORK_FAILURE),{token:Se,traceId:Le,location:"peer-client.connect",tag:et,action:_e}))}({action:w,token:T,traceId:h,tag:C});clearTimeout(pe),ce(Ce)}},this.on(io,j),this.on(wt,B),$=()=>{clearTimeout(pe)},U.signal.aborted&&(clearTimeout(pe),ce(te)),U.signal.addEventListener("abort",()=>{clearTimeout(pe),ce(te)})});try{const oe=yield Promise.all([Kt(this,void 0,void 0,function*(){P||(yield this.start(),this.mediaStream=yield this.initializePeerConnection(d));const ae=_==null?void 0:_.assignmentToken,te=_==null?void 0:_.nodeOverride;return yield this.exchangeSdp({iceRestart:P,nodeOverride:te,assignmentToken:ae,abortController:U}),this.mediaStream}),Q]);this.statsReporter.traceId=h;const ce=oe[0];if(this.abortController=void 0,!P&&w===ve.PUBLISH)try{yield this.verifyOrUpdateTransceiverSync()}catch(ae){this.logger.error({err:ae,msg:"error syncing transceivers"})}return{mediaStream:ce}}catch(oe){throw $&&$(),oe}finally{K()}}),this.disconnect=(d=!1)=>Kt(this,void 0,void 0,function*(){var h;const{token:_,action:T}=this;(h=this.abortController)===null||h===void 0||h.abort(),this.stop(),this.protocol="",d?this.cleanup(T,_.participantID,_,d):yield this.cleanup(T,_.participantID,_,d)}),this.resetTransformers=()=>{var d,h;(d=this.videoSenderTransformer)===null||d===void 0||d.destroy(),this.videoSenderTransformer=this.createVideoSenderTransformer(),(h=this.videoReceiverTransformer)===null||h===void 0||h.destroy(),this.videoReceiverTransformer=this.createVideoReceiverTransformer(),this.statsReporter.resetTransformers(this.videoReceiverTransformer,this.videoSenderTransformer)},this.onTrack=d=>{var h,_;const{token:T,action:C,traceId:R,identifier:w}=this;this.trace(T,R,`onTrack: ${d.track.kind}`,C,w),this.sendInBandMessagingEnabled&&((h=this.videoSenderTransformer)===null||h===void 0||h.onTrackEvent(d)),this.receiveInBandMessagingEnabled&&((_=this.videoReceiverTransformer)===null||_===void 0||_.onTrackEvent(d))},this.onIceGatheringStateChange=()=>{var d,h,_;const{token:T,action:C,traceId:R,identifier:w}=this;if(((d=this.peerConnection)===null||d===void 0?void 0:d.iceGatheringState)==="gathering"?this.perfTracker.markIceGatheringStart():((h=this.peerConnection)===null||h===void 0?void 0:h.iceGatheringState)==="complete"&&this.perfTracker.markIceGatheringStop(),this.peerConnection){const P=this.peerConnection.iceGatheringState,U=new mc(C,T,R,P,w);this.analyticsTracker.trackEventNoSharedProps(U)}this.trace(T,R,`ICE gathering state change: ${(_=this.peerConnection)===null||_===void 0?void 0:_.iceGatheringState}`,C,w)},this.onSelectedCandidatePairChange=()=>{var d,h,_,T,C,R,w,P,U,j,B,$,K,Q;const{token:oe,action:ce,traceId:ae,identifier:te}=this,pe=(h=(d=this.peerConnection)===null||d===void 0?void 0:d.getReceivers()[0].transport)===null||h===void 0?void 0:h.iceTransport,be=pe==null?void 0:pe.getSelectedCandidatePair();if(be){const{local:Ce,remote:_e}=be,Se=`Selected candidate pair change (local, remote): ${Ce==null?void 0:Ce.candidate}, ${_e==null?void 0:_e.candidate}`;this.logger.debug({msg:Se});const Le=new fi(ce,oe,ae,(T=(_=be.local)===null||_===void 0?void 0:_.protocol)!==null&&T!==void 0?T:"",(R=(C=be.local)===null||C===void 0?void 0:C.type)!==null&&R!==void 0?R:"",(P=(w=be.local)===null||w===void 0?void 0:w.address)!==null&&P!==void 0?P:"",(j=(U=be.remote)===null||U===void 0?void 0:U.address)!==null&&j!==void 0?j:"",($=(B=be.local)===null||B===void 0?void 0:B.priority)!==null&&$!==void 0?$:0,te);this.analyticsTracker.trackEvent(Le),this.protocol=(Q=(K=be.local)===null||K===void 0?void 0:K.protocol)!==null&&Q!==void 0?Q:""}},this.onIceCandidate=d=>Kt(this,void 0,void 0,function*(){var h,_;const{identifier:T,action:C,traceId:R}=this,w=(h=d.target.localDescription)===null||h===void 0?void 0:h.sdp.includes("relay");this.analyticsTracker.trackEventNoSharedProps(new lo(this.token,R,`ice candidate: hasRelay = ${w}, candidate = ${(_=d.candidate)===null||_===void 0?void 0:_.candidate}`,C,T))}),this.onMute=()=>Kt(this,void 0,void 0,function*(){const{token:d,action:h,traceId:_,identifier:T}=this;this.trace(d,_,"Track has muted",h,T)}),this.onUnMute=()=>Kt(this,void 0,void 0,function*(){const{token:d,action:h,traceId:_,identifier:T}=this;this.trace(d,_,"Track has unmuted",h,T)}),this.fetchAndSetRemoteDescription=d=>Kt(this,void 0,void 0,function*(){var h,_,T,C;const R=(_=(h=this.peerConnection)===null||h===void 0?void 0:h.localDescription)===null||_===void 0?void 0:_.sdp;R||this.logger.warn({msg:"Unexpected state: No SDP offer when attempting to fetch remote description"});const{token:w,traceId:P,action:U,identifier:j,tag:B}=this,{endpointURL:$,nodeOverride:K,assignmentToken:Q,multiCodec:oe,abortController:ce}=d;let ae;this.perfTracker.markPostStart(),this.perfTracker.markSdpExchangeStart();try{const _e=Su({connection:this.stageConnection,action:U,token:w,identifier:this.identifier,tracker:this.analyticsTracker});this.perfTracker.setTransport(_e.getTransport());const Se=K||Mn("node")||Mn("dataPlaneEndpoint");ae=yield _e.exchange({sdpOffer:R,url:$,traceId:P,forceNode:Se,assignmentToken:Q,multiCodec:oe,abortController:ce,initialLayerPreference:(T=this.simulcastSubscribeConfig)===null||T===void 0?void 0:T.initialLayerPreference})}catch(_e){let Se=_e;Se instanceof ze||(Se=new ze(Object.assign(Object.assign({},de.UNEXPECTED_ERROR),{action:U,token:w,traceId:P,tag:B,details:_e instanceof Error?_e.message:"",location:"sdp-exchange"}))),Se instanceof ze&&(this.analyticsTracker.trackError(Se),this.emit(io,Se))}if(this.perfTracker.markSdpExchangeStop(),!ae)return;const{location:te,sessionDeleteLink:pe,mediaControls:be}=ae;let Ce=ae.sdpAnswer;try{Ce=this.mungeSdpAnswer(Ce),ae.sdpAnswer=Ce}catch(_e){this.logger.error({err:_e,msg:"Error while attempting to munge SDP, keeping original answer"})}this.statsReporter.sdpAnswer=Ce,this.emit(Ui,ae),te&&(this.whipResource={location:te,sessionDeleteLink:pe,mediaControls:be},this.sfuResource=function(_e){const Se=_e.match(/https:\/\/([^/]+)\//);if(Se){const Le=Se[1].split(".");if(Le[0].includes("video-rtx"))return{node:`${Le[0]}.${Le[1]}`,cluster:Le[1]}}}(te)||{node:"",cluster:""},this.statsReporter.updateSfuResource(this.sfuResource));try{this.perfTracker.markSetRemoteDescStart(),yield(C=this.peerConnection)===null||C===void 0?void 0:C.setRemoteDescription({sdp:Ce,type:"answer"}),this.perfTracker.markSetRemoteDescStop(),this.perfTracker.markPostStop()}catch(_e){const Se=new ze(Object.assign(Object.assign({},de.SET_ANSWER_FAILURE),{action:U,token:w,traceId:P,tag:Pt(U,j),location:"setRemoteDescription",remoteParticipantId:j,details:_e instanceof Error?_e.message:""}));this.analyticsTracker.trackError(Se),this.emit(io,Se)}}),this.cleanup=(d,h,_,T=!1)=>Kt(this,void 0,void 0,function*(){var C,R,w;const P=Fo();if(this.toggleStageConnectionListeners(!1),this.currentJitterBufferMinDelayInMs=void 0,this.stageConnection=void 0,this.closeFailedPeerConnections(),!(!((C=this.whipResource)===null||C===void 0)&&C.location))return this.trace(_,this.traceId,"whipResource location not known, exiting cleanup",d,h),void this.analyticsTracker.trackError(new ze(Object.assign(Object.assign({},de.WHIP_URL_MISSING),{action:d,token:_,traceId:this.traceId,tag:Pt(d,h),location:d===ve.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:P,remoteParticipantId:h})));let U=this.whipResource.location;if(this.trace(_,this.traceId,`use hostnamecachedurl: ${U}`,d,h),T){if(!((w=this.whipResource)===null||w===void 0)&&w.sessionDeleteLink){U=this.whipResource.sessionDeleteLink,this.trace(_,this.traceId,`DELETE via session-delete beacon path: ${U}`,d,h);try{navigator.sendBeacon(U,JSON.stringify({authorization:_.rawToken}))}catch(j){this.analyticsTracker.trackErrorAndThrow(new ze(Object.assign(Object.assign({},hn(de.WHIP_DELETE_FAILURE,j)),{action:d,token:_,traceId:this.traceId,tag:Pt(d,h),location:ve.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:P,remoteParticipantId:h})))}}}else try{yield g().delete(U,{headers:{Authorization:`Bearer ${_.rawToken}`,"X-Stages-Platform":"web","X-Stages-Request-ID":P.value,"X-Stages-SDK":"1.28.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":this.traceId.value,"X-Stages-WHIP-Version":uo}})}catch(j){((R=j.response)===null||R===void 0?void 0:R.status)===404?this.trace(_,this.traceId,`DELETE returned 404, ignoring, action = ${d}, uuid = ${P.value}`,d,h):this.analyticsTracker.trackErrorAndThrow(new ze(Object.assign(Object.assign({},hn(de.WHIP_DELETE_FAILURE,j)),{action:d,token:_,traceId:this.traceId,tag:Pt(d,h),location:ve.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:P,remoteParticipantId:h})))}}),this.getConnectionState=()=>{if(!this.peerConnection)return xe.NONE;const d=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;try{return Pa(d)}catch{return this.logger.warn({msg:"Unhandled connection state:",rawState:d}),xe.IDLE}},this.onIceCandidateError=d=>{const{token:h,traceId:_,tag:T}=this;if(d.errorCode!==701){const C=new ze(Object.assign(Object.assign({},de.ICE_CANDIDATE_ERROR),{action:this.action,token:h,traceId:_,tag:T,location:"onIceCandidateError",remoteParticipantId:this.identifier}));this.analyticsTracker.trackError(C),this.emit(io,C)}},this.onIceConnectionStateChange=()=>{var d,h;const{token:_,traceId:T,action:C,identifier:R}=this;this.trace(_,T,`ICE connection state change: ${(d=this.peerConnection)===null||d===void 0?void 0:d.iceConnectionState}`,C,R),((h=this.peerConnection)===null||h===void 0?void 0:h.iceConnectionState)==="checking"&&this.peerConnection.getTransceivers().forEach(({receiver:w,sender:P})=>{[w,P].forEach(U=>{var j,B;(B=(j=U==null?void 0:U.transport)===null||j===void 0?void 0:j.iceTransport)===null||B===void 0||B.addEventListener("selectedcandidatepairchange",this.onSelectedCandidatePairChange)})}),this.onConnectionStateChange()},this.createVideoSenderTransformer=()=>new Uc(this.analyticsTracker.getSessionId()),this.createVideoReceiverTransformer=()=>{const d=new Yi(this.analyticsTracker.getSessionId()),{token:h,tag:_,identifier:T,action:C,traceId:R}=this;d.on(fr,U=>{this.emit(Ar,U)});const w=function(U,j){let B=0;return function(...$){const K=Date.now();K-B>=j&&(B=K,U(...$))}}(U=>{const j=`Transform error occurred: ${U.type}`,B=$a({traceId:R,token:h,tag:_,identifier:T,action:C,details:j,stageErrorValue:de.TRANSFORM_UNEXPECTED_ERROR});this.logger.warn({err:B,msg:"Error encountered when transforming receiver",error:U})},1e3),P=U=>{const j=`Too many errors occurred: ${U.type}`,B=$a({traceId:R,token:h,tag:_,identifier:T,action:C,details:j,stageErrorValue:de.TRANSFORM_TOO_MANY_ERRORS});this.logger.error({err:B,msg:"Too many errors encountered when transforming receiver. Shutting down transformer.",error:U}),d.destroy(),this.analyticsTracker.trackError(B),this.emit(Hr,B)};return d.on(yt,U=>{U.stageErrorValue.code!==de.TRANSFORM_TOO_MANY_ERRORS.code?w(U):P(U)}),d},this.onConnectionStateChange=()=>{if(this.peerConnection){const h=this.peerConnection.connectionState||this.peerConnection.iceConnectionState,{token:_,traceId:T,identifier:C,action:R}=this,w=new gc(R,_,T,h,C);this.analyticsTracker.trackEventNoSharedProps(w),this.trace(_,T,`connection state change: ${h}`,R,C)}const d=this.getConnectionState();switch(d){case xe.CONNECTED:this.closeFailedPeerConnections(),this.perfTracker.markActionStop(),this.emit(wt,d),this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream);break;case xe.FAILED:this.storeFailedPeerConnection(this.peerConnection),this.destroyPeerConnection({closeConnection:!1}),this.emit(wt,d),this.handleConnectionFailure();break;default:this.emit(wt,d)}},this.onIncompatibleCodecs=d=>Kt(this,void 0,void 0,function*(){if(d.forEach(T=>{let C=!1;this.incompatibleCodecs.forEach(R=>{R.config===T.config&&R.mime===T.mime&&(C=!0)}),C||this.incompatibleCodecs.add(T)}),this.peerConnection)try{yield(h=this.peerConnection,_=[...this.incompatibleCodecs],Ma(void 0,void 0,void 0,function*(){var T;for(const C of h.getSenders()){const R=C.getParameters();if(R.codecs.length>1){const w=R.codecs[0];let P=!1;for(const U of _)qo(w,U)&&(P=!0);if(P){const U=Ba(_,R.codecs);(T=R.encodings)===null||T===void 0||T.forEach(j=>{j.active&&(j.codec=U)}),yield C.setParameters(R)}}}}))}catch(T){const{token:C,action:R,traceId:w,identifier:P}=this,U=new ze(Object.assign(Object.assign({},de.CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR),{action:R,token:C,traceId:w,tag:Pt(R,P),location:"onIncompatibleCodecs",remoteParticipantId:P,details:T instanceof Error?T.message:""}));this.analyticsTracker.trackError(U),this.emit(io,U)}var h,_}),this.token=r,this.logger=new Ze(a,Ft.WEBRTC),this.action=c,this.tag=l,this.traceId=n,c===ve.SUBSCRIBE&&!t)throw new Error("Subscribe action provided without subscriber Id");this.jitterBufferConfig=o==null?void 0:o.jitterBuffer,this.simulcastSubscribeConfig=o==null?void 0:o.simulcast,this.subscriberId=t,this.stageConnection=i,this.failedPeerConnections=[],this.receiveInBandMessagingEnabled=!!(!((u=this.subscribeConfig)===null||u===void 0)&&u.inBandMessaging.enabled),this.perfTracker=new ht(this.action,this.traceId),this.statsReporter=new Ha(c,r,n,this.identifier,this.analyticsTracker),this.handlePublishingChangedBinding=this.handlePublishingChanged.bind(this),this.toggleStageConnectionListeners(!0)}get videoMediaId(){var r,a;return(a=(r=this.videoTransceiver)===null||r===void 0?void 0:r.mid)!==null&&a!==void 0?a:null}toggleStageConnectionListeners(r){var a,c;r?(a=this.stageConnection)===null||a===void 0||a.on(iu,this.handlePublishingChangedBinding):(c=this.stageConnection)===null||c===void 0||c.off(iu,this.handlePublishingChangedBinding)}updateSubscribeConfig(r){var a,c;if(this.jitterBufferConfig=r.jitterBuffer,this.simulcastSubscribeConfig=r.simulcast,this.action===ve.SUBSCRIBE){const l=r.inBandMessaging.enabled;this.receiveInBandMessagingEnabled!==l&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for receiver"})}this.applyJitterBufferMinDelayConditionally((c=(a=this.stageConnection)===null||a===void 0?void 0:a.getIsStagePublishing())!==null&&c!==void 0&&c)}verifyOrUpdateTransceiverSync(){var r,a;return Kt(this,void 0,void 0,function*(){if(this.publishVideoStream){const c=this.getTransceiverForKind("video");c?this.publishVideoStream.track.id!==((r=c.sender.track)===null||r===void 0?void 0:r.id)&&(this.logger.debug({msg:"found out of sync video transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishVideoStream)):this.logger.warn({msg:"missing transceiver for video"})}if(this.publishAudioStream){const c=this.getTransceiverForKind("audio");c?this.publishAudioStream.track.id!==((a=c.sender.track)===null||a===void 0?void 0:a.id)&&(this.logger.debug({msg:"found out of sync audio transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishAudioStream)):this.logger.warn({msg:"missing transceiver for audio"})}})}start(){return Kt(this,void 0,void 0,function*(){const{token:r,action:a,traceId:c,identifier:l}=this;a!==ve.PUBLISH||r.claims.capabilities.allow_publish||this.analyticsTracker.trackErrorAndThrow(new ze(Object.assign(Object.assign({},hn(de.TOKEN_PERMISSIONS_DENIED,new Error("Cannot publish with subscribe only token"))),{action:a,token:r,traceId:c,tag:Pt(a,l),location:"StagePeerClient.start",remoteParticipantId:l})));const n=function({action:e,identifier:t,token:i,analyticsTracker:o}){let u="";const d=dc(i,o);switch(e){case ve.PUBLISH:u=d.getPublishEndpoint();break;case ve.SUBSCRIBE:t&&(u=d.getSubscribeEndpoint(t))}return u}({action:a,identifier:l,token:r.rawToken,analyticsTracker:this.analyticsTracker});try{this.perfTracker.markActionStart(),this.endpointURL=n,this.createPeerConnection(),this.trace(r,c,"peer connection created",a,l)}catch(e){const t=new ze(Object.assign(Object.assign({action:a},hn(de.CREATE_PEER_CONNECTION_FAILURE,e)),{token:r,traceId:c,tag:Pt(a,l),location:"StagePeerClient.start",remoteParticipantId:l}));a===ve.PUBLISH&&this.emit(wt,xe.FAILED),this.emit(io,t),this.analyticsTracker.trackErrorAndThrow(t)}})}mungeSdpOffer(r,a,c){if(c.simulcastEnabled&&(r=new dt(r).withVideoLayersAllocationRtpHeaderExtension().sdp),a===ve.SUBSCRIBE)r=new dt(r).withOpusAudioConfig(Pr(fo),!0).sdp;else if(a===ve.PUBLISH&&c.audioConfig){const{maxBitrateBps:l,stereo:n}=c.audioConfig;r=new dt(r).withOpusAudioConfig(l,n).sdp}return r}mungeSdpAnswer(r){Ai.browser.isFirefox()&&this.publishAudioStream&&this.action===ve.PUBLISH&&(r=new dt(r).withOpusAudioConfig(this.publishAudioStream.config.maxBitrateBps,void 0).sdp);const a=Ai.browser.isChrome()||Ai.browser.isEdge();this.action===ve.SUBSCRIBE&&a&&(r=new dt(r).withoutAudioRtcpRSize().sdp);const c=function(){const l=Mn("subscribeForceIceProtocol");if(l==="tcp"||l==="udp")return l}();return this.action===ve.SUBSCRIBE&&c&&(r=new dt(r).withFilteredCandidates(c).sdp),r}createPeerConnection(){var r;this.logger.debug({msg:"setting up peer connection"}),this.peerConnection&&(this.logger.debug({msg:"peer connection is already established, cleaning up previous connection"}),this.destroyPeerConnection({closeConnection:!1})),this.peerConnection=new RTCPeerConnection({iceTransportPolicy:"all"}),this.statsReporter.start(this.peerConnection,(r=this.publishVideoStream)===null||r===void 0?void 0:r.config.simulcastEnabled),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.peerConnection.addEventListener("icecandidateerror",this.onIceCandidateError),this.peerConnection.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate),this.peerConnection.addEventListener("track",this.onTrack),this.peerConnection.addEventListener("mute",this.onMute),this.peerConnection.addEventListener("unmute",this.onUnMute)}destroyPeerConnection(r){var a,c,l,n,e,t,i,o,u;this.statsReporter.stop(),(a=this.peerConnection)===null||a===void 0||a.removeEventListener("connectionstatechange",this.onConnectionStateChange),(c=this.peerConnection)===null||c===void 0||c.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),(l=this.peerConnection)===null||l===void 0||l.removeEventListener("icecandidateerror",this.onIceCandidateError),(n=this.peerConnection)===null||n===void 0||n.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),(e=this.peerConnection)===null||e===void 0||e.removeEventListener("icecandidate",this.onIceCandidate),(t=this.peerConnection)===null||t===void 0||t.removeEventListener("track",this.onTrack),(i=this.peerConnection)===null||i===void 0||i.removeEventListener("mute",this.onMute),(o=this.peerConnection)===null||o===void 0||o.removeEventListener("unmute",this.onUnMute),(r.closeConnection||this.action===ve.PUBLISH)&&((u=this.peerConnection)===null||u===void 0||u.close()),this.peerConnection=void 0}closeFailedPeerConnections(){for(const r of this.failedPeerConnections)r==null||r.close();this.failedPeerConnections=[]}storeFailedPeerConnection(r){r&&this.action!==ve.PUBLISH&&this.failedPeerConnections.push(r)}stop(){var r,a;(r=this.videoReceiverTransformer)===null||r===void 0||r.destroy(),(a=this.videoSenderTransformer)===null||a===void 0||a.destroy(),this.destroyPeerConnection({closeConnection:!0})}getTransceiverForKind(r){if(!this.peerConnection)return;const a=this.peerConnection.getTransceivers();return r==="audio"?a.find(c=>c.mid==="0"):r==="video"?a.find(c=>c.mid==="1"):void 0}removeTrack(r){return Kt(this,void 0,void 0,function*(){if(r==="audio"||r==="video")if(this.peerConnection)try{const a=this.getTransceiverForKind(r);if(!a)return void this.logger.warn({msg:`tried removing track type ${r} but couldn't find transceiver`});yield a.sender.replaceTrack(null),r===at.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0,yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(a){this.logger.warn({msg:"error replacing track",err:a})}else r===at.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0;else this.logger.warn({msg:"RemoveTrack called with invalid track type",trackType:r})})}replaceOrUpdateStream(r){return Kt(this,void 0,void 0,function*(){if(r.track){if(pu(r)?this.publishAudioStream=r:Ac(r)&&(this.publishVideoStream=r),this.peerConnection)try{const a=this.getTransceiverForKind(r.track.kind);if(!a)return void this.logger.warn({msg:`tried replacing track type ${r.track.kind} but couldn't find transceiver`,track:r.track});if(Ac(r)){const c=a.sender.getParameters(),l=r.config.encodingLayers;c.encodings=c.encodings.map(n=>{var e;const t=(e=n.rid)!==null&&e!==void 0?e:"",i=l.find(o=>{var u;return((u=o.rid)!==null&&u!==void 0?u:"")===t});return i?Object.assign(Object.assign({},n),i):n}),yield a.sender.setParameters(c)}else if(pu(r)){const c=a.sender.getParameters(),l=kr(r)[0];c.encodings=c.encodings.map(n=>Object.assign(Object.assign({},n),l)),yield a.sender.setParameters(c)}yield a.sender.replaceTrack(r.track),yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(a){this.logger.warn({msg:"error replacing track",err:a})}}else this.logger.warn({msg:"Unexpected call to replaceOrUpdateStream with no track"})})}initializePeerConnection(r=!1){var a,c,l,n,e,t,i,o;return Kt(this,void 0,void 0,function*(){const{traceId:u,token:d,action:h,identifier:_}=this;Kn(this.peerConnection),this.resetTransformers();let T=new MediaStream;if(h===ve.PUBLISH){this.publishAudioStream||(this.publishAudioStream={track:this.getSilentAudio(),config:{maxBitrateBps:Pr($o),stereo:!1}});const C=this.peerConnection.getTransceivers(),R=[];C.forEach(K=>{var Q;R.concat((Q=K.sender.track)===null||Q===void 0?void 0:Q.id)}),T=new MediaStream([this.publishAudioStream.track,(a=this.publishVideoStream)===null||a===void 0?void 0:a.track].filter(K=>!!K&&!R.includes(K.id)));const w=T.getAudioTracks()[0]||"audio",P=T.getVideoTracks()[0]||"video",U={direction:"sendonly",streams:[T],sendEncodings:kr(this.publishAudioStream)},j={direction:"sendrecv",streams:[T],sendEncodings:(c=this.publishVideoStream)===null||c===void 0?void 0:c.config.encodingLayers};this.peerConnection.addTransceiver(w,U),this.trace(d,u,`track added, type: ${w.kind||w}`,h,_);const B=this.peerConnection.addTransceiver(P,j);this.trace(d,u,`track added, type: ${P.kind||P}`,h,_);const $=!!(!((n=(l=this.publishVideoStream)===null||l===void 0?void 0:l.config)===null||n===void 0)&&n.inBandMessagingEnabled);this.sendInBandMessagingEnabled===void 0?this.sendInBandMessagingEnabled=$:this.sendInBandMessagingEnabled!==$&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for sender"}),this.sendInBandMessagingEnabled&&!Uc.isSupported(B)?this.handleTransformNotSupported():this.sendInBandMessagingEnabled&&((e=this.videoSenderTransformer)===null||e===void 0||e.onTransceiverAdd(B))}else h===ve.SUBSCRIBE&&(d.shouldSendSilentAudio()?this.peerConnection.addTransceiver(this.getSilentAudio(),{direction:"sendrecv"}):this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.trace(d,u,"track added, type: audio",h,_),r||(this.videoTransceiver=this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.trace(d,u,"track added, type: video",h,_),this.receiveInBandMessagingEnabled&&!Yi.isSupported(this.videoTransceiver)?this.handleTransformNotSupported():this.receiveInBandMessagingEnabled&&((t=this.videoReceiverTransformer)===null||t===void 0||t.onTransceiverAdd(this.videoTransceiver))),this.peerConnection.getTransceivers().forEach(C=>{C.receiver?(this.logger.info({msg:"dbg: Subscribe succeeded, adding media track to participant mediaStream"}),T==null||T.addTrack(C.receiver.track)):this.logger.info({msg:"dbg: Subscribe succeeded, but Transceiver were negotiated without Receiver"})}),this.applyJitterBufferMinDelayConditionally((o=(i=this.stageConnection)===null||i===void 0?void 0:i.getIsStagePublishing())!==null&&o!==void 0&&o));return T})}handlePublishingChanged(r){this.logger.debug({msg:`[handlePublishingChanged (${this.subscriberId})] isStagePublishing: ${r}, currentMinDelay: ${this.currentJitterBufferMinDelayInMs}`}),this.action===ve.SUBSCRIBE&&this.applyJitterBufferMinDelayConditionally(r)}applyJitterBufferMinDelayConditionally(r){const a=this.currentJitterBufferMinDelayInMs,c=this.calcJitterBufferMinDelay(r,this.jitterBufferConfig);if(r){if(a===void 0||a>c){const l=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is publishing and min delay is unset or > configured; attempting to update to ${c}`;this.logger.debug({msg:l}),this.trace(this.token,this.traceId,l,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(c)}}else if(a===void 0||c!==a){const l=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is subscribe-only and min delay is unset or != configured; attempting to update to ${c}`;this.logger.debug({msg:l}),this.trace(this.token,this.traceId,l,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(c)}}calcJitterBufferMinDelay(r,a){var c,l,n;let e=0;if(!(()=>{const t=RTCRtpReceiver.prototype;return!(!t||typeof t!="object")&&("jitterBufferTarget"in t||"playoutDelayHint"in t)})())return 0;if(r)e=hr((c=a==null?void 0:a.minDelayWhenPublishing)!==null&&c!==void 0?c:Fn.DEFAULT,r);else{e=hr((l=a==null?void 0:a.minDelayWhenSubscribeOnly)!==null&&l!==void 0?l:Fn.DEFAULT,r);const t=(n=this.stageConnection)===null||n===void 0?void 0:n.jitterBufferMinDelayInMs();(a==null?void 0:a.minDelayWhenSubscribeOnly)===Fn.DEFAULT&&t!==void 0&&(e=t,this.logger.debug({msg:`[calcJitterBufferMinDelay] overriding min delay with remote value: ${e}`}))}return e}applyAndTrackJitterBufferMinDelay(r){var a,c;this.currentJitterBufferMinDelayInMs=r,this.statsReporter.updateJitterBufferMinDelay(r),r!==void 0&&((c=(a=this.peerConnection)===null||a===void 0?void 0:a.getTransceivers())===null||c===void 0||c.forEach(l=>{l.receiver&&this.applyJitterBufferMinDelay(l.receiver,r)}))}applyJitterBufferMinDelay(r,a){let c="Unable to set jitter buffer min delay";if("jitterBufferTarget"in r)c=`setting jitterBufferTarget to: ${a} for track: ${r.track.kind}`,this.logger.debug({msg:c}),r.jitterBufferTarget=a;else if("playoutDelayHint"in r){const l=a/1e3;c=`setting playoutDelayHint to: ${a} for track: ${r.track.kind}`,this.logger.debug({msg:c}),r.playoutDelayHint=l}else this.logger.warn({msg:c});this.trace(this.token,this.traceId,c,this.action,this.identifier)}exchangeSdp(r){var a,c,l;return Kt(this,void 0,void 0,function*(){const{traceId:n,token:e,action:t,identifier:i,tag:o,endpointURL:u}=this,{iceRestart:d=!1,nodeOverride:h,assignmentToken:_,abortController:T}=r;let C;this.logger.debug({msg:`Exchanging SDP: ${n.value}, iceRestart=${d}, nodeOverride=${h}, assignmentToken=${_}`}),Kn(this.peerConnection),t===ve.PUBLISH&&ms()&&(this.logger.debug({msg:"Applying publisher codec preference for main profile."}),((w,P)=>{var U,j;const B=(U=RTCRtpReceiver.getCapabilities("video"))===null||U===void 0?void 0:U.codecs;if(!B)return;let $=B;$=xa(B,"42e0"),P.preferMainProfile&&($=xa(B,"4d00")),(j=w.getTransceivers().find(K=>K.receiver.track.kind==="video"))===null||j===void 0||j.setCodecPreferences($)})(this.peerConnection,{preferMainProfile:ms()}));try{this.trace(e,n,"Creating offer",t,i),C=yield this.peerConnection.createOffer({iceRestart:d})}catch(w){const P=new ze(Object.assign(Object.assign({},hn(de.CREATE_OFFER_FAILURE,w)),{action:t,token:e,traceId:n,tag:o,location:"exchangeSdp",remoteParticipantId:i}));this.emit(io,P),this.analyticsTracker.trackErrorAndThrow(P)}C.sdp&&(C.sdp=this.mungeSdpOffer(C.sdp,t,{simulcastEnabled:(c=(a=this.publishVideoStream)===null||a===void 0?void 0:a.config.simulcastEnabled)!==null&&c!==void 0&&c,audioConfig:(l=this.publishAudioStream)===null||l===void 0?void 0:l.config})),this.trace(e,n,"Setting local description",t,i),yield this.peerConnection.setLocalDescription(C),this.trace(e,n,"local description set",t,i),u||this.logger.warn({msg:"Unexpected state: No endpointURL specified for fetching of remote description."});const R=t===ve.PUBLISH&&ms()||t===ve.SUBSCRIBE&&ln("multiCodecAnswer");yield this.fetchAndSetRemoteDescription({endpointURL:u,nodeOverride:h,assignmentToken:_,multiCodec:R,abortController:T})})}getReports(){var r;return Kt(this,void 0,void 0,function*(){try{const a=(yield(r=this.peerConnection)===null||r===void 0?void 0:r.getStats())||[],c=[];return a.forEach(l=>{c.push(l)}),c}catch{return[]}})}requestRTCStats(r){return Kt(this,void 0,void 0,function*(){if(this.peerConnection)return this.statsReporter.getStats(r)})}get identifier(){return this.subscriberId||this.token.participantID}handleTransformNotSupported(){const{token:r,tag:a,identifier:c,action:l,traceId:n}=this,e=$a({traceId:n,token:r,tag:a,identifier:c,action:l,stageErrorValue:de.TRANSFORM_NOT_SUPPORTED_BY_PLATFORM});this.logger.error({err:e,msg:"Transforms not supported by this platform"}),this.analyticsTracker.trackError(e),this.emit(Hr,e)}handleConnectionFailure(){return Kt(this,void 0,void 0,function*(){const{token:r,traceId:a,tag:c}=this;this.analyticsTracker.trackError(new ze(Object.assign(Object.assign({},de.PEER_CONNECTION_NETWORK_FAILURE),{action:this.action,token:r,traceId:a,tag:c,location:"onIceCandidateError",remoteParticipantId:this.identifier})))})}getSilentAudio(){Qi||(Qi=new AudioContext);const r=Qi.createOscillator(),a=Qi.createGain();r.connect(a);const c=Qi.createMediaStreamDestination();return a.connect(c),a.gain.value=0,r.start(),c.stream.getAudioTracks()[0]}getActionMeasurements(){return this.perfTracker.getMeasurements()}getProtocol(){return this.protocol}initStreamsToPublish(r){this.publishVideoStream=r.find(Ac),this.publishAudioStream=r.find(pu)}getSfuResource(){return this.sfuResource}getExpectedJitterBufferMinDelayInMs(){var r,a;return this.calcJitterBufferMinDelay((a=(r=this.stageConnection)===null||r===void 0?void 0:r.getIsStagePublishing())!==null&&a!==void 0&&a,this.jitterBufferConfig)}trace(r,a,c,l,n){this.analyticsTracker.trackEventNoSharedProps(new lo(r,a,c,l,n))}sendSeiMessage(r,a){const c=this.getTransceiverForKind("video");return this.videoSenderTransformer&&this.sendInBandMessagingEnabled?this.action===ve.PUBLISH&&c?this.videoSenderTransformer.sendSeiMessage(r,a):Re.err(Be.NOT_PUBLISHING_VIDEO):Re.err(Be.INBAND_MESSAGING_NOT_ENABLED)}}const st=ve.SUBSCRIBE;class pn{constructor(r,a,c){this.analyticsTracker=r,this.token=a,this.remoteId=c,this.action=st}trackAttempt({stageConnectionStats:r,isReassignment:a=!1,traceIdOverride:c,preAttemptSfuResource:l}){const{action:n,analyticsTracker:e,token:t,remoteId:i}=this,o=c||Jn();return e.trackEvent(new Pc({token:this.token,subscribedId:this.remoteId,traceId:o,isEdpConnected:r.isConnected,isReassignment:a,preAttemptSfuResource:l})),{getTraceId:()=>o,trackSubscribeStarted({totalDurationWithRetries:u,retryTimes:d,sfuResource:h,peerClientPerfStats:_,protocol:T}){const{optionsDuration:C,postDuration:R,timeToCandidate:w,timeToConnected:P,sdpExchangeDuration:U,sdpExchangeTransport:j,setRemoteDescDuration:B,peerConnectionDuration:$}=_,{edpInitialConnectDuration:K,edpInitialConnectRetries:Q,edpInitialStateDuration:oe,edpInitialStatePublishingCount:ce,edpStateUpdateCount:ae}=r;e.trackEvent(new Pl({token:t,traceId:o,remoteParticipantId:i,optionsDuration:C,postDuration:R,timeToCandidate:w,totalDuration:P,edpInitialConnectDuration:K,edpInitialConnectRetries:Q,edpInitialStateDuration:oe,edpInitialStatePublishingCount:ce,edpStateUpdateCount:ae,sdpExchangeDuration:U,sdpExchangeTransport:j,setRemoteDescDuration:B,peerConnectionDuration:$,sfuResource:h,totalDurationWithRetries:u,subscribeRetryTimes:d,isReassignment:a,protocol:T}))},trackSubscribeFirstFrame:({peerClientPerfStats:u,totalDurationWithRetries:d,sfuResource:h,retryTimes:_,currentJitterBufferMinDelayInMs:T,mediaType:C,firstFrameDuration:R,protocol:w})=>{const{sdpExchangeDuration:P,sdpExchangeTransport:U,setRemoteDescDuration:j,peerConnectionDuration:B}=u,{edpInitialConnectDuration:$,edpInitialConnectRetries:K,edpInitialStateDuration:Q,edpInitialStatePublishingCount:oe,edpStateUpdateCount:ce}=r;this.analyticsTracker.trackEvent(new Dc({token:this.token,traceId:o,remoteParticipantId:i,edpInitialConnectDuration:$,edpInitialConnectRetries:K,edpInitialStateDuration:Q,edpInitialStatePublishingCount:oe,edpStateUpdateCount:ce,sdpExchangeDuration:P,sdpExchangeTransport:U,setRemoteDescDuration:j,peerConnectionDuration:B,videoWasPaused:!1,firstFrameDuration:R,mediaType:C,sfuResource:h,totalDurationWithRetries:d,subscribeRetryTimes:_,currentJitterBufferMinDelayInMs:T,protocol:w}))},trackSubscribeFailed(u,d,h){const _=((R,w,P)=>{if(R instanceof ze)return R;let U="";return R instanceof ao.AxiosError&&(U+=`AxiosError - ${R.code}`),new ze(Object.assign(Object.assign(Object.assign({},de.SUBSCRIBE_FAILURE),{action:st,token:w,traceId:P,tag:ir,location:"subscribe",details:`${U} ${R==null?void 0:R.message}`}),{fatal:!0}))})(u,t,o);e.trackEvent(new Dl({token:t,traceId:o,remoteParticipantId:i,code:_.code,message:_.message,fatal:_.fatal,nominal:_.nominal,isReassignment:a,protocol:d}));const{isConnected:T}=r,C=new ze(Object.assign(Object.assign({},de.SUBSCRIBE_FAILURE),{action:n,token:t,traceId:o,tag:Pt(ve.SUBSCRIBE,i),location:"subscribe",remoteParticipantId:i,isEdpConnected:T,details:h}));return u instanceof ze&&(C.fatal=u.fatal,C.nominal=u.nominal,C.location=`subscribe > ${u.location}`),e.trackError(C),_},trackUnsubscribe:()=>{e.trackEvent(new Ju({token:t,unsubscribedId:i,traceId:o}))},trackEndSucceeded:(u,d)=>{e.trackEvent(new vu({token:t,traceId:o,remoteParticipantId:i,isUnsubscribeSuccessful:!0,reason:u,protocol:d}))},trackEndFailed:(u,d)=>{const h=new ze(Object.assign(Object.assign({},de.UNSUBSCRIBE_FAILURE),{token:t,traceId:o,tag:Pt(ve.SUBSCRIBE,i),location:"unsubscribe",remoteParticipantId:i}));return u!==or.UNLOAD&&u!==or.UNSUBSCRIBE||e.trackError(h),e.trackEvent(new vu({token:t,traceId:o,remoteParticipantId:i,isUnsubscribeSuccessful:!0,reason:u,protocol:d})),h}}}}class Eu extends ot{constructor(r,a,c,l,n,e){super(Fe.PLAYBACK_LAYER_REQUEST,r,a,!1),Object.assign(this.properties,{media_type:c,remote_participant_id:l,track_id:n,layer_id:e})}}class za extends ot{constructor(r,a,c,l,n,e=1){super(Fe.PLAYBACK_LAYER_STATE,r,a,!1),Object.assign(this.properties,{media_type:c,remote_participant_id:l,track_id:n,request_count:e})}}var pi,Sn,mo,Ct;(function(s){s.PAUSE="pause",s.PLAY="play"})(pi||(pi={})),function(s){s.IDLE="idle",s.ACTIVE="active",s.ERRORED="errored",s.DESTROYED="destroyed"}(Sn||(Sn={})),function(s){s.SUCCESS="success"}(mo||(mo={})),function(s){s.FAILED="failed",s.DESTROYED="destroyed",s.THROTTLED="throttled"}(Ct||(Ct={}));var Zt=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class qa{constructor(r){this.state=Sn.IDLE,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null,this.stopVideo=()=>Zt(this,void 0,void 0,function*(){return this.state!==Sn.ACTIVE?(this.logCommandSkipped("stopVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(pi.PAUSE)}),this.startVideo=()=>Zt(this,void 0,void 0,function*(){return this.state!==Sn.ACTIVE?(this.logCommandSkipped("startVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(pi.PLAY)}),this.setLayer=a=>Zt(this,void 0,void 0,function*(){return this.state!==Sn.ACTIVE?(this.logCommandSkipped("setLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest(a)}),this.unsetLayer=()=>Zt(this,void 0,void 0,function*(){return this.state!==Sn.ACTIVE?(this.logCommandSkipped("unsetLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest()}),this.getLayers=()=>Zt(this,void 0,void 0,function*(){return this.state!==Sn.ACTIVE?(this.logCommandSkipped("getLayers"),this.mapSkippedResultFromState(this.state)):this.sendLayerStateRequest()}),this.sendPlaybackRequest=a=>Zt(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,Re.err)(Ct.FAILED);if(!this.playbackEndpoint)return this.logger.warn({msg:"Playback endpoint is unset and required for playback control requests"}),(0,Re.err)(Ct.FAILED);this.logger.info({msg:`Sending ${a} request to ${this.playbackEndpoint}`});const c=a===pi.PAUSE?{pause:[this.mid]}:{play:[this.mid]},l=this.createPostWhepRequest(c);return fetch(this.playbackEndpoint,l).then(n=>{if(n.status>=300){const e=new Error(`Error sending media controls request: ${n.status}:${n.statusText}`);return this.logger.error({err:e}),(0,Re.err)(Ct.FAILED)}return this.logger.debug({msg:`Request to ${a} was successful: ${n.status}`}),(0,Re.ok)(mo.SUCCESS)}).catch(n=>(this.logger.error({err:n,msg:"Error sending media controls request"}),(0,Re.err)(Ct.FAILED)))}),this.sendLayerRequest=a=>Zt(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,Re.err)(Ct.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,Re.err)(Ct.FAILED);const c=typeof a=="string",l=c?{mediaId:this.mid,encodingId:a}:{},n=c?`set : ${a}`:"unset layer";this.logger.info({msg:`sendLayerRequest for ${n} at ${this.layersEndpoint}`});const e=this.createPostWhepRequest(l);return this.trackLayerRequest(a??"auto"),fetch(this.layersEndpoint,e).then(t=>this.state===Sn.DESTROYED?(0,Re.err)(Ct.DESTROYED):t.status>=300?this.handleLayerRequestError(t.status,t.statusText):(this.logger.debug({msg:`Request to ${n} was successful: ${t.status}`}),(0,Re.ok)(mo.SUCCESS))).catch(t=>this.handleLayerRequestError(0,t.message))}),this.sendLayerStateRequest=()=>Zt(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,Re.err)(Ct.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,Re.err)(Ct.FAILED);this.logger.info({msg:`sendLayerStateRequest for ${this.mid} at ${this.layersEndpoint}`});const a=this.createGetWhepRequest();return this.trackLayerStateRequest(),fetch(this.layersEndpoint,a).then(c=>Zt(this,void 0,void 0,function*(){var l;if(this.state===Sn.DESTROYED)return(0,Re.err)(Ct.DESTROYED);if(c.status>=300)return this.handleLayerStateRequestError(c.status,c.statusText);const n=yield c.json(),e=(l=n==null?void 0:n.layers)!==null&&l!==void 0?l:[],t=JSON.stringify(e,null,2);return this.logger.debug({msg:`sendLayerStateRequest was successful: ${t}`}),(0,Re.ok)(e)})).catch(c=>this.handleLayerStateRequestError(0,c.message))}),this.logger=new Ze(r.logger,Ft.REMOTE_PLAYBACK),this.token=r.token,this.traceId=r.traceId,this.analyticsTracker=r.analyticsTracker,this.remoteParticipantId=r.remoteParticipantId}set mediaId(r){if(this.state!==Sn.DESTROYED){if(this.mid=r,this.mid===null)return this.logger.info({msg:"media id is unset, controller is transitioning to idle state"}),void(this.state=Sn.IDLE);(this.playbackEndpoint||this.layersEndpoint)&&(this.state=Sn.ACTIVE)}else this.logCommandSkipped("set mediaId")}set endpoints(r){var a,c;if(this.state!==Sn.DESTROYED){if(this.playbackEndpoint=(a=r.playback)!==null&&a!==void 0?a:null,this.layersEndpoint=(c=r.layers)!==null&&c!==void 0?c:null,!this.playbackEndpoint||!this.layersEndpoint){const l={playbackEndpoint:this.playbackEndpoint,layersEndpoint:this.layersEndpoint};return this.logger.info({msg:`no endpoints are set, transitioning to idle state: ${JSON.stringify(l,null)}`}),void(this.state=Sn.IDLE)}this.mid&&(this.state=Sn.ACTIVE)}else this.logCommandSkipped("set endpoints")}destroy(){this.state=Sn.DESTROYED,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null}logCommandSkipped(r="command"){this.logger.info({msg:`skipping ${r}, controller state invalid: ${this.state}`})}mapSkippedResultFromState(r){return r===Sn.DESTROYED?(0,Re.err)(Ct.DESTROYED):(0,Re.err)(Ct.FAILED)}createPostWhepRequest(r){return{method:"POST",headers:this.createRequestHeaders(),body:JSON.stringify(r)}}createGetWhepRequest(){return{method:"GET",headers:this.createRequestHeaders()}}createRequestHeaders(){var r,a;return{Authorization:`Bearer ${this.token.rawToken}`,"Content-Type":"application/json","X-Stages-Platform":"web","X-Stages-Request-ID":Fo().value,"X-Stages-SDK":"1.28.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":(a=(r=this.traceId)===null||r===void 0?void 0:r.value)!==null&&a!==void 0?a:"","X-Stages-WHIP-Version":uo}}trackLayerRequest(r){var a;this.analyticsTracker.trackEventNoSharedProps(new Eu(this.token,this.traceId,Je.VIDEO,this.remoteParticipantId,(a=this.mid)!==null&&a!==void 0?a:"unknown",r))}trackLayerStateRequest(r=1){var a;this.analyticsTracker.trackEventNoSharedProps(new za(this.token,this.traceId,Je.VIDEO,this.remoteParticipantId,(a=this.mid)!==null&&a!==void 0?a:"unknown",r))}handleLayerRequestError(r,a){const c=`sendLayerRequest failed for reason: ${r} ${a}`;let l,n;return r===429?(l=Ct.THROTTLED,n=de.WHEP_SET_LAYER_REQUEST_THROTTLED):(l=Ct.FAILED,n=de.WHEP_SET_LAYER_REQUEST_FAILED),this.trackRequestError(n,c),(0,Re.err)(l)}handleLayerStateRequestError(r,a){const c=`sendLayerStateRequest failed for reason: ${r} ${a}`;let l,n;return r===429?(l=Ct.THROTTLED,n=de.WHEP_GET_LAYER_STATE_THROTTLED):(l=Ct.FAILED,n=de.WHEP_GET_LAYER_STATE_FAILED),this.trackRequestError(n,c),(0,Re.err)(l)}trackRequestError(r,a){const c=new Error(a);this.logger.error({err:c}),r.message=a;const l=this.createError(r);this.analyticsTracker.trackError(l)}createError(r,a){return new ze(Object.assign({action:ve.SUBSCRIBE,traceId:this.traceId,token:this.token,location:"RemotePlaybackController",tag:ir,details:a},r))}}var Fs,Vs,nn,Ne,rt=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})},pr=function(s,r,a,c){if(a==="a"&&!c)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?s!==r||!c:!r.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?c:a==="a"?c.call(s):c?c.value:r.get(s)};(function(s){s.DISCONNECTED="disconnected",s.CONNECTING="connecting",s.CONNECTED="connected",s.ERRORED="errored"})(nn||(nn={})),function(s){s.NONE="none",s.AUDIO_ONLY="audio_only",s.AUDIO_VIDEO="audio_video"}(Ne||(Ne={}));class Lr extends lt{constructor(r,a,c,l,n,e,t){super(),this.id=r,this.token=a,this.stageConnection=c,this.nonScopedLogger=l,this.analyticsTracker=n,this.desiredSubscribeType=e,Fs.add(this),this.isSubscriptionActive=!1,this.subscriptionState={connectionState:nn.DISCONNECTED,subscribeInProgress:!1},this.previousSignalState={isTargetPublishing:!1},this.failedRetries=0,this.startConnectingTimestamp=-1,this.throttler=new ws(1e3),this.cleanupFirstFrameTracking=Vo,this.actualSubscribeType=Ne.NONE,this.action=ve.SUBSCRIBE,this.updateDesiredSubscribeType=o=>{this.desiredSubscribeType=o,this.attemptToActualizeSubscribeType()},this.updateSubscribeConfig=o=>{this.peerClient.updateSubscribeConfig(o)},this.getDesiredSubscribeType=()=>this.desiredSubscribeType,this.attemptToActualizeSubscribeType=()=>{const o=this.actualSubscribeType,u=this.desiredSubscribeType;this.logger.debug({msg:`Attempt to actualize subscribe type to ${u}`}),this.subscriptionState.connectionState===nn.CONNECTED&&u!==Ne.NONE&&o!==u&&this.applyVideoControlsBySubscribeType(u,o)},this.onParticipantUpdated=o=>{pr(this,Fs,"m",Vs).call(this,o)&&(this.logger.debug({msg:"onParticipantUpdated",participant:o}),this.processStateUpdate({isTargetPublishing:o.isPublishing}))},this.onParticipantJoined=o=>{pr(this,Fs,"m",Vs).call(this,o)&&(this.logger.debug({msg:"onParticipantJoined",participant:o}),this.processStateUpdate({isTargetPublishing:o.isPublishing}))},this.onParticipantLeft=o=>{pr(this,Fs,"m",Vs).call(this,o)&&(this.logger.debug({msg:"onParticipantLeft",participant:o}),this.processStateUpdate({isTargetPublishing:!1}))},this.onPeerClientConnectionStateChange=o=>{const u=this.stageConnection.getParticipant(this.id);this.logger.debug({msg:`onPeerClientConnectionStateChange: ${o}`,state:o,targetParticipant:u}),this.processStateUpdate({peerClientState:o})},this.onPeerClientTransformError=o=>{this.emit(au,o)},this.onSdpNegotiated=o=>{this.remotePlaybackController.endpoints={playback:o.mediaControls,layers:o.layerControls}},this.seiMessageHandler=o=>{this.emit(uc,o)},this.requestRTCStats=o=>rt(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(o)}),this.trySubscribe=o=>rt(this,void 0,void 0,function*(){var u,d;if(this.logger.debug({msg:`Subscribe attempt started: ${o}`}),!this.isSubscriptionActive)return this.logger.warn({msg:"Subscribe attempt invalid: Subscription is inactive"}),!1;this.logger.debug({msg:"Subscribe attempt is valid."}),this.startConnectingTimestamp<0&&(this.startConnectingTimestamp=performance.now()),this.subscriptionState.connectionState!==nn.ERRORED&&(this.logger.debug({msg:"Updating state to CONNECTING"}),this.updateState({connectionState:nn.CONNECTING}));const h=this.stageConnection.getConnectionStats(),_=this.peerClient.getExpectedJitterBufferMinDelayInMs(),T=this.peerClient.getSfuResource();this.attemptTracker=this.subscribeTracker.trackAttempt({stageConnectionStats:h,preAttemptSfuResource:T});try{this.remotePlaybackController.traceId=this.attemptTracker.getTraceId();const{mediaStream:C}=yield this.subscribe(this.attemptTracker.getTraceId()),R=performance.now()-this.startConnectingTimestamp,w=this.peerClient.getSfuResource();this.remotePlaybackController.mediaId=this.peerClient.videoMediaId;const P=this.failedRetries;this.attemptToActualizeSubscribeType();const U=this.peerClient.getActionMeasurements(),j=this.peerClient.getProtocol();if(this.attemptTracker.trackSubscribeStarted({sfuResource:w,totalDurationWithRetries:R,retryTimes:P,peerClientPerfStats:U,protocol:j}),C){this.cleanupFirstFrameTracking();const B=this.actualSubscribeType,$=this.attemptTracker,K=(Q,oe)=>{$.trackSubscribeFirstFrame({peerClientPerfStats:U,sfuResource:w,totalDurationWithRetries:R,retryTimes:P,currentJitterBufferMinDelayInMs:_,mediaType:oe,firstFrameDuration:Q,protocol:j})};this.cleanupFirstFrameTracking=this.measureFirstFrameDuration({mediaStream:C,subscribeType:B,callback:K})}return this.throttler.clear(),this.failedRetries=0,this.startConnectingTimestamp=-1,C&&this.emit(Is,C,this.remotePlaybackController),this.logger.debug({msg:"Subscribe attempt succeeded"}),!0}catch(C){const R=(d=(u=this.peerClient)===null||u===void 0?void 0:u.getProtocol())!==null&&d!==void 0?d:"",w=this.attemptTracker.trackSubscribeFailed(C,R);this.logger.error({log:"Subscribe attempt failed",err:C}),this.onTrySubscribeFailure(w,o)}return!1});const i=Jn();this.peerClient=new Jt(a,this.nonScopedLogger,this.action,Pt(this.action,r),i,n,r,c,t),this.logger=new Ze(l,Ft.SUBSCRIPTION),this.subscribeTracker=new pn(this.analyticsTracker,a,r),this.remotePlaybackController=new qa({token:a,analyticsTracker:n,traceId:i,logger:this.nonScopedLogger,remoteParticipantId:this.id})}applyVideoControlsBySubscribeType(r,a){try{r===Ne.AUDIO_ONLY?this.remotePlaybackController.stopVideo().catch(c=>{this.logger.error({err:c,msg:"Remote playback request to stop video failed"})}):r===Ne.AUDIO_VIDEO&&this.remotePlaybackController.startVideo().catch(c=>{this.logger.error({err:c,msg:"Remote playback request to start video failed"})}),this.actualSubscribeType=r,this.logger.debug({msg:`Desired subscribe type actualized from ${a} to ${r}.`})}catch(c){this.logger.error({err:c,msg:`Error updating subscribe type from ${a} to ${r}.`})}}processStateUpdate(r){const a=this.previousSignalState,c=Object.assign({},a,r);if(!this.isSubscriptionActive)return void this.logger.warn({msg:"Unexpected processStateUpdate when subscription is inactive"});c.isTargetPublishing?r.peerClientState===xe.CONNECTED?this.updateState({connectionState:nn.CONNECTED,subscribeInProgress:!0}):r.peerClientState===xe.FAILED&&this.subscriptionState.subscribeInProgress&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(or.CONNECTION_FAIL,this.peerClient.getProtocol()),this.updateState({subscribeInProgress:!1}),this.emit(ui)):(a.isTargetPublishing&&this.subscriptionState.subscribeInProgress&&(this.logger.debug({msg:"Scheduling an unsubscribe on the event loop"}),this.unsubscribe()),this.throttler.clear(),this.updateState({connectionState:nn.DISCONNECTED}));const l=!a.isTargetPublishing&&r.isTargetPublishing,n=this.subscriptionState.connectionState===nn.CONNECTED&&r.peerClientState===xe.FAILED;(l||n)&&this.throttledTrySubscribe("onSignalState change: isTargetPublishing is now true"),Object.assign(this.previousSignalState,r)}onTrySubscribeFailure(r,a){this.logger.debug({msg:"Changing/keeping state FAILED"});const c=r.fatal,l=r.code===de.OPERATION_ABORTED.code,n=this.failedRetries<=4;if(!l&&!c&&n){const e=1e3*Math.pow(2,this.failedRetries);this.logger.debug({msg:`Retrying in ${e}ms`}),this.failedRetries++,this.nextAttemptTimerId=window.setTimeout(()=>rt(this,void 0,void 0,function*(){this.throttledTrySubscribe(a)}),e)}else this.updateState({connectionState:nn.ERRORED}),this.emit(jn,r),this.onTerminalFailure()}onTerminalFailure(){this.previousSignalState.isTargetPublishing=!1,this.startConnectingTimestamp=-1,this.failedRetries=0}start(){this.isSubscriptionActive=!0,this.peerClient.on(wt,this.onPeerClientConnectionStateChange),this.peerClient.on(Ui,this.onSdpNegotiated),this.peerClient.on(Ar,this.seiMessageHandler),this.peerClient.on(Hr,this.onPeerClientTransformError),this.stageConnection.on(yi,this.onParticipantUpdated),this.stageConnection.on(cc,this.onParticipantJoined),this.stageConnection.on(so,this.onParticipantLeft),this.stageConnection.on(ci,this.onParticipantLeft);let r=!0;if(this.stageConnection.isConnected()){const a=this.stageConnection.getParticipant(this.id);r=!!(a!=null&&a.isPublishing)}this.processStateUpdate({isTargetPublishing:r})}throttledTrySubscribe(r){return this.throttler.invoke(this.trySubscribe,r)}updateState(r){r.subscribeInProgress!==void 0&&(this.subscriptionState.subscribeInProgress=r.subscribeInProgress),r.connectionState&&this.subscriptionState.connectionState!==r.connectionState&&(this.subscriptionState.connectionState=r.connectionState,this.emit(Cs,this.subscriptionState.connectionState))}stop(r=!1){this.peerClient.off(wt,this.onPeerClientConnectionStateChange),this.peerClient.off(Hr,this.onPeerClientTransformError),this.peerClient.off(Ui,this.onSdpNegotiated),this.peerClient.off(Ar,this.seiMessageHandler),this.unsubscribe(r),this.throttler.clear(),this.stageConnection.off(yi,this.onParticipantUpdated),this.stageConnection.off(cc,this.onParticipantJoined),this.stageConnection.off(so,this.onParticipantLeft),this.stageConnection.off(ci,this.onParticipantLeft),this.isSubscriptionActive=!1,this.updateState({connectionState:nn.DISCONNECTED})}isActive(){return this.isSubscriptionActive}subscribe(r,a){return rt(this,void 0,void 0,function*(){const{token:c,id:l}=this;c.assertTokenIsUnexpired(r,Pt(ve.SUBSCRIBE,l),"subscribe",l);const{mediaStream:n}=yield this.peerClient.connect({audioOnly:a,traceId:r});return{peerClient:this.peerClient,mediaStream:n}})}unsubscribe(r=!1){return rt(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.remotePlaybackController.destroy(),!this.isSubscriptionActive||!this.attemptTracker||this.subscriptionState.connectionState===nn.DISCONNECTED)return;this.cleanupFirstFrameTracking(),this.attemptTracker.trackUnsubscribe();const a=r?or.UNLOAD:or.UNSUBSCRIBE,c=this.peerClient.getProtocol();try{r?this.peerClient.disconnect(r):yield this.peerClient.disconnect(r),this.updateState({subscribeInProgress:!1}),this.attemptTracker.trackEndSucceeded(a,c)}catch{this.attemptTracker.trackEndFailed(a,c)}})}triggerIceRestart(r){var a;return rt(this,void 0,void 0,function*(){const c=this.stageConnection.getConnectionStats(),l=this.peerClient.getSfuResource(),n=this.subscribeTracker.trackAttempt({stageConnectionStats:c,isReassignment:!0,traceIdOverride:r.traceId,preAttemptSfuResource:l}),e=performance.now();try{this.emit(co),this.logger.debug({msg:`Triggering attempt. Current node: ${this.peerClient.getSfuResource().node}`}),yield this.peerClient.connect({iceRestartOptions:r,traceId:r.traceId}),this.logger.debug({msg:`Successful ICE restart attempt. Current node: ${this.peerClient.getSfuResource().node}`});const t=performance.now()-e,i=this.peerClient.getSfuResource(),o=this.peerClient.getActionMeasurements();(a=this.attemptTracker)===null||a===void 0||a.trackEndSucceeded(or.REASSIGNMENT,this.peerClient.getProtocol()),this.applyVideoControlsBySubscribeType(this.actualSubscribeType,this.actualSubscribeType),n.trackSubscribeStarted({totalDurationWithRetries:t,sfuResource:i,retryTimes:0,peerClientPerfStats:o,protocol:this.peerClient.getProtocol()}),this.emit(lc)}catch(t){this.emit(bt),this.logger.error({msg:"ICE restart attempt failed",err:t});const i=this.peerClient.getSfuResource(),o=n.trackSubscribeFailed(t,this.peerClient.getProtocol(),`iceRestart=true, startNode=${l.node}, endNode=${i==null?void 0:i.node}`);throw o.code===de.SUBSCRIBE_TIMED_OUT.code&&this.onTrySubscribeFailure(o,"ice restart timeout"),t}})}measureFirstFrameDuration({mediaStream:r,subscribeType:a,callback:c}){const l=performance.now(),n=i=>{const o=performance.now()-l;c(o,i),i==="audio"?t():e()};let e=Vo,t=Vo;return a!==Ne.AUDIO_ONLY&&(e=function(i,o){return pc(i,"video",o)}(r,n)),t=function(i,o){return pc(i,"audio",o)}(r,n),()=>{e(),t()}}}var pt,Me;Fs=new WeakSet,Vs=function(s){return s.id===this.id},function(s){s.JOIN_ERROR="JOIN_ERROR",s.PUBLISH_ERROR="PUBLISH_ERROR",s.SUBSCRIBE_ERROR="SUBSCRIBE_ERROR"}(pt||(pt={})),function(s){s[s.TOKEN_MALFORMED=1]="TOKEN_MALFORMED",s[s.TOKEN_EXPIRED=2]="TOKEN_EXPIRED",s[s.TIMEOUT=3]="TIMEOUT",s[s.FAILED=4]="FAILED",s[s.CANCELED=5]="CANCELED",s[s.STAGE_AT_CAPACITY=6]="STAGE_AT_CAPACITY",s[s.CODEC_MISMATCH=7]="CODEC_MISMATCH",s[s.TOKEN_NOT_ALLOWED=8]="TOKEN_NOT_ALLOWED",s[s.STAGE_DELETED=9]="STAGE_DELETED",s[s.PARTICIPANT_DISCONNECTED=10]="PARTICIPANT_DISCONNECTED"}(Me||(Me={}));const tl={[Me.TOKEN_MALFORMED]:"Token is malformed",[Me.TOKEN_EXPIRED]:"Token expired and is no longer valid",[Me.TIMEOUT]:"Operation timed out",[Me.FAILED]:"Operation failed",[Me.CANCELED]:"Operation canceled",[Me.STAGE_AT_CAPACITY]:"Stage at capacity",[Me.CODEC_MISMATCH]:"Client codec is not supported",[Me.TOKEN_NOT_ALLOWED]:"Token not allowed to perform operation",[Me.STAGE_DELETED]:"Stage has been deleted, unable to join",[Me.PARTICIPANT_DISCONNECTED]:"Participant has been disconnected, unable to join"},Gs={[de.EXPIRED_TOKEN.code]:Me.TOKEN_EXPIRED,[de.MALFORMED_TOKEN.code]:Me.TOKEN_MALFORMED,[de.JOIN_SERVER_BAD_REQUEST.code]:Me.FAILED,[de.TOKEN_PERMISSIONS_DENIED.code]:Me.TOKEN_NOT_ALLOWED,[de.OPERATION_ABORTED.code]:Me.CANCELED,[de.JOIN_TIMED_OUT.code]:Me.TIMEOUT,[de.STAGE_DELETED.code]:Me.STAGE_DELETED,[de.PARTICIPANT_DISCONNECTED.code]:Me.PARTICIPANT_DISCONNECTED,[de.EVENT_PLANE_WS_CREATE_FAILED.code]:Me.FAILED,[de.PUBLISH_TIMED_OUT.code]:Me.TIMEOUT,[de.PUBLISH_FAILURE.code]:Me.FAILED,[de.SUBSCRIBE_TIMED_OUT.code]:Me.TIMEOUT,[de.SUBSCRIBE_FAILURE.code]:Me.FAILED,[de.STAGE_AT_CAPACITY.code]:Me.STAGE_AT_CAPACITY,[de.NO_MATCHING_CODEC.code]:Me.CODEC_MISMATCH,[de.NETWORK_FAILURE.code]:Me.FAILED,[de.INTERNAL_SERVER_ERROR.code]:Me.FAILED,[de.REMOTE_STREAM_NOT_FOUND.code]:Me.FAILED,[de.INTERNAL_MHCP_ERROR.code]:Me.FAILED,[de.UNREACHABLE_MHCP.code]:Me.FAILED,[de.INVALID_SESSION_STATUS.code]:Me.FAILED,[de.MHCP_ABORTED.code]:Me.FAILED,[de.EVENT_PLANE_PONG_TIMEOUT.code]:Me.FAILED,[de.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code]:Me.FAILED},jc={[de.SEI_INSERT_NOT_PUBLISHING_VIDEO.code]:"SEI insert failed due to not publishing video",[de.SEI_INSERT_INBAND_NOT_ENABLED.code]:"SEI insert failed due to in-band messaging not being enabled for the stage stream"};class jl extends Error{constructor(r,a,c){super(),this.code=r,this.category=a,this.message=c,this.name="StageError",this.errorDetails=[],this.message=`[${a}] ${c}`}addDetails(r){this.errorDetails.push(r)}get details(){return this.errorDetails.length?JSON.stringify(this.errorDetails):""}toString(){return`
${this.message}
details - ${this.details}
        `.trim()}}var Fc,vo,na;function Ws(s,r){let a;if(s instanceof ze){if(r===pt.JOIN_ERROR&&(s.code===de.EVENT_PLANE_PONG_TIMEOUT.code||s.code===de.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code))return;const c=Gs[s.code];c&&(a=function(l,n,e){var t,i,o;const u=tl[l],d=new jl(l,n,u);return d.addDetails({stageErrorMessage:u,stageErrorCode:l,stageErrorCategory:n,stageArn:(t=e.token)===null||t===void 0?void 0:t.stageARN,traceId:(i=e.traceId)===null||i===void 0?void 0:i.value,causeCode:e.code,causeDetails:e.details,causeMessage:e.message,causeLocation:e.location,participantId:(o=e.token)===null||o===void 0?void 0:o.participantID,timeUTC:new Date().toISOString()}),d}(c,r,s))}return a}(function(s){s.ERROR="error"})(Fc||(Fc={}));class yu extends lt{constructor(r){super(),this.logger=r,this.handleError=(a,c,l=!0)=>{const n=function(t){let i;return t instanceof ze&&(i=jc[t.code]),i}(a),e=Ws(a,c);if(n&&this.logger.warn({msg:n}),e)return l&&this.emit(Fc.ERROR,e),e}}}(function(s){s.INTERNAL="internal",s.REMOTE="remote",s.API="api"})(vo||(vo={})),function(s){s.ADDITIVE="additive",s.REPLACE="replace"}(na||(na={}));class Fl{constructor(r){this.logger=new Ze(r.logger,Ft.CONNECTION),this.subscribeConfig={defaults:r.subscribeDefaults,participants:{}}}handleSubscribeConfigUpdate(r,a,c,l=na.REPLACE){a=(u=>{const d=vc(u);if(d.jitterBuffer!==void 0){const h=_=>{if(typeof _=="number"){if(_<0)return 0;if(_>4e3)return 4e3}return _};d.jitterBuffer.minDelayWhenPublishing!==void 0&&(d.jitterBuffer.minDelayWhenPublishing=h(d.jitterBuffer.minDelayWhenPublishing)),d.jitterBuffer.minDelayWhenSubscribeOnly!==void 0&&(d.jitterBuffer.minDelayWhenSubscribeOnly=h(d.jitterBuffer.minDelayWhenSubscribeOnly))}return d})(a),this.subscribeConfig.participants[r]===void 0&&(this.subscribeConfig.participants[r]={internalOverrides:{},apiOverrides:{},remoteOverrides:{},lastMerged:this.subscribeConfig.defaults});const n=this.subscribeConfig.participants[r];switch(c){case vo.INTERNAL:n.internalOverrides=this.handleSubscribeConfigLevelMerging(n.internalOverrides,a,l);break;case vo.REMOTE:n.remoteOverrides=this.handleSubscribeConfigLevelMerging(n.remoteOverrides,a,l);break;case vo.API:n.apiOverrides=this.handleSubscribeConfigLevelMerging(n.apiOverrides,a,l);break;default:(function(u){throw new Error(`Unknown case kind: ${u}`)})(c)}const e=Go(this.subscribeConfig.defaults,n.internalOverrides,n.remoteOverrides,n.apiOverrides);if(e===void 0)return this.logger.warn({msg:`Unable to merge subscribe configs for participant: ${r} | ${n}, ${a}`}),!1;const t=(i=n.lastMerged,o=e,(typeof i=="object"&&typeof o=="object"&&(0,qt.isEqual)(i,o))===!1);var i,o;return n.lastMerged=e,this.subscribeConfig.participants[r]=n,t}handleExternalSubscribeConfigUpdate(r,a,c,l=na.REPLACE){const n=(e=>{const t={};return typeof e!="object"?Re.err(new Error("Invalid input")):(e.jitterBuffer!==void 0&&(t.jitterBuffer={},e.jitterBuffer.minDelay!==void 0&&(t.jitterBuffer.minDelayWhenSubscribeOnly=e.jitterBuffer.minDelay)),e.inBandMessaging!==void 0&&(t.inBandMessaging={enabled:e.inBandMessaging.enabled===!0}),e.simulcast!==void 0&&(t.simulcast={},e.simulcast.initialLayerPreference!==void 0&&(t.simulcast.initialLayerPreference=e.simulcast.initialLayerPreference)),Re.ok(t))})(a);return n.ok===!0&&this.handleSubscribeConfigUpdate(r,n.value,c,l)}handleSubscribeConfigLevelMerging(r,a,c){if(c===na.REPLACE)return a;{const l=Go(r,a);return l===void 0?(this.logger.warn({msg:`Unable to merge '${r}' and '${a}' with type ${c}`}),r):l}}getSubscribeConfigSnapshot(r){return this.subscribeConfig.participants[r]===void 0?ks(this.subscribeConfig.defaults):ks(this.subscribeConfig.participants[r].lastMerged)}}class Vl extends ot{constructor(r){super(Fe.REASSIGNMENT_REQUEST,r.token,r.traceId,!1),Object.assign(this.properties,{target_local_participant_id:r.targetLocalParticipantId,target_remote_participant_id:r.targetRemoteParticipantId}),this.critical=!0}}var Bt,ct,mn,ra,gi,nl=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class Vc extends lt{constructor(r,a){super(),this.setGetStats=c=>{this._getInternalStats=c},this.getStats=()=>nl(this,void 0,void 0,function*(){return this.requestRTCStats()}),this.requestRTCStats=()=>nl(this,void 0,void 0,function*(){if(!this._getInternalStats)return;const c=yield this._getInternalStats(this.mediaStreamTrack);return c?c.rawReport:void 0}),this._getInternalStats=a,this.id=r.id,this.isMuted=!r.enabled,this.mediaStreamTrack=r,this.streamType=this.mediaStreamTrack.kind==="audio"?Je.AUDIO:Je.VIDEO}cleanup(){this.removeAllListeners(),this._getInternalStats=void 0}}(function(s){s.IDLE="IDLE",s.INITIALIZING="INITIALIZING",s.ACTIVE="ACTIVE",s.CONTROLS_PAUSED="CONTROLS_PAUSED",s.DESTROYED="DESTROYED"})(Bt||(Bt={})),function(s){s.LAYERS_CHANGED="LAYERS_CHANGED",s.LAYER_SELECTED="LAYER_SELECTED",s.ADAPTION_CHANGED="ADAPTION_CHANGED"}(ct||(ct={})),function(s){s.LAYERS_CHANGED="LAYERS_CHANGED",s.LAYER_SELECTED="LAYER_SELECTED",s.ADAPTION_CHANGED="ADAPTION_CHANGED"}(mn||(mn={})),function(s){s.UNAVAILABLE="unavailable",s.SELECTED="selected"}(ra||(ra={})),function(s){s.LOCAL_STREAM_MUTE_CHANGED="localStreamMutedChanged",s.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST="localStreamInsertSeiMsgRequest"}(gi||(gi={}));var mi,cn,En,ia=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class bu extends Vc{constructor(r,a){super(r),this.setMuted=c=>{c!==this.isMuted&&(this.mediaStreamTrack.enabled=!c,this.isMuted=c,this.emit(gi.LOCAL_STREAM_MUTE_CHANGED,this))},this.insertSeiMessage=(c,l)=>ia(this,void 0,void 0,function*(){let n;if(this.streamType==="audio")n=Be.INVALID_TRACK_TYPE;else if(this.mediaConfig.inBandMessaging.enabled){const e=this.validator.validateMessagePayload(c,(l==null?void 0:l.repeatCount)||0);n=Re.getErr(e)}else n=Be.INBAND_MESSAGING_NOT_ENABLED;n?console.warn(`Unable to insert SEI message due to ${n}`):this.emit(gi.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this,c,l)}),this.requestQualityStats=()=>ia(this,void 0,void 0,function*(){if(!this._getInternalStats)return;const c=yield this._getInternalStats(this.mediaStreamTrack);return c?c.stats:void 0}),this.validatedExternalConfig=gu(r,a),this.normalizedConfig=Kr(0,this.validatedExternalConfig),this.mediaConfig=(0,qt.cloneDeep)(this.normalizedConfig),this.validator=new ut(Ln)}}class Tu{constructor(r,a){this.strategy=r,this.logger=a}setStrategy(r){this.strategy=r}hasStrategy(r){return this.strategy[r]!==void 0}stageStreamsToPublish(){let r=[];try{r=this.strategy.stageStreamsToPublish(),r=r.filter(l=>l instanceof bu)}catch(l){return this.logger.warn({msg:"error executing stageStreamsToPublish treating this as a no-op",err:l}),console.error("Error executing stageStreamsToPublish",l),Re.err(l)}let a=0,c=0;for(const l of r)l.mediaStreamTrack.kind==="audio"?a++:l.mediaStreamTrack.kind==="video"&&c++;if(a>1||c>1){const l=Error("stageStreamsToPublish strategy function returned more than 1 video or audio stream and as a result will not publish",{cause:"UserStrategy"});return Re.err(l)}return Re.ok(r)}shouldPublishParticipant(r){try{return Re.ok(this.strategy.shouldPublishParticipant(r))}catch(a){return this.logger.warn({msg:"error executing shouldPublishParticipant treating this as a no-op",err:a}),console.error("Error executing shouldPublishParticipant",a),Re.err(a)}}shouldSubscribeToParticipant(r){try{return Re.ok(this.strategy.shouldSubscribeToParticipant(r))}catch(a){return this.logger.warn({msg:"error executing shouldSubscribeToParticipant. Treating it as a no-op",err:a}),console.error("Error executing shouldSubscribeToParticipant",a),Re.err(a)}}subscribeConfiguration(r){var a,c;try{return Re.ok((c=(a=this.strategy).subscribeConfiguration)===null||c===void 0?void 0:c.call(a,r))}catch(l){return this.logger.warn({msg:"error executing subscribeConfiguration. Treating it as a no-op",err:l}),console.error("Error executing subscribeConfiguration",l),Re.err(l)}}preferredLayerForStream(r,a){var c,l;try{return Re.ok((l=(c=this.strategy).preferredLayerForStream)===null||l===void 0?void 0:l.call(c,r,a))}catch(n){return this.logger.warn({msg:"error executing preferredLayerForStream. Treating it as a no-op",err:n}),console.error("Error executing preferredLayerForStream",n),Re.err(n)}}}class Cu extends lt{constructor(r,a){super(),this.audioMuted=!0,this.videoStopped=!0,this.publishState=cn.NOT_PUBLISHED,this.logger=a,this.info=r,this.audioMuted=r.audioMuted,this.videoStopped=r.videoStopped}}(function(s){s.PUBLISH="publish",s.SUBSCRIBE="subscribe"})(mi||(mi={})),function(s){s.NOT_PUBLISHED="not_published",s.ATTEMPTING_PUBLISH="attempting_publish",s.PUBLISHED="published",s.ERRORED="errored"}(cn||(cn={})),function(s){s.NOT_SUBSCRIBED="not_subscribed",s.ATTEMPTING_SUBSCRIBE="attempting_subscribe",s.SUBSCRIBED="subscribed",s.ERRORED="errored"}(En||(En={}));function rl(s){return s.map(r=>r.remote)}function Gl(s){return{label:s.encodingId,bitrateBps:1e3*s.bitrate,width:s.width,height:s.height,framesPerSecond:s.framesPerSecond,selected:s.selected}}function il(s,r){const a=s.width*s.height,c=r.width*r.height;return a>c||s.bitrateBps>r.bitrateBps||s.framesPerSecond>r.framesPerSecond?1:a===c&&s.bitrateBps===r.bitrateBps&&s.framesPerSecond===r.framesPerSecond?0:-1}var Iu=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class ol extends lt{constructor(r){var a,c,l;super(),this.onAdaptionChanged=n=>{this.emit(mn.ADAPTION_CHANGED,n)},this.onLayersChanged=n=>{this.emit(mn.LAYERS_CHANGED,n)},this.onLayerSelected=(n,e)=>{this.emit(mn.LAYER_SELECTED,n,e)},this.setGetStats=()=>{},this.requestRTCStats=()=>Iu(this,void 0,void 0,function*(){var n;return(n=this.internalStream)===null||n===void 0?void 0:n.requestRTCStats()}),this.requestQualityStats=()=>Iu(this,void 0,void 0,function*(){if(this.internalStream)try{const n=yield this.internalStream.getInternalStats();return n?n.stats:void 0}catch{return}}),this.getStats=()=>Iu(this,void 0,void 0,function*(){var n;return(n=this.internalStream)===null||n===void 0?void 0:n.requestRTCStats()}),this.setMuted=n=>{var e;(e=this.internalStream)===null||e===void 0||e.setMuted(n)},this.getLayers=()=>{var n,e;return(e=(n=this.internalStream)===null||n===void 0?void 0:n.layers)!==null&&e!==void 0?e:this.cachedLayers},this.getSelectedLayer=()=>{var n,e;return(e=(n=this.internalStream)===null||n===void 0?void 0:n.selectedLayer)!==null&&e!==void 0?e:this.cachedSelectedLayer},this.getLowestQualityLayer=()=>{var n,e;return(e=(n=this.internalStream)===null||n===void 0?void 0:n.lowestQualityLayer)!==null&&e!==void 0?e:this.cachedLowestLowestLayer},this.getHighestQualityLayer=()=>{var n,e;return(e=(n=this.internalStream)===null||n===void 0?void 0:n.highestQualityLayer)!==null&&e!==void 0?e:this.cachedHighestQualityLayer},this.internalStream=r,this.cachedId=this.internalStream.id,this.cachedParticipantInfo=(0,qt.cloneDeep)(this.internalStream.participantInfo),this.cachedStreamType=this.internalStream.streamType,this.cachedMediaStreamTrack=(l=(c=(a=this.internalStream.mediaStreamTrack).clone)===null||c===void 0?void 0:c.call(a))!==null&&l!==void 0?l:{},this.cachedIsMuted=this.internalStream.isMuted,this.cachedIsAdapting=this.internalStream.isAdapting,this.cachedLayers=this.internalStream.layers,this.updateCachedStreamData(),this.internalStream.on(ct.ADAPTION_CHANGED,this.onAdaptionChanged),this.internalStream.on(ct.LAYERS_CHANGED,this.onLayersChanged),this.internalStream.on(ct.LAYER_SELECTED,this.onLayerSelected)}updateCachedStreamData(){var r,a,c,l,n;this.cachedLayers=(a=(r=this.internalStream)===null||r===void 0?void 0:r.layers)!==null&&a!==void 0?a:[],this.cachedHighestQualityLayer=(c=this.internalStream)===null||c===void 0?void 0:c.highestQualityLayer,this.cachedLowestLowestLayer=(l=this.internalStream)===null||l===void 0?void 0:l.lowestQualityLayer,this.cachedSelectedLayer=(n=this.internalStream)===null||n===void 0?void 0:n.selectedLayer}get id(){var r,a;return(a=(r=this.internalStream)===null||r===void 0?void 0:r.id)!==null&&a!==void 0?a:this.cachedId}get participantInfo(){var r,a;return(a=(r=this.internalStream)===null||r===void 0?void 0:r.participantInfo)!==null&&a!==void 0?a:this.cachedParticipantInfo}get streamType(){var r,a;return(a=(r=this.internalStream)===null||r===void 0?void 0:r.streamType)!==null&&a!==void 0?a:this.cachedStreamType}get mediaStreamTrack(){var r,a;return(a=(r=this.internalStream)===null||r===void 0?void 0:r.mediaStreamTrack)!==null&&a!==void 0?a:this.cachedMediaStreamTrack}get isMuted(){var r,a;return(a=(r=this.internalStream)===null||r===void 0?void 0:r.isMuted)!==null&&a!==void 0?a:this.cachedIsMuted}set isMuted(r){var a;(a=this.internalStream)===null||a===void 0||a.setMuted(r)}get isAdapting(){var r,a;return(a=(r=this.internalStream)===null||r===void 0?void 0:r.isAdapting)!==null&&a!==void 0?a:this.cachedIsAdapting}cleanup(){var r,a,c;this.updateCachedStreamData(),(r=this.internalStream)===null||r===void 0||r.off(ct.ADAPTION_CHANGED,this.onAdaptionChanged),(a=this.internalStream)===null||a===void 0||a.off(ct.LAYERS_CHANGED,this.onLayersChanged),(c=this.internalStream)===null||c===void 0||c.off(ct.LAYER_SELECTED,this.onLayerSelected),this.internalStream=void 0,this.removeAllListeners()}}var Ka,Ja,Ru=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class al extends Vc{constructor({track:r,info:a,getStats:c,remotePlaybackController:l,analyticsTracker:n,token:e,subscribeConfig:t}){super(r,c),this.hasRemoteListenersForLayerEvents=()=>{const o=this.remote;return o.hasListenersFor(mn.ADAPTION_CHANGED)||o.hasListenersFor(mn.LAYERS_CHANGED)||o.hasListenersFor(mn.LAYER_SELECTED)},this.setMuted=o=>{this.isMuted=o,this.mediaStreamTrack.enabled=!o},this.setLayer=o=>{const u=(0,qt.cloneDeep)(o);if(this.queueLayerUpdateForValidState(u))return void this.logger.debug({msg:`setLayer:${u} queued, skipping for now`});const d=function(_,T){if(!_)return(0,Re.ok)(void 0);const C=typeof _=="string"?_:_.label,R=T.filter(w=>w.label===C)[0];return R?(0,Re.ok)(R):(0,Re.err)(`Provided layer with id ${C} does not exist`)}(u,this._layers);if(!d.ok){const _=d.error;return void this.logger.error({err:_,msg:"Unable to select layer, skipping selection"})}const h=d.value;if(this.isNextUpdateAdaptionOnly(h))return this.logger.warn({msg:"setLayer:dynamic"}),void this.handleDynamicUpdate();this.isFirstLayerUpdate()||!this.isRepeatLayerSelection(h)||this.isAdapting?h&&(this.logger.warn({msg:`setLayer:${JSON.stringify(h)} `}),this.handleManualUpdate(h)):this.logger.debug({msg:"Setting the same layer, same adaption state, skipping selection"})},this.state=Bt.INITIALIZING,this.prevState=Bt.IDLE,this.analyticsTracker=n,this.token=e,this.id=r.id,this.info=a,this.mediaStreamTrack=r,this.remotePlaybackController=l,this.layerPollingIntervalId=null,this.weakRemoteMap=new WeakMap,this.weakRemoteKey={id:"remote"},this.commandMap=new Map,this.subscribeConfig=t,this._isAdapting=!0,this._layers=[],this._selectedLayer=null;const i=Zs();this.logger=new Ze(new Pe(i),Ft.REMOTE_STAGE_STREAM),this.streamType===Je.AUDIO?this.isMuted=a.audioMuted:this.isMuted=a.videoStopped,this.initializeLayerPolling(),this.pollInternalLayers(!0)}transitionStateTo(r){this.state!==r&&(this.prevState=this.state,this.state=r)}initializeLayerPolling(){ys(this.mediaStreamTrack)?this.streamType!==Je.AUDIO?(this.logger.debug({msg:"Setting up RemoteStageStream, requesting initial layers"}),this.layerPollingIntervalId!==null&&clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=setInterval(()=>{this.pollInternalLayers()},this.subscribeConfig.simulcast.layerPollingIntervalMs)):this.logger.debug({msg:"Skipping initializing polling for audio streams"}):this.logger.debug({msg:"Skipping initializing polling, media track is not active"})}startLayerPolling(){this.layerPollingIntervalId===null?this.initializeLayerPolling():this.logger.debug({msg:"Skipping start polling request, already started"})}stopLayerPolling(){this.layerPollingIntervalId!==null?(clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=null):this.logger.debug({msg:"Skipping stop polling request, already stopped"})}pollInternalLayers(r=!1){if(!ys(this.mediaStreamTrack))return void this.pauseControls();if(this.streamType===Je.AUDIO)return this.logger.debug({msg:"Skipping layer poll request for audio stream"}),void this.transitionStateTo(Bt.ACTIVE);const a=!this.hasRemoteListenersForLayerEvents(),c=!this.subscribeConfig.simulcast.layerPollingEnabled;!r&&a&&c?this.logger.debug({msg:"Skipping layer request due to no listeners"}):this.remotePlaybackController.getLayers().then(l=>{if(this.isStateValidForLayerUpdates()){if(!l.ok)throw Error(l.error);this.updateInternalLayersFromRemote(l.value),this.transitionStateTo(Bt.ACTIVE),this.flushCommandQueue()}else this.logger.warn({msg:"Stream controls have been paused, skipping getLayers"})}).catch(l=>{this.logger.error({err:l,msg:"Error calling getLayers, returning current layers"})})}updateInternalLayersFromRemote(r){const a=this._layers,c=r.map(Gl).sort(il),l=!(0,qt.isEqual)(c,a);this._layers=c;const n=this._selectedLayer,e=this._layers.filter(i=>i.selected)[0],t=!(0,qt.isEqual)(e,n);n&&(n.selected=!1),this._selectedLayer=e,t&&(this.trackLayerUpdate(n),this.trackLayerUpdate(e)),this.isCommandQueueEmpty()&&(l&&this.emitLayersChanged(),t&&this.emitLayerSelected(e))}flushCommandQueue(){if(this.isCommandQueueEmpty())return;const r=Array.from(this.commandMap.keys());this.logger.debug({msg:`Flushing active commands from map ${r}`});for(const a of this.commandMap.keys()){const c=this.commandMap.get(a);c==null||c()}this.commandMap.clear()}queueLayerUpdateForValidState(r){if(!r)return this.commandMap.delete("setLayer"),!1;if(this.state===Bt.INITIALIZING){const a=this.setLayer.bind(this,r);return this.commandMap.set("setLayer",a),!0}return!1}handleDynamicUpdate(){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const r=this._isAdapting;this._isAdapting=!0,this.emitAdaptionChanged(),this.remotePlaybackController.unsetLayer().then(a=>{if(!this.isStateValidForLayerUpdates())return this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"}),void this.resetAdaptionStateOnError(r,`Stream in invalid state: ${this.state}`);a.ok?this.logger.debug({msg:"Layer successfully unset, restarting dynamic adaption"}):this.resetAdaptionStateOnError(r,a.error)}).catch(()=>{})}resetAdaptionStateOnError(r,a){this._isAdapting=r,this.emitAdaptionChanged(),this.logger.error({err:a,msg:"Error unsetting layer, reverting adaption state"})}handleManualUpdate(r){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping manual updates"});const a=this._isAdapting,c=this._selectedLayer;c&&(c.selected=!1),this._isAdapting=!1,this._selectedLayer=r,r.selected=!0,a!==this._isAdapting&&this.emitAdaptionChanged(),this.updateLocalLayerStateBeforeRemote(r,c),this.trackLayerUpdate(c),this.trackLayerUpdate(r),this.emitLayersChanged(),this.emitLayerSelected(r),this.remotePlaybackController.setLayer(r.label).then(l=>{if(!this.isStateValidForLayerUpdates()){this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const n=`Stream in invalid state: ${this.state}`;return this.resetAdaptionStateOnError(a,n),void this.resetLayerOnError(c,r,n)}if(!l.ok){const n=l.error;return this.resetAdaptionStateOnError(a,n),void this.resetLayerOnError(c,r,n)}this.logger.debug({msg:`Layer successfully selected: ${r.label}`})}).catch(()=>{})}applyExistingControlState(){var r;this._isAdapting?this.remotePlaybackController.unsetLayer().then(()=>{}).catch(()=>{}):!((r=this._selectedLayer)===null||r===void 0)&&r.label&&this.remotePlaybackController.setLayer(this._selectedLayer.label).then(()=>{}).catch(()=>{})}resetLayerOnError(r,a,c){a&&(a.selected=!1),r&&(r.selected=!0),this._selectedLayer=r,this.logger.error({err:c,msg:"Error unsetting layer, leaving current selection in place"}),this.updateLocalLayerStateBeforeRemote(r,a),this.emitLayersChanged(),r!==null&&this.emitLayerSelected(r,ra.UNAVAILABLE),this.trackLayerUpdate(a),this.trackLayerUpdate(r)}updateLocalLayerStateBeforeRemote(r,a){this._layers=this._layers.map(c=>c.label===(r==null?void 0:r.label)?r:c.label===(a==null?void 0:a.label)?a:c).sort(il)}trackLayerUpdate(r){var a,c;this.analyticsTracker.trackEventNoSharedProps(new Ua(this.token,Jn(),(a=r==null?void 0:r.label)!==null&&a!==void 0?a:"auto",!0,ve.SUBSCRIBE,(c=r==null?void 0:r.selected)!==null&&c!==void 0&&c,this.info.id))}isNextUpdateAdaptionOnly(r){return r===void 0&&this.isFirstLayerUpdate()||r===void 0&&!this.isAdapting}isFirstLayerUpdate(){return this._selectedLayer===null}isRepeatLayerSelection(r){var a;return((a=this._selectedLayer)===null||a===void 0?void 0:a.label)===(r==null?void 0:r.label)}isStateValidForLayerUpdates(){return this.state===Bt.ACTIVE||this.state===Bt.INITIALIZING}isCommandQueueEmpty(){return this.commandMap.size===0}emitLayerSelected(r,a=ra.SELECTED){this.logger.debug({msg:`Emitting layers selected ${JSON.stringify(r,null,2)}`}),this.emit(ct.LAYER_SELECTED,(0,qt.cloneDeep)(r),a)}emitLayersChanged(){this.emit(ct.LAYERS_CHANGED,(0,qt.cloneDeep)(this._layers))}emitAdaptionChanged(){this.emit(ct.ADAPTION_CHANGED,this._isAdapting)}get remote(){const r=this.weakRemoteMap.get(this.weakRemoteKey);if(r)return r;const a=new ol(this);return this.weakRemoteMap.set(this.weakRemoteKey,a),a}get participantInfo(){return(0,qt.cloneDeep)(this.info)}get isAdapting(){return this._isAdapting}get layers(){return(0,qt.cloneDeep)(this._layers)}get selectedLayer(){var r;return(0,qt.cloneDeep)((r=this._selectedLayer)!==null&&r!==void 0?r:void 0)}get highestQualityLayer(){return(0,qt.cloneDeep)(this.layers[this.layers.length-1])}get lowestQualityLayer(){return(0,qt.cloneDeep)(this.layers[0])}getInternalStats(){return Ru(this,void 0,void 0,function*(){if(this._getInternalStats)return this._getInternalStats(this.mediaStreamTrack)})}pauseControls(){this.transitionStateTo(Bt.CONTROLS_PAUSED),this.stopLayerPolling()}resumeControls(){this.applyExistingControlState(),this.startLayerPolling(),this.transitionStateTo(Bt.ACTIVE)}updateSubscribeConfig(r){const a=this.subscribeConfig;this.subscribeConfig=r,a.simulcast.layerPollingIntervalMs!==r.simulcast.layerPollingIntervalMs&&this.isStateValidForLayerUpdates()&&this.initializeLayerPolling()}cleanup(){this.transitionStateTo(Bt.DESTROYED),super.cleanup(),this.weakRemoteMap.delete(this.weakRemoteKey),this.stopLayerPolling(),this._layers=[],this._selectedLayer=null,this._isAdapting=!0,this.commandMap.clear()}}(function(s){s.STATE_CHANGE="stateChange",s.MEDIA_STREAM_ADDED="mediaStreamAdded",s.MEDIA_STREAM_REMOVED="mediaStreamRemoved",s.MEDIA_STREAM_MUTE_CHANGED="mediaStreamMuteChanged",s.ERROR="error"})(Ka||(Ka={})),function(s){s.SUBSCRIPTION_STATE_CHANGE="subscriptionStateChange",s.MEDIA_STREAM_SEI_MESSAGE_RECEIVED="mediaStreamSeiMessageReceived"}(Ja||(Ja={}));const Hn=Object.assign(Object.assign({},Ka),Ja);var Hs;(function(s){s.PUBLICATION_STATE_CHANGE="publicationStateChange"})(Hs||(Hs={}));const _o=Object.assign(Object.assign({},Ka),Hs);var yr=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class Xn extends Cu{constructor(r,a,c,l,n,e,t,i=!1){super(r,new Ze(l,Ft.REMOTE_PARTICIPANT)),this.subscribeState=En.NOT_SUBSCRIBED,this.reassigning=!1,this.streams=[],this.left=!1,this.onSubscriptionStateChange=o=>{this.logger.debug({msg:"subscriptionStateChange",state:o}),o===nn.DISCONNECTED?this.updateSubscriptionState(En.NOT_SUBSCRIBED):o===nn.CONNECTED?this.updateSubscriptionState(En.SUBSCRIBED):o===nn.CONNECTING?this.updateSubscriptionState(En.ATTEMPTING_SUBSCRIBE):o===nn.ERRORED?(this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams(),this.updateSubscriptionState(En.ERRORED)):this.logger.warn({msg:"FIXME onSubscriptionStateChange UNHANDLED STATE",state:o})},this.onSubscriptionStreamRemoved=()=>{this.logger.debug({msg:"onSubscriptionStreamRemoved"}),this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams()},this.onSubscriptionStreamCreated=(o,u)=>{this.logger.debug({msg:"onSubscriptionStreamCreated",stream:o}),this.pruneInactiveStreams();let d=o.getTracks().map(h=>{const _=new al({track:h,info:this.info,getStats:this.subscription.requestRTCStats,remotePlaybackController:u,analyticsTracker:this.analyticsTracker,token:this.token,subscribeConfig:this.subscribeConfig});return this.streams.push(_),_});this.subscription.getDesiredSubscribeType()===Ne.AUDIO_ONLY&&(d=d.filter(h=>h.streamType!==Je.VIDEO)),this.emit(Hn.MEDIA_STREAM_ADDED,d)},this.onSubscriptionError=o=>{this.emit(Hn.ERROR,o)},this.onSubscriptionSeiMessageReceived=o=>{this.emit(Hn.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,o)},this.onSubscriptionTransformError=o=>{this.emit(Hn.ERROR,o)},this.onSubscriptionReassignmentStart=()=>{for(const o of this.streams)o.pauseControls()},this.onSubscriptionReassignmentDone=()=>{for(const o of this.streams)o.resumeControls()},this.updateSubscribeStateIfNecessary=(o,u)=>{if(!this.info.capabilities.has(mi.SUBSCRIBE))return;u!==void 0&&(this.subscribeConfig=u,this.subscription.updateSubscribeConfig(u),this.streams.forEach(_=>{_.updateSubscribeConfig(u)}));const d=o!==Ne.NONE&&this.publishState===cn.PUBLISHED,h=this.subscribeState!==En.NOT_SUBSCRIBED&&this.subscribeState!==En.ERRORED;if(d&&!h)this.subscription.updateDesiredSubscribeType(o),this.subscribe();else if(!d&&h)this.unsubscribe(),this.subscription.updateDesiredSubscribeType(o);else if(this.subscribeState===En.SUBSCRIBED&&this.subscription.getDesiredSubscribeType()!==o)try{o===Ne.AUDIO_ONLY?this.emit(Hn.MEDIA_STREAM_REMOVED,this.filterStreamsByType(this.streams,Je.VIDEO)):o===Ne.AUDIO_VIDEO&&this.emit(Hn.MEDIA_STREAM_ADDED,this.filterStreamsByType(this.streams,Je.VIDEO)),this.subscription.updateDesiredSubscribeType(o)}catch(_){this.logger.error({err:_,msg:"error updating subscribe type"})}},this.updatePublishState=o=>{const u=o&&this.publishState===cn.PUBLISHED,d=!o&&this.publishState===cn.NOT_PUBLISHED;return!u&&!d&&(this.info.isPublishing=o,this.publishState=o?cn.PUBLISHED:cn.NOT_PUBLISHED,!0)},this.updateStreamState=(o,u)=>{this.audioMuted!==o&&(this.audioMuted=o,this.info.audioMuted=o,this.updateStreamMuteState(Je.AUDIO,o)),this.videoStopped!==u&&(this.videoStopped=u,this.info.videoStopped=u,this.updateStreamMuteState(Je.VIDEO,u))},this.updateStreamMuteState=(o,u)=>{const d=this.filterStreamsByType(this.streams,o),h=d[d.length-1];if(!h){const _=`state update received for ${this.info.id} for non-existent ${o} stream`;return this.logger.warn({msg:_}),void this.traceRemoteParticipantMsg(_)}h.setMuted(u),this.emit(Hn.MEDIA_STREAM_MUTE_CHANGED,h)},this.cleanup=()=>{this.removeAllListeners()},this.quickUnsubscribe=()=>this.subscribeState!==En.NOT_SUBSCRIBED&&this.subscription.stop(!0),this.getDesiredSubscribeType=()=>this.subscription.getDesiredSubscribeType(),this.isReassigning=()=>this.reassigning,this.analyticsTracker=t,this.token=a,this.subscribeConfig=e,this.createSubscription=()=>{const o=new Lr(r.id,a,c,l,t,n,e);return o.on(Cs,this.onSubscriptionStateChange),o.on(Is,this.onSubscriptionStreamCreated),o.on(ui,this.onSubscriptionStreamRemoved),o.on(jn,this.onSubscriptionError),o.on(uc,this.onSubscriptionSeiMessageReceived),o.on(au,this.onSubscriptionTransformError),o.on(co,this.onSubscriptionReassignmentStart),o.on(lc,this.onSubscriptionReassignmentDone),o.on(bt,this.onSubscriptionReassignmentDone),o},this.subscription=this.createSubscription(),i&&(this.publishState=cn.PUBLISHED)}updateSubscriptionState(r){r!==this.subscribeState&&(this.subscribeState=r,this.emit(Hn.SUBSCRIPTION_STATE_CHANGE,this.subscribeState))}pruneInactiveStreams(){const r=[];this.streams=this.streams.filter(n=>!!ys(n.mediaStreamTrack)||(r.push(n),!1));const a=r.length;if(a===0)return;const c=this.filterStreamsByType(r,Je.AUDIO).length,l=a-c;this.traceRemoteParticipantMsg(`Pruning inactive streams (${c} audio, ${l} video)`),this.emitStreamsRemoved(r),r.forEach(n=>{n.remote.cleanup(),n.cleanup()})}filterStreamsByType(r,a){return r.filter(c=>c.streamType===a)}participantLeave(){this.left=!0}subscribe(){this.left?this.logger.warn({msg:"tried to subscribe to a participant that left"}):(this.updateSubscriptionState(En.ATTEMPTING_SUBSCRIBE),this.logger.debug({msg:"subscribe"}),this.subscription.start())}unsubscribe(){if(this.subscribeState===En.NOT_SUBSCRIBED)return;this.logger.debug({msg:"unsubscribe"}),this.subscription.stop(),this.subscription.off(Cs,this.onSubscriptionStateChange),this.subscription.off(Is,this.onSubscriptionStreamCreated),this.subscription.off(ui,this.onSubscriptionStreamRemoved),this.subscription.off(jn,this.onSubscriptionError),this.subscription.off(au,this.onSubscriptionTransformError);const r=this.getDesiredSubscribeType();this.subscription=this.createSubscription(),this.emitStreamsRemovedByType(r),this.updateSubscriptionState(En.NOT_SUBSCRIBED),this.cleanupStreams()}emitStreamsRemovedByType(r){switch(r){case Ne.AUDIO_VIDEO:this.emitStreamsRemoved(this.streams);break;case Ne.AUDIO_ONLY:this.emitStreamsRemoved(this.filterStreamsByType(this.streams,Je.AUDIO));case Ne.NONE:}}emitStreamsRemoved(r){this.emit(Hn.MEDIA_STREAM_REMOVED,r)}cleanupStreams(){this.streams.length!==0&&(this.logger.debug({msg:"Cleaning up streams due to internal removal"}),this.streams.forEach(r=>{r.remote.cleanup(),r.cleanup()}),this.streams=[])}traceRemoteParticipantMsg(r){this.analyticsTracker.trackEventNoSharedProps(new lo(this.token,Jn(),r,ve.SUBSCRIBE,this.info.id))}triggerIceRestart(r){return yr(this,void 0,void 0,function*(){this.reassigning=!0;try{yield this.subscription.triggerIceRestart(r)}finally{this.reassigning=!1}})}}const Gc=ve.PUBLISH;function sl(s,r,a){return new ze(Object.assign(Object.assign({},s),{token:r,traceId:a,location:"stage-publication.sendSeiMessage",tag:Xt,action:ve.PUBLISH}))}class wu{constructor(r,a){this.analyticsTracker=r,this.token=a,this.action=Gc,this.traceId=Jn()}trackPublish(r){const{action:a,traceId:c,analyticsTracker:l,token:n}=this;return l.trackEvent(new Ol({token:n,traceId:c})),{getTraceId:()=>c,trackPublishStarted({totalDurationWithRetries:e,retryTimes:t,sfuResource:i,peerClientPerfStats:o,protocol:u}){const{optionsDuration:d,postDuration:h,timeToCandidate:_,timeToConnected:T,sdpExchangeDuration:C,sdpExchangeTransport:R,setRemoteDescDuration:w,peerConnectionDuration:P}=o,{edpInitialConnectDuration:U,edpInitialConnectRetries:j,edpInitialStateDuration:B,edpStateUpdateCount:$}=r;l.trackEvent(new Al({token:n,traceId:c,optionsDuration:d,postDuration:h,timeToCandidate:_,totalDuration:T,edpInitialConnectDuration:U,edpInitialConnectRetries:j,edpInitialStateDuration:B,edpStateUpdateCount:$,sdpExchangeDuration:C,sdpExchangeTransport:R,setRemoteDescDuration:w,peerConnectionDuration:P,publishRetries:t,totalDurationWithRetries:e,sfuResource:i,protocol:u}))},trackPublishFailed(e,t){const i=((u,d,h)=>{if(u instanceof ze)return u;let _="";return u instanceof ao.AxiosError&&(_+=`AxiosError - ${u.code}`),new ze(Object.assign(Object.assign(Object.assign({},de.PUBLISH_FAILURE),{action:Gc,token:d,traceId:h,tag:Xt,location:"publish",details:`${_} ${u.message}`}),{fatal:!0}))})(e,n,c);l.trackEvent(new kl({token:n,traceId:c,code:i.code,message:i.message,fatal:i.fatal,nominal:i.nominal,protocol:t}));const o=new ze(Object.assign(Object.assign({},de.PUBLISH_FAILURE),{action:a,token:n,traceId:c,tag:Xt,location:"publish"}));return e instanceof ze&&(o.fatal=e.fatal,o.nominal=e.nominal,o.location=`publish > ${e.location}`),l.trackError(o),i},trackUnpublish:()=>{l.trackEvent(new mu({token:n,traceId:c}))},trackEndSucceeded:(e,t)=>{l.trackEvent(new Yu({token:n,isUnpublishSuccessful:!0,traceId:c,reason:e,protocol:t}))},trackEndFailed:(e,t)=>{const i=new ze(Object.assign(Object.assign({},de.UNPUBLISH_FAILURE),{token:n,traceId:c,tag:Ae,location:"unpublish"}));return e!==or.UNLOAD&&e!==or.UNPUBLISH||this.analyticsTracker.trackError(i),l.trackEvent(new Yu({token:n,isUnpublishSuccessful:!1,traceId:c,reason:e,protocol:t})),i},createSeiNotPublishingVideoError:()=>sl(de.SEI_INSERT_NOT_PUBLISHING_VIDEO,n,c),createSeiInBandMessagingNotEnabledError:()=>sl(de.SEI_INSERT_INBAND_NOT_ENABLED,n,c)}}}var yn,Zn,So=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};(function(s){s.DISCONNECTED="disconnected",s.CONNECTING="connecting",s.CONNECTED="connected",s.ERRORED="errored"})(yn||(yn={})),function(s){s.STATE_CHANGE="stateChange",s.ERROR="error",s.TRANSFORM_ERROR="transformError"}(Zn||(Zn={}));class Wl extends lt{constructor(r,a,c,l){super(),this.token=r,this.stageConnection=a,this.nonScopedLogger=c,this.analyticsTracker=l,this.streamsToPublish=[],this.publicationState=yn.DISCONNECTED,this.latestPubAttemptNum=0,this.startConnectingTimestamp=-1,this.action=ve.PUBLISH,this.start=n=>{this.publicationState===yn.DISCONNECTED||this.publicationState===yn.ERRORED?(this.streamsToPublish=n,this.latestPubAttemptNum=0,this.processStateUpdate()):this.logger.warn({msg:"publication cannot be started if not in disconnected or error state"})},this.requestRTCStats=n=>So(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(n)}),this.stop=(n=!1)=>So(this,void 0,void 0,function*(){this.peerClient.off(wt,this.onPeerClientConnectionStateChange),this.peerClient.off(Hr,this.onPeerClientTransformError),yield this.unpublish(n),this.updateState(yn.DISCONNECTED)}),this.processStateUpdate=n=>{const{publicationState:e}=this;e===yn.DISCONNECTED||e===yn.ERRORED?this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(yn.CONNECTING),this.tryPublish()):e===yn.CONNECTING?n===xe.CONNECTED&&this.updateState(yn.CONNECTED):e===yn.CONNECTED&&n===xe.FAILED&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(or.CONNECTION_FAIL,this.peerClient.getProtocol()),this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(yn.CONNECTING),this.tryPublish()))},this.updateState=n=>{this.publicationState=n,this.emit(Zn.STATE_CHANGE,n)},this.tryPublish=()=>So(this,void 0,void 0,function*(){if(this.latestPubAttemptNum++,this.latestPubAttemptNum<=4){const n=this.stageConnection.getConnectionStats();this.attemptTracker=this.publishTracker.trackPublish(n);try{this.logger.debug({msg:`attempting to publish, attemptNum: ${this.latestPubAttemptNum}`}),yield this.publish(this.streamsToPublish,this.attemptTracker.getTraceId()),this.logger.debug({msg:"publish succeeded!"});const e=this.peerClient.getSfuResource(),t=this.latestPubAttemptNum-1,i=performance.now()-this.startConnectingTimestamp,o=this.peerClient.getActionMeasurements();this.attemptTracker.trackPublishStarted({sfuResource:e,totalDurationWithRetries:i,retryTimes:t,peerClientPerfStats:o,protocol:this.peerClient.getProtocol()}),this.latestPubAttemptNum=0}catch(e){this.logger.error({msg:"publish failed!",err:e});const t=this.attemptTracker.trackPublishFailed(e,this.peerClient.getProtocol()),i=t.code===de.OPERATION_ABORTED.code,o=t.fatal,u=this.latestPubAttemptNum===4;if(i)return;if(o||u)return this.logger.error({msg:`Stopping attempts: isFatal=${o}, isLastAttempt=${u}`,err:e}),this.updateState(yn.ERRORED),void this.emit(Zn.ERROR,t);const d=1e3*Math.pow(2,this.latestPubAttemptNum);this.logger.debug({msg:`attempt failed, retrying in ${d}ms`}),this.nextAttemptTimerId=window.setTimeout(()=>{this.tryPublish()},d)}}}),this.publish=(n,e)=>So(this,void 0,void 0,function*(){this.peerClient.initStreamsToPublish(n),yield this.peerClient.connect({audioOnly:!1,traceId:e})}),this.unpublish=(n=!1)=>So(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.publicationState===yn.DISCONNECTED||this.publicationState===yn.ERRORED||!this.attemptTracker)return;this.attemptTracker.trackUnpublish();const e=n?or.UNLOAD:or.UNPUBLISH,t=this.peerClient.getProtocol();try{n?this.peerClient.disconnect(n):yield this.peerClient.disconnect(n),this.attemptTracker.trackEndSucceeded(e,t)}catch{this.attemptTracker.trackEndFailed(e,t)}}),this.replaceOrUpdateStream=n=>So(this,void 0,void 0,function*(){this.streamsToPublish.find(e=>e.track.kind===n.track.kind)?this.streamsToPublish=this.streamsToPublish.map(e=>e.track.kind===n.track.kind?n:e):this.streamsToPublish.push(n),yield this.peerClient.replaceOrUpdateStream(n)}),this.onPeerClientConnectionStateChange=n=>{this.logger.debug({msg:`onPeerClientConnectionStateChange: ${n}`,state:n}),this.processStateUpdate(n)},this.onPeerClientTransformError=n=>{this.emit(Zn.TRANSFORM_ERROR,n)},this.onIncompatibleCodecs=n=>So(this,void 0,void 0,function*(){yield this.peerClient.onIncompatibleCodecs(n)}),this.sendSeiMessage=(n,e)=>{if(this.publicationState!==yn.CONNECTED)return this.attemptTracker&&this.emit(Zn.ERROR,this.attemptTracker.createSeiNotPublishingVideoError()),Re.err(Be.NOT_PUBLISHING_VIDEO);const t=this.peerClient.sendSeiMessage(n,e),i=Re.getErr(t);return i&&this.attemptTracker&&(i===Be.INBAND_MESSAGING_NOT_ENABLED?this.emit(Zn.ERROR,this.attemptTracker.createSeiInBandMessagingNotEnabledError()):i===Be.NOT_PUBLISHING_VIDEO&&this.emit(Zn.ERROR,this.attemptTracker.createSeiNotPublishingVideoError())),t},this.peerClient=new Jt(r,this.nonScopedLogger,this.action,Pt(this.action),Jn(),this.analyticsTracker,void 0,a,void 0),this.logger=new Ze(c,Ft.PUBLICATION),this.peerClient.on(wt,this.onPeerClientConnectionStateChange),this.peerClient.on(Hr,this.onPeerClientTransformError),this.publishTracker=new wu(this.analyticsTracker,this.token)}removeTrack(r){return So(this,void 0,void 0,function*(){this.streamsToPublish=this.streamsToPublish.filter(a=>a.track.kind!==r),yield this.peerClient.removeTrack(r)})}}var Wt,Ou=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};class Hl extends Cu{constructor(r,a,c,l,n){super(r,new Ze(c,Ft.LOCAL_PARTICIPANT)),this.onPublicationStateChange=e=>{switch(this.logger.debug({msg:"publicationStateChange",state:e}),e){case"connected":this.connection.setStagePublishing(!0),this.updatePublishState(cn.PUBLISHED);break;case"connecting":this.updatePublishState(cn.ATTEMPTING_PUBLISH);break;case"errored":this.updatePublishState(cn.ERRORED),this.connection.setStagePublishing(!1);break;default:return void this.logger.warn({msg:"FIXME onPublicationStateChange UNHANDLED STATE",state:e})}},this.onPublicationError=e=>{this.emit(_o.ERROR,e)},this.updatePublishState=e=>{this.info.isPublishing=e===cn.PUBLISHED,this.publishState=e,this.emit(_o.PUBLICATION_STATE_CHANGE,this.publishState)},this.handleMute=e=>{e.streamType===Je.AUDIO&&(this.audioMuted=e.isMuted,this.info.audioMuted=e.isMuted),e.streamType===Je.VIDEO&&(this.videoStopped=e.isMuted,this.info.videoStopped=e.isMuted),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.emit(_o.MEDIA_STREAM_MUTE_CHANGED,e)},this.handleInsertSeiMsgRequest=(e,t,i)=>{this.sendSeiMessage(t,i==null?void 0:i.repeatCount)},this.publish=e=>{this.logger.debug({msg:"publish"}),e.forEach(i=>{i&&(this.setupStreamListeners(i),i.streamType===Je.AUDIO?(this.audioStream=i,this.audioMuted=!i.mediaStreamTrack.enabled,this.info.audioMuted=this.audioMuted):i.streamType===Je.VIDEO&&(this.videoStream=i,this.videoStopped=!i.mediaStreamTrack.enabled,this.info.videoStopped=this.videoStopped),i.setGetStats(this.publication.requestRTCStats))}),this.connection.emitStageState(this.audioMuted,this.videoStopped);const t=e.map(i=>$u(i));this.publication.start(t)},this.cleanup=()=>this.removeAllListeners(),this.quickUnpublish=()=>this.publishState!==cn.NOT_PUBLISHED&&this.publishState!==cn.ERRORED&&void this.publication.stop(!0),this.onIncompatibleCodecs=e=>Ou(this,void 0,void 0,function*(){yield this.publication.onIncompatibleCodecs(e)}),this.sendSeiMessage=(e,t=0)=>this.publication.sendSeiMessage(e,t),this.sendSeiMessageString=(e,t=0)=>{const i=new TextEncoder().encode(e);return this.publication.sendSeiMessage(i,t)},this.connection=l,this.createPublication=()=>{const e=new Wl(a,l,c,n);return e.on(Zn.STATE_CHANGE,this.onPublicationStateChange),e.on(Zn.ERROR,this.onPublicationError),e.on(Zn.TRANSFORM_ERROR,this.onPublicationError),e},this.publication=this.createPublication()}setupStreamListeners(r){r.on(gi.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),r.streamType===Je.VIDEO&&r.on(gi.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleInsertSeiMsgRequest)}removeTrack(r){var a,c,l;r.streamType===Je.AUDIO?((a=this.audioStream)===null||a===void 0||a.off(gi.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.audioStream=void 0,this.audioMuted=!0,this.info.audioMuted=!0):r.streamType===Je.VIDEO&&((c=this.videoStream)===null||c===void 0||c.off(gi.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),(l=this.videoStream)===null||l===void 0||l.off(gi.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleMute),this.videoStream=void 0,this.videoStopped=!0,this.info.videoStopped=!0),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.publication.removeTrack(r.streamType)}replaceOrAddTrack(r){return Ou(this,void 0,void 0,function*(){this.setupStreamListeners(r),r.setGetStats(this.publication.requestRTCStats),r.streamType===Je.AUDIO?(this.audioStream=r,this.audioMuted=!r.mediaStreamTrack.enabled):r.streamType===Je.VIDEO&&(this.videoStream=r,this.videoStopped=!r.mediaStreamTrack.enabled),this.connection.emitStageState(this.audioMuted,this.videoStopped);const a=$u(r);yield this.publication.replaceOrUpdateStream(a)})}unpublish(){if(this.publishState===cn.NOT_PUBLISHED||this.publishState===cn.ERRORED)return;this.logger.debug({msg:"unpublish"}),this.connection.setStagePublishing(!1),this.publication.stop(),this.publication.off(Zn.STATE_CHANGE,this.onPublicationStateChange),this.publication.off(Zn.ERROR,this.onPublicationError),this.publication.off(Zn.TRANSFORM_ERROR,this.onPublicationError);const r=[this.audioStream,this.videoStream].filter(a=>!!a);r.forEach(a=>{a.cleanup()}),this.audioStream=void 0,this.videoStream=void 0,this.emit(_o.MEDIA_STREAM_REMOVED,r),this.updatePublishState(cn.NOT_PUBLISHED),this.publication=this.createPublication()}}(function(s){s.STAGE_CONNECTION_STATE_CHANGED="stageConnectionStateChanged",s.STAGE_PARTICIPANT_JOINED="stageParticipantJoined",s.STAGE_PARTICIPANT_LEFT="stageParticipantLeft",s.STAGE_PARTICIPANT_STREAMS_ADDED="stageParticipantStreamsAdded",s.STAGE_PARTICIPANT_STREAMS_REMOVED="stageParticipantStreamsRemoved",s.STAGE_STREAM_MUTE_CHANGED="stageStreamMuteChanged",s.STAGE_STREAM_SEI_MESSAGE_RECEIVED="stageStreamSeiMessageReceived",s.STAGE_STREAM_LAYERS_CHANGED="stageStreamLayersChanged",s.STAGE_STREAM_LAYER_SELECTED="stageStreamLayerSelected",s.STAGE_STREAM_ADAPTION_CHANGED="stageStreamAdaptionChanged",s.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED="stageParticipantSubscribeStateChanged",s.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED="stageParticipantPublishStateChanged",s.ERROR="error",s.STAGE_LEFT="stageLeft"})(Wt||(Wt={}));var oa=function(s,r,a,c){return new(a||(a=Promise))(function(l,n){function e(o){try{i(c.next(o))}catch(u){n(u)}}function t(o){try{i(c.throw(o))}catch(u){n(u)}}function i(o){var u;o.done?l(o.value):(u=o.value,u instanceof a?u:new a(function(d){d(u)})).then(e,t)}i((c=c.apply(s,[])).next())})};const Ya=s=>!!s;class Au extends lt{constructor(r,a){super(),this.connectionState=Lt.DISCONNECTED,this.participants=new Map,this.connectionStateErrored=!1,this.onConnectionStateChanged=(l,n)=>{var e,t;if(this.connectionState=l,l===Lt.ERRORED&&(this.connectionStateErrored=!0),l===Lt.CONNECTED&&this.localParticipant&&this.localParticipant.publishState!==cn.NOT_PUBLISHED&&this.stageConnection.emitStageState((e=this.localParticipant)===null||e===void 0?void 0:e.audioMuted,(t=this.localParticipant)===null||t===void 0?void 0:t.videoStopped),l===Lt.CONNECTED&&this.connectionStateErrored&&(this.connectionStateErrored=!1,this.refreshStrategy()),l===Lt.DISCONNECTED){if(n&&n!==Gn.CLIENT_RECONNECT&&n!==Gn.USER_INITIATED){let i=Eo.UNKNOWN;(function(o){return Object.values(Eo).includes(o)})(n)?i=n:this.logger.warn({msg:`DISCONNECTED reason is not a StageLeftReason: ${n}`}),this.cleanup(i)}}else this.emit(Wt.STAGE_CONNECTION_STATE_CHANGED,this.connectionState)},this.setupLocalParticipantOnce=()=>{var l;this.localParticipant?this.analyticsTracker.trackEventNoSharedProps(new lo(this.token,(l=this.joinTraceId)!==null&&l!==void 0?l:new Uu,"reusing local participant from repeat join",ve.JOIN,"")):this.createLocalParticipant()},this.createLocalParticipant=()=>{const l=function(n){var e,t;const i=new Set;return n.token.claims.capabilities.allow_publish&&i.add(mi.PUBLISH),n.token.claims.capabilities.allow_subscribe&&i.add(mi.SUBSCRIBE),{id:n.token.participantID,userId:(e=n.token.userID)!==null&&e!==void 0?e:"",attributes:(t=n.token.claims.attributes)!==null&&t!==void 0?t:{},capabilities:i,isLocal:!0,userInfo:{},videoStopped:n.videoStopped,audioMuted:n.audioMuted,isPublishing:n.isPublishing}}({token:this.token,videoStopped:!0,audioMuted:!0,isPublishing:!1});this.localParticipant=new Hl(l,this.token,this.logger.unwrap(),this.stageConnection,this.analyticsTracker),this.localParticipant.on(_o.PUBLICATION_STATE_CHANGE,n=>{this.onPublishStateChanged(this.localParticipant.info,n)}),this.localParticipant.on(_o.MEDIA_STREAM_REMOVED,this.onLocalStreamsRemoved),this.localParticipant.on(_o.MEDIA_STREAM_MUTE_CHANGED,n=>{this.localParticipant?this.onStreamMuteChange(this.localParticipant.info,n):this.logger.warn({msg:"tried to emit a stream mute change event for undefined local participant"})}),this.localParticipant.on(_o.ERROR,n=>{this.errorManager.handleError(n,pt.PUBLISH_ERROR)}),this.emit(Wt.STAGE_PARTICIPANT_JOINED,l)},this.onRemoteParticipantJoined=l=>{if(l.id!==this.token.participantID){const n=function(o){return{id:o.id,userId:o.userId,attributes:o.attributes,capabilities:new Set([mi.SUBSCRIBE]),isLocal:!1,userInfo:{},videoStopped:o.videoStopped,audioMuted:o.audioMuted,isPublishing:o.isPublishing}}(l);if(this.participants.has(n.id))return void this.logger.warn({msg:"Remote participant already tracked"});let e=Ne.NONE;n.capabilities.has(mi.SUBSCRIBE)&&(e=Re.getOk_or(this.strategyWrapper.shouldSubscribeToParticipant(n),e),this.updateManagerWithExternalSubscribeConfig(n,"joined"));const t=this.configManager.getSubscribeConfigSnapshot(n.id),i=new Xn(n,this.token,this.stageConnection,this.logger.unwrap(),e,t,this.analyticsTracker,l.isPublishing);this.participants.set(n.id,i),this.setupRemoteParticipantListeners(i),this.emit(Wt.STAGE_PARTICIPANT_JOINED,i.info),i.updateSubscribeStateIfNecessary(e)}},this.setupRemoteParticipantListeners=l=>{l.on(Hn.SUBSCRIPTION_STATE_CHANGE,n=>{this.onParticipantSubscribeStateChanged(l.info.id,n)}),l.on(Hn.MEDIA_STREAM_ADDED,n=>{const e=this.participants.get(l.info.id);if(e){for(const t of n)this.setupRemoteParticipantStreamEvents(e.info,t);this.emit(Wt.STAGE_PARTICIPANT_STREAMS_ADDED,e.info,rl(n)),this.updateStreamLayerForParticipantInfo(l.info,l.streams)}else this.logger.warn({msg:"Got stream add for participant no longer being tracked"})}),l.on(Hn.MEDIA_STREAM_REMOVED,n=>{const e=this.participants.get(l.info.id);e?this.emit(Wt.STAGE_PARTICIPANT_STREAMS_REMOVED,e.info,rl(n)):this.logger.warn({msg:"Got stream remove for participant no longer being tracked"})}),l.on(Hn.MEDIA_STREAM_MUTE_CHANGED,n=>{this.onStreamMuteChange(l.info,n.remote)}),l.on(Hn.ERROR,n=>{this.errorManager.handleError(n,pt.SUBSCRIBE_ERROR)}),l.on(Hn.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,n=>{this.onSeiMessageReceived(l.info,n)})},this.onRemoteParticipantLeft=l=>{if(this.connectionState!==Lt.CONNECTED)return;const n=this.participants.get(l);n?(n.participantLeave(),n.unsubscribe(),n.cleanup(),this.participants.delete(l),this.emitParticipantLeave(n.info)):this.logger.warn({msg:"Remote participant no longer tracked"})},this.emitParticipantLeave=l=>{this.emit(Wt.STAGE_PARTICIPANT_LEFT,l)},this.onRemoteParticipantStateChanged=l=>{const n=this.participants.get(l.id);if(!n)return void this.logger.warn({msg:"Remote participant updated but not tracked"});n.updatePublishState(l.isPublishing)&&this.onPublishStateChanged(n.info,n.publishState),n.updateStreamState(l.audioMuted,l.videoStopped);const e=this.strategyWrapper.shouldSubscribeToParticipant(n.info);if(Re.isNotOk(e))return;this.updateManagerWithExternalSubscribeConfig(n.info,"updated");const t=this.configManager.getSubscribeConfigSnapshot(n.info.id),i=Re.getOk_or(e,Ne.NONE);n.updateSubscribeStateIfNecessary(i,t)},this.onPublishStateChanged=(l,n)=>{this.emit(Wt.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED,l,n)},this.onParticipantSubscribeStateChanged=(l,n)=>{const e=this.participants.get(l);e?this.emit(Wt.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED,e.info,n):this.logger.warn({msg:"Remote participant subscribe state changed but not tracked"})},this.onLocalStreamsAdded=l=>{this.localParticipant&&this.emit(Wt.STAGE_PARTICIPANT_STREAMS_ADDED,this.localParticipant.info,l)},this.onLocalStreamsRemoved=l=>{this.localParticipant&&this.emit(Wt.STAGE_PARTICIPANT_STREAMS_REMOVED,this.localParticipant.info,l)},this.onStreamMuteChange=(l,n)=>{this.emit(Wt.STAGE_STREAM_MUTE_CHANGED,l,n)},this.onSeiMessageReceived=(l,n)=>{this.emit(Wt.STAGE_STREAM_SEI_MESSAGE_RECEIVED,l,n)},this.leave=()=>{this.cleanup(Eo.USER_INITIATED)},this.onBeforeUnloadCleanup=()=>{var l;this.participants.forEach(n=>{n.quickUnsubscribe()}),(l=this.localParticipant)===null||l===void 0||l.quickUnpublish(),this.stageConnection.disconnect(),this.emit(Wt.STAGE_CONNECTION_STATE_CHANGED,Lt.DISCONNECTED),this.analyticsTracker.stop(!0)},this.cleanup=l=>{if(!this.localParticipant)return;this.analyticsTracker.trackEventNoSharedProps(new jo({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId,reason:l})),this.localParticipant.unpublish(),this.localParticipant.cleanup();const n=this.localParticipant.info;this.localParticipant=void 0,this.emitParticipantLeave(n);const e=this.participants.entries();for(const[t,i]of e)i.unsubscribe(),this.participants.delete(t),i.cleanup(),this.emitParticipantLeave(i.info);hi.destroy(this.analyticsTracker.getSessionId()),this.stageConnection.disconnect(),this.emit(Wt.STAGE_CONNECTION_STATE_CHANGED,Lt.DISCONNECTED),this.emit(Wt.STAGE_LEFT,l),this.analyticsTracker.stop(!1),window.removeEventListener("beforeunload",this.onBeforeUnloadCleanup)},this.refreshStrategy=()=>{this.participants.forEach(l=>{if(l.info.capabilities.has(mi.SUBSCRIBE)){const n=this.strategyWrapper.shouldSubscribeToParticipant(l.info);if(Re.isNotOk(n))return;const e=Re.getOk_or(n,Ne.NONE);this.updateManagerWithExternalSubscribeConfig(l.info,"updated");const t=this.configManager.getSubscribeConfigSnapshot(l.info.id);l.updateSubscribeStateIfNecessary(e,t),this.updateStreamLayerForParticipantInfo(l.info,l.streams)}}),this.updateStreamsToPublishIfNecessary()},this.updateStreamsToPublishIfNecessary=()=>{var l;if(!this.localParticipant||!(!((l=this.localParticipant)===null||l===void 0)&&l.info.capabilities.has(mi.PUBLISH)))return;const n=this.localParticipant.publishState!==cn.NOT_PUBLISHED&&this.localParticipant.publishState!==cn.ERRORED,e=this.strategyWrapper.shouldPublishParticipant(this.localParticipant.info);if(Re.isNotOk(e))return;let t=Re.getOk_or(e,!1);if(!n&&!t)return;if(n&&!t)return void this.localParticipant.unpublish();const i=this.strategyWrapper.stageStreamsToPublish();if(Re.isNotOk(i)){const u=Re.getErr(i);if(u instanceof Error&&u.cause==="UserStrategy")throw u;return}const o=Re.getOk_or(i,[]);t=t&&o.length>0,!n&&t?(this.localParticipant.publish(o),this.onLocalStreamsAdded(o)):this.syncTracksToPublish(o)},this.syncTracksToPublish=l=>{var n;if(!this.localParticipant)return;const e=this.localParticipant.audioStream,t=this.localParticipant.videoStream,{updates:i,streamsToAdd:o,streamsToRemove:u}=this.determineStreamUpdates(e,t,l);if(i.length){for(const d of i)d.newStream?(n=this.localParticipant)===null||n===void 0||n.replaceOrAddTrack(d.newStream):d.oldStream&&this.localParticipant.removeTrack(d.oldStream);u.length!==0&&this.onLocalStreamsRemoved(u),o.length!==0&&this.onLocalStreamsAdded(o)}},this.determineStreamUpdates=(l,n,e=[])=>{const t=[],i=e.slice(0,2);if(i.sort((d,h)=>d.streamType===Je.AUDIO?-1:1),i.length===0)l&&t.push({oldStream:l}),n&&t.push({oldStream:n});else if(i.length===1){const d=i[0];d.streamType===Je.AUDIO?n&&t.push({oldStream:n}):d.streamType===Je.VIDEO&&l&&t.push({oldStream:l})}i.forEach(d=>{var h,_;d.streamType===Je.AUDIO?l?l.id===d.id&&(0,qt.isEqual)(l.mediaConfig,d.mediaConfig)||(!!(!((h=l.mediaConfig)===null||h===void 0)&&h.stereo)!=!!(!((_=d.mediaConfig)===null||_===void 0)&&_.stereo)&&this.logger.warn({msg:"Ignoring change to audio stream's stereo configuration. Re-publish to change stereo configuraiton."}),t.push({oldStream:l,newStream:d})):t.push({newStream:d}):d.streamType===Je.VIDEO&&(n?n.id===d.id&&(0,qt.isEqual)(n.mediaConfig,d.mediaConfig)||t.push({oldStream:n,newStream:d}):t.push({newStream:d}))});const o=t.map(d=>d.newStream).filter(Ya),u=t.map(d=>d.oldStream).filter(Ya);return{updates:t,streamsToAdd:o,streamsToRemove:u}},this.onReassignmentMessage=l=>oa(this,void 0,void 0,function*(){if(ln("disableReassignments"))return void this.logger.debug({msg:"REASSIGN message ignored: disableReassignments is configured"});if(!Ai.browser.isChrome())return void this.logger.debug({msg:"REASSIGN message ignored: browser is not chrome"});const n=Jn();this.trackReassignmentRequest(l,n);const e=this.participants.get(l.remoteParticipantId),t=this.token.participantID,i=function(o,{localParticipantId:u,remoteParticipant:d}){const{participantId:h}=o;if(u!==h)return Re.err(Object.assign(Object.assign({},de.REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID),{details:`Invalid participantId received: ${h}`}));if(!d)return Re.err(Object.assign(Object.assign({},de.REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID),{details:`Invalid remoteParticipantId received: ${d}`}));if(d.isReassigning())return Re.err(de.REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS);const _=d.subscription.peerClient.getConnectionState();return[xe.CONNECTED,xe.DISCONNECTED].includes(_)?Re.ok(d):Re.err(Object.assign(Object.assign({},de.REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE),{details:`connectionState: ${_}`}))}(l,{localParticipantId:t,remoteParticipant:e});if(!i.ok)this.trackReassignmentRequestRejected(i.error,n);else try{const{token:o,nodeOverride:u}=l;yield i.value.triggerIceRestart({assignmentToken:o,traceId:n,nodeOverride:u})}catch(o){this.logger.error({msg:"Reassignment failed.",err:o})}}),this.onIncompatibleCodecsMessage=l=>oa(this,void 0,void 0,function*(){var n;yield(n=this.localParticipant)===null||n===void 0?void 0:n.onIncompatibleCodecs(l.codecs)}),this.analyticsTracker=new _s;const c=Zs();this.logger=new Ze(new Pe(c),Ft.STAGE),this.strategyWrapper=new Tu(a,this.logger),this.configManager=new Fl({logger:this.logger.unwrap(),subscribeDefaults:{jitterBuffer:{minDelayWhenPublishing:Fn.DEFAULT,minDelayWhenSubscribeOnly:Fn.DEFAULT},inBandMessaging:{enabled:!1},simulcast:{initialLayerPreference:Na.LOWEST_QUALITY,layerPollingEnabled:!0,layerPollingIntervalMs:3e3}}}),this.errorManager=new yu(this.logger.unwrap());try{this.token=dc(r,this.analyticsTracker)}catch(l){const n=new ze(Object.assign({action:ve.JOIN,token:r,traceId:Jn(),tag:si,location:"Stage.constructor"},de.MALFORMED_TOKEN));throw l instanceof Error&&(n.details=l.message),this.errorManager.handleError(n,pt.JOIN_ERROR)||l}this.stageConnection=new Us(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners()}setupListeners(){this.stageConnection.on(_n,(r,a)=>{this.onConnectionStateChanged(r,a)}),this.stageConnection.on(cc,r=>{this.onRemoteParticipantJoined(r)}),this.stageConnection.on(so,r=>{this.onRemoteParticipantLeft(r.id)}),this.stageConnection.on(yi,r=>{var a;r.id!==((a=this.localParticipant)===null||a===void 0?void 0:a.info.id)&&this.onRemoteParticipantStateChanged(r)}),this.stageConnection.on(_r,r=>oa(this,void 0,void 0,function*(){yield this.onReassignmentMessage(r)})),this.stageConnection.on(an,r=>oa(this,void 0,void 0,function*(){yield this.onIncompatibleCodecsMessage(r)})),this.stageConnection.on(Ia,r=>{r instanceof ze&&this.analyticsTracker.trackError(r),this.errorManager.handleError(r,pt.JOIN_ERROR)}),this.errorManager.on(Fc.ERROR,r=>{this.emit(Wt.ERROR,r)})}setupRemoteParticipantStreamEvents(r,a){const c=a.remote;a.on(ct.ADAPTION_CHANGED,l=>{this.emit(Wt.STAGE_STREAM_ADAPTION_CHANGED,r,c,l)}),a.on(ct.LAYERS_CHANGED,l=>{this.emit(Wt.STAGE_STREAM_LAYERS_CHANGED,r,c,l),this.updateStreamLayerForParticipantInfo(r,[a])}),a.on(ct.LAYER_SELECTED,(l,n)=>{this.emit(Wt.STAGE_STREAM_LAYER_SELECTED,r,c,l,n)}),a.layers.length>0&&(this.emit(Wt.STAGE_STREAM_LAYERS_CHANGED,r,c,c.getLayers()),this.emit(Wt.STAGE_STREAM_LAYER_SELECTED,r,c,c.getSelectedLayer(),ra.SELECTED))}join(){return oa(this,void 0,void 0,function*(){this.analyticsTracker.start(),this.joinTraceId=Jn(),this.analyticsTracker.trackEvent(new Ml({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId}));try{this.token.assertTokenIsUnexpired(Jn(),si,"join")}catch(r){throw this.errorManager.handleError(r,pt.JOIN_ERROR)||r}try{this.joinTraceId=yield this.stageConnection.connect(this.joinTraceId),this.connectionState===Lt.CONNECTED&&(this.setupLocalParticipantOnce(),this.updateStreamsToPublishIfNecessary()),window.addEventListener("beforeunload",this.onBeforeUnloadCleanup)}catch(r){throw this.logger.error({err:r,msg:"error joining stage"}),this.errorManager.handleError(r,pt.JOIN_ERROR,!1)||r}})}replaceStrategy(r){this.strategyWrapper.setStrategy(r),this.refreshStrategy()}updateManagerWithExternalSubscribeConfig(r,a){var c;const l=Re.getOk(this.strategyWrapper.subscribeConfiguration(r)),n=Re.getOk(this.getRemoteSubscribeConfiguration()),e=this.getInternalSubscribeOverrides(),t=r.id;let i=!1;l&&(i=this.configManager.handleExternalSubscribeConfigUpdate(t,l,vo.API));let o=!1;n&&(o=this.configManager.handleSubscribeConfigUpdate(t,n,vo.REMOTE));let u=!1;if(e&&(u=this.configManager.handleSubscribeConfigUpdate(t,e,vo.INTERNAL)),i||o||u){const d=this.configManager.getSubscribeConfigSnapshot(t);this.analyticsTracker.trackEventNoSharedProps(new qu(this.token,(c=this.joinTraceId)!==null&&c!==void 0?c:Jn(),a==="joined"?"initial":"ad-hoc",t,d))}}getRemoteSubscribeConfiguration(){return Re.err("todo")}getInternalSubscribeOverrides(){const r=this.strategyWrapper.hasStrategy("preferredLayerForStream"),a=this.hasListenersFor(Wt.STAGE_STREAM_LAYERS_CHANGED)||this.hasListenersFor(Wt.STAGE_STREAM_ADAPTION_CHANGED)||this.hasListenersFor(Wt.STAGE_STREAM_LAYER_SELECTED);return{simulcast:{layerPollingEnabled:r||a}}}updateStreamLayerForParticipantInfo(r,a){a.forEach(c=>{if(c.streamType==="audio")return;const l=this.strategyWrapper.preferredLayerForStream(r,c.remote),n=Re.getOk_or(l,void 0);c.setLayer(n)})}trackReassignmentRequestRejected(r,a){const{token:c}=this,l=new ze(Object.assign(Object.assign({},r),{token:c,action:ve.JOIN,traceId:a,tag:ir,location:"publish"}));this.logger.error({err:l,msg:"Reassignment request rejected."}),this.analyticsTracker.trackError(l)}trackReassignmentRequest(r,a){const{token:c}=this;this.analyticsTracker.trackEvent(new Vl({token:c,traceId:a,targetLocalParticipantId:r.participantId,targetRemoteParticipantId:r.remoteParticipantId}))}}var Eo;(function(s){s.UNKNOWN="unknown",s.USER_INITIATED="user-initiated",s.TOKEN_REUSED="token-reused",s.PARTICIPANT_DISCONNECTED="participant-disconnected",s.STAGE_DELETED="stage-deleted"})(Eo||(Eo={}));const $l=y})(),je})())})(sd);var Dn=sd.exports;class _d{constructor(N,F){tt(this,"config");tt(this,"callbacks");tt(this,"localStreams",[]);tt(this,"localStream",null);tt(this,"isPublishing",!1);tt(this,"isLocalAudioEnabled",!0);tt(this,"isLocalVideoEnabled",!0);tt(this,"defaultVideoResolution",{width:1280,height:720});this.config=N,this.callbacks=F}async startPublishing(){try{if(this.localStream&&(this.localStream.getTracks().forEach(N=>N.stop()),this.localStream=null),this.localStreams.forEach(N=>{var F;return(F=N.mediaStreamTrack)==null?void 0:F.stop()}),this.localStreams=[],this.config.videoInputDeviceId){const F=(await pd(this.config.videoInputDeviceId,this.defaultVideoResolution.width,this.defaultVideoResolution.height)).getVideoTracks()[0];if(F){const Z=this.config.enableInBandMessaging!==!1?{inBandMessaging:{enabled:!0}}:void 0;F.enabled=this.isLocalVideoEnabled,this.localStreams.push(new Dn.LocalStageStream(F,Z))}}if(this.config.audioInputDeviceId){const F=(await od(this.config.audioInputDeviceId)).getAudioTracks()[0];F&&(F.enabled=this.isLocalAudioEnabled,this.localStreams.push(new Dn.LocalStageStream(F)))}if(this.localStreams.length>0&&(this.localStream=new MediaStream(this.localStreams.map(N=>N.mediaStreamTrack).filter(N=>N)),this.callbacks.onLocalStreamReady&&this.callbacks.onLocalStreamReady(this.localStream),this.config.localVideoElement&&this.localStream)){this.config.localVideoElement.srcObject=this.localStream,this.config.localVideoElement.muted=!0,this.config.localVideoElement.playsInline=!0;try{await this.config.localVideoElement.play()}catch(N){console.warn("Failed to play local video:",N)}}this.isPublishing=!0,this.callbacks.onPublishingStarted&&this.callbacks.onPublishingStarted()}catch(N){throw console.error("Failed to start publishing:",N),this.callbacks.onError&&this.callbacks.onError(N),N}}stopPublishing(){this.localStream&&(this.localStream.getTracks().forEach(N=>N.stop()),this.localStream=null),this.localStreams.forEach(N=>{var F;return(F=N.mediaStreamTrack)==null?void 0:F.stop()}),this.localStreams=[],this.isPublishing=!1,this.callbacks.onPublishingStopped&&this.callbacks.onPublishingStopped()}toggleVideo(){this.setLocalVideoEnabled(!this.isLocalVideoEnabled)}toggleAudio(){this.setLocalAudioEnabled(!this.isLocalAudioEnabled)}setLocalAudioEnabled(N){var Z;this.isLocalAudioEnabled=N;const F=(Z=this.localStreams.find(ue=>{var je;return((je=ue.mediaStreamTrack)==null?void 0:je.kind)==="audio"}))==null?void 0:Z.mediaStreamTrack;N&&!F&&this.config.audioInputDeviceId?od(this.config.audioInputDeviceId).then(ue=>{const je=ue.getAudioTracks()[0];je&&(this.localStreams.push(new Dn.LocalStageStream(je)),this.localStream?this.localStream.addTrack(je):this.localStream=new MediaStream([je]),this.config.localVideoElement&&(this.config.localVideoElement.srcObject=this.localStream,this.config.localVideoElement.play().catch(()=>{})),this.callbacks.onAudioToggled&&this.callbacks.onAudioToggled(!0))}).catch(()=>{this.callbacks.onAudioToggled&&this.callbacks.onAudioToggled(!1)}):F&&(F.enabled=N,this.callbacks.onAudioToggled&&this.callbacks.onAudioToggled(N))}setLocalVideoEnabled(N){if(this.isLocalVideoEnabled=N,!this.localStream)return;const F=this.localStream.getVideoTracks()[0];F&&(F.enabled=N,this.callbacks.onVideoToggled&&this.callbacks.onVideoToggled(N))}getStreams(){return this.localStreams.filter(F=>{const Z=F.mediaStreamTrack;return Z?Z.kind==="audio"?this.isLocalAudioEnabled&&Z.enabled&&Z.readyState==="live":this.isLocalVideoEnabled&&Z.enabled&&Z.readyState==="live":(console.log("Stream has no mediaStreamTrack"),!1)})}getRawVideoStream(){return this.localStreams.find(N=>{var F;return((F=N.mediaStreamTrack)==null?void 0:F.kind)==="video"})??null}shouldPublish(){return this.config.role==="admin"||this.config.role==="user"&&this.isPublishing}getLocalStream(){return this.localStream}}class Sd{constructor(N,F,Z){tt(this,"config");tt(this,"callbacks");tt(this,"mediaManager");tt(this,"canvases",new Map);tt(this,"resizeObservers",new Map);tt(this,"animationFrameId",null);tt(this,"lastRender",0);tt(this,"targetFps",15);tt(this,"isSafari",/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent));this.config=N,this.callbacks=F,this.mediaManager=Z}addParticipant(){this.startRenderLoop()}removeParticipant(N){this.removeCanvas(N),this.canvases.size===0&&this.stopRenderLoop()}createCanvas(N,F){var v,m,y;const Z=document.createElement("canvas");Z.id=`participant-canvas-${N}`,Z.style.width="100%",Z.style.height="100%",Z.style.display="block",Z.style.objectFit="cover",(v=this.config.canvasConfig)!=null&&v.style&&Object.assign(Z.style,this.config.canvasConfig.style);const ue=window.devicePixelRatio||1,je=F.getBoundingClientRect(),O=(je.width||((m=this.config.canvasConfig)==null?void 0:m.width)||640)*ue,k=(je.height||((y=this.config.canvasConfig)==null?void 0:y.height)||480)*ue;Z.width=O,Z.height=k;const p=Z.getContext("2d");return p&&(p.scale(ue,ue),p.imageSmoothingEnabled=!0,p.imageSmoothingQuality=this.isSafari?"medium":"high"),this.canvases.set(N,Z),F.appendChild(Z),this.setupResizeObserver(N,Z,F),this.callbacks.onParticipantCanvasCreated&&this.callbacks.onParticipantCanvasCreated(N,Z),Z}removeCanvas(N){const F=this.resizeObservers.get(N);F&&(F.disconnect(),this.resizeObservers.delete(N));const Z=this.canvases.get(N);Z&&Z.parentNode&&Z.parentNode.removeChild(Z),this.canvases.delete(N),this.callbacks.onParticipantCanvasRemoved&&this.callbacks.onParticipantCanvasRemoved(N)}setupResizeObserver(N,F,Z){const ue=()=>{var y,E;const O=window.devicePixelRatio||1,k=Z.getBoundingClientRect(),p=(k.width||((y=this.config.canvasConfig)==null?void 0:y.width)||640)*O,v=(k.height||((E=this.config.canvasConfig)==null?void 0:E.height)||480)*O;F.width=p,F.height=v;const m=F.getContext("2d");m&&(m.scale(O,O),m.imageSmoothingEnabled=!0,m.imageSmoothingQuality=this.isSafari?"medium":"high")};if(ue(),typeof ResizeObserver>"u"){console.warn("ResizeObserver is not supported, falling back to window resize listener");const O=()=>ue();window.addEventListener("resize",O),this.resizeObservers.set(N,{disconnect:()=>window.removeEventListener("resize",O),observe:()=>{},unobserve:()=>{}});return}const je=new ResizeObserver(()=>ue());je.observe(Z),this.resizeObservers.set(N,je)}startRenderLoop(){if(this.animationFrameId)return;const N=()=>{const F=performance.now();if(F-this.lastRender<1e3/this.targetFps){this.animationFrameId=requestAnimationFrame(N);return}this.lastRender=F,this.canvases.forEach((Z,ue)=>this.renderCanvas(ue,Z)),this.animationFrameId=requestAnimationFrame(N)};this.animationFrameId=requestAnimationFrame(N)}stopRenderLoop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}renderCanvas(N,F){const Z=F.getContext("2d");if(!Z)return;const ue=window.devicePixelRatio||1,je=F.width/ue,O=F.height/ue;Z.clearRect(0,0,je,O),Z.fillStyle="#3c4043",Z.fillRect(0,0,je,O);const k=this.mediaManager.media.get(N),p=k==null?void 0:k.videoElement;if(p&&p.videoWidth>0&&p.videoHeight>0&&p)try{const m=Math.min(je/p.videoWidth,O/p.videoHeight),y=p.videoWidth*m,E=p.videoHeight*m,I=(je-y)/2,S=(O-E)/2;Z.drawImage(p,I,S,y,E)}catch(m){console.warn(`Failed to draw video for ${N}:`,m),this.renderAvatar(Z,N,je,O)}else this.renderAvatar(Z,N,je,O);this.renderBottomInfo(Z,N,je,O)}renderAvatar(N,F,Z,ue){N.fillStyle="#222",N.fillRect(0,0,Z,ue);const je=F.slice(0,2).toUpperCase();N.fillStyle="#555",N.beginPath();const O=Math.min(Z,ue)*.28;N.arc(Z/2,ue/2-8,O,0,Math.PI*2),N.fill(),N.fillStyle="#ddd",N.font=`${Math.floor(O*.9)}px sans-serif`,N.textAlign="center",N.textBaseline="middle",N.fillText(je,Z/2,ue/2-8)}renderBottomInfo(N,F,Z,ue){N.fillStyle="rgba(0,0,0,0.6)",N.fillRect(0,ue-40,Z,40),N.fillStyle="#fff",N.font="12px sans-serif",N.textAlign="left",N.textBaseline="middle",N.fillText(F,8,ue-20);const je=this.mediaManager.getVolume(F),O=Math.min(1,je)*(Z-16);O>0&&(N.fillStyle=je>.7?"#ea4335":je>.3?"#fbbc04":"#34a853",N.fillRect(8,ue-8,O,4))}getCanvases(){return new Map(this.canvases)}getCanvas(N){return this.canvases.get(N)||null}cleanup(){this.canvases.forEach((N,F)=>this.removeCanvas(F)),this.stopRenderLoop()}}class Ed{constructor(N,F,Z,ue){tt(this,"config");tt(this,"callbacks");tt(this,"publishManager");tt(this,"subscriptionManager");tt(this,"stage",null);tt(this,"handlers",{});this.config=N,this.callbacks=F,this.publishManager=Z,this.subscriptionManager=ue}setEventHandlers(N){this.handlers=N}async initialize(){try{this.stage=new Dn.Stage(this.config.token,this.createStrategy()),this.registerEvents(),await this.stage.join()}catch(N){throw console.error("Stage initialization failed:",N),N}}createStrategy(){return{stageStreamsToPublish:()=>this.publishManager.getStreams(),shouldPublishParticipant:()=>this.publishManager.shouldPublish(),shouldSubscribeToParticipant:N=>this.subscriptionManager.getSubscribeType(N),subscribeConfiguration:this.config.enableInBandMessaging!==!1?()=>({inBandMessaging:{enabled:!0}}):void 0}}registerEvents(){this.stage&&(this.handlers.onConnectionStateChanged&&this.stage.on(Dn.StageEvents.STAGE_CONNECTION_STATE_CHANGED,this.handlers.onConnectionStateChanged),this.handlers.onParticipantJoined&&this.stage.on(Dn.StageEvents.STAGE_PARTICIPANT_JOINED,this.handlers.onParticipantJoined),this.handlers.onParticipantLeft&&this.stage.on(Dn.StageEvents.STAGE_PARTICIPANT_LEFT,this.handlers.onParticipantLeft),this.handlers.onParticipantStreamsAdded&&this.stage.on(Dn.StageEvents.STAGE_PARTICIPANT_STREAMS_ADDED,this.handlers.onParticipantStreamsAdded),this.handlers.onParticipantStreamsRemoved&&this.stage.on(Dn.StageEvents.STAGE_PARTICIPANT_STREAMS_REMOVED,this.handlers.onParticipantStreamsRemoved),this.handlers.onStreamSeiMessageReceived&&this.config.enableInBandMessaging!==!1&&this.stage.on(Dn.StageEvents.STAGE_STREAM_SEI_MESSAGE_RECEIVED,this.handlers.onStreamSeiMessageReceived))}unregisterEvents(){this.stage&&(this.handlers.onConnectionStateChanged&&this.stage.off(Dn.StageEvents.STAGE_CONNECTION_STATE_CHANGED,this.handlers.onConnectionStateChanged),this.handlers.onParticipantJoined&&this.stage.off(Dn.StageEvents.STAGE_PARTICIPANT_JOINED,this.handlers.onParticipantJoined),this.handlers.onParticipantLeft&&this.stage.off(Dn.StageEvents.STAGE_PARTICIPANT_LEFT,this.handlers.onParticipantLeft),this.handlers.onParticipantStreamsAdded&&this.stage.off(Dn.StageEvents.STAGE_PARTICIPANT_STREAMS_ADDED,this.handlers.onParticipantStreamsAdded),this.handlers.onParticipantStreamsRemoved&&this.stage.off(Dn.StageEvents.STAGE_PARTICIPANT_STREAMS_REMOVED,this.handlers.onParticipantStreamsRemoved),this.handlers.onStreamSeiMessageReceived&&this.stage.off(Dn.StageEvents.STAGE_STREAM_SEI_MESSAGE_RECEIVED,this.handlers.onStreamSeiMessageReceived))}refreshStrategy(){try{this.stage?this.stage.refreshStrategy():console.error("Stage is null, cannot refresh strategy")}catch(N){console.error("Failed to refresh strategy:",N)}}leave(){var N;this.unregisterEvents(),(N=this.stage)==null||N.leave(),this.stage=null}handleConnectionStateChanged(N){if(N===Dn.StageConnectionState.CONNECTED&&this.callbacks.onConnected){this.callbacks.onConnected();return}if(N===Dn.StageConnectionState.DISCONNECTED&&this.callbacks.onDisconnected){this.callbacks.onDisconnected();return}N===Dn.StageConnectionState.ERRORED&&this.callbacks.onError&&this.callbacks.onError(new Error("Stage connection errored"))}}class yd{constructor(N,F,Z){tt(this,"callbacks");tt(this,"mediaManager");tt(this,"participantManager");tt(this,"intervalId",null);this.callbacks=N,this.mediaManager=F,this.participantManager=Z}start(){this.stop(),this.intervalId=window.setInterval(()=>{this.mediaManager.media.forEach((N,F)=>{const Z=this.participantManager.getSelfId();if(F===Z)return;const{analyser:ue,volume:je}=N;if(!ue)return;const O=new Uint8Array(ue.fftSize);ue.getByteTimeDomainData(O);let k=0;for(let v=0;v<O.length;v++){const m=(O[v]-128)/128;k+=m*m}const p=Math.min(1,Math.sqrt(k/O.length)*2);N.volume=je*.6+p*.4,Math.abs(N.volume-je)>.02&&this.callbacks.onParticipantVolumeChanged&&this.callbacks.onParticipantVolumeChanged(F,N.volume)})},500)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}}class bd{constructor(){tt(this,"subscriptions",new Map)}setSubscription(N,F){const Z=this.subscriptions.get(N)||{video:!0,audio:!0};this.subscriptions.set(N,{video:F.video??Z.video,audio:F.audio??Z.audio})}getSubscription(N){return this.subscriptions.get(N)||null}removeSubscription(N){this.subscriptions.delete(N)}getSubscribeType(N){const F=this.getSubscription(N.id)||{video:!0,audio:!0};return F.video&&F.audio||F.video?Dn.SubscribeType.AUDIO_VIDEO:F.audio?Dn.SubscribeType.AUDIO_ONLY:Dn.SubscribeType.NONE}}class Td{constructor(N,F={}){tt(this,"config");tt(this,"callbacks");tt(this,"stageManager");tt(this,"publishManager");tt(this,"participantManager");tt(this,"subscriptionManager");tt(this,"mediaManager");tt(this,"commandManager");tt(this,"renderManager");tt(this,"statusMonitor");this.config=N,this.callbacks=F,this.subscriptionManager=new bd,this.publishManager=new _d(this.config,this.callbacks),this.participantManager=new vd(this.publishManager),this.mediaManager=new md(this.callbacks,this.subscriptionManager,this.participantManager),this.stageManager=new Ed(this.config,this.callbacks,this.publishManager,this.subscriptionManager),this.commandManager=new gd(this.config,this.callbacks,this.publishManager,this.mediaManager,this.participantManager),this.renderManager=new Sd(this.config,this.callbacks,this.mediaManager),this.statusMonitor=new yd(this.callbacks,this.mediaManager,this.participantManager),this.stageManager.setEventHandlers({onConnectionStateChanged:this.stageManager.handleConnectionStateChanged.bind(this.stageManager),onParticipantJoined:this.handleParticipantJoined.bind(this),onParticipantLeft:this.handleParticipantLeft.bind(this),onParticipantStreamsAdded:this.handleParticipantStreamsAdded.bind(this),onParticipantStreamsRemoved:this.handleParticipantStreamsRemoved.bind(this),onStreamSeiMessageReceived:this.config.enableInBandMessaging!==!1?this.commandManager.handleSeiMessage.bind(this.commandManager):void 0})}async initialize(){try{await this.stageManager.initialize(),this.statusMonitor.start(),this.callbacks.onInitialized&&this.callbacks.onInitialized()}catch(N){throw this.callbacks.onError&&this.callbacks.onError(N),N}}async startPublishing(){await this.publishManager.startPublishing(),this.stageManager.refreshStrategy();const N=this.participantManager.getSelfId();if(N){this.mediaManager.initializeParticipant(N);const F=this.publishManager.getLocalStream();F&&(console.log(`Force setting local stream to MediaManager for ${N}`),this.mediaManager.setLocalStream(N,F)),this.mediaManager.forceRefreshVideoElement(N),this.updateParticipantStatus()}}stopPublishing(){this.publishManager.stopPublishing(),this.updateParticipantStatus()}toggleVideo(){this.publishManager.toggleVideo(),this.updateParticipantStatus()}toggleAudio(){this.publishManager.toggleAudio(),this.updateParticipantStatus()}setLocalAudioEnabled(N){this.publishManager.setLocalAudioEnabled(N),this.updateParticipantStatus()}setLocalVideoEnabled(N){this.publishManager.setLocalVideoEnabled(N),this.updateParticipantStatus()}getParticipants(){return this.participantManager.getParticipants().map(N=>({id:N.id,role:N.role,isPublishing:N.isPublishing}))}getSelfId(){return this.participantManager.getSelfId()}leaveStage(){this.publishManager.stopPublishing(),this.stageManager.leave(),this.statusMonitor.stop(),this.renderManager.cleanup(),this.mediaManager.cleanupAll(),this.participantManager.clear(),this.callbacks.onStageLeft&&this.callbacks.onStageLeft()}setParticipantSubscription(N,F){this.subscriptionManager.setSubscription(N,F),this.mediaManager.updateSubscription(N),this.stageManager.refreshStrategy()}getParticipantSubscription(N){return this.subscriptionManager.getSubscription(N)}muteParticipantAudio(N){this.commandManager.muteAudio(N)}unmuteParticipantAudio(N){this.commandManager.unmuteAudio(N)}muteParticipantVideo(N){this.commandManager.muteVideo(N)}unmuteParticipantVideo(N){this.commandManager.unmuteVideo(N)}getParticipantVolume(N){return this.mediaManager.getVolume(N)}getParticipantCanvases(){return this.renderManager.getCanvases()}getParticipantCanvas(N){return this.renderManager.getCanvas(N)}createParticipantCanvas(N,F){return this.renderManager.createCanvas(N,F)}removeParticipantCanvas(N){this.renderManager.removeCanvas(N)}async broadcastCommand(N,F){return await this.commandManager.broadcastCommand(N,F)}getLocalStreamStatus(){const N=this.publishManager.getLocalStream(),{hasAudio:F,hasVideo:Z}=ed(N),ue=this.participantManager.getSelfId();return{hasAudio:F,hasVideo:Z,selfId:ue}}updateParticipantStatus(){const{hasAudio:N,hasVideo:F,selfId:Z}=this.getLocalStreamStatus(),ue={hasAudio:N,hasVideo:F,isActive:N||F,lastUpdated:Date.now()};Z&&(this.callbacks.onStreamStatusChanged&&Z&&this.callbacks.onStreamStatusChanged(Z,ue),this.commandManager.broadcastCommand({type:Ni.StatusUpdate,targetParticipantId:Z,data:{hasAudio:N,hasVideo:F}}))}handleParticipantJoined(N){this.participantManager.add(N),this.subscriptionManager.setSubscription(N.id,{video:!0,audio:!0}),this.mediaManager.initializeParticipant(N.id),this.renderManager.addParticipant(),this.callbacks.onParticipantJoined&&this.callbacks.onParticipantJoined(N.id,N.attributes)}handleParticipantLeft(N){this.participantManager.remove(N.id),this.subscriptionManager.removeSubscription(N.id),this.mediaManager.cleanup(N.id),this.renderManager.removeParticipant(N.id),this.callbacks.onParticipantLeft&&this.callbacks.onParticipantLeft(N.id)}handleParticipantStreamsAdded(N,F){const Z=this.mediaManager.addStreams(N.id,F);this.participantManager.checkSelfParticipant(N,F),this.mediaManager.attachStreams(N.id),this.callbacks.onRemoteStreamAdded&&this.callbacks.onRemoteStreamAdded(Z,N.id)}handleParticipantStreamsRemoved(N,F){this.mediaManager.removeStreams(N.id,F)||(this.mediaManager.cleanup(N.id),this.callbacks.onRemoteStreamRemoved&&this.callbacks.onRemoteStreamRemoved(N.id))}}exports.CommandType=Ni;exports.CommunicationSDK=Td;
